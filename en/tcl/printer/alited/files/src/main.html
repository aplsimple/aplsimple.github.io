<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>

<title>main.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>README.md</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">main.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#main.tcl">main.tcl</a></b></li>
<li><b><a href="#Variables">Variables</a></b></li>
<li><b><a href="#Common">Common</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::CurrentWTXT">CurrentWTXT</a><span class=tooltiptext> main::CurrentWTXT : Gets a current text widget's path.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::GetWTXT">GetWTXT</a><span class=tooltiptext> main::GetWTXT : Gets a text widget's path of a tab.
TID - ID of the tab</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::ClearCbx">ClearCbx</a><span class=tooltiptext> main::ClearCbx : Clears a combobox's value and removes it from the combobox' list.
cbx - the combobox's path
varname - name of variable used in the current namespace</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::SetTabs">SetTabs</a><span class=tooltiptext> main::SetTabs : Configures tabs of a text.
wtxt - text's path
indent - indentation (= tab's length)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::Help">Help</a><span class=tooltiptext> main::Help : Display context helps.
suff - suffix of file name</span></div></li></ul>
<li><b><a href="#Get_and_show_text_widget">Get and show text widget</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::GetText">GetText</a><span class=tooltiptext> main::GetText : Creates or gets a text widget for a tab.
TID - tab's ID
doshow - flag "this widget should be displayed"
dohighlight - flag "this text should be highlighted"
Returns a list of: curfile (current file name),
wtxt (text's path), wsbv (scrollbar's path),
pos (cursor's position), doinit (flag "initialized")
dopack (flag "packed")
selrange (selected text's range)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::ShowText">ShowText</a><span class=tooltiptext> main::ShowText : Displays a current text.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateHighlighting">UpdateHighlighting</a><span class=tooltiptext> main::UpdateHighlighting : Updates the current text's highlighting.</span></div></li></ul>
<li><b><a href="#Updating_gutter_&_text">Updating gutter & text</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateGutter">UpdateGutter</a><span class=tooltiptext> main::UpdateGutter : Redraws the gutter.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::GutterAttrs">GutterAttrs</a><span class=tooltiptext> main::GutterAttrs : Returns list of gutter's data (canvas widget, width, shift)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateText">UpdateText</a><span class=tooltiptext> main::UpdateText : Redraws a text.
wtxt - the text widget's path
curfile - file name of the text</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateTextGutter">UpdateTextGutter</a><span class=tooltiptext> main::UpdateTextGutter : Redraws both a text and a gutter.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateUnitTree">UpdateUnitTree</a><span class=tooltiptext> main::UpdateUnitTree : Redraws unit tree at need.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateAll">UpdateAll</a><span class=tooltiptext> main::UpdateAll : Updates tree, text and gutter.
headers - headers of all selected units</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateTextGutterTree">UpdateTextGutterTree</a><span class=tooltiptext> main::UpdateTextGutterTree : Updates after replacements: text, gutter, unit tree.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateIcons">UpdateIcons</a><span class=tooltiptext> main::UpdateIcons : Updates after replacements: icons.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateTextGutterTreeIcons">UpdateTextGutterTreeIcons</a><span class=tooltiptext> main::UpdateTextGutterTreeIcons : Updates after replacements: text, gutter, unit tree, icons.</span></div></li></ul>
<li><b><a href="#Mark_bar">Mark bar</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::FillMarkBar">FillMarkBar</a><span class=tooltiptext> main::FillMarkBar : Fills the mark bar, makes bindings for its tags.
args - if set, contains canvas' path
It's run from InitActions without *args*.
See also: InitActions</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateMarkBar">UpdateMarkBar</a><span class=tooltiptext> main::UpdateMarkBar : Updates mark bar at changing -bg color.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::SetMark">SetMark</a><span class=tooltiptext> main::SetMark : Sets a mark in the mark bar.
idx - index of tag used as the mark</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UnsetMark">UnsetMark</a><span class=tooltiptext> main::UnsetMark : Unsets a mark in the mark bar or call a popup menu.
idx - index of tag used as the mark
X - X-coordinate of pointer
Y - Y-coordinate of pointer</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::MarkWidth">MarkWidth</a><span class=tooltiptext> main::MarkWidth : Change the mark bar's width.
i - 1/-1 to increment/decrement</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::MarkWidthSave">MarkWidthSave</a><span class=tooltiptext> main::MarkWidthSave : Saves alited.ini at need.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UnsetOneMark">UnsetOneMark</a><span class=tooltiptext> main::UnsetOneMark : Unsets one mark in the mark bar.
idx - index of tag used as the mark</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UnsetAllMarks">UnsetAllMarks</a><span class=tooltiptext> main::UnsetAllMarks : Unsets all marks in the mark bar.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::SaveMarks">SaveMarks</a><span class=tooltiptext> main::SaveMarks : Saves mark data for a text to be closed.
wtxt - text's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::RestoreMarks">RestoreMarks</a><span class=tooltiptext> main::RestoreMarks : Restores mark data for a text to be shown.
fname - file name
wtxt - text's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::MarkOptions">MarkOptions</a><span class=tooltiptext> main::MarkOptions : Returns options for marks.
idx - index of tag</span></div></li></ul>
<li><b><a href="#Focus">Focus</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::FocusText">FocusText</a><span class=tooltiptext> main::FocusText : Sets a focus on a current text.
args - contains tab's ID and a cursor position.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::FocusInText">FocusInText</a><span class=tooltiptext> main::FocusInText : Processes <FocusIn> event on the text.
TID - tab's ID
wtxt - text widget's path</span></div></li></ul>
<li><b><a href="#Highlight">Highlight</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::HighlightText">HighlightText</a><span class=tooltiptext> main::HighlightText : Highlights a file's syntax constructs.
TID - tab's ID
curfile - file name
wtxt - text widget's path
cmd - callback for modifying text
cmdpos - callback for changing cursor position
fontsize - text font size
Depending on a file name, Tcl or C highlighter is called.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::HighlightLine">HighlightLine</a><span class=tooltiptext> main::HighlightLine : Highlights a current line of a current text.</span></div></li></ul>
<li><b><a href="#Line">Line</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::CursorPos">CursorPos</a><span class=tooltiptext> main::CursorPos : Displays a current text's row and column in the status bar.
wtxt - text widget's path
args - contains a cursor position,</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::InsertLine">InsertLine</a><span class=tooltiptext> main::InsertLine : Puts a new line into a text, attentive to a previous line's indentation.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::GotoBracket">GotoBracket</a><span class=tooltiptext> main::GotoBracket : Processes Alt+B keypressing: "go to a matched bracket".
frommenu - yes, if run from a menu
search a pair for a bracket highlighted</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::GotoLine">GotoLine</a><span class=tooltiptext> main::GotoLine : Processes Ctrl+G keypressing: "go to a line".</span></div></li></ul>
<li><b><a href="#Event_handlers">Event handlers</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::SaveVisitInfo">SaveVisitInfo</a><span class=tooltiptext> main::SaveVisitInfo : Remembers data about current unit.
wtxt - text's path
K - key pressed (to check keypressings)
s - key's state</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::AfterUndoRedo">AfterUndoRedo</a><span class=tooltiptext> main::AfterUndoRedo : Actions after undo/redo.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::AfterCut">AfterCut</a><span class=tooltiptext> main::AfterCut : Actions after cutting text: resets the unit tree's selection.</span></div></li></ul>
<li><b><a href="#GUI">GUI</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::ShowHeader">ShowHeader</a><span class=tooltiptext> main::ShowHeader : Displays a file's name and modification flag (*) in alited's title.
doit - if yes, displays unconditionally.
If *doit* is *no*, displays only at changing a file name or a flag.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::CalcIndentation">CalcIndentation</a><span class=tooltiptext> main::CalcIndentation : Check for "Auto detection of indentation" and calculates it at need.
wtxt - text's path
doit - if yes, recalculates the indentation</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::CalcPad">CalcPad</a><span class=tooltiptext> main::CalcPad : Calculates the indenting pad for the edited text.
wtxt - text's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::UpdateProjectInfo">UpdateProjectInfo</a><span class=tooltiptext> main::UpdateProjectInfo : Displays a project settings in the status bar.
indent - indentation calculated for a text</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::TipStatus">TipStatus</a><span class=tooltiptext> main::TipStatus : Gets a tip for a status bar's short info.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::BindsForText">BindsForText</a><span class=tooltiptext> main::BindsForText : Sets bindings for a text.
TID - tab's ID
wtxt - text widget's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::BindsForCode">BindsForCode</a><span class=tooltiptext> main::BindsForCode : Sets bindings for a code.
wtxt - text widget's path
curfile - current file's name
if {[alited::file::IsTcl $curfile] || [alited::file::IsClang $curfile]} {</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::PackTextWidgets">PackTextWidgets</a><span class=tooltiptext> main::PackTextWidgets : Packs a text and its scrollbar.
wtxt - text widget's path
wsbv - scrollbar widget's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::ShowOutdatedTODO">ShowOutdatedTODO</a><span class=tooltiptext> main::ShowOutdatedTODO : Shows a balloon with outdated TODO.
prj - project's name
date - date of TODO
todo - text of TODO
is - 1 for current day TODO, 2 for "ahead" TODO</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::InitActions">InitActions</a><span class=tooltiptext> main::InitActions : Initializes working with a main form of alited.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#main::ProcMessage">ProcMessage</a><span class=tooltiptext> main::ProcMessage : Handles clicking on message label.</span></div></li></ul>
<li><b><a href="#Main__create">Main _create</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::_create">_create</a><span class=tooltiptext> main::_create : Creates a main form of the alited.</span></div></li></ul>
<li><b><a href="#Main_window">&nbsp;&nbsp;Main window</a></b></li>
<li><b><a href="#Main_pan">&nbsp;&nbsp;&nbsp;&nbsp;Main pan</a></b></li>
<li><b><a href="#Tree_pan">&nbsp;&nbsp;&nbsp;&nbsp;Tree pan</a></b></li>
<li><b><a href="#Tree's_toolbar">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tree's toolbar</a></b></li>
<li><b><a href="#Tree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tree</a></b></li>
<li><b><a href="#Favorites">&nbsp;&nbsp;&nbsp;&nbsp;Favorites</a></b></li>
<li><b><a href="#Favorites'_toolbar">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Favorites' toolbar</a></b></li>
<li><b><a href="#Favorites'_list">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Favorites' list</a></b></li>
<li><b><a href="#Tab_bar_&_Text">&nbsp;&nbsp;&nbsp;&nbsp;Tab bar & Text</a></b></li>
<li><b><a href="#Find_units">&nbsp;&nbsp;&nbsp;&nbsp;Find units</a></b></li>
<li><b><a href="#Info_&_status_bar">&nbsp;&nbsp;&nbsp;&nbsp;Info & status bar</a></b></li>
<li><b><a href="#Main__run">Main _run</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#main::_run">_run</a><span class=tooltiptext> main::_run : Runs the alited, displaying its main form with attributes
'modal', 'not closed by Esc', 'decorated with Contract/Expand buttons',
'minimal sizes' and 'saved geometry'.
After closing the alited, saves its settings (geometry etc.).
See also: menu::TearoffCascadeMenu</span></div></li></ul>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->

<h1><font color=#ca14ca> alited's source</font></h1>
</p><p>
The <a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/about.html">alited/src</a> directory contains alited's own source files.
</p><p>
Some additional alited's files are also contained in <a href="https://aplsimple.github.io/en/tcl/printer/alited/files/lib/addon/hl_alm.html">alited/lib/addon</a> directory (<i><font color=#1b1baa>alited/lib</font></i> directory contains all library files).
</p><p>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/about.html">about.tcl</a> - "About alited" dialogue.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/alited.html">alited.tcl</a> - The alited's main script to start.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/bar.html">bar.tcl</a> - Handles the bar of tabs.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/check.html">check.tcl</a> - "Check Tcl" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/complete.html">complete.tcl</a> - Handles auto-completion.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/edit.html">edit.tcl</a> - "Edit" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/favor.html">favor.tcl</a> - Handles the favorite and last visited units.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/favor_ls.html">favor_ls.tcl</a> - "Saved lists of favorites" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/file.html">file.tcl</a> - "File" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/find.html">find.tcl</a> - "Find / Replace" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/format.html">format.tcl</a> - "Edit / Formats" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/img.html">img.tcl</a> - List of images used by alited.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/indent.html">indent.tcl</a> - Handles text indentation.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/info.html">info.tcl</a> - Handles the info bar.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/ini.html">ini.tcl</a> - Handles initializing alited.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/keys.html">keys.tcl</a> - Handles keyboard (mapping etc.).</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/main.html">main.tcl</a> - Handles the main form of alited.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/menu.html">menu.tcl</a> - Handles alited's menus.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/msgs.html">msgs.tcl</a> - Localized messages used in several places.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/paver.html">paver.tcl</a> - "Tools / Paver" tool.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/pkgIndex.html">pkgIndex.tcl</a> - Includes README.md text (for Ruff doc generator).</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/pref.html">pref.tcl</a> - "Preferences" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/preview.html">preview.tcl</a> - "Preview (theme, CS)" dialogue called by "Preferences".</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/printer.html">printer.tcl</a> - "Tools / Project Printer" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/project.html">project.tcl</a> - "Projects" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/run.html">run.tcl</a> - "Tools / Run..." dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/tool.html">tool.tcl</a> - "Tools" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/tree.html">tree.tcl</a> - Handles the tree of units and files.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/unit.html">unit.tcl</a> - Handles the unit tree.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/unit_tpl.html">unit_tpl.tcl</a> - "Templates" dialogue and procedures.</li>
</p><p>

</p>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>main.tcl</b></font></div></td></table>

<pre class="code"><i><font color=#4b5d50>###########################################################<a id=main.tcl></a></font></i>
<i><font color=#4b5d50># Name:    main.tcl</font></i>
<i><font color=#4b5d50># Author:  Alex Plotnikov  (aplsimple@gmail.com)</font></i>
<i><font color=#4b5d50># Date:    06/20/2021</font></i>
<i><font color=#4b5d50># Brief:   Handles the main form of alited.</font></i>
<i><font color=#4b5d50># License: MIT.</font></i>
<i><font color=#4b5d50>###########################################################</font></i>
<a id=Variables></a>
<i><font color=#4b5d50># _________________________ Variables ________________________ #</font></i>

<b><font color=#ca14ca>namespace</font></b> eval main {
  <b><font color=#3a6797>variable</font></b> findunits 1     ;<i><font color=#4b5d50># where to find units: 1 current file, 2 all</font></i>
  <b><font color=#3a6797>variable</font></b> gotoline1 {}    ;<i><font color=#4b5d50># line number of &quot;Go to Line&quot; dialogue</font></i>
  <b><font color=#3a6797>variable</font></b> gotoline2 {}    ;<i><font color=#4b5d50># units list of &quot;Go to Line&quot; dialogue</font></i>
  <b><font color=#3a6797>variable</font></b> gotolineTID {}  ;<i><font color=#4b5d50># tab ID last used in &quot;Go to Line&quot; dialogue</font></i>
  <b><font color=#3a6797>variable</font></b> wcan {} fgcan {} bgcan {}   ;<i><font color=#4b5d50># canvas' path and its colors</font></i>
  <b><font color=#3a6797>variable</font></b> saveini no      ;<i><font color=#4b5d50># flag &quot;save alited.ini&quot;</font></i>
}
<a id=Common></a>
<i><font color=#4b5d50># ________________________ Common _________________________ #</font></i>
<a id=main::CurrentWTXT></a>
<b><font color=#ca14ca>proc</font></b> main::CurrentWTXT {} {
  <i><font color=#4b5d50># Gets a current text widget's path.</font></i>

  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>lindex</font></b> [alited::bar::GetBarState] 2]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::GetWTXT></a>
<b><font color=#ca14ca>proc</font></b> main::GetWTXT {TID} {
  <i><font color=#4b5d50># Gets a text widget's path of a tab.</font></i>
  <i><font color=#4b5d50>#   TID - ID of the tab</font></i>

  <b><font color=#ca14ca>return</font></b> [alited::bar::GetTabState <font color=#1b1baa>$TID</font> <font color=#653760>--wtxt</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::ClearCbx></a>
<b><font color=#ca14ca>proc</font></b> main::ClearCbx {cbx varname} {
  <i><font color=#4b5d50># Clears a combobox's value and removes it from the combobox' list.</font></i>
  <i><font color=#4b5d50>#   cbx - the combobox's path</font></i>
  <i><font color=#4b5d50>#   varname - name of variable used in the current namespace</font></i>

  <b><font color=#3a6797>set</font></b> val [<b><font color=#3a6797>string</font></b> trim [<font color=#1b1baa>$cbx</font> get]]
  <b><font color=#3a6797>set</font></b> values [<font color=#1b1baa>$cbx</font> cget <font color=#653760>-values</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$values</font> <font color=#1b1baa>$val</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> values [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$values</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
    <font color=#1b1baa>$cbx</font> configure <font color=#653760>-values</font> <font color=#1b1baa>$values</font>
  }
  <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$varname</font> <font color=#1b1baa>$values</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::SetTabs></a>
<b><font color=#ca14ca>proc</font></b> main::SetTabs {wtxt indent} {
  <i><font color=#4b5d50># Configures tabs of a text.</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>
  <i><font color=#4b5d50>#   indent - indentation (= tab's length)</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> texttabs [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$indent</font> * [<b><font color=#134070>font</font></b> measure <font color=#1b1baa>$al(FONT,txt)</font> 0]}]
  <font color=#1b1baa>$wtxt</font> configure <font color=#653760>-tabs</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>texttabs left&quot;</font> <font color=#653760>-tabstyle</font> wordprocessor
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::Help></a>
<b><font color=#ca14ca>proc</font></b> main::Help {{suff <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Display context helps.</font></i>
  <i><font color=#4b5d50>#   suff - suffix of file name</font></i>

  alited::Help <font color=#1b1baa>$::alited::al(WIN)</font> <font color=#1b1baa>$suff</font>
}
<a id=Get_and_show_text_widget></a>
<i><font color=#4b5d50># ________________________ Get and show text widget _________________________ #</font></i>
<a id=main::GetText></a>
<b><font color=#ca14ca>proc</font></b> main::GetText {TID {doshow no} {dohighlight yes}} {
  <i><font color=#4b5d50># Creates or gets a text widget for a tab.</font></i>
  <i><font color=#4b5d50>#   TID - tab's ID</font></i>
  <i><font color=#4b5d50>#   doshow - flag &quot;this widget should be displayed&quot;</font></i>
  <i><font color=#4b5d50>#   dohighlight - flag &quot;this text should be highlighted&quot;</font></i>
  <i><font color=#4b5d50># Returns a list of: curfile (current file name),</font></i>
  <i><font color=#4b5d50># wtxt (text's path), wsbv (scrollbar's path),</font></i>
  <i><font color=#4b5d50># pos (cursor's position), doinit (flag &quot;initialized&quot;)</font></i>
  <i><font color=#4b5d50># dopack (flag &quot;packed&quot;)</font></i>
  <i><font color=#4b5d50># selrange (selected text's range)</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>set</font></b> curfile [alited::bar::FileName <font color=#1b1baa>$TID</font>]
  <i><font color=#4b5d50># initial text and its scrollbar:</font></i>
  <b><font color=#3a6797>set</font></b> wtxt [<font color=#1b1baa>$obPav</font> Text]
  <b><font color=#3a6797>set</font></b> wsbv [<font color=#1b1baa>$obPav</font> SbvText]
  <i><font color=#4b5d50># get data of the current tab</font></i>
  <b><font color=#3a6797>lassign</font></b> [alited::bar::GetBarState] TIDold fileold wold1 wold2
  <b><font color=#3a6797>lassign</font></b> [alited::bar::GetTabState <font color=#1b1baa>$TID</font> <font color=#653760>--pos</font> <font color=#653760>--selection</font> <font color=#653760>--wrap</font>] pos selrange wrap
  <b><font color=#3a6797>set</font></b> doreload no  ;<i><font color=#4b5d50># obsolete</font></i>
  <b><font color=#3a6797>set</font></b> doinit yes
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$TIDold</font> eq {-1} && <font color=#1b1baa>$TID</font> eq {tab0}} {
    ;<i><font color=#4b5d50># first text to edit in original Text widget: create its scrollbar</font></i>
    BindsForText <font color=#1b1baa>$TID</font> <font color=#1b1baa>$wtxt</font>
    ::apave::logMessage <font color=#8b2a0e>&quot;first <font color=#1b1baa>$</font>curfile&quot;</font>
  } <b><font color=#3a6797>elseif</font></b> {[GetWTXT <font color=#1b1baa>$TID</font>] ne {}} {
    <i><font color=#4b5d50># edited text: get its widgets' data</font></i>
    <b><font color=#3a6797>lassign</font></b> [alited::bar::GetTabState <font color=#1b1baa>$TID</font> <font color=#653760>--wtxt</font> <font color=#653760>--wsbv</font>] wtxt wsbv
    <b><font color=#3a6797>set</font></b> doinit no
  } <b><font color=#3a6797>else</font></b> {
    <i><font color=#4b5d50># till now, not edited text: create its own Text/SbvText widgets</font></i>
    <b><font color=#3a6797>append</font></b> wtxt <font color=#8b2a0e>&quot;_<font color=#1b1baa>$</font>TID&quot;</font>  ;<i><font color=#4b5d50># new text</font></i>
    <b><font color=#3a6797>append</font></b> wsbv <font color=#8b2a0e>&quot;_<font color=#1b1baa>$</font>TID&quot;</font>  ;<i><font color=#4b5d50># new scrollbar</font></i>
  }
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> is double <font color=#653760>-strict</font> <font color=#1b1baa>$pos</font>]} {<b><font color=#3a6797>set</font></b> pos 1.0}
  <i><font color=#4b5d50># check for previous text and hide it, if it's not the selected one</font></i>
  <b><font color=#3a6797>set</font></b> dopack [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$TID</font> ne <font color=#1b1baa>$TIDold</font>}]
  alited::bar::SetTabState <font color=#1b1baa>$TID</font> <font color=#653760>--fname</font> <font color=#1b1baa>$curfile</font> <font color=#653760>--wtxt</font> <font color=#1b1baa>$wtxt</font> <font color=#653760>--wsbv</font> <font color=#1b1baa>$wsbv</font>
  <i><font color=#4b5d50># create the text and the scrollbar if new</font></i>
  <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wtxt</font>]} {
    <b><font color=#3a6797>lassign</font></b> [GutterAttrs] canvas width shift
    <b><font color=#3a6797>set</font></b> texopts [<b><font color=#3a6797>lindex</font></b> [::apave::defaultAttrs tex] 1]
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions texopts <font color=#653760>-selborderwidth</font> 1] selbw
    <b><font color=#134070>text</font></b> <font color=#1b1baa>$wtxt</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$texopts</font>
    <font color=#1b1baa>$wtxt</font> tag configure sel <font color=#653760>-borderwidth</font> <font color=#1b1baa>$selbw</font>
    <font color=#1b1baa>$obPav</font> themeNonThemed [<b><font color=#134070>winfo</font></b> parent <font color=#1b1baa>$wtxt</font>]
    <font color=#1b1baa>$obPav</font> bindGutter <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$canvas</font> <font color=#1b1baa>$width</font> <font color=#1b1baa>$shift</font>
    <b><font color=#134070>ttk::scrollbar</font></b> <font color=#1b1baa>$wsbv</font> <font color=#653760>-orient</font> vertical <font color=#653760>-takefocus</font> 0
    <font color=#1b1baa>$wtxt</font> configure <font color=#653760>-yscrollcommand</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>wsbv set&quot;</font>
    <font color=#1b1baa>$wsbv</font> configure <font color=#653760>-command</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>wtxt yview&quot;</font>
    BindsForText <font color=#1b1baa>$TID</font> <font color=#1b1baa>$wtxt</font>
    alited::file::OutwardChange <font color=#1b1baa>$TID</font> no
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wold1</font>]} {
    <i><font color=#4b5d50># previous text: save its state</font></i>
    alited::bar::SetTabState <font color=#1b1baa>$TIDold</font> <font color=#653760>--pos</font> [<font color=#1b1baa>$wold1</font> index insert] <font color=#653760>--selection</font> [<font color=#1b1baa>$wold1</font> tag ranges sel]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dopack</font> && <font color=#1b1baa>$doshow</font>} {
      <i><font color=#4b5d50># hide both previous</font></i>
      <b><font color=#134070>pack</font></b> forget <font color=#1b1baa>$wold1</font>  ;<i><font color=#4b5d50># a text</font></i>
      <b><font color=#134070>pack</font></b> forget <font color=#1b1baa>$wold2</font>  ;<i><font color=#4b5d50># a scrollbar</font></i>
      <b><font color=#3a6797>after</font></b> idle update
    }
  }
  <i><font color=#4b5d50># show the selected text</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doshow</font>} {
    alited::bar::SetBarState [alited::bar::CurrentTabID] <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$wsbv</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doinit</font>} {
    <i><font color=#4b5d50># if the file isn't read yet, read it and initialize its highlighting</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjindent)</font>&gt;1 && <font color=#1b1baa>$al(prjindent)</font>&lt;9 && !<font color=#1b1baa>$al(prjindentAuto)</font>} {
      SetTabs <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$al(prjindent)</font>
    }
    alited::file::DisplayFile <font color=#1b1baa>$TID</font> <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$doreload</font>
    RestoreMarks <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjindentAuto)</font>} {
      SetTabs <font color=#1b1baa>$wtxt</font> [<b><font color=#3a6797>lindex</font></b> [CalcIndentation <font color=#1b1baa>$wtxt</font>] 0]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doshow</font>} {
      HighlightText <font color=#1b1baa>$TID</font> <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font>
    } <b><font color=#3a6797>else</font></b> {
      alited::file::MakeThemHighlighted <font color=#1b1baa>$TID</font>  ;<i><font color=#4b5d50># postpone the highlighting till a show</font></i>
    }
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$dohighlight</font> && [alited::file::ToBeHighlighted <font color=#1b1baa>$wtxt</font>]} {
    HighlightText <font color=#1b1baa>$TID</font> <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(TREE,isunits)</font>} alited::tree::RecreateTree
  }
  <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$wsbv</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$doinit</font> <font color=#1b1baa>$dopack</font> <font color=#1b1baa>$selrange</font> <font color=#1b1baa>$wrap</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::ShowText></a>
<b><font color=#ca14ca>proc</font></b> main::ShowText {} {
  <i><font color=#4b5d50># Displays a current text.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>set</font></b> TID [alited::bar::CurrentTabID]
  <b><font color=#3a6797>lassign</font></b> [GetText <font color=#1b1baa>$TID</font> yes] curfile wtxt wsbv pos doinit dopack selrange wrap
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dopack</font>} {
    PackTextWidgets <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$wsbv</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doinit</font> || <font color=#1b1baa>$dopack</font>} {
    <i><font color=#4b5d50># for newly displayed text: create also its unit tree</font></i>
    <b><font color=#3a6797>set</font></b> al(TREE,units) no
    alited::tree::Create
    <b><font color=#3a6797>after</font></b> idle alited::main::SaveVisitInfo
  }
  <i><font color=#4b5d50># this code below redraws the tree's scrollbar</font></i>
  <b><font color=#3a6797>set</font></b> wtree [<font color=#1b1baa>$obPav</font> Tree]
  <font color=#1b1baa>$wtree</font> configure <font color=#653760>-yscrollcommand</font> [<font color=#1b1baa>$wtree</font> cget <font color=#653760>-yscrollcommand</font>]
  FocusText <font color=#1b1baa>$TID</font> <font color=#1b1baa>$pos</font>
  <b><font color=#134070>focus</font></b> <font color=#1b1baa>$wtxt</font>
  alited::tree::SeeTreeItem
  alited::tree::IconContract
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$selrange</font> ne {}} {
    <b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$wtxt</font> tag add sel {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$selrange</font>}
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wrap</font> eq {none}} {
    alited::bar::SetTabState <font color=#1b1baa>$TID</font> <font color=#653760>--wrap</font> {}  ;<i><font color=#4b5d50># because it's the very first enter</font></i>
    alited::file::WrapLines yes
  }
  <i><font color=#4b5d50># update &quot;File&quot; menu and app's header</font></i>
  alited::menu::CheckMenuItems
  ShowHeader
  <i><font color=#4b5d50># fill Type Templates menu</font></i>
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$al(afterFillTTMenu)</font>}
  <b><font color=#3a6797>set</font></b> al(afterFillTTMenu) [<b><font color=#3a6797>after</font></b> 500 {<b><font color=#3a6797>after</font></b> idle alited::unit::FillTypeTplMenu}]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateHighlighting></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateHighlighting {} {
  <i><font color=#4b5d50># Updates the current text's highlighting.</font></i>

  <b><font color=#3a6797>set</font></b> TID [alited::bar::CurrentTabID]
  <b><font color=#3a6797>lassign</font></b> [GetText <font color=#1b1baa>$TID</font>] curfile wtxt
  HighlightText <font color=#1b1baa>$TID</font> <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$wtxt</font>
}
<a id=Updating_gutter_&_text></a>
<i><font color=#4b5d50># ________________________ Updating gutter & text _________________________ #</font></i>
<a id=main::UpdateGutter></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateGutter {} {
  <i><font color=#4b5d50># Redraws the gutter.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited obPav obPav
  <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
  <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> after 0 <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>obPav fillGutter <font color=#1b1baa>$</font>wtxt&quot;</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::GutterAttrs></a>
<b><font color=#ca14ca>proc</font></b> main::GutterAttrs {} {
  <i><font color=#4b5d50># Returns list of gutter's data (canvas widget, width, shift)</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>list</font></b> [<font color=#1b1baa>$obPav</font> GutText] <font color=#1b1baa>$al(ED,gutterwidth)</font> <font color=#1b1baa>$al(ED,guttershift)</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateText></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateText {{wtxt {}} {curfile {}}} {
  <i><font color=#4b5d50># Redraws a text.</font></i>
  <i><font color=#4b5d50>#   wtxt - the text widget's path</font></i>
  <i><font color=#4b5d50>#   curfile - file name of the text</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited obPav obPav
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wtxt</font> eq {}} {<b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$curfile</font> eq {}} {<b><font color=#3a6797>set</font></b> curfile [alited::bar::FileName]}
  <b><font color=#3a6797>if</font></b> {[alited::file::IsClang <font color=#1b1baa>$curfile</font>]} {
    ::hl_c::hl_text <font color=#1b1baa>$wtxt</font>
  } <b><font color=#3a6797>else</font></b> {
    ::hl_tcl::hl_text <font color=#1b1baa>$wtxt</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateTextGutter></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateTextGutter {} {
  <i><font color=#4b5d50># Redraws both a text and a gutter.</font></i>

  UpdateGutter
  UpdateText
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateUnitTree></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateUnitTree {} {
  <i><font color=#4b5d50># Redraws unit tree at need.</font></i>

  <b><font color=#3a6797>set</font></b> fname [alited::bar::FileName]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::alited::al(TREE,isunits)</font> && [alited::file::IsUnitFile <font color=#1b1baa>$fname</font>]} {
    alited::tree::RecreateTree
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateAll></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateAll {{headers {}}} {
  <i><font color=#4b5d50># Updates tree, text and gutter.</font></i>
  <i><font color=#4b5d50>#   headers - headers of all selected units</font></i>

  alited::tree::RecreateTree {} <font color=#1b1baa>$headers</font>
  UpdateTextGutter
  HighlightLine
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateTextGutterTree></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateTextGutterTree {} {
  <i><font color=#4b5d50># Updates after replacements: text, gutter, unit tree.</font></i>

  UpdateTextGutter
  UpdateUnitTree
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateIcons></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateIcons {} {
  <i><font color=#4b5d50># Updates after replacements: icons.</font></i>

  alited::bar::OnTabSelection [alited::bar::CurrentTabID]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateTextGutterTreeIcons></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateTextGutterTreeIcons {} {
  <i><font color=#4b5d50># Updates after replacements: text, gutter, unit tree, icons.</font></i>

  UpdateTextGutterTree
  UpdateIcons
}
<a id=Mark_bar></a>
<i><font color=#4b5d50># ________________________ Mark bar _________________________ #</font></i>
<a id=main::FillMarkBar></a>
<b><font color=#ca14ca>proc</font></b> main::FillMarkBar {args} {
  <i><font color=#4b5d50># Fills the mark bar, makes bindings for its tags.</font></i>
  <i><font color=#4b5d50>#   args - if set, contains canvas' path</font></i>
  <i><font color=#4b5d50># It's run from InitActions without *args*.</font></i>
  <i><font color=#4b5d50># See also: InitActions</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>variable</font></b> wcan
  <b><font color=#3a6797>variable</font></b> fgcan
  <b><font color=#3a6797>variable</font></b> bgcan
  <b><font color=#3a6797>lassign</font></b> [MarkOptions] N
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$args</font>]} {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> wcan
    <font color=#1b1baa>$wcan</font> create rectangle <font color=#8b2a0e>&quot;0 0 99 9999&quot;</font> <font color=#653760>-fill</font> <font color=#1b1baa>$bgcan</font> <font color=#653760>-outline</font> <font color=#1b1baa>$bgcan</font>
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<b><font color=#134070>winfo</font></b> geometry [<font color=#1b1baa>$obPav</font> Text]] x+] -&gt; h
  <b><font color=#3a6797>set</font></b> hp [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$h</font>/<font color=#1b1baa>$N</font>-0.5)}]
  <font color=#1b1baa>$wcan</font> configure <font color=#653760>-highlightbackground</font> <font color=#1b1baa>$bgcan</font> <font color=#653760>-highlightthickness</font> 0
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0; <b><font color=#3a6797>set</font></b> y 1} {<font color=#1b1baa>$i</font>&lt;(<font color=#1b1baa>$N</font>+1)} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$i</font>] -&gt; tip mark
    <b><font color=#3a6797>set</font></b> y2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y</font>+<font color=#1b1baa>$hp</font>}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>==<font color=#1b1baa>$N</font>} {<b><font color=#3a6797>incr</font></b> y2 9999}
    <b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$mark</font>) [<font color=#1b1baa>$wcan</font> create rectangle <font color=#8b2a0e>&quot;1 <font color=#1b1baa>$</font>y 99 <font color=#1b1baa>$</font>y2&quot;</font> <font color=#653760>-fill</font> <font color=#1b1baa>$bgcan</font> <font color=#653760>-outline</font> <font color=#1b1baa>$fgcan</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$N</font>} {
      <font color=#1b1baa>$wcan</font> bind <font color=#1b1baa>$al($mark)</font> &lt;ButtonPress-1&gt; <font color=#8b2a0e>&quot;alited::main::SetMark <font color=#1b1baa>$</font>i&quot;</font>
      <font color=#1b1baa>$wcan</font> bind <font color=#1b1baa>$al($mark)</font> &lt;ButtonPress-3&gt; <font color=#8b2a0e>&quot;alited::main::UnsetMark <font color=#1b1baa>$</font>i %X %Y&quot;</font>
      UnsetOneMark <font color=#1b1baa>$i</font>
    }
    <b><font color=#3a6797>incr</font></b> y <font color=#1b1baa>$hp</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateMarkBar></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateMarkBar {} {
  <i><font color=#4b5d50># Updates mark bar at changing -bg color.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>lassign</font></b> [MarkOptions] N
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$N</font>} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$i</font>] - - - markdata
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists al(<font color=#1b1baa>$markdata</font>)]} {UnsetOneMark <font color=#1b1baa>$i</font>}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::SetMark></a>
<b><font color=#ca14ca>proc</font></b> main::SetMark {idx} {
  <i><font color=#4b5d50># Sets a mark in the mark bar.</font></i>
  <i><font color=#4b5d50>#   idx - index of tag used as the mark</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> wcan
  <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$idx</font>] -&gt; tip mark markdata colors
  <font color=#1b1baa>$wcan</font> itemconfigure <font color=#1b1baa>$al($mark)</font> <font color=#653760>-fill</font> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$colors</font> <font color=#1b1baa>$idx</font>]
  <b><font color=#3a6797>set</font></b> tag MARK<font color=#1b1baa>$idx</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists al(<font color=#1b1baa>$markdata</font>)]} {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$al($markdata)</font> fname pos
    <b><font color=#3a6797>set</font></b> TID [alited::file::OpenFile <font color=#1b1baa>$fname</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$TID</font> ne {}} {
      <b><font color=#3a6797>set</font></b> wtxt [GetWTXT <font color=#1b1baa>$TID</font>]
      <b><font color=#3a6797>lassign</font></b> [<font color=#1b1baa>$wtxt</font> tag ranges <font color=#1b1baa>$tag</font>] pos2
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is double <font color=#653760>-strict</font> <font color=#1b1baa>$pos2</font>]} {<b><font color=#3a6797>set</font></b> pos <font color=#1b1baa>$pos2</font>}
      <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;::tk::TextSetCursor <font color=#1b1baa>$</font>wtxt <font color=#1b1baa>$</font>pos ; alited::main::UpdateAll&quot;</font>
    }
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> fname [alited::bar::FileName]
    <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
    <b><font color=#3a6797>set</font></b> pos [<font color=#1b1baa>$wtxt</font> index insert]
    <b><font color=#3a6797>set</font></b> nl [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$pos</font>)}]
    <b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$markdata</font>) [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$fname</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$tag</font>]
    <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> trim [<font color=#1b1baa>$wtxt</font> get <font color=#1b1baa>$nl</font>.0 <font color=#1b1baa>$nl</font>.end]]
    <b><font color=#3a6797>set</font></b> lmax 50
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]&gt;<font color=#1b1baa>$lmax</font>} {
      <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 0 <font color=#1b1baa>$lmax</font>]...
    }
    <b><font color=#3a6797>set</font></b> tip [<b><font color=#3a6797>string</font></b> trim <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>file tail <font color=#1b1baa>$</font>fname<font color=#1b1baa>]</font> <font color=#1b1baa>$</font>nl:\n<font color=#1b1baa>$</font>line&quot;</font>]
    ::baltip::tip <font color=#1b1baa>$wcan</font> <font color=#1b1baa>$tip</font> <font color=#653760>-ctag</font> <font color=#1b1baa>$al($mark)</font> <font color=#653760>-shiftX</font> 10 <font color=#653760>-pause</font> 0
    ::baltip repaint <font color=#1b1baa>$wcan</font>
  }
  <b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$wtxt</font> tag delete <font color=#1b1baa>$tag</font>}
  <font color=#1b1baa>$wtxt</font> tag add <font color=#1b1baa>$tag</font> <font color=#1b1baa>$pos</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UnsetMark></a>
<b><font color=#ca14ca>proc</font></b> main::UnsetMark {idx X Y} {
  <i><font color=#4b5d50># Unsets a mark in the mark bar or call a popup menu.</font></i>
  <i><font color=#4b5d50>#   idx - index of tag used as the mark</font></i>
  <i><font color=#4b5d50>#   X - X-coordinate of pointer</font></i>
  <i><font color=#4b5d50>#   Y - Y-coordinate of pointer</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> wcan
  <b><font color=#3a6797>set</font></b> disabletips no
  <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$idx</font>] N tip mark markdata
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists al(<font color=#1b1baa>$markdata</font>)]} {
    <b><font color=#3a6797>set</font></b> disabletips yes
    UnsetOneMark <font color=#1b1baa>$idx</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> disabletips yes
    <b><font color=#3a6797>set</font></b> popm <font color=#1b1baa>$al(WIN)</font>.popmMARK
    <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$popm</font>}
    <b><font color=#134070>menu</font></b> <font color=#1b1baa>$popm</font> <font color=#653760>-tearoff</font> 1 <font color=#653760>-title</font> <font color=#1b1baa>$al(MC,marks)</font>
    <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> [msgcat::mc {Clear All}] \
      <font color=#653760>-command</font> <font color=#8b2a0e>&quot;alited::main::UnsetAllMarks&quot;</font>
    <font color=#1b1baa>$popm</font> add separator
    <b><font color=#3a6797>set</font></b> lab [msgcat::mc Width]
    <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>lab +&quot;</font> <font color=#653760>-command</font> <font color=#8b2a0e>&quot;alited::main::MarkWidth 1&quot;</font>
    <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>lab -&quot;</font> <font color=#653760>-command</font> <font color=#8b2a0e>&quot;alited::main::MarkWidth -1&quot;</font>
    <font color=#1b1baa>$popm</font> add separator
    <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$al(MC,help)</font> <font color=#653760>-command</font> {alited::main::Help mark}
    <b><font color=#134070>tk_popup</font></b> <font color=#1b1baa>$popm</font> <font color=#1b1baa>$X</font> <font color=#1b1baa>$Y</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$disabletips</font> && ![<b><font color=#3a6797>info</font></b> exists al(MARK_TIPOFF)]} {
    <i><font color=#4b5d50># disable all default tips on empty marks</font></i>
    <b><font color=#3a6797>set</font></b> al(MARK_TIPOFF) 1
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$N</font>} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$i</font>] - - - data
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists al(<font color=#1b1baa>$data</font>)]} {
        UnsetOneMark <font color=#1b1baa>$i</font>
      }
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::MarkWidth></a>
<b><font color=#ca14ca>proc</font></b> main::MarkWidth {i} {
  <i><font color=#4b5d50># Change the mark bar's width.</font></i>
  <i><font color=#4b5d50>#   i - 1/-1 to increment/decrement</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> wcan
  <b><font color=#3a6797>variable</font></b> saveini
  <b><font color=#3a6797>set</font></b> width [<font color=#1b1baa>$wcan</font> cget <font color=#653760>-width</font>]
  <b><font color=#3a6797>incr</font></b> width <font color=#1b1baa>$i</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$width</font>&gt;=5 && <font color=#1b1baa>$width</font>&lt;=99} {
    <font color=#1b1baa>$wcan</font> configure <font color=#653760>-width</font> <font color=#1b1baa>$width</font>
    <b><font color=#3a6797>set</font></b> al(markwidth) <font color=#1b1baa>$width</font>
    <b><font color=#3a6797>set</font></b> saveini yes
    <b><font color=#3a6797>after</font></b> 3000 alited::main::MarkWidthSave
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#134070>bell</font></b>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::MarkWidthSave></a>
<b><font color=#ca14ca>proc</font></b> main::MarkWidthSave {} {
  <i><font color=#4b5d50># Saves alited.ini at need.</font></i>

  <b><font color=#3a6797>variable</font></b> saveini
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$saveini</font>} {
    <b><font color=#3a6797>set</font></b> saveini no
    alited::ini::SaveIni
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UnsetOneMark></a>
<b><font color=#ca14ca>proc</font></b> main::UnsetOneMark {idx} {
  <i><font color=#4b5d50># Unsets one mark in the mark bar.</font></i>
  <i><font color=#4b5d50>#   idx - index of tag used as the mark</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> wcan
  <b><font color=#3a6797>variable</font></b> bgcan
  <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$idx</font>] N tip mark markdata
  <font color=#1b1baa>$wcan</font> itemconfigure <font color=#1b1baa>$al($mark)</font> <font color=#653760>-fill</font> <font color=#1b1baa>$bgcan</font>
  ::baltip::tip <font color=#1b1baa>$wcan</font> <font color=#1b1baa>$tip</font> <font color=#653760>-ctag</font> <font color=#1b1baa>$al($mark)</font> <font color=#653760>-shiftX</font> 10
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$al($markdata)</font> fname pos wtxt tag
    <b><font color=#3a6797>unset</font></b> al(<font color=#1b1baa>$markdata</font>)
    <font color=#1b1baa>$wtxt</font> tag delete <font color=#1b1baa>$tag</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UnsetAllMarks></a>
<b><font color=#ca14ca>proc</font></b> main::UnsetAllMarks {} {
  <i><font color=#4b5d50># Unsets all marks in the mark bar.</font></i>

  <b><font color=#3a6797>variable</font></b> wcan
  <b><font color=#3a6797>variable</font></b> bgcan
  <b><font color=#3a6797>lassign</font></b> [MarkOptions] N
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$N</font>} {<b><font color=#3a6797>incr</font></b> i} {
    UnsetOneMark <font color=#1b1baa>$i</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::SaveMarks></a>
<b><font color=#ca14ca>proc</font></b> main::SaveMarks {wtxt} {
  <i><font color=#4b5d50># Saves mark data for a text to be closed.</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>foreach</font></b> tag [<font color=#1b1baa>$wtxt</font> tag names] {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match MARK* <font color=#1b1baa>$tag</font>]} {
      <b><font color=#3a6797>set</font></b> idx [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tag</font> 4 end]
      <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$idx</font>] -&gt; tip mark markdata
      <b><font color=#3a6797>catch</font></b> {
        <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$al($markdata)</font> fname pos
        <b><font color=#3a6797>lassign</font></b> [<font color=#1b1baa>$wtxt</font> tag ranges <font color=#1b1baa>$tag</font>] pos
        <b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$markdata</font>) [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$fname</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$tag</font>]
      }
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::RestoreMarks></a>
<b><font color=#ca14ca>proc</font></b> main::RestoreMarks {fname wtxt} {
  <i><font color=#4b5d50># Restores mark data for a text to be shown.</font></i>
  <i><font color=#4b5d50>#   fname - file name</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>lassign</font></b> [MarkOptions] N
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$N</font>} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>lassign</font></b> [MarkOptions <font color=#1b1baa>$i</font>] N tip mark markdata
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists al(<font color=#1b1baa>$markdata</font>)]} {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$al($markdata)</font> fname2 pos
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fname</font> eq <font color=#1b1baa>$fname2</font>} {
        <b><font color=#3a6797>set</font></b> tag MARK<font color=#1b1baa>$i</font>
        <b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$markdata</font>) [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$fname</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$tag</font>]
        <b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$wtxt</font> tag delete <font color=#1b1baa>$tag</font>}
        <font color=#1b1baa>$wtxt</font> tag add <font color=#1b1baa>$tag</font> <font color=#1b1baa>$pos</font>
      }
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::MarkOptions></a>
<b><font color=#ca14ca>proc</font></b> main::MarkOptions {{idx 0}} {
  <i><font color=#4b5d50># Returns options for marks.</font></i>
  <i><font color=#4b5d50>#   idx - index of tag</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>variable</font></b> fgcan
  <b><font color=#3a6797>variable</font></b> bgcan
  <b><font color=#3a6797>lassign</font></b> [<font color=#1b1baa>$obPav</font> csGet] - - - bgcan - - - - fgcan
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$al(TIPS,Marks)</font> || [<b><font color=#3a6797>info</font></b> exists al(MARK_TIPOFF)]} {
    <b><font color=#3a6797>set</font></b> tip {}
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> tip [msgcat::mc <font color=#8b2a0e>&quot;Left click sets / goes to a mark.\nRight click clears it.&quot;</font>]
  }
  <i><font color=#4b5d50># 12 greenish</font></i>
  <b><font color=#3a6797>lappend</font></b> colors #00ff00 #00f500 #00eb00 #00e100 #00d700 #00cd00
  <b><font color=#3a6797>lappend</font></b> colors #00c300 #00b900 #00af00 #00a500 #009b00 #009100
  <i><font color=#4b5d50># 12 reddish</font></i>
  <b><font color=#3a6797>lappend</font></b> colors #910000 #9b0000 #a50000 #af0000 #b90000 #c30000
  <b><font color=#3a6797>lappend</font></b> colors #cd0000 #d70000 #e10000 #eb0000 #f50000 #ff0000
  <b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$colors</font>] <font color=#1b1baa>$tip</font> MARK,<font color=#1b1baa>$idx</font> MARKDATA,<font color=#1b1baa>$idx</font> <font color=#1b1baa>$colors</font>
}
<a id=Focus></a>
<i><font color=#4b5d50># ________________________ Focus _________________________ #</font></i>
<a id=main::FocusText></a>
<b><font color=#ca14ca>proc</font></b> main::FocusText {args} {
  <i><font color=#4b5d50># Sets a focus on a current text.</font></i>
  <i><font color=#4b5d50>#   args - contains tab's ID and a cursor position.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> TID pos
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pos</font> eq {}} {
    <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
    <b><font color=#3a6797>set</font></b> TID [alited::bar::CurrentTabID]
    <b><font color=#3a6797>set</font></b> pos [<font color=#1b1baa>$wtxt</font> index insert]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> wtxt [GetWTXT <font color=#1b1baa>$TID</font>]
  }
  <i><font color=#4b5d50># find a current unit/file in the tree</font></i>
  <b><font color=#3a6797>set</font></b> ::alited::tree::doFocus no
  <b><font color=#3a6797>set</font></b> wtree [<font color=#1b1baa>$obPav</font> Tree]
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(TREE,isunits)</font>} {
      <i><font color=#4b5d50># search the tree for a unit with current line of text</font></i>
      <b><font color=#3a6797>set</font></b> itemID [alited::tree::CurrentItemByLine <font color=#1b1baa>$pos</font>]
    } <b><font color=#3a6797>else</font></b> {
      <i><font color=#4b5d50># search the tree for a current file</font></i>
      <b><font color=#3a6797>set</font></b> fname [alited::bar::FileName]
      <b><font color=#3a6797>set</font></b> wtree [<font color=#1b1baa>$obPav</font> Tree]
      <b><font color=#3a6797>while</font></b> {1} {
        <b><font color=#3a6797>incr</font></b> iit
        <b><font color=#3a6797>set</font></b> ID [alited::tree::NewItemID <font color=#1b1baa>$iit</font>]
        <b><font color=#3a6797>if</font></b> {![<font color=#1b1baa>$wtree</font> exists <font color=#1b1baa>$ID</font>]} <b><font color=#ca14ca>break</font></b>
        <b><font color=#3a6797>lassign</font></b> [<font color=#1b1baa>$wtree</font> item <font color=#1b1baa>$ID</font> <font color=#653760>-values</font>] -&gt; tip isfile
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tip</font> eq <font color=#1b1baa>$fname</font>} {
          <b><font color=#3a6797>set</font></b> itemID <font color=#1b1baa>$ID</font>
          <b><font color=#ca14ca>break</font></b>
        }
      }
    }
  }
  <i><font color=#4b5d50># display a current item of the tree</font></i>
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$itemID</font> ni [<font color=#1b1baa>$wtree</font> selection]} {<font color=#1b1baa>$wtree</font> selection set <font color=#1b1baa>$itemID</font>}
    <b><font color=#3a6797>after</font></b> 10 alited::tree::SeeSelection
  }
  <i><font color=#4b5d50># focus on the text</font></i>
  <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>focus</font></b> <font color=#653760>-force</font> <font color=#1b1baa>$wtxt</font>}
  <b><font color=#3a6797>catch</font></b> {::tk::TextSetCursor <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$pos</font>}
  <b><font color=#3a6797>after</font></b> idle {<b><font color=#3a6797>set</font></b> ::alited::tree::doFocus yes}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::FocusInText></a>
<b><font color=#ca14ca>proc</font></b> main::FocusInText {TID wtxt} {
  <i><font color=#4b5d50># Processes &lt;FocusIn&gt; event on the text.</font></i>
  <i><font color=#4b5d50>#   TID - tab's ID</font></i>
  <i><font color=#4b5d50>#   wtxt - text widget's path</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited obPav obPav
  <b><font color=#3a6797>if</font></b> {![alited::bar::BAR isTab <font color=#1b1baa>$TID</font>]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>catch</font></b> {
    CursorPos <font color=#1b1baa>$wtxt</font>
    [<font color=#1b1baa>$obPav</font> TreeFavor] selection set {}
    alited::file::OutwardChange <font color=#1b1baa>$TID</font>
  }
}
<a id=Highlight></a>
<i><font color=#4b5d50># ________________________ Highlight _________________________ #</font></i>
<a id=main::HighlightText></a>
<b><font color=#ca14ca>proc</font></b> main::HighlightText {TID curfile wtxt {cmd <font color=#8b2a0e>&quot;&quot;</font>} {cmdpos <font color=#8b2a0e>&quot;&quot;</font>} {fontsize <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Highlights a file's syntax constructs.</font></i>
  <i><font color=#4b5d50>#   TID - tab's ID</font></i>
  <i><font color=#4b5d50>#   curfile - file name</font></i>
  <i><font color=#4b5d50>#   wtxt - text widget's path</font></i>
  <i><font color=#4b5d50>#   cmd - callback for modifying text</font></i>
  <i><font color=#4b5d50>#   cmdpos - callback for changing cursor position</font></i>
  <i><font color=#4b5d50>#   fontsize - text font size</font></i>
  <i><font color=#4b5d50># Depending on a file name, Tcl or C highlighter is called.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <i><font color=#4b5d50># the language (Tcl or C) is defined by the file's extension</font></i>
  <b><font color=#3a6797>set</font></b> ext [<b><font color=#3a6797>string</font></b> tolower [<b><font color=#3a6797>file</font></b> extension <font color=#1b1baa>$curfile</font>]]
  <b><font color=#3a6797>set</font></b> itwas [<b><font color=#3a6797>info</font></b> exists al(HL,<font color=#1b1baa>$wtxt</font>)]
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$itwas</font> || <font color=#1b1baa>$al(HL,$wtxt)</font> ne <font color=#1b1baa>$ext</font>} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$itwas</font>} {
      <i><font color=#4b5d50># remove old syntax</font></i>
      <b><font color=#3a6797>foreach</font></b> tag [<font color=#1b1baa>$wtxt</font> tag names] {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match hil* <font color=#1b1baa>$tag</font>] && <font color=#1b1baa>$tag</font> ni {sel fndTag}} {
          <font color=#1b1baa>$wtxt</font> tag delete <font color=#1b1baa>$tag</font>
        }
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cmd</font> eq {}} {
      <b><font color=#3a6797>set</font></b> cmd <font color=#8b2a0e>&quot;::alited::edit::Modified <font color=#1b1baa>$</font>TID&quot;</font>
      <b><font color=#3a6797>set</font></b> cmdpos ::alited::main::CursorPos
    }
    <b><font color=#3a6797>set</font></b> clrnams [::hl_tcl::hl_colorNames]
    <b><font color=#3a6797>set</font></b> clrCURL [<b><font color=#3a6797>lindex</font></b> [<font color=#1b1baa>$obPav</font> csGet] 16]
    <i><font color=#4b5d50># get a color list for the highlighting Tcl and C</font></i>
    <b><font color=#3a6797>foreach</font></b> lng {{} C} {
      <b><font color=#3a6797>foreach</font></b> nam <font color=#1b1baa>$clrnams</font> {
        <b><font color=#3a6797>lappend</font></b> <font color=#8b2a0e>&quot;<font color=#1b1baa>${</font>lng<font color=#1b1baa>}</font>colors&quot;</font> <font color=#1b1baa>$al(ED,${lng}$nam)</font>
      }
      <b><font color=#3a6797>lappend</font></b> <font color=#8b2a0e>&quot;<font color=#1b1baa>${</font>lng<font color=#1b1baa>}</font>colors&quot;</font> <font color=#1b1baa>$clrCURL</font>
    }
    <b><font color=#3a6797>set</font></b> tfont <font color=#1b1baa>$al(FONT,txt)</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fontsize</font> ne {}} {<b><font color=#3a6797>append</font></b> tfont <font color=#8b2a0e>&quot; -size <font color=#1b1baa>$</font>fontsize&quot;</font>}
    <b><font color=#3a6797>if</font></b> {[alited::file::IsClang <font color=#1b1baa>$curfile</font>]} {
      <b><font color=#3a6797>lassign</font></b> [::hl_tcl::addingColors] -&gt; clrCMN2
      <b><font color=#3a6797>lappend</font></b> Ccolors <font color=#1b1baa>$clrCMN2</font>
      ::hl_c::hl_init <font color=#1b1baa>$wtxt</font> <font color=#653760>-dark</font> [<font color=#1b1baa>$obPav</font> csDark] \
        <font color=#653760>-multiline</font> 1 <font color=#653760>-keywords</font> <font color=#1b1baa>$al(ED,CKeyWords)</font> \
        <font color=#653760>-cmd</font> <font color=#1b1baa>$cmd</font> <font color=#653760>-cmdpos</font> <font color=#1b1baa>$cmdpos</font> <font color=#653760>-font</font> <font color=#1b1baa>$tfont</font> <font color=#653760>-colors</font> <font color=#1b1baa>$Ccolors</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> pltext [<b><font color=#3a6797>expr</font></b> {![alited::file::IsTcl <font color=#1b1baa>$curfile</font>]}]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pltext</font>} {
        <b><font color=#3a6797>set</font></b> plcom [alited::HighlightAddon <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$curfile</font> <font color=#1b1baa>$colors</font> <font color=#1b1baa>$fontsize</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$plcom</font> ne {}} {<b><font color=#3a6797>set</font></b> pltext 0}
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> plcom {}
      }
      ::hl_tcl::hl_init <font color=#1b1baa>$wtxt</font> <font color=#653760>-dark</font> [<font color=#1b1baa>$obPav</font> csDark] \
        <font color=#653760>-multiline</font> <font color=#1b1baa>$al(prjmultiline)</font> <font color=#653760>-keywords</font> <font color=#1b1baa>$al(ED,TclKeyWords)</font> \
        <font color=#653760>-cmd</font> <font color=#1b1baa>$cmd</font> <font color=#653760>-cmdpos</font> <font color=#1b1baa>$cmdpos</font> <font color=#653760>-plaintext</font> <font color=#1b1baa>$pltext</font> <font color=#653760>-plaincom</font> <font color=#1b1baa>$plcom</font> \
        <font color=#653760>-font</font> <font color=#1b1baa>$tfont</font> <font color=#653760>-colors</font> <font color=#1b1baa>$colors</font>
    }
    UpdateText <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$curfile</font>
    BindsForCode <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$curfile</font>
  }
  <b><font color=#3a6797>set</font></b> al(HL,<font color=#1b1baa>$wtxt</font>) <font color=#1b1baa>$ext</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::HighlightLine></a>
<b><font color=#ca14ca>proc</font></b> main::HighlightLine {} {
  <i><font color=#4b5d50># Highlights a current line of a current text.</font></i>

  <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
  <b><font color=#3a6797>if</font></b> {[alited::file::IsClang [alited::bar::FileName]]} {
    ::hl_c::hl_line <font color=#1b1baa>$wtxt</font>
  } <b><font color=#3a6797>else</font></b> {
    ::hl_tcl::hl_line <font color=#1b1baa>$wtxt</font>
  }
}
<a id=Line></a>
<i><font color=#4b5d50># ________________________ Line _________________________ #</font></i>
<a id=main::CursorPos></a>
<b><font color=#ca14ca>proc</font></b> main::CursorPos {wtxt args} {
  <i><font color=#4b5d50># Displays a current text's row and column in the status bar.</font></i>
  <i><font color=#4b5d50>#   wtxt - text widget's path</font></i>
  <i><font color=#4b5d50>#   args - contains a cursor position,</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited obPav obPav
  <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wtxt</font>]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$args</font> eq {}} {<b><font color=#3a6797>set</font></b> args [<font color=#1b1baa>$wtxt</font> index {end -1 char}]}
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$wtxt</font> index insert] .] r c
  <b><font color=#3a6797>set</font></b> R [<b><font color=#3a6797>expr</font></b> {int([<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0])}]
  <b><font color=#3a6797>set</font></b> c [<b><font color=#3a6797>incr</font></b> c]
  <b><font color=#3a6797>set</font></b> wrow [<font color=#1b1baa>$obPav</font> Labstat1]
  <b><font color=#3a6797>set</font></b> wcol [<font color=#1b1baa>$obPav</font> Labstat2]
  <b><font color=#3a6797>set</font></b> textrow <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>r / <font color=#1b1baa>$</font>R&quot;</font>
  <b><font color=#3a6797>set</font></b> textcol <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>c&quot;</font>
  ::baltip tip <font color=#1b1baa>$wrow</font> <font color=#1b1baa>$textrow</font>
  ::baltip tip <font color=#1b1baa>$wcol</font> <font color=#1b1baa>$textcol</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$R</font>&gt;99999} {<b><font color=#3a6797>set</font></b> textrow <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>r / *****&quot;</font>}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c</font>&gt;9999} {<b><font color=#3a6797>set</font></b> textcol ****}
  <font color=#1b1baa>$wrow</font> configure <font color=#653760>-text</font> <font color=#1b1baa>$textrow</font>
  <font color=#1b1baa>$wcol</font> configure <font color=#653760>-text</font> <font color=#1b1baa>$textcol</font>
  alited::tree::SaveCursorPos
  alited::edit::RectSelection 1
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::InsertLine></a>
<b><font color=#ca14ca>proc</font></b> main::InsertLine {} {
  <i><font color=#4b5d50># Puts a new line into a text, attentive to a previous line's indentation.</font></i>

  <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
  <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$wtxt</font> index insert])}]
  <b><font color=#3a6797>set</font></b> line [<font color=#1b1baa>$wtxt</font> get <font color=#1b1baa>$ln</font>.0 <font color=#1b1baa>$ln</font>.end]
  <b><font color=#3a6797>set</font></b> leadsp [obj leadingSpaces <font color=#1b1baa>$line</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$line</font>] 0] eq <font color=#8b2a0e>&quot;\}&quot;</font>} {
    <b><font color=#3a6797>incr</font></b> leadsp [<b><font color=#3a6797>lindex</font></b> [CalcIndentation] 0]
  }
  <font color=#1b1baa>$wtxt</font> insert <font color=#1b1baa>$ln</font>.0 <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>string repeat <font color=#1b1baa>{</font> <font color=#1b1baa>}</font> <font color=#1b1baa>$</font>leadsp<font color=#1b1baa>]</font>\n&quot;</font>
  <b><font color=#3a6797>set</font></b> pos <font color=#1b1baa>$ln</font>.<font color=#1b1baa>$leadsp</font>
  ::tk::TextSetCursor <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$pos</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::GotoBracket></a>
<b><font color=#ca14ca>proc</font></b> main::GotoBracket {{frommenu no}} {
  <i><font color=#4b5d50># Processes Alt+B keypressing: &quot;go to a matched bracket&quot;.</font></i>
  <i><font color=#4b5d50>#   frommenu - yes, if run from a menu</font></i>

  <i><font color=#4b5d50># search a pair for a bracket highlighted</font></i>
  <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> [<b><font color=#3a6797>set</font></b> tagged [<font color=#1b1baa>$wtxt</font> tag ranges tagBRACKET]]]==4} {
    <b><font color=#3a6797>set</font></b> p [<font color=#1b1baa>$wtxt</font> index insert]
    <b><font color=#3a6797>set</font></b> p1 [<font color=#1b1baa>$wtxt</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>p +1c&quot;</font>]
    <b><font color=#3a6797>set</font></b> p2 [<font color=#1b1baa>$wtxt</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>p -1c&quot;</font>]
    <b><font color=#3a6797>foreach</font></b> {pos1 pos2} <font color=#1b1baa>$tagged</font> {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> -]==2 || (<font color=#1b1baa>$pos1</font>!=<font color=#1b1baa>$p</font> && <font color=#1b1baa>$pos1</font>!=<font color=#1b1baa>$p1</font> && <font color=#1b1baa>$pos1</font>!=<font color=#1b1baa>$p2</font>)} {
        FocusText [alited::bar::CurrentTabID] <font color=#1b1baa>$pos1</font>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$frommenu</font>} SaveVisitInfo
        <b><font color=#ca14ca>break</font></b>
      }
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::GotoLine></a>
<b><font color=#ca14ca>proc</font></b> main::GotoLine {} {
  <i><font color=#4b5d50># Processes Ctrl+G keypressing: &quot;go to a line&quot;.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obDl2 obDl2
  <b><font color=#3a6797>set</font></b> head [msgcat::mc {Go to Line}]
  <b><font color=#3a6797>set</font></b> prompt1 [msgcat::mc {Line number:}]
  <b><font color=#3a6797>set</font></b> prompt2 [msgcat::mc {    In unit:}]
  <b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]
  <b><font color=#3a6797>set</font></b> ln 1 ;<i><font color=#4b5d50>#[expr {int([$wtxt index insert])}]</font></i>
  <b><font color=#3a6797>set</font></b> lmax [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$wtxt</font> index <font color=#8b2a0e>&quot;end -1c&quot;</font>])}]
  <b><font color=#3a6797>set</font></b> units [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> TID [alited::bar::CurrentTabID]
  <b><font color=#3a6797>foreach</font></b> it <font color=#1b1baa>$al(_unittree,$TID)</font> {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$it</font> lev leaf fl1 title l1 l2
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$leaf</font> && [<b><font color=#3a6797>set</font></b> title [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$title</font>]] ne {}} {
      <b><font color=#3a6797>lappend</font></b> units <font color=#1b1baa>$title</font>
    }
  }
  <b><font color=#3a6797>set</font></b> ::alited::main::gotoline2 [<b><font color=#3a6797>linsert</font></b> [<b><font color=#3a6797>lsort</font></b> <font color=#653760>-nocase</font> <font color=#1b1baa>$units</font>] 0 {}]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::alited::main::gotolineTID</font> ne <font color=#1b1baa>$TID</font>} {
    <b><font color=#3a6797>set</font></b> ::alited::main::gotoline1 {}
    <b><font color=#3a6797>set</font></b> ::alited::main::gotolineTID <font color=#1b1baa>$TID</font>
  }
  <b><font color=#3a6797>after</font></b> 300 {<b><font color=#3a6797>catch</font></b> {<b><font color=#134070>bind</font></b> [apave::dlgPath] &lt;F1&gt; {alited::main::Help goline}}}
  <b><font color=#3a6797>lassign</font></b> [<font color=#1b1baa>$obDl2</font> input {} <font color=#1b1baa>$head</font> [<b><font color=#3a6797>list</font></b> \
    spx <font color=#8b2a0e>&quot;<font color=#1b1baa>{$</font>prompt1<font color=#1b1baa>}</font> <font color=#1b1baa>{}</font> <font color=#1b1baa>{</font>-from 1 -to <font color=#1b1baa>$</font>lmax -selected yes<font color=#1b1baa>}</font>&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>{$</font>ln<font color=#1b1baa>}</font>&quot;</font> \
    cbx <font color=#8b2a0e>&quot;<font color=#1b1baa>{$</font>prompt2<font color=#1b1baa>}</font> <font color=#1b1baa>{}</font> <font color=#1b1baa>{</font>-tvar ::alited::main::gotoline1 -state readonly -h 16 -w 25<font color=#1b1baa>}</font>&quot;</font> \
      <font color=#8b2a0e>&quot;<font color=#1b1baa>{$</font>::alited::main::gotoline1<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>::alited::main::gotoline2&quot;</font> \
  ]] res ln unit
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$res</font>} {
    <b><font color=#3a6797>set</font></b> ::alited::main::gotoline1 <font color=#1b1baa>$unit</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$unit</font> ne {}} {
      <i><font color=#4b5d50># for a chosen unit - a relative line number</font></i>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> it [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-index</font> 3 <font color=#1b1baa>$al(_unittree,$TID)</font> <font color=#1b1baa>$unit</font>]] &gt;- 1} {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$al(_unittree,$TID)</font> <font color=#1b1baa>$it</font>] lev leaf fl1 title l1 l2
        <b><font color=#3a6797>set</font></b> l <font color=#1b1baa>$l1</font>
        <b><font color=#3a6797>set</font></b> fst 1
        <b><font color=#3a6797>foreach</font></b> line [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$wtxt</font> get <font color=#1b1baa>$l1</font>.0 <font color=#1b1baa>$l2</font>.end] \n] {
          <i><font color=#4b5d50># gentlemen, use \ for continuation of long lines & strings!</font></i>
          <b><font color=#3a6797>set</font></b> continued [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> end] eq <font color=#8b2a0e>&quot;\\&quot;</font>}]
          <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$continued</font> || <font color=#1b1baa>$fst</font>} {
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fst</font>} {
              <b><font color=#3a6797>set</font></b> l <font color=#1b1baa>$l1</font>
              <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> ln -1]&lt;1} <b><font color=#ca14ca>break</font></b>
            }
            <b><font color=#3a6797>set</font></b> fst [<b><font color=#3a6797>expr</font></b> {!<font color=#1b1baa>$continued</font>}]
          }
          <b><font color=#3a6797>incr</font></b> l1
        }
        <b><font color=#3a6797>set</font></b> ln <font color=#1b1baa>$l</font>
      }
    }
    <b><font color=#3a6797>after</font></b> 200 <font color=#8b2a0e>&quot; \</font>
<font color=#8b2a0e>      alited::main::FocusText <font color=#1b1baa>$</font>TID <font color=#1b1baa>$</font>ln.0 ; \</font>
<font color=#8b2a0e>      alited::tree::NewSelection <font color=#1b1baa>{}</font> <font color=#1b1baa>$</font>ln.0 yes; \</font>
<font color=#8b2a0e>      alited::main::HighlightLine&quot;</font>
  }
}
<a id=Event_handlers></a>
<i><font color=#4b5d50># ________________________ Event handlers _________________________ #</font></i>
<a id=main::SaveVisitInfo></a>
<b><font color=#ca14ca>proc</font></b> main::SaveVisitInfo {{wtxt <font color=#8b2a0e>&quot;&quot;</font>} {K <font color=#8b2a0e>&quot;&quot;</font>} {s 0}} {
  <i><font color=#4b5d50># Remembers data about current unit.</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>
  <i><font color=#4b5d50>#   K - key pressed (to check keypressings)</font></i>
  <i><font color=#4b5d50>#   s - key's state</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <i><font color=#4b5d50># only for unit tree and not navigation key</font></i>
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$al(TREE,isunits)</font> || [alited::favor::SkipVisited] || \
  <font color=#1b1baa>$K</font> in {Tab Up Down Left Right Next Prior Home End Insert} || \
  [<b><font color=#3a6797>string</font></b> match *Cont* <font color=#1b1baa>$K</font>]} {
    <b><font color=#ca14ca>return</font></b>
  }
  <i><font color=#4b5d50># check for current text and current unit's lines</font></i>
  <b><font color=#3a6797>set</font></b> wcur [CurrentWTXT]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wtxt</font> eq {}} {
    <b><font color=#3a6797>set</font></b> wtxt <font color=#1b1baa>$wcur</font>
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$wtxt</font> ne <font color=#1b1baa>$wcur</font>} {
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>set</font></b> wtree [<font color=#1b1baa>$obPav</font> Tree]
  <b><font color=#3a6797>set</font></b> pos [<font color=#1b1baa>$wtxt</font> index insert]
  <b><font color=#3a6797>lassign</font></b> [alited::tree::CurrentItemByLine <font color=#1b1baa>$pos</font> 1] itemID - - - name l1
  <b><font color=#3a6797>set</font></b> header [alited::unit::GetHeader <font color=#1b1baa>$wtree</font> <font color=#1b1baa>$itemID</font>]
  <b><font color=#3a6797>set</font></b> gokeys [<b><font color=#3a6797>list</font></b> {}]
  <b><font color=#3a6797>foreach</font></b> gk {F3 AltQ AltW} {
    <b><font color=#3a6797>lappend</font></b> gokeys {<b><font color=#3a6797>*</font></b>}[apave::getTextHotkeys <font color=#1b1baa>$gk</font>]
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$K</font> in <font color=#1b1baa>$gokeys</font> || (<font color=#1b1baa>$s</font> & 0b1000)} {
    <b><font color=#3a6797>set</font></b> l1 -1 ;<i><font color=#4b5d50># to avoid a unit's name spawned in last visits at its change</font></i>
  }
  alited::favor::LastVisited [<font color=#1b1baa>$wtree</font> item <font color=#1b1baa>$itemID</font>] <font color=#1b1baa>$header</font> <font color=#1b1baa>$l1</font>
  <b><font color=#3a6797>set</font></b> selID [<font color=#1b1baa>$wtree</font> selection]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$selID</font>]&lt;2 && <font color=#1b1baa>$selID</font> ne <font color=#1b1baa>$itemID</font>} {
    <font color=#1b1baa>$wtree</font> selection set <font color=#1b1baa>$itemID</font>
    <font color=#1b1baa>$wtree</font> see <font color=#1b1baa>$itemID</font>
    alited::tree::AddTagSel <font color=#1b1baa>$wtree</font> <font color=#1b1baa>$itemID</font>
  }
  <b><font color=#3a6797>set</font></b> TID [alited::bar::CurrentTabID]
  <b><font color=#3a6797>foreach</font></b> it <font color=#1b1baa>$al(_unittree,$TID)</font> {
    <b><font color=#3a6797>set</font></b> treeID [alited::tree::NewItemID [<b><font color=#3a6797>incr</font></b> iit]]
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$it</font> lev leaf fl1 title l1 l2
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$name</font> eq [alited::tree::UnitTitle <font color=#1b1baa>$title</font> <font color=#1b1baa>$l1</font> <font color=#1b1baa>$l2</font>]} {
      <b><font color=#3a6797>set</font></b> al(CPOS,<font color=#1b1baa>$TID</font>,<font color=#1b1baa>$header</font>) [::apave::p+ <font color=#1b1baa>$pos</font> -<font color=#1b1baa>$l1</font>]
      <b><font color=#ca14ca>return</font></b>
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::AfterUndoRedo></a>
<b><font color=#ca14ca>proc</font></b> main::AfterUndoRedo {} {
  <i><font color=#4b5d50># Actions after undo/redo.</font></i>

  HighlightLine
  <b><font color=#3a6797>after</font></b> 0 {<b><font color=#3a6797>after</font></b> idle {
    alited::main::SaveVisitInfo
    alited::main::UpdateUnitTree
    alited::main::FocusText}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::AfterCut></a>
<b><font color=#ca14ca>proc</font></b> main::AfterCut {} {
  <i><font color=#4b5d50># Actions after cutting text: resets the unit tree's selection.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(TREE,isunits)</font>} {
    [<font color=#1b1baa>$obPav</font> Tree] selection set {}
    <b><font color=#3a6797>after</font></b> idle alited::main::FocusText
  }
}
<a id=GUI></a>
<i><font color=#4b5d50># ________________________ GUI _________________________ #</font></i>
<a id=main::ShowHeader></a>
<b><font color=#ca14ca>proc</font></b> main::ShowHeader {{doit no}} {
  <i><font color=#4b5d50># Displays a file's name and modification flag (*) in alited's title.</font></i>
  <i><font color=#4b5d50>#   doit - if yes, displays unconditionally.</font></i>
  <i><font color=#4b5d50># If *doit* is *no*, displays only at changing a file name or a flag.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>if</font></b> {[alited::file::IsModified]} {<b><font color=#3a6797>set</font></b> modif <font color=#8b2a0e>&quot;*&quot;</font>} {<b><font color=#3a6797>set</font></b> modif <font color=#8b2a0e>&quot; &quot;</font>}
  <b><font color=#3a6797>set</font></b> TID [alited::bar::CurrentTabID]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doit</font> || <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>modif<font color=#1b1baa>$</font>TID&quot;</font> ne [alited::bar::BAR cget <font color=#653760>-ALmodif</font>]} {
    alited::bar::BAR configure <font color=#653760>-ALmodif</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>modif<font color=#1b1baa>$</font>TID&quot;</font>
    <b><font color=#3a6797>set</font></b> f [alited::bar::CurrentTab 1]
    <b><font color=#3a6797>set</font></b> d [<b><font color=#3a6797>file</font></b> normalize [<b><font color=#3a6797>file</font></b> dirname [alited::bar::CurrentTab 2]]]
    <b><font color=#3a6797>set</font></b> ttl [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %f <font color=#1b1baa>$f</font> %d <font color=#1b1baa>$d</font> %p <font color=#1b1baa>$al(prjname)</font>] <font color=#1b1baa>$al(TITLE)</font>]
    <b><font color=#134070>wm</font></b> title <font color=#1b1baa>$al(WIN)</font> [<b><font color=#3a6797>string</font></b> trim <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>modif<font color=#1b1baa>$</font>ttl&quot;</font>]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::CalcIndentation></a>
<b><font color=#ca14ca>proc</font></b> main::CalcIndentation {{wtxt <font color=#8b2a0e>&quot;&quot;</font>} {doit no}} {
  <i><font color=#4b5d50># Check for &quot;Auto detection of indentation&quot; and calculates it at need.</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>
  <i><font color=#4b5d50>#   doit - if yes, recalculates the indentation</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$al(prjindent)</font> { }]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjindentAuto)</font>} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wtxt</font> eq {}} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> wtxt [CurrentWTXT]}]} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>}
    }
    <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wtxt</font>]} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>}
    <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$doit</font> && [<b><font color=#3a6797>info</font></b> exists al(_INDENT_,<font color=#1b1baa>$wtxt</font>)]} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$al(_INDENT_,$wtxt)</font>}
    <b><font color=#3a6797>foreach</font></b> line [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$wtxt</font> get 1.0 end] \n] {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> lsp [obj leadingSpaces <font color=#1b1baa>$line</font>]]&gt;0} {
        <i><font color=#4b5d50># check if the indentation is homogeneous</font></i>
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first [<b><font color=#3a6797>string</font></b> repeat { } <font color=#1b1baa>$lsp</font>] <font color=#1b1baa>$line</font>]==0} {
          <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$lsp</font> { }]
          <b><font color=#ca14ca>break</font></b>
        } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> first [<b><font color=#3a6797>string</font></b> repeat \t <font color=#1b1baa>$lsp</font>] <font color=#1b1baa>$line</font>]==0} {
          <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$lsp</font> \t]
          <b><font color=#ca14ca>break</font></b>
        }
      }
    }
    <b><font color=#3a6797>set</font></b> al(_INDENT_,<font color=#1b1baa>$wtxt</font>) <font color=#1b1baa>$res</font>  ;<i><font color=#4b5d50># to omit the calculation next time</font></i>
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::CalcPad></a>
<b><font color=#ca14ca>proc</font></b> main::CalcPad {{wtxt <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Calculates the indenting pad for the edited text.</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>

  <b><font color=#3a6797>lassign</font></b> [CalcIndentation <font color=#1b1baa>$wtxt</font>] pad padchar
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>string</font></b> repeat <font color=#1b1baa>$padchar</font> <font color=#1b1baa>$pad</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::UpdateProjectInfo></a>
<b><font color=#ca14ca>proc</font></b> main::UpdateProjectInfo {{indent {}}} {
  <i><font color=#4b5d50># Displays a project settings in the status bar.</font></i>
  <i><font color=#4b5d50>#   indent - indentation calculated for a text</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjroot)</font> ne {}} {<b><font color=#3a6797>set</font></b> stsw normal} {<b><font color=#3a6797>set</font></b> stsw disabled}
  [<font color=#1b1baa>$obPav</font> BtTswitch] configure <font color=#653760>-state</font> <font color=#1b1baa>$stsw</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> eol [alited::file::EOL]}] || <font color=#1b1baa>$eol</font> eq {}} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> eol <font color=#1b1baa>$al(prjEOL)</font>] eq {}} {<b><font color=#3a6797>set</font></b> eol auto}
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$eol</font>] -&gt; eol
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$indent</font> eq {}} {<b><font color=#3a6797>set</font></b> indent [<b><font color=#3a6797>lindex</font></b> [CalcIndentation] 0]}
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> enc [alited::file::Encoding]}] || <font color=#1b1baa>$enc</font> eq {}} {
    <b><font color=#3a6797>set</font></b> enc utf-8
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$enc</font>] -&gt; enc
  }
  <b><font color=#3a6797>set</font></b> info <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>enc, eol=<font color=#1b1baa>$</font>eol, ind=<font color=#1b1baa>$</font>indent&quot;</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjindentAuto)</font>} {<b><font color=#3a6797>append</font></b> info /auto}
  [<font color=#1b1baa>$obPav</font> Labstat4] configure <font color=#653760>-text</font> <font color=#1b1baa>$info</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::TipStatus></a>
<b><font color=#ca14ca>proc</font></b> main::TipStatus {} {
  <i><font color=#4b5d50># Gets a tip for a status bar's short info.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>set</font></b> run <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,run) &quot;</font>
  <b><font color=#3a6797>switch</font></b> <font color=#1b1baa>$al(prjincons)</font> {
    0 {<b><font color=#3a6797>append</font></b> run <font color=#1b1baa>$al(MC,intkcon)</font>}
    1 {<b><font color=#3a6797>append</font></b> run <font color=#1b1baa>$al(MC,inconsole)</font>}
    2 {<b><font color=#3a6797>append</font></b> run <font color=#1b1baa>$al(MC,asis)</font>}
  }
  <b><font color=#3a6797>if</font></b> {[alited::tool::ComForced]} {
    <b><font color=#3a6797>append</font></b> run :\ <font color=#1b1baa>$al(comForce)</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lassign</font></b> [alited::tool::RunArgs] ar rf ex
    <b><font color=#3a6797>append</font></b> run :\ <font color=#1b1baa>$ar$rf$ex</font>
  }
  <b><font color=#3a6797>set</font></b> tip [[<font color=#1b1baa>$obPav</font> Labstat4] cget <font color=#653760>-text</font>]
  <b><font color=#3a6797>set</font></b> tip [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \
    eol= <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,EOL:) &quot;</font> \
    ind= <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,indent:) &quot;</font> \
    {, } \n \
    ] <font color=#1b1baa>$tip</font>]
  <b><font color=#ca14ca>return</font></b> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>run\n\n<font color=#1b1baa>[</font>msgcat::mc Encoding<font color=#1b1baa>]</font>: <font color=#1b1baa>$</font>tip&quot;</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::BindsForText></a>
<b><font color=#ca14ca>proc</font></b> main::BindsForText {TID wtxt} {
  <i><font color=#4b5d50># Sets bindings for a text.</font></i>
  <i><font color=#4b5d50>#   TID - tab's ID</font></i>
  <i><font color=#4b5d50>#   wtxt - text widget's path</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>if</font></b> {[alited::bar::BAR isTab <font color=#1b1baa>$TID</font>]} {
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;FocusIn&gt; [<b><font color=#3a6797>list</font></b> after 500 <font color=#8b2a0e>&quot;::alited::main::FocusInText <font color=#1b1baa>$</font>TID <font color=#1b1baa>$</font>wtxt&quot;</font>]
  }
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Control-ButtonRelease-1&gt; <font color=#8b2a0e>&quot;::alited::find::LookDecl ; break&quot;</font>
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Control-Shift-ButtonRelease-1&gt; {alited::find::SearchWordInSession ; <b><font color=#ca14ca>break</font></b>}
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Control-Tab&gt; {alited::bar::ControlTab}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(IsWindows)</font>} {
    <i><font color=#4b5d50># unlike Unix, Shift+Key doesn't work in Windows</font></i>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Tab&gt; \
      [<b><font color=#3a6797>list</font></b> + if {{%K} eq {Tab} && {%s}==1} <font color=#8b2a0e>&quot;focus <font color=#1b1baa>[$</font>obPav LbxInfo<font color=#1b1baa>]</font>; break&quot;</font>]
  }
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Alt-BackSpace&gt; {alited::unit::SwitchUnits ; <b><font color=#ca14ca>break</font></b>}
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;space&gt; <font color=#8b2a0e>&quot;+ alited::unit::PutTypeTemplate <font color=#1b1baa>$</font>wtxt&quot;</font>
  ::apave::bindToEvent <font color=#1b1baa>$wtxt</font> &lt;ButtonRelease-1&gt; alited::main::SaveVisitInfo <font color=#1b1baa>$wtxt</font>
  ::apave::bindToEvent <font color=#1b1baa>$wtxt</font> &lt;KeyRelease&gt; alited::main::SaveVisitInfo <font color=#1b1baa>$wtxt</font> %K %s
  ::apave::bindToEvent <font color=#1b1baa>$wtxt</font> &lt;&lt;Undo&gt;&gt; alited::main::AfterUndoRedo
  ::apave::bindToEvent <font color=#1b1baa>$wtxt</font> &lt;&lt;Redo&gt;&gt; alited::main::AfterUndoRedo
  ::apave::bindToEvent <font color=#1b1baa>$wtxt</font> &lt;&lt;Cut&gt;&gt; <b><font color=#3a6797>after</font></b> 50 {<b><font color=#3a6797>after</font></b> 50 alited::main::AfterCut}
  alited::keys::ReservedAdd
  alited::keys::BindAllKeys <font color=#1b1baa>$wtxt</font> no
  alited::edit::BindPluginables <font color=#1b1baa>$wtxt</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::BindsForCode></a>
<b><font color=#ca14ca>proc</font></b> main::BindsForCode {wtxt curfile} {
  <i><font color=#4b5d50># Sets bindings for a code.</font></i>
  <i><font color=#4b5d50>#   wtxt - text widget's path</font></i>
  <i><font color=#4b5d50>#   curfile - current file's name</font></i>

<i><font color=#4b5d50>#  if {[alited::file::IsTcl $curfile] || [alited::file::IsClang $curfile]} {</font></i>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Control-Right&gt; <font color=#8b2a0e>&quot;alited::edit::ControlRight <font color=#1b1baa>$</font>wtxt %s&quot;</font>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wtxt</font> &lt;Control-Left&gt; <font color=#8b2a0e>&quot;alited::edit::ControlLeft <font color=#1b1baa>$</font>wtxt %s&quot;</font>
<i><font color=#4b5d50>#  }</font></i>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::PackTextWidgets></a>
<b><font color=#ca14ca>proc</font></b> main::PackTextWidgets {wtxt wsbv} {
  <i><font color=#4b5d50># Packs a text and its scrollbar.</font></i>
  <i><font color=#4b5d50>#   wtxt - text widget's path</font></i>
  <i><font color=#4b5d50>#   wsbv - scrollbar widget's path</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$wtxt</font> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$wsbv</font> <font color=#653760>-fill</font> y <font color=#653760>-expand</font> 1
  <b><font color=#3a6797>lassign</font></b> [GutterAttrs] canvas width shift
  <i><font color=#4b5d50># widgets created outside apave require the theming:</font></i>
  <font color=#1b1baa>$obPav</font> csSet [<font color=#1b1baa>$obPav</font> csCurrent] <font color=#1b1baa>$al(WIN)</font> <font color=#653760>-doit</font>
  <font color=#1b1baa>$obPav</font> bindGutter <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$canvas</font> <font color=#1b1baa>$width</font> <font color=#1b1baa>$shift</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::ShowOutdatedTODO></a>
<b><font color=#ca14ca>proc</font></b> main::ShowOutdatedTODO {prj date todo is} {
  <i><font color=#4b5d50># Shows a balloon with outdated TODO.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>
  <i><font color=#4b5d50>#   date - date of TODO</font></i>
  <i><font color=#4b5d50>#   todo - text of TODO</font></i>
  <i><font color=#4b5d50>#   is - 1 for current day TODO, 2 for &quot;ahead&quot; TODO</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> todo <font color=#8b2a0e>&quot;\n<font color=#1b1baa>$</font>al(MC,prjName) <font color=#1b1baa>$</font>prj\n\n<font color=#1b1baa>$</font>al(MC,on) <font color=#1b1baa>$</font>date\n\n<font color=#1b1baa>$</font>todo\n&quot;</font>
  <b><font color=#3a6797>set</font></b> opts {}
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first !!! <font color=#1b1baa>$todo</font>]&gt;-1 || (<font color=#1b1baa>$is</font>==1 && <font color=#1b1baa>$al(todoahead)</font>)} {
    <b><font color=#3a6797>set</font></b> opts {<font color=#653760>-ontop</font> 1 <font color=#653760>-eternal</font> 1 <font color=#653760>-fg</font> white <font color=#653760>-bg</font> red}
  }
  ::alited::Balloon <font color=#1b1baa>$todo</font> yes 2500 {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opts</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::InitActions></a>
<b><font color=#ca14ca>proc</font></b> main::InitActions {} {
  <i><font color=#4b5d50># Initializes working with a main form of alited.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <i><font color=#4b5d50># fill the bars waiting for full size of text widget</font></i>
  alited::bar::FillBar [<font color=#1b1baa>$obPav</font> BtsBar]
  FillMarkBar
  <i><font color=#4b5d50># check for outdated TODOs for current project</font></i>
  <b><font color=#3a6797>lassign</font></b> [alited::project::IsOutdated <font color=#1b1baa>$al(prjname)</font> yes] is date todo
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$is</font>} {
    ShowOutdatedTODO <font color=#1b1baa>$al(prjname)</font> <font color=#1b1baa>$date</font> <font color=#1b1baa>$todo</font> <font color=#1b1baa>$is</font>
  } <b><font color=#3a6797>else</font></b> {
    <i><font color=#4b5d50># check other projects</font></i>
    alited::project::SaveSettings
    alited::project::GetProjects
    <b><font color=#3a6797>set</font></b> prjname [alited::project::CheckOutdated]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prjname</font> ne {}} {
      <b><font color=#3a6797>lassign</font></b> [alited::project::IsOutdated <font color=#1b1baa>$prjname</font> yes] is date todo
      ShowOutdatedTODO <font color=#1b1baa>$prjname</font> <font color=#1b1baa>$date</font> <font color=#1b1baa>$todo</font> <font color=#1b1baa>$is</font>
    }
  }
  <b><font color=#3a6797>after</font></b> idle {alited::main::UpdateGutter; alited::main::FocusText}  ;<i><font color=#4b5d50># get it for sure</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(INI,isfindrepl)</font>} {
    <b><font color=#3a6797>after</font></b> idle {<b><font color=#3a6797>after</font></b> 100 {  ;<i><font color=#4b5d50># for getting a current word to find</font></i>
      alited::find::_run
      <b><font color=#134070>focus</font></b> <font color=#1b1baa>$::alited::al(WIN)</font>; alited::main::FocusText
      <b><font color=#3a6797>after</font></b> idle {<b><font color=#3a6797>after</font></b> 100 {<b><font color=#3a6797>after</font></b> idle {<b><font color=#3a6797>after</font></b> 100 alited::main::FocusText}}}
    }}
  }
  <i><font color=#4b5d50># Ctrl-click for Run, e_menu, Tkcon buttons</font></i>
  <b><font color=#3a6797>foreach</font></b> ico {run e_menu other} {
    <b><font color=#3a6797>set</font></b> but [alited::tool::ToolButName <font color=#1b1baa>$ico</font>]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$but</font> &lt;Control-Button-1&gt; <font color=#1b1baa>$al(runAsIs)</font>
    <b><font color=#3a6797>set</font></b> tip [::baltip::cget <font color=#1b1baa>$but</font> <font color=#653760>-text</font>][alited::tool::AddTooltipRun]
    <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> ::baltip::tip <font color=#1b1baa>$but</font> <font color=#1b1baa>$tip</font>]
  }
  <b><font color=#3a6797>foreach</font></b> ico {undo redo} {
    <b><font color=#3a6797>set</font></b> but [alited::tool::ToolButName <font color=#1b1baa>$ico</font>]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$but</font> &lt;Control-Button-1&gt; alited::tool::<font color=#1b1baa>${ico}</font>All
    <b><font color=#3a6797>set</font></b> tip [::baltip::cget <font color=#1b1baa>$but</font> <font color=#653760>-text</font>]
    <b><font color=#3a6797>append</font></b> tip <font color=#8b2a0e>&quot;\n\nCtrl+click = <font color=#1b1baa>[</font>msgcat::mc <font color=#1b1baa>{</font>All in text<font color=#1b1baa>}]</font>&quot;</font>
    <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> ::baltip::tip <font color=#1b1baa>$but</font> <font color=#1b1baa>$tip</font>]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=main::ProcMessage></a>
<b><font color=#ca14ca>proc</font></b> main::ProcMessage {lab} {
  <i><font color=#4b5d50># Handles clicking on message label.</font></i>

  <b><font color=#3a6797>set</font></b> msg [baltip cget <font color=#1b1baa>$lab</font> <font color=#653760>-text</font>]
  alited::Message <font color=#1b1baa>$msg</font> 3 <font color=#1b1baa>$lab</font>
}
<a id=Main__create></a>
<i><font color=#4b5d50># ________________________ Main _create _________________________ #</font></i>
<a id=main::_create></a>
<b><font color=#ca14ca>proc</font></b> main::_create {} {
  <i><font color=#4b5d50># Creates a main form of the alited.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  <b><font color=#3a6797>set</font></b> al(AU!) 0
  <font color=#1b1baa>$obPav</font> untouchWidgets *.frAText *.lbxInfo *.lbxFlist *.too*
  <i><font color=#4b5d50># make the main apave object and populate it</font></i>
  <font color=#1b1baa>$obPav</font> makeWindow <font color=#1b1baa>$al(WIN)</font>.fra alited

  <i><font color=#4b5d50># alited_checked</font></i>
<a id=Main_window></a>
<i><font color=#4b5d50>## ________________________ Main window _________________________ ##</font></i>

  <font color=#1b1baa>$obPav</font> paveWindow <font color=#1b1baa>$al(WIN)</font>.fra {
    {Menu - - - - - {<font color=#653760>-array</font> {
      <b><font color=#3a6797>file</font></b> File
      edit Edit
      search Search
      tool Tools
      setup Setup
      help Help
    }} alited::menu::FillMenu}
{#<a id=Main_pan></a>
<i><font color=#4b5d50>### ________________________ Main pan _________________________ ###</font></i>
}
    {frat - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both}}
    {frat.ToolTop - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top}
      {<font color=#653760>-relief</font> flat <font color=#653760>-borderwidth</font> 0 <font color=#653760>-array</font> {<font color=#1b1baa>$::alited::al(atools)</font>}
      <font color=#653760>-onevent</font> {&lt;ButtonPress-3&gt; <font color=#8b2a0e>&quot;alited::tool::PopupBar %X %Y&quot;</font>}}}
    {fra - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1 <font color=#653760>-pady</font> 0}}
    {fra.Pan - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1} {<font color=#653760>-orient</font> horizontal
      <font color=#1b1baa>$::alited::Pan_wh</font> <font color=#653760>-onevent</font> {&lt;ButtonRelease&gt; alited::tree::AdjustWidth}}}
    {fra.pan.PanL - - - - {add} {<font color=#653760>-orient</font> vertical <font color=#1b1baa>$::alited::PanL_wh</font>}}
    {.fraBot - - - - {add}}
{#<a id=Tree_pan></a>
<i><font color=#4b5d50>### ________________________ Tree pan _________________________ ###</font></i>
}
    {.fraBot.PanBM - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1} {<font color=#1b1baa>$::alited::PanBM_wh</font>}}
    {.fraBot.panBM.FraTree - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}}
    {.fraBot.panBM.fraTree.fra1 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x}}
{#<a id=Tree's_toolbar></a>
<i><font color=#4b5d50>#### ________________________ Tree's toolbar _________________________ ####</font></i>
}
    {.fraBot.panBM.fraTree.fra1.BtTswitch - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_gulls <font color=#653760>-com</font> alited::tree::SwitchTree}}
    {.fraBot.panBM.fraTree.fra1.BtTUpdT - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_retry <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,updtree)</font>}
    <font color=#653760>-command</font> alited::main::UpdateAll}}
    {.fraBot.panBM.fraTree.fra1.sev1 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> y <font color=#653760>-padx</font> 5}}
    {.fraBot.panBM.fraTree.fra1.BtTUp - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_up <font color=#653760>-com</font> {alited::tree::MoveItem up}}}
    {.fraBot.panBM.fraTree.fra1.BtTDown - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_down <font color=#653760>-com</font> {alited::tree::MoveItem down}}}
    {.fraBot.panBM.fraTree.fra1.sev2 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> y <font color=#653760>-padx</font> 5}}
    {.fraBot.panBM.fraTree.fra1.BtTAddT - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_add <font color=#653760>-com</font> alited::tree::AddItem}}
    {.fraBot.panBM.fraTree.fra1.BtTRenT - - - - {<b><font color=#134070>pack</font></b> forget <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_change <font color=#653760>-tip</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,renamefile)\nF2&quot;</font>
      <font color=#653760>-com</font> {alited::file::RenameFileInTree 0 <font color=#653760>-geometry</font> pointer+10+10}}}
    {.fraBot.panBM.fraTree.fra1.BtTDelT - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_delete <font color=#653760>-com</font> alited::tree::DelItem}}
    {.fraBot.panBM.fraTree.fra1.BtTCloT - - - - {<b><font color=#134070>pack</font></b> forget <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_copy <font color=#653760>-com</font> alited::file::CloneFile <font color=#653760>-tip</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,clonefile)&quot;</font>}}
    {.fraBot.panBM.fraTree.fra1.BtTOpen - - - - {<b><font color=#134070>pack</font></b> forget <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_OpenFile <font color=#653760>-com</font> ::alited::file::OpenWith <font color=#653760>-tip</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,openwith)&quot;</font>}}
    {.fraBot.panBM.fraTree.fra1.h_ - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-anchor</font> center <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}}
    {.fraBot.panBM.fraTree.fra1.btTCtr - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_minus <font color=#653760>-com</font> {alited::tree::ExpandContractTree Tree no} <font color=#653760>-tip</font> <font color=#8b2a0e>&quot;Contract All&quot;</font>}}
    {.fraBot.panBM.fraTree.fra1.btTExp - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_plus <font color=#653760>-com</font> {alited::tree::ExpandContractTree Tree} <font color=#653760>-tip</font> <font color=#8b2a0e>&quot;Expand All&quot;</font>}}
{#<a id=Tree></a>
<i><font color=#4b5d50>#### ________________________ Tree _________________________ ####</font></i>
}
    {.fraBot.panBM.fraTree.fra1.sev3 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> right <font color=#653760>-fill</font> y <font color=#653760>-padx</font> 0}}
    {.fraBot.panBM.fraTree.fra - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> bottom <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1} {<font color=#653760>-w</font> 1}}
    {.fraBot.panBM.fraTree.fra.Tree - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}
      {<font color=#653760>-columns</font> {L1 L2 PRL ID LEV LEAF FL1} <font color=#653760>-displaycolumns</font> {L1}
      <font color=#653760>-columnoptions</font> <font color=#8b2a0e>&quot;#0 <font color=#1b1baa>{</font>-width <font color=#1b1baa>$</font>al(TREE,cw0)<font color=#1b1baa>}</font> L1 <font color=#1b1baa>{</font>-width <font color=#1b1baa>$</font>al(TREE,cw1) -anchor e<font color=#1b1baa>}</font>&quot;</font>
      <font color=#653760>-style</font> TreeNoHL <font color=#653760>-takefocus</font> 0 <font color=#653760>-selectmode</font> extended
      <font color=#653760>-tip</font> {<font color=#653760>-BALTIP</font> {alited::tree::GetTooltip %i %c} <font color=#653760>-SHIFTX</font> 10}}}
{#<a id=Favorites></a>
<i><font color=#4b5d50>### ________________________ Favorites _________________________ ###</font></i>
}
    {.fraBot.panBM.fraTree.fra.SbvTree .fraBot.panBM.fraTree.fra.Tree L - -
      {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> right <font color=#653760>-fill</font> both}}
    {.FraFV - - - - {add}}
    {.fraFV.v_ - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x} {<font color=#653760>-h</font> 5}}
    {.fraFV.fra1 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x}}
    {.fraFV.fra1.seh - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x <font color=#653760>-expand</font> 1 <font color=#653760>-pady</font> 0}}
{#<a id=Favorites'_toolbar></a>
<i><font color=#4b5d50>#### ________________________ Favorites' toolbar _________________________ ####</font></i>
}
    {.fraFV.fra1.BtTVisitF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_misc <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,lastvisit)</font>} <font color=#653760>-com</font> alited::favor::SwitchFavVisit}}
    {.fraFV.fra1.sev0 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> y <font color=#653760>-padx</font> 5}}
    {.fraFV.fra1.BtTListF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_SaveFile <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,FavLists)</font>} <font color=#653760>-com</font> alited::favor::Lists}}
    {.fraFV.fra1.SevF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> y <font color=#653760>-padx</font> 5}}
    {.fraFV.fra1.BtTAddF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_add <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,favoradd)</font>} <font color=#653760>-com</font> alited::favor::Add}}
    {.fraFV.fra1.BtTRenF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_change <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,favorren)</font>} <font color=#653760>-command</font> ::alited::favor::Rename}}
    {.fraFV.fra1.btTDelF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_delete <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,favordel)</font>} <font color=#653760>-com</font> alited::favor::Delete}}
    {.fraFV.fra1.btTDelAllF - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x}
      {<font color=#653760>-image</font> alimg_trash <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,favordelall)</font>} <font color=#653760>-com</font> alited::favor::DeleteAll}}
    {.fraFV.fra1.h_2 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-anchor</font> center <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}}
    {.fraFV.fra1.sev2 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> right <font color=#653760>-fill</font> y <font color=#653760>-padx</font> 0}}
    {.fraFV.fra - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1} {}}
{#<a id=Favorites'_list></a>
<i><font color=#4b5d50>#### ________________________ Favorites' list _________________________ ####</font></i>
}
    {.fraFV.fra.TreeFavor - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}
      {<font color=#653760>-h</font> 5 <font color=#653760>-style</font> TreeNoHL <font color=#653760>-columns</font> {C1 C2 C3 C4} <font color=#653760>-displaycolumns</font> C1
      <font color=#653760>-show</font> headings <font color=#653760>-takefocus</font> 0 <font color=#653760>-tip</font> {<font color=#653760>-BALTIP</font> {alited::favor::GetTooltip %i} <font color=#653760>-SHIFTX</font> 10}}}
    {.fraFV.fra.SbvFavor + L - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both}}
    {fra.pan.PanR - - - - {add} {<font color=#653760>-orient</font> vertical <font color=#1b1baa>$::alited::PanR_wh</font>}}
{#<a id=Tab_bar_&_Text></a>
<i><font color=#4b5d50>### ________________________ Tab bar & Text _________________________ ###</font></i>
}
    {.fraTop - - - - {add}}
    {.fraTop.PanTop - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1} {<font color=#1b1baa>$::alited::PanTop_wh</font>}}
    {.fraTop.panTop.BtsBar  - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x <font color=#653760>-pady</font> 3}}
    {.fraTop.panTop.canmark - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 0 <font color=#653760>-fill</font> both
      <font color=#653760>-padx</font> 0 <font color=#653760>-pady</font> 0 <font color=#653760>-ipadx</font> 0 <font color=#653760>-ipady</font> 0} {<font color=#653760>-w</font> <font color=#1b1baa>$al(markwidth)</font>
      <font color=#653760>-afteridle</font> {alited::main::FillMarkBar %w}}}
    {.fraTop.panTop.GutText - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 0 <font color=#653760>-fill</font> both}}
    {.fraTop.panTop.FrAText - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both
      <font color=#653760>-padx</font> 0 <font color=#653760>-pady</font> 0 <font color=#653760>-ipadx</font> 0 <font color=#653760>-ipady</font> 0} {<font color=#653760>-background</font> <font color=#1b1baa>$::apave::BGMAIN2</font>}}
    {.fraTop.panTop.frAText.Text - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both}
      {<font color=#653760>-w</font> 80 <font color=#653760>-h</font> 30 <font color=#653760>-gutter</font> GutText <font color=#653760>-gutterwidth</font> <font color=#1b1baa>$al(ED,gutterwidth)</font>
      <font color=#653760>-guttershift</font> <font color=#1b1baa>$al(ED,guttershift)</font>}}
    {.fraTop.panTop.fraSbv - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> right <font color=#653760>-fill</font> y}}
{#<a id=Find_units></a>
<i><font color=#4b5d50>### ________________________ Find units _________________________ ###</font></i>
}
    {.fraTop.panTop.fraSbv.SbvText .fraTop.panTop.frAText.text L - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> y}}
    {.fraTop.FraSbh  - - - - {<b><font color=#134070>pack</font></b> forget <font color=#653760>-fill</font> x}}
    {.fraTop.fraSbh.SbhText .fraTop.panTop.frAText.text T - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> x}}
    {.fraTop.FraHead  - - - - {<b><font color=#134070>pack</font></b> forget <font color=#653760>-side</font> bottom <font color=#653760>-fill</font> x}
      {<font color=#653760>-padding</font> {4 4 4 4} <font color=#653760>-relief</font> groove}}
    {.fraTop.fraHead.labFind - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left} {<font color=#653760>-t</font> {    Unit: }}}
    {.fraTop.fraHead.CbxFindSTD - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}
      {<font color=#653760>-tvar</font> ::alited::al(findunit) <font color=#653760>-values</font> {<font color=#1b1baa>$al(findunitvals)</font>} <font color=#653760>-w</font> 30 <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,findunit)</font>}}}
    {.fraTop.fraHead.btT - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-padx</font> 4}
      {<font color=#653760>-t</font> {Find: } <font color=#653760>-com</font> alited::find::DoFindUnit <font color=#653760>-w</font> 8 <font color=#653760>-anchor</font> e <font color=#653760>-tip</font> {Find Unit}}}
    {.fraTop.fraHead.rad1 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-padx</font> 4}
      {<font color=#653760>-takefocus</font> 0 <font color=#653760>-var</font> ::alited::main::findunits <font color=#653760>-t</font> {in all} <font color=#653760>-value</font> 1}}
    {.fraTop.fraHead.rad2 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-padx</font> 4}
      {<font color=#653760>-takefocus</font> 0 <font color=#653760>-var</font> ::alited::main::findunits <font color=#653760>-t</font> {in current} <font color=#653760>-value</font> 2}}
    {.fraTop.fraHead.h_ - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> x <font color=#653760>-expand</font> 1}}
    {.fraTop.fraHead.btTno - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left} {<font color=#653760>-command</font> {alited::find::HideFindUnit}}}
{#<a id=Info_&_status_bar></a>
<i><font color=#4b5d50>### ________________________ Info & status bar _________________________ ###</font></i>
}
    {.fraBot - - - - {add}}
    {.fraBot.fra - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}}
    {.fraBot.fra.LbxInfo - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}
      {<font color=#653760>-h</font> 1 <font color=#653760>-w</font> 40 <font color=#653760>-lvar</font> ::alited::info::list <font color=#653760>-font</font> <font color=#1b1baa>$al(FONT,defsmall)</font>
      <font color=#653760>-highlightthickness</font> 0 <font color=#653760>-onevent</font> {
      &lt;&lt;ListboxSelect&gt;&gt; <font color=#8b2a0e>&quot;alited::info::ListboxSelect %w&quot;</font>
      &lt;ButtonPress-3&gt; <font color=#8b2a0e>&quot;alited::info::PopupMenu %X %Y&quot;</font>}}}
    {.fraBot.fra.sbv + L - - pack}
    {.fraBot.fra.SbhInfo .fraBot.fra.LbxInfo T - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> bottom <font color=#653760>-before</font> %w}}
    {.fraBot.stat - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> bottom} {<font color=#653760>-array</font> {
      {{<font color=#1b1baa>$al(MC,Row:)</font>}} 12
      {{<font color=#1b1baa>$al(MC,Col:)</font>}} 4
      {{} <font color=#653760>-anchor</font> w <font color=#653760>-expand</font> 1} 51
      {{} <font color=#653760>-anchor</font> e} 25
    }}}
  }
  UpdateProjectInfo
  <i><font color=#4b5d50># a pause (and cycles) must be enough for FillBar to have proper -wbar option</font></i>
  <b><font color=#3a6797>after</font></b> idle after 50 after idle after 50 after idle after 50 after idle after 50 \
    alited::main::InitActions
  <b><font color=#3a6797>set</font></b> sbhi [<font color=#1b1baa>$obPav</font> SbhInfo]
  <b><font color=#3a6797>set</font></b> lbxi [<font color=#1b1baa>$obPav</font> LbxInfo]
  <b><font color=#134070>pack</font></b> forget <font color=#1b1baa>$sbhi</font>
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lbxi</font> &lt;FocusIn&gt; <font color=#8b2a0e>&quot;alited::info::FocusIn <font color=#1b1baa>$</font>sbhi <font color=#1b1baa>$</font>lbxi&quot;</font>
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lbxi</font> &lt;FocusOut&gt; <font color=#8b2a0e>&quot;alited::info::FocusOut <font color=#1b1baa>$</font>sbhi&quot;</font>
  <b><font color=#134070>bind</font></b> [<font color=#1b1baa>$obPav</font> Labstat3] &lt;Button-1&gt; {alited::main::ProcMessage %W}
  ::baltip tip [<font color=#1b1baa>$obPav</font> Labstat4] = <font color=#653760>-command</font> ::alited::main::TipStatus <font color=#653760>-per10</font> 0
}<a id=Main__run></a>
<i><font color=#4b5d50># ________________________ Main _run _________________________ #</font></i>
<a id=main::_run></a>
<b><font color=#ca14ca>proc</font></b> main::_run {} {
  <i><font color=#4b5d50># Runs the alited, displaying its main form with attributes</font></i>
  <i><font color=#4b5d50># 'modal', 'not closed by Esc', 'decorated with Contract/Expand buttons',</font></i>
  <i><font color=#4b5d50># 'minimal sizes' and 'saved geometry'.</font></i>
  <i><font color=#4b5d50># After closing the alited, saves its settings (geometry etc.).</font></i>
  <i><font color=#4b5d50># See also: menu::TearoffCascadeMenu</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav
  ::apave::setAppIcon <font color=#1b1baa>$al(WIN)</font> <font color=#1b1baa>$::alited::img::_AL_IMG(ale)</font>
  <b><font color=#3a6797>after</font></b> idle after 8 after idle after 8 after idle after 8 {<b><font color=#3a6797>incr</font></b> ::alited::al(AU!)}
  <b><font color=#3a6797>after</font></b> 3000 {<b><font color=#3a6797>incr</font></b> ::alited::al(AU!)} ;<i><font color=#4b5d50># control shot</font></i>
  <b><font color=#3a6797>after</font></b> 2000 [<b><font color=#3a6797>list</font></b> wm iconphoto <font color=#1b1baa>$al(WIN)</font> <font color=#653760>-default</font> [::apave::getAppIcon]]
  <b><font color=#3a6797>after</font></b> 1000 {alited::ini::CheckUpdates no}
  <b><font color=#3a6797>set</font></b> ans [<font color=#1b1baa>$obPav</font> showModal <font color=#1b1baa>$al(WIN)</font> <font color=#653760>-decor</font> 1 <font color=#653760>-minsize</font> {500 500} <font color=#653760>-escape</font> no \
    <font color=#653760>-onclose</font> alited::Exit {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$al(GEOM)</font> <font color=#653760>-resizable</font> 1 <font color=#653760>-waitme</font> ::alited::al(AU!) \
    <font color=#653760>-ontop</font> 0]
  <i><font color=#4b5d50># ans==2 means 'no saves of settings' (imaginary mode)</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ans</font> ne {2}} {alited::ini::SaveIni}
  <b><font color=#134070>destroy</font></b> <font color=#1b1baa>$al(WIN)</font>
  <font color=#1b1baa>$obPav</font> destroy
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$ans</font>
}<a id=EOF></a>
<i><font color=#4b5d50># _________________________________ EOF _________________________________ #</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>main.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>