<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>

<title>project.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>README.md</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">project.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#project.tcl">project.tcl</a></b></li>
<li><b><a href="#Variables">Variables</a></b></li>
<li><b><a href="#Common">Common</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::ProjectName">ProjectName</a><span class=tooltiptext> project::ProjectName : Gets a project name from its file name.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ProjectFileName">ProjectFileName</a><span class=tooltiptext> project::ProjectFileName : Gets a project file name from a project's name.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CheckProjectName">CheckProjectName</a><span class=tooltiptext> project::CheckProjectName : Removes spec.characters from a project name (sort of normalizing it).
Returns yes, if the name is "correct" (no char replacements made).</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::GetProjects">GetProjects</a><span class=tooltiptext> project::GetProjects : Reads settings of all projects.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ClockFormat">ClockFormat</a><span class=tooltiptext> project::ClockFormat : Formats date in seconds.
secs - date in seconds</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ClockScan">ClockScan</a><span class=tooltiptext> project::ClockScan : Scans date to get date in seconds.
d - date</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ClockYMD">ClockYMD</a><span class=tooltiptext> project::ClockYMD : Extracts year, month, day from date.
d - date</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::IsOutdated">IsOutdated</a><span class=tooltiptext> project::IsOutdated : Checks for outdated TODOs of a project.
prj - project's name
todo - if yes, gets also date and todo
Returns 0, if no todo for the project, 1 otherwise; if todo=yes, adds also date and todo outdated (if there is).</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CheckOutdated">CheckOutdated</a><span class=tooltiptext> project::CheckOutdated : Checks for outdated TODOs of all projects except for the current.
Return {} or a name of project with outdated TODOs.</span></div></li></ul>
<li><b><a href="#Ini">Ini</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::SaveData">SaveData</a><span class=tooltiptext> project::SaveData : Saves some data.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::GetOptVal">GetOptVal</a><span class=tooltiptext> project::GetOptVal : Gets a name and a value from a line of form "name=value".
line - the line</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::SaveSettings">SaveSettings</a><span class=tooltiptext> project::SaveSettings : Saves project settings to curinfo array.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::RestoreSettings">RestoreSettings</a><span class=tooltiptext> project::RestoreSettings : Restores project settings from curinfo array.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::GetProjectOpts">GetProjectOpts</a><span class=tooltiptext> project::GetProjectOpts : Reads a project's settings from a project settings file.
fname - the project settings file's name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::PutProjectOpts">PutProjectOpts</a><span class=tooltiptext> project::PutProjectOpts : Writes a project's settings to a project settings file.
fname - the project settings file's name
oldname - old name of the project file
dorename - yes, if rename of old -notes/-rems</span></div></li></ul>
<li><b><a href="#Text_fields">Text fields</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::CurrProject">CurrProject</a><span class=tooltiptext> project::CurrProject : Gets a current project name, from a current item of project list.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::SaveNotes">SaveNotes</a><span class=tooltiptext> project::SaveNotes : For a current item of project list, saves a file of notes and Commands tab's commands.
prj - project's name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::NotesFile">NotesFile</a><span class=tooltiptext> project::NotesFile : Gets a file name of notes.
prj - project's name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::RemsFile">RemsFile</a><span class=tooltiptext> project::RemsFile : Gets a file name of reminders.
prj - project's name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ReadRems">ReadRems</a><span class=tooltiptext> project::ReadRems : Reads reminders.
prj - project's name
Returns sorted reminders of project.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::SortRems">SortRems</a><span class=tooltiptext> project::SortRems : Sorts reminders by date.
rems - list of reminders
Returns a list of reminder date before current date, sorted list, flag of outdated reminder.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_save">Klnd_save</a><span class=tooltiptext> project::Klnd_save : Saves a reminder on a date.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_Dosave">Klnd_Dosave</a><span class=tooltiptext> project::Klnd_Dosave : Saves text of reminder
txt - text widget of text content
prjname - project name
date - date of TODO
doborder - yes to highlight the todo text border</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndBorderText">KlndBorderText</a><span class=tooltiptext> project::KlndBorderText : Highlights/unhighlights a reminder's border.
clr - color of border</span></div></li></ul>
<li><b><a href="#GUI_helpers">GUI helpers</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::ReadNotes">ReadNotes</a><span class=tooltiptext> project::ReadNotes : Reads notes of a project and commands for Commands tab.
prj - project's name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::SelectedPrj">SelectedPrj</a><span class=tooltiptext> project::SelectedPrj : Gets a project name of selected item.
item - selected item</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Select">Select</a><span class=tooltiptext> project::Select : Handles a selection in a list of projects.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Selected">Selected</a><span class=tooltiptext> project::Selected : Gets a currently selected project's index.
what - if "index", selected item's index is returned
domsg - if "no", no message displayed if there is no selected project</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::UpdateTree">UpdateTree</a><span class=tooltiptext> project::UpdateTree : Fills a list of projects.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::FocusInTab">FocusInTab</a><span class=tooltiptext> project::FocusInTab : Focuses on a widget in a tab.
tab - the tab's path
wid - the widget's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CheckNewDir">CheckNewDir</a><span class=tooltiptext> project::CheckNewDir : Checks if the root directory exists. If no, tries to create it.
Returns yes, if all is OK.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ExistingProject">ExistingProject</a><span class=tooltiptext> project::ExistingProject : Checks if a project (of entry field) exists.
msgOnExist - yes, if message on existing, else on non-existing project
Returns a project name if it exists or {} otherwise.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ValidProject">ValidProject</a><span class=tooltiptext> project::ValidProject : Checks if a project's options are valid.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CheckPrjLeaf">CheckPrjLeaf</a><span class=tooltiptext> project::CheckPrjLeaf : Checks "Regexp of a leaf" field.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CheckPrjUseLeaf">CheckPrjUseLeaf</a><span class=tooltiptext> project::CheckPrjUseLeaf : Enables/disables the "Regexp of a leaf" field.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::StdLeafRE">StdLeafRE</a><span class=tooltiptext> project::StdLeafRE : Sets standard RE for leaf unit.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndDay">KlndDay</a><span class=tooltiptext> project::KlndDay : Selects a date of reminder.
dsec - date in seconds to select
doblink - if yes, make the month blink</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndDayRem">KlndDayRem</a><span class=tooltiptext> project::KlndDayRem : Selects a date of reminder before a current one.
dmin - date in seconds to select</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Message">Message</a><span class=tooltiptext> project::Message : Displays a message in statusbar of projects dialogue.
msg - message
mode - mode of Message</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KeyOnTree">KeyOnTree</a><span class=tooltiptext> project::KeyOnTree : Handles key press on the tree.
K - key</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::focusTree">focusTree</a><span class=tooltiptext> project::focusTree : Sets focus on the treeview.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ValidateIni">ValidateIni</a><span class=tooltiptext> project::ValidateIni : Validates values of alited.ini.
V - %V wildcard of -validatecommand</span></div></li></ul>
<li><b><a href="#Files_tab's_procs">Files tab's procs</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::SelFiles">SelFiles</a><span class=tooltiptext> project::SelFiles : Checks for a selection of file listbox.
domsg - yes for error message shown
Returns: list of listbox's path and the selection or {}.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CurrentFile">CurrentFile</a><span class=tooltiptext> project::CurrentFile : Gets a current file of file listbox.
Returns file name of first selected file or 1st in the list, if no selection.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::OpenFile">OpenFile</a><span class=tooltiptext> project::OpenFile : Opens a file of listbox after double clicking.
y - y-coordinate of clicking</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::OpenSelFiles">OpenSelFiles</a><span class=tooltiptext> project::OpenSelFiles : Opens selected files of listbox.
showmsg - if yes, shows a message
Files are open in a currently open project.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::CloseSelFiles">CloseSelFiles</a><span class=tooltiptext> project::CloseSelFiles : Closes selected files of listbox.
Files are closed in a currently open project.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::DetachSelFiles">DetachSelFiles</a><span class=tooltiptext> project::DetachSelFiles : Detaches selected files.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::afterOpenCloseFiles">afterOpenCloseFiles</a><span class=tooltiptext> project::afterOpenCloseFiles : Actions after opening/closing files.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::SelectAllFiles">SelectAllFiles</a><span class=tooltiptext> project::SelectAllFiles : Selects all files of listbox.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::LbxPopup">LbxPopup</a><span class=tooltiptext> project::LbxPopup : Runs a popup menu on the project files listbox.
X - x-coordinate of mouse pointer
Y - y-coordinate of mouse pointer</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ValidateDir">ValidateDir</a><span class=tooltiptext> project::ValidateDir : Tries to get a project name at choosing root dir.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::TipOnFile">TipOnFile</a><span class=tooltiptext> project::TipOnFile : Shows info on a file in the file list as a tooltip.
idx - item index</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::PopupMenu">PopupMenu</a><span class=tooltiptext> project::PopupMenu : Opens a popup menu in the project list.
x - x-coordinate to identify an item
y - y-coordinate to identify an item
X - x-coordinate of the click
Y - x-coordinate of the click</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::TabFileHeading">TabFileHeading</a><span class=tooltiptext> project::TabFileHeading : Show Files tab's heading.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::TabFileFill">TabFileFill</a><span class=tooltiptext> project::TabFileFill : Fills a listbox of files.
flist - file list</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::TabFileInfo">TabFileInfo</a><span class=tooltiptext> project::TabFileInfo : Fills a listbox with a list of project files.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::TabFileFilter">TabFileFilter</a><span class=tooltiptext> project::TabFileFilter : Fills a listbox with a list of filtered files of all projects.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::postValidateFilter">postValidateFilter</a><span class=tooltiptext> project::postValidateFilter : Postvalidates the file filter change.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::preValidateFilter">preValidateFilter</a><span class=tooltiptext> project::preValidateFilter : Prevalidates the file filter change.</span></div></li></ul>
<li><b><a href="#Buttons_for_project_list">Buttons for project list</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::Add">Add</a><span class=tooltiptext> project::Add : "Add project" button's handler.
showtotals - if yes, shows total number of files
Returns yes, if the project is successfully added.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Change">Change</a><span class=tooltiptext> project::Change : "Change project" button's handler.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Delete">Delete</a><span class=tooltiptext> project::Delete : "Delete project" button's handler.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Template">Template</a><span class=tooltiptext> project::Template : Creates a project by template as set in Template tab.
The template can contain directories or files (indented for subdirectories).
The files satisfy glob-patterns: changelog*, license*, licence*, readme*.
See also: TplDefault</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::PendingTODOs">PendingTODOs</a><span class=tooltiptext> project::PendingTODOs : Displays all pending TODOs.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::UpdateMsg">UpdateMsg</a><span class=tooltiptext> project::UpdateMsg : Displays a message on project updating.
msg - message of action (add/change)
showtotals - if yes, shows total number of files</span></div></li></ul>
<li><b><a href="#Buttons">Buttons</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::Ok">Ok</a><span class=tooltiptext> project::Ok : 'OK' button handler.
args - possible arguments</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Close">Close</a><span class=tooltiptext> project::Close : 'Close' button handler.
args - possible arguments</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Help">Help</a><span class=tooltiptext> project::Help : 'Help' button handler.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::HelpMe">HelpMe</a><span class=tooltiptext> project::HelpMe : 'Help' for start.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::OnProjectEnter">OnProjectEnter</a><span class=tooltiptext> project::OnProjectEnter : Actions on entering a project.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ProcMessage">ProcMessage</a><span class=tooltiptext> project::ProcMessage : Handles clicking on message label.
Shows the message and if it is about TODO, selects the corresponding project.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ProjectEnter">ProjectEnter</a><span class=tooltiptext> project::ProjectEnter : Processes double-clicking and pressing Enter on the project list.
Cancels selecting projects if there are old reminders.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_button">Klnd_button</a><span class=tooltiptext> project::Klnd_button : Fire an event handler (paste/undo/redo) on a reminder.
ev - event to fire</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_paste">Klnd_paste</a><span class=tooltiptext> project::Klnd_paste : Pastes a text to a reminder.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_undo">Klnd_undo</a><span class=tooltiptext> project::Klnd_undo : Undoes changes of a reminder.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_redo">Klnd_redo</a><span class=tooltiptext> project::Klnd_redo : Redoes changes of a reminder.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_delete">Klnd_delete</a><span class=tooltiptext> project::Klnd_delete : Clears a reminder.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_moveTODO">Klnd_moveTODO</a><span class=tooltiptext> project::Klnd_moveTODO : Moves current TODO to a new date.
wrem - text widget of TODO
todo - text of TODO
date1 - old date (in seconds)
date2 - new date (in seconds)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_next">Klnd_next</a><span class=tooltiptext> project::Klnd_next : Moves a reminder to *days*.
days - days to move to</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_next2">Klnd_next2</a><span class=tooltiptext> project::Klnd_next2 : Moves a reminder to 7 days.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_previous">Klnd_previous</a><span class=tooltiptext> project::Klnd_previous : Moves a reminder back to 1 day.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Klnd_previous2">Klnd_previous2</a><span class=tooltiptext> project::Klnd_previous2 : Moves a reminder back to 7 days.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndPopup">KlndPopup</a><span class=tooltiptext> project::KlndPopup : Handles a popup menu for the calendar.
w - day widget clicked
y - year
m - month
d - day
X - X-coordinate of pointer
Y - Y-coordinate of pointer</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ViewDir">ViewDir</a><span class=tooltiptext> project::ViewDir : Shows file chooser just to view the project's dir</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::RunComs">RunComs</a><span class=tooltiptext> project::RunComs : Handles running commands of Commands tab.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ChecksRun">ChecksRun</a><span class=tooltiptext> project::ChecksRun : Sets checks of "Commands / Run for project".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::ChecksCom">ChecksCom</a><span class=tooltiptext> project::ChecksCom : Sets checks of "Commands / Run for all".</span></div></li></ul>
<li><b><a href="#Template_procs">Template procs</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::TplDefaultText">TplDefaultText</a><span class=tooltiptext> project::TplDefaultText : Gets default contents of project template.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::TplDefault">TplDefault</a><span class=tooltiptext> project::TplDefault : Sets default contents of project template.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::UpdateTplLists">UpdateTplLists</a><span class=tooltiptext> project::UpdateTplLists : Updates lists of template data, setting the current template on the top.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::UpdateTplText">UpdateTplText</a><span class=tooltiptext> project::UpdateTplText : Updates the template text.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::RemoveFromTplList">RemoveFromTplList</a><span class=tooltiptext> project::RemoveFromTplList : Removes a template name from the lists of template data.
val - name of template to be removed</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::DeleteFromTplList">DeleteFromTplList</a><span class=tooltiptext> project::DeleteFromTplList : Deletes a template name from the list of project templates.</span></div></li></ul>
<li><b><a href="#Calendar">Calendar</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::KlndUpdate">KlndUpdate</a><span class=tooltiptext> project::KlndUpdate : Updates calendar data.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndInDate">KlndInDate</a><span class=tooltiptext> project::KlndInDate : Gets a date in seconds.
y - year
m - month
d - day
If *y* is omitted or y/m/d not valid, gets a current date in seconds.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndOutDate">KlndOutDate</a><span class=tooltiptext> project::KlndOutDate : Gets a date formatted.
y - year
m - month
d - day
If *y* is omitted or y/m/d not valid, gets a current date formatted.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndDate">KlndDate</a><span class=tooltiptext> project::KlndDate : Formats a calendar date by alited's format (Preferences/Templates).
date - the date to be formatted</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndText">KlndText</a><span class=tooltiptext> project::KlndText : Gets a reminder text for a date.
dt - date</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndClick">KlndClick</a><span class=tooltiptext> project::KlndClick : Processes a click on a calendar day.
y - year
m - month
d - day</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndSearch">KlndSearch</a><span class=tooltiptext> project::KlndSearch : Search a date in calendar data.
Returns index of found item or -1 if not found.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::KlndTextModified">KlndTextModified</a><span class=tooltiptext> project::KlndTextModified : Processes modifications of calendar text.
wtxt - text's path
args - not used arguments</span></div></li></ul>
<li><b><a href="#GUI">GUI</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::MainFrame">MainFrame</a><span class=tooltiptext> project::MainFrame : Creates a main frame of "Project" dialogue.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Tab1">Tab1</a><span class=tooltiptext> project::Tab1 : Creates a main tab of "Project".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Tab2">Tab2</a><span class=tooltiptext> project::Tab2 : Creates Options tab of "Project".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Tab3">Tab3</a><span class=tooltiptext> project::Tab3 : Creates Templates tab of "Project".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Tab4">Tab4</a><span class=tooltiptext> project::Tab4 : Creates Commands tab of "Project".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::Tab5">Tab5</a><span class=tooltiptext> project::Tab5 : Creates Files tab of "Project".</span></div></li></ul>
<li><b><a href="#Main">Main</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#project::_create">_create</a><span class=tooltiptext> project::_create : Creates and opens Projects dialogue.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#project::_run">_run</a><span class=tooltiptext> project::_run : Runs Projects dialogue.
checktodo - if yes, checks for outdated TODOs</span></div></li></ul>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->

<h1><font color=#ca14ca> alited's source</font></h1>
</p><p>
The <a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/about.html">alited/src</a> directory contains alited's own source files.
</p><p>
Some additional alited's files are also contained in <a href="https://aplsimple.github.io/en/tcl/printer/alited/files/lib/addon/hl_alm.html">alited/lib/addon</a> directory (<i><font color=#1b1baa>alited/lib</font></i> directory contains all library files).
</p><p>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/about.html">about.tcl</a> - "About alited" dialogue.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/alited.html">alited.tcl</a> - The alited's main script to start.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/bar.html">bar.tcl</a> - Handles the bar of tabs.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/check.html">check.tcl</a> - "Check Tcl" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/complete.html">complete.tcl</a> - Handles auto-completion.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/edit.html">edit.tcl</a> - "Edit" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/favor.html">favor.tcl</a> - Handles the favorite and last visited units.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/favor_ls.html">favor_ls.tcl</a> - "Saved lists of favorites" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/file.html">file.tcl</a> - "File" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/find.html">find.tcl</a> - "Find / Replace" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/format.html">format.tcl</a> - "Edit / Formats" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/img.html">img.tcl</a> - List of images used by alited.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/indent.html">indent.tcl</a> - Handles text indentation.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/info.html">info.tcl</a> - Handles the info bar.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/ini.html">ini.tcl</a> - Handles initializing alited.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/keys.html">keys.tcl</a> - Handles keyboard (mapping etc.).</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/main.html">main.tcl</a> - Handles the main form of alited.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/menu.html">menu.tcl</a> - Handles alited's menus.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/msgs.html">msgs.tcl</a> - Localized messages used in several places.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/paver.html">paver.tcl</a> - "Tools / Paver" tool.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/pkgIndex.html">pkgIndex.tcl</a> - Includes README.md text (for Ruff doc generator).</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/pref.html">pref.tcl</a> - "Preferences" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/preview.html">preview.tcl</a> - "Preview (theme, CS)" dialogue called by "Preferences".</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/printer.html">printer.tcl</a> - "Tools / Project Printer" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/project.html">project.tcl</a> - "Projects" dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/run.html">run.tcl</a> - "Tools / Run..." dialogue and procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/tool.html">tool.tcl</a> - "Tools" menu's procedures.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/tree.html">tree.tcl</a> - Handles the tree of units and files.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/unit.html">unit.tcl</a> - Handles the unit tree.</li>
<li><a href="https://aplsimple.github.io/en/tcl/printer/alited/files/src/unit_tpl.html">unit_tpl.tcl</a> - "Templates" dialogue and procedures.</li>
</p><p>

</p>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>project.tcl</b></font></div></td></table>

<pre class="code"><i><font color=#4b5d50>###########################################################<a id=project.tcl></a></font></i>
<i><font color=#4b5d50># Name:    project.tcl</font></i>
<i><font color=#4b5d50># Author:  Alex Plotnikov  (aplsimple@gmail.com)</font></i>
<i><font color=#4b5d50># Date:    04/28/2021</font></i>
<i><font color=#4b5d50># Brief:   Handles project settings.</font></i>
<i><font color=#4b5d50># License: MIT.</font></i>
<i><font color=#4b5d50>###########################################################</font></i>
<a id=Variables></a>
<i><font color=#4b5d50># _________________________ Variables ________________________ #</font></i>

<b><font color=#ca14ca>namespace</font></b> eval project {

  <i><font color=#4b5d50># apave object of Projects</font></i>
  <b><font color=#3a6797>variable</font></b> obPrj pavedProject

  <i><font color=#4b5d50># Projects dialogue's path</font></i>
  <b><font color=#3a6797>variable</font></b> win <font color=#1b1baa>$::alited::al(WIN)</font>.diaPrj

  <i><font color=#4b5d50># list of projects</font></i>
  <b><font color=#3a6797>variable</font></b> prjlist [<b><font color=#3a6797>list</font></b>]

  <i><font color=#4b5d50># initial geometry of Projects dialogue (centered in the main form)</font></i>
  <b><font color=#3a6797>variable</font></b> geo root=<font color=#1b1baa>$::alited::al(WIN)</font>
  <b><font color=#3a6797>variable</font></b> geotodolist root=<font color=#1b1baa>$win</font>

  <i><font color=#4b5d50># saved index of last selected project</font></i>
  <b><font color=#3a6797>variable</font></b> ilast -1

  <i><font color=#4b5d50># saved tab of Projects dialogue</font></i>
  <b><font color=#3a6797>variable</font></b> oldTab {}

  <i><font color=#4b5d50># data of projects</font></i>
  <b><font color=#3a6797>variable</font></b> prjinfo; <b><font color=#3a6797>array</font></b> set prjinfo [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>foreach</font></b> _ <font color=#1b1baa>$::alited::OPTS</font> {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> prjinfo(*DEFAULT*,<font color=#1b1baa>$_</font>) <font color=#1b1baa>$::alited::al(DEFAULT,$_)</font>}  ;<i><font color=#4b5d50># default options</font></i>
  }

  <i><font color=#4b5d50># data of currently open project (to save/restore)</font></i>
  <b><font color=#3a6797>variable</font></b> curinfo; <b><font color=#3a6797>array</font></b> set curinfo [<b><font color=#3a6797>list</font></b>]

  <i><font color=#4b5d50># calendar's data</font></i>
  <b><font color=#3a6797>variable</font></b> klnddata; <b><font color=#3a6797>array</font></b> set klnddata [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> klnddata(dateformat) {%Y/%m/%d}

  <i><font color=#4b5d50># todo message and its project</font></i>
  <b><font color=#3a6797>variable</font></b> msgtodo {}
  <b><font color=#3a6797>variable</font></b> itemtodo {}

  <i><font color=#4b5d50># flag &quot;projects changed&quot;</font></i>
  <b><font color=#3a6797>variable</font></b> updateGUI no

  <i><font color=#4b5d50># total of project files</font></i>
  <b><font color=#3a6797>variable</font></b> totalfiles 0

  <i><font color=#4b5d50># separator for commands in Notes</font></i>
  <b><font color=#3a6797>variable</font></b> COMSEP \t

  <i><font color=#4b5d50># filter for project files</font></i>
  <b><font color=#3a6797>variable</font></b> filefilter {}
  <b><font color=#3a6797>variable</font></b> casefilter 0
  <b><font color=#3a6797>variable</font></b> savedfilefilter <font color=#1b1baa>$filefilter</font>
  <b><font color=#3a6797>variable</font></b> savedcasefilter <font color=#1b1baa>$casefilter</font>

  <i><font color=#4b5d50># flag &quot;save alited.ini&quot;</font></i>
  <b><font color=#3a6797>variable</font></b> saveini no
}
<a id=Common></a>
<i><font color=#4b5d50># ________________________ Common _________________________ #</font></i>
<a id=project::ProjectName></a>
<b><font color=#ca14ca>proc</font></b> project::ProjectName {fname} {
  <i><font color=#4b5d50># Gets a project name from its file name.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited PRJEXT PRJEXT
  <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>file</font></b> tail <font color=#1b1baa>$fname</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> *<font color=#1b1baa>$PRJEXT</font> <font color=#1b1baa>$fname</font>]} {
    <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>file</font></b> rootname <font color=#1b1baa>$fname</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$fname</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ProjectFileName></a>
<b><font color=#ca14ca>proc</font></b> project::ProjectFileName {name} {
  <i><font color=#4b5d50># Gets a project file name from a project's name.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited PRJDIR PRJDIR PRJEXT PRJEXT
  <b><font color=#3a6797>set</font></b> name [ProjectName [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$name</font>]]
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>file</font></b> normalize [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$PRJDIR</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>name<font color=#1b1baa>$</font>PRJEXT&quot;</font>]]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CheckProjectName></a>
<b><font color=#ca14ca>proc</font></b> project::CheckProjectName {} {
  <i><font color=#4b5d50># Removes spec.characters from a project name (sort of normalizing it).</font></i>
  <i><font color=#4b5d50># Returns yes, if the name is &quot;correct&quot; (no char replacements made).</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> oldname <font color=#1b1baa>$al(prjname)</font>
  <b><font color=#3a6797>set</font></b> al(prjname) [::apave::NormalizeFileName <font color=#1b1baa>$al(prjname)</font>]
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$oldname</font> eq <font color=#1b1baa>$al(prjname)</font>}]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::GetProjects></a>
<b><font color=#ca14ca>proc</font></b> project::GetProjects {} {
  <i><font color=#4b5d50># Reads settings of all projects.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al PRJEXT PRJEXT
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> ilast
  <b><font color=#3a6797>set</font></b> prjlist [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>set</font></b> ilast 0]
  alited::tree::PrepareDirectoryContents
  <b><font color=#3a6797>foreach</font></b> finfo [alited::tree::GetDirectoryContents <font color=#1b1baa>$::alited::PRJDIR</font>] {
    <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$finfo</font> 2]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>file</font></b> extension <font color=#1b1baa>$fname</font>] eq <font color=#1b1baa>$PRJEXT</font>} {
      <b><font color=#3a6797>if</font></b> {[GetProjectOpts <font color=#1b1baa>$fname</font>] eq <font color=#1b1baa>$al(prjname)</font>} {
        <b><font color=#3a6797>set</font></b> ilast <font color=#1b1baa>$i</font>
      }
      <b><font color=#3a6797>incr</font></b> i
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ClockFormat></a>
<b><font color=#ca14ca>proc</font></b> project::ClockFormat {secs} {
  <i><font color=#4b5d50># Formats date in seconds.</font></i>
  <i><font color=#4b5d50>#   secs - date in seconds</font></i>

  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>clock</font></b> format <font color=#1b1baa>$secs</font> <font color=#653760>-format</font> <font color=#1b1baa>$klnddata(dateformat)</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ClockScan></a>
<b><font color=#ca14ca>proc</font></b> project::ClockScan {d} {
  <i><font color=#4b5d50># Scans date to get date in seconds.</font></i>
  <i><font color=#4b5d50>#   d - date</font></i>

  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>clock</font></b> scan <font color=#1b1baa>$d</font> <font color=#653760>-format</font> <font color=#1b1baa>$klnddata(dateformat)</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ClockYMD></a>
<b><font color=#ca14ca>proc</font></b> project::ClockYMD {d} {
  <i><font color=#4b5d50># Extracts year, month, day from date.</font></i>
  <i><font color=#4b5d50>#   d - date</font></i>

  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>split</font></b> [ClockFormat <font color=#1b1baa>$d</font>] /]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::IsOutdated></a>
<b><font color=#ca14ca>proc</font></b> project::IsOutdated {prj {todo no}} {
  <i><font color=#4b5d50># Checks for outdated TODOs of a project.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>
  <i><font color=#4b5d50>#   todo - if yes, gets also date and todo</font></i>
  <i><font color=#4b5d50># Returns 0, if no todo for the project, 1 otherwise; if todo=yes, adds also date and todo outdated (if there is).</font></i>

  <b><font color=#3a6797>set</font></b> rems [ReadRems <font color=#1b1baa>$prj</font>]
  <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$rems</font> 2]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$todo</font>} {
    <b><font color=#3a6797>lappend</font></b> res {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$rems</font> 1 0]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CheckOutdated></a>
<b><font color=#ca14ca>proc</font></b> project::CheckOutdated {} {
  <i><font color=#4b5d50># Checks for outdated TODOs of all projects except for the current.</font></i>
  <i><font color=#4b5d50># Return {} or a name of project with outdated TODOs.</font></i>

  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>foreach</font></b> prj <font color=#1b1baa>$prjlist</font> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> ne <font color=#1b1baa>$::alited::al(prjname)</font>} {
      <b><font color=#3a6797>if</font></b> {[IsOutdated <font color=#1b1baa>$prj</font>]} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$prj</font>}
    }
  }
  <b><font color=#ca14ca>return</font></b> {}
}
<a id=Ini></a>
<i><font color=#4b5d50># ________________________ Ini _________________________ #</font></i>
<a id=project::SaveData></a>
<b><font color=#ca14ca>proc</font></b> project::SaveData {} {
  <i><font color=#4b5d50># Saves some data.</font></i>

  <b><font color=#3a6797>variable</font></b> ilast
  <b><font color=#3a6797>set</font></b> ilast [Selected index no]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::GetOptVal></a>
<b><font color=#ca14ca>proc</font></b> project::GetOptVal {line} {
  <i><font color=#4b5d50># Gets a name and a value from a line of form &quot;name=value&quot;.</font></i>
  <i><font color=#4b5d50>#   line - the line</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> first = <font color=#1b1baa>$line</font>]]&gt;-1} {
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 0 <font color=#1b1baa>$i</font>-1] [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font>+1 end]]
  }
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::SaveSettings></a>
<b><font color=#ca14ca>proc</font></b> project::SaveSettings {} {
  <i><font color=#4b5d50># Saves project settings to curinfo array.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al OPTS OPTS
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>foreach</font></b> v <font color=#1b1baa>$OPTS</font> {
    <b><font color=#3a6797>set</font></b> curinfo(<font color=#1b1baa>$v</font>) <font color=#1b1baa>$al($v)</font>
  }
  <b><font color=#3a6797>set</font></b> curinfo(prjfile) <font color=#1b1baa>$al(prjfile)</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::RestoreSettings></a>
<b><font color=#ca14ca>proc</font></b> project::RestoreSettings {} {
  <i><font color=#4b5d50># Restores project settings from curinfo array.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al OPTS OPTS
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>foreach</font></b> v <font color=#1b1baa>$OPTS</font> {
    <b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$v</font>) <font color=#1b1baa>$curinfo($v)</font>
  }
  <b><font color=#3a6797>set</font></b> al(prjfile) <font color=#1b1baa>$curinfo(prjfile)</font>
  TabFileInfo
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::GetProjectOpts></a>
<b><font color=#ca14ca>proc</font></b> project::GetProjectOpts {fname} {
  <i><font color=#4b5d50># Reads a project's settings from a project settings file.</font></i>
  <i><font color=#4b5d50>#   fname - the project settings file's name</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al OPTS OPTS DIR DIR
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>set</font></b> pname [ProjectName <font color=#1b1baa>$fname</font>]
  <i><font color=#4b5d50># save project names to 'prjlist' variable to display it by treeview widget</font></i>
  <b><font color=#3a6797>lappend</font></b> prjlist <font color=#1b1baa>$pname</font>
  <i><font color=#4b5d50># save project files' settings in prjinfo array</font></i>
  <b><font color=#3a6797>set</font></b> filecont [readTextFile <font color=#1b1baa>$fname</font>]
  <b><font color=#3a6797>foreach</font></b> opt <font color=#1b1baa>$OPTS</font> {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,<font color=#1b1baa>$opt</font>) <font color=#1b1baa>$prjinfo(*DEFAULT*,$opt)</font>}  ;<i><font color=#4b5d50># defaults</font></i>
  }
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,tablist) [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> currentprj [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$curinfo(prjname)</font> eq <font color=#1b1baa>$pname</font>}]]} {
    <b><font color=#3a6797>foreach</font></b> tab [alited::bar::BAR listTab] {
      <b><font color=#3a6797>set</font></b> tid [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$tab</font> 0]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> val [alited::bar::FileName <font color=#1b1baa>$tid</font>]] ne {}} {
        <b><font color=#3a6797>lappend</font></b> prjinfo(<font color=#1b1baa>$pname</font>,tablist) <font color=#1b1baa>$val</font>
      }
    }
  }
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,prjroot) <font color=#1b1baa>$DIR</font>
  <b><font color=#3a6797>foreach</font></b> line [textsplit <font color=#1b1baa>$filecont</font>] {
    <b><font color=#3a6797>lassign</font></b> [GetOptVal <font color=#1b1baa>$line</font>] opt val
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#1b1baa>$OPTS</font> <font color=#1b1baa>$opt</font>]&gt;-1} {
      <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,<font color=#1b1baa>$opt</font>) [alited::ProcEOL <font color=#1b1baa>$val</font> in]
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$opt</font> eq {tab} && !<font color=#1b1baa>$currentprj</font> && <font color=#1b1baa>$val</font> ne {}} {
      <b><font color=#3a6797>lappend</font></b> prjinfo(<font color=#1b1baa>$pname</font>,tablist) <font color=#1b1baa>$val</font>
    }
  }
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,prjfile) <font color=#1b1baa>$fname</font>
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,prjname) <font color=#1b1baa>$pname</font>
  <b><font color=#3a6797>set</font></b> al(tablist) <font color=#1b1baa>$prjinfo($pname,tablist)</font>
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$pname</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::PutProjectOpts></a>
<b><font color=#ca14ca>proc</font></b> project::PutProjectOpts {fname oldname dorename} {
  <i><font color=#4b5d50># Writes a project's settings to a project settings file.</font></i>
  <i><font color=#4b5d50>#   fname - the project settings file's name</font></i>
  <i><font color=#4b5d50>#   oldname - old name of the project file</font></i>
  <i><font color=#4b5d50>#   dorename - yes, if rename of old -notes/-rems</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al OPTS OPTS
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>set</font></b> filecont [readTextFile <font color=#1b1baa>$oldname</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$filecont</font> eq {}} {
    alited::ini::SaveIniPrj
    <b><font color=#3a6797>set</font></b> filecont [readTextFile <font color=#1b1baa>$oldname</font>]
  }
  <b><font color=#3a6797>set</font></b> newcont {}
  <b><font color=#3a6797>foreach</font></b> line [textsplit <font color=#1b1baa>$filecont</font>] {
    <b><font color=#3a6797>lassign</font></b> [GetOptVal <font color=#1b1baa>$line</font>] opt val
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$line</font> eq {[Tabs]}} {
      <b><font color=#3a6797>foreach</font></b> tab <font color=#1b1baa>$al(tablist)</font> {
        <b><font color=#3a6797>append</font></b> line \n <font color=#8b2a0e>&quot;tab=<font color=#1b1baa>$</font>tab&quot;</font>
      }
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$opt</font> in [<b><font color=#3a6797>list</font></b> tab rem tablist {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$OPTS</font>]} {
      <b><font color=#ca14ca>continue</font></b>
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$opt</font> in {curtab}} {
      <i><font color=#4b5d50>#</font></i>
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$line</font> eq {[Options]}} {
      <b><font color=#3a6797>foreach</font></b> opt <font color=#1b1baa>$OPTS</font> {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt</font> ni {prjname tablist}} {
          <b><font color=#3a6797>set</font></b> val [<b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$opt</font>)]
          <b><font color=#3a6797>append</font></b> line \n <font color=#1b1baa>$opt</font>= <font color=#1b1baa>$val</font>
          <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$al(prjname)</font>,<font color=#1b1baa>$opt</font>) [alited::ProcEOL <font color=#1b1baa>$val</font> in]
        }
      }
    }
    <b><font color=#3a6797>append</font></b> newcont <font color=#1b1baa>$line</font> \n
  }
  writeTextFile <font color=#1b1baa>$fname</font> newcont
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$oldname</font> ne <font color=#1b1baa>$fname</font>} {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> delete <font color=#1b1baa>$oldname</font>}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dorename</font>} {
      <b><font color=#3a6797>foreach</font></b> ftyp {notes rems} {
        <b><font color=#3a6797>set</font></b> oldtyp [<b><font color=#3a6797>file</font></b> rootname <font color=#1b1baa>$oldname</font>]-<font color=#1b1baa>$ftyp</font>.txt
        <b><font color=#3a6797>set</font></b> newtyp [<b><font color=#3a6797>file</font></b> rootname <font color=#1b1baa>$fname</font>]-<font color=#1b1baa>$ftyp</font>.txt
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> rename <font color=#1b1baa>$oldtyp</font> <font color=#1b1baa>$newtyp</font>}
      }
    }
  }
}
<a id=Text_fields></a>
<i><font color=#4b5d50># ________________________ Text fields _________________________ #</font></i>
<a id=project::CurrProject></a>
<b><font color=#ca14ca>proc</font></b> project::CurrProject {} {
  <i><font color=#4b5d50># Gets a current project name, from a current item of project list.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>set</font></b> prj {}
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>set</font></b> tree [<font color=#1b1baa>$obPrj</font> TreePrj]
    <b><font color=#3a6797>set</font></b> item [Selected item no]
    <b><font color=#3a6797>set</font></b> isel [<font color=#1b1baa>$tree</font> index <font color=#1b1baa>$item</font>]
    <b><font color=#3a6797>set</font></b> prj [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$isel</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$prj</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::SaveNotes></a>
<b><font color=#ca14ca>proc</font></b> project::SaveNotes {{prj <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50>#  For a current item of project list, saves a file of notes and Commands tab's commands.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>variable</font></b> COMSEP
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> eq {}} {<b><font color=#3a6797>set</font></b> prj <font color=#1b1baa>$klnddata(SAVEPRJ)</font>}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> ne {}} {
    <b><font color=#3a6797>set</font></b> fnotes [NotesFile <font color=#1b1baa>$prj</font>]
    <b><font color=#3a6797>set</font></b> fcont [<b><font color=#3a6797>string</font></b> trimright [[<font color=#1b1baa>$obPrj</font> TexPrj] get 1.0 end]]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> indent [<b><font color=#3a6797>string</font></b> repeat { } <font color=#1b1baa>$::alited::al(prjindent)</font>]}]} {<b><font color=#3a6797>set</font></b> indent {    }}
    <b><font color=#3a6797>set</font></b> fcont [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$COMSEP</font> <font color=#1b1baa>$indent</font>] <font color=#1b1baa>$fcont</font>]
    <b><font color=#3a6797>set</font></b> fcontOrig <font color=#1b1baa>$fcont</font>
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>set</font></b> com [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$al(PTP,run$i)</font>]
      <b><font color=#3a6797>set</font></b> al(PTP,run<font color=#1b1baa>$i</font>) {}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com</font> ne {}} {
        <b><font color=#3a6797>incr</font></b> irun   ;<i><font color=#4b5d50># starting commands from #1</font></i>
        <b><font color=#3a6797>append</font></b> fcont \nrun<font color=#1b1baa>$irun$COMSEP$al(PTP,runch$i)$COMSEP$com</font>
        <b><font color=#3a6797>set</font></b> al(PTP,run<font color=#1b1baa>$i</font>) <font color=#1b1baa>$com</font>
      }
    }
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>set</font></b> com [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$al(PTP,com$i)</font>]
      <b><font color=#3a6797>set</font></b> al(PTP,com<font color=#1b1baa>$i</font>) {}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com</font> ne {}} {
        <b><font color=#3a6797>incr</font></b> irun   ;<i><font color=#4b5d50># starting commands from #1</font></i>
        <b><font color=#3a6797>append</font></b> fcont \nrun<font color=#1b1baa>$irun$COMSEP$al(PTP,comch$i)$COMSEP$COMSEP$com</font>
        <b><font color=#3a6797>set</font></b> al(PTP,com<font color=#1b1baa>$i</font>) <font color=#1b1baa>$com</font>
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fcontOrig</font> eq {} && <font color=#1b1baa>$fcont</font> ne {}} {
      <b><font color=#3a6797>set</font></b> fcont __<font color=#1b1baa>$al(MC,coms)</font>__<font color=#1b1baa>$fcont</font>
    }
    writeTextFile <font color=#1b1baa>$fnotes</font> fcont 0 0
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::NotesFile></a>
<b><font color=#ca14ca>proc</font></b> project::NotesFile {prj} {
  <i><font color=#4b5d50># Gets a file name of notes.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>

  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::alited::PRJDIR</font> <font color=#1b1baa>$prj</font>-notes.txt]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::RemsFile></a>
<b><font color=#ca14ca>proc</font></b> project::RemsFile {prj} {
  <i><font color=#4b5d50># Gets a file name of reminders.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>

  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::alited::PRJDIR</font> <font color=#1b1baa>$prj</font>-rems.txt]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ReadRems></a>
<b><font color=#ca14ca>proc</font></b> project::ReadRems {prj} {
  <i><font color=#4b5d50># Reads reminders.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>
  <i><font color=#4b5d50># Returns sorted reminders of project.</font></i>

  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>set</font></b> frems [RemsFile <font color=#1b1baa>$prj</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$frems</font>]} {
    <b><font color=#3a6797>set</font></b> res [readTextFile <font color=#1b1baa>$frems</font>]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b>]
  }
  SortRems <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::SortRems></a>
<b><font color=#ca14ca>proc</font></b> project::SortRems {rems} {
  <i><font color=#4b5d50># Sorts reminders by date.</font></i>
  <i><font color=#4b5d50>#   rems - list of reminders</font></i>
  <i><font color=#4b5d50># Returns a list of reminder date before current date, sorted list, flag of outdated reminder.</font></i>

  <b><font color=#3a6797>set</font></b> tmp [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> dmin [<b><font color=#3a6797>set</font></b> outdated 0]
  <b><font color=#3a6797>set</font></b> dcur [<b><font color=#3a6797>clock</font></b> add [KlndInDate] <font color=#1b1baa>$::alited::al(todoahead)</font> day]
  <b><font color=#3a6797>foreach</font></b> it <font color=#1b1baa>$rems</font> {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$it</font> d text
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$d</font> /] y m d
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> d [KlndInDate <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>]}]} {
      <b><font color=#3a6797>set</font></b> d [<b><font color=#3a6797>clock</font></b> seconds]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$d</font>&lt;=<font color=#1b1baa>$dcur</font> && (<font color=#1b1baa>$dmin</font>==0 || <font color=#1b1baa>$d</font>&lt;<font color=#1b1baa>$dmin</font>)} {
      <b><font color=#3a6797>set</font></b> dmin <font color=#1b1baa>$d</font>
    }
    <b><font color=#3a6797>lappend</font></b> tmp [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$d</font> <font color=#1b1baa>$text</font>]
  }
  <b><font color=#3a6797>set</font></b> rems [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>foreach</font></b> it [<b><font color=#3a6797>lsort</font></b> <font color=#653760>-index</font> 0 <font color=#1b1baa>$tmp</font>] {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$it</font> d text
    <b><font color=#3a6797>lappend</font></b> rems [<b><font color=#3a6797>list</font></b> [ClockFormat <font color=#1b1baa>$d</font>] <font color=#1b1baa>$text</font>]
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dmin</font>} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dmin</font>&lt;[<b><font color=#3a6797>clock</font></b> seconds]} {
      <b><font color=#3a6797>set</font></b> outdated 1 ;<i><font color=#4b5d50># current day reached</font></i>
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$dmin</font>&lt;<font color=#1b1baa>$dcur</font>} {
      <b><font color=#3a6797>set</font></b> outdated 2 ;<i><font color=#4b5d50># &quot;ahead&quot; day reached</font></i>
    }
  }
  <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$dmin</font> <font color=#1b1baa>$rems</font> <font color=#1b1baa>$outdated</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_save></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_save {} {
  <i><font color=#4b5d50># Saves a reminder on a date.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>set</font></b> wtxt [<font color=#1b1baa>$obPrj</font> TexKlnd]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> prjname <font color=#1b1baa>$klnddata(SAVEPRJ)</font>] eq {}} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>set</font></b> date <font color=#1b1baa>$klnddata(SAVEDATE)</font>
  Klnd_Dosave <font color=#1b1baa>$wtxt</font> <font color=#1b1baa>$prjname</font> <font color=#1b1baa>$date</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_Dosave></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_Dosave {txt prjname date {doborder yes}} {
  <i><font color=#4b5d50># Saves text of reminder</font></i>
  <i><font color=#4b5d50>#   txt - text widget of text content</font></i>
  <i><font color=#4b5d50>#   prjname - project name</font></i>
  <i><font color=#4b5d50>#   date - date of TODO</font></i>
  <i><font color=#4b5d50>#   doborder - yes to highlight the todo text border</font></i>

  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>set</font></b> iswidget [<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$txt</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iswidget</font>} {<b><font color=#3a6797>set</font></b> txt [<b><font color=#3a6797>string</font></b> trim [<font color=#1b1baa>$txt</font> get 1.0 end]]}
  <b><font color=#3a6797>set</font></b> info [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$date</font> <font color=#1b1baa>$txt</font> <font color=#8b2a0e>&quot;TODO opt.&quot;</font>]  ;<i><font color=#4b5d50># + possible options for future</font></i>
  <b><font color=#3a6797>set</font></b> i [KlndSearch <font color=#1b1baa>$date</font> <font color=#1b1baa>$prjname</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$txt</font> eq {}} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>&gt;-1} {
      <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$prjname</font>,prjrem) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$prjinfo($prjname,prjrem)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iswidget</font> && <font color=#1b1baa>$doborder</font>} KlndBorderText
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$i</font>&gt;-1} {
    <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$prjname</font>,prjrem) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$prjinfo($prjname,prjrem)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$info</font>]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lappend</font></b> prjinfo(<font color=#1b1baa>$prjname</font>,prjrem) <font color=#1b1baa>$info</font>
  }
  ::klnd::update {} {} {} <font color=#1b1baa>$prjinfo($prjname,prjrem)</font>
  <b><font color=#3a6797>set</font></b> fcont <font color=#1b1baa>$prjinfo($prjname,prjrem)</font>
  writeTextFile [RemsFile <font color=#1b1baa>$prjname</font>] fcont 0 0
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndBorderText></a>
<b><font color=#ca14ca>proc</font></b> project::KlndBorderText {{clr {}}} {
  <i><font color=#4b5d50># Highlights/unhighlights a reminder's border.</font></i>
  <i><font color=#4b5d50>#   clr - color of border</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clr</font> eq {}} {<b><font color=#3a6797>set</font></b> clr [<b><font color=#3a6797>lindex</font></b> [obj csGet] 8]}
  [<font color=#1b1baa>$obPrj</font> TexKlnd] configure <font color=#653760>-highlightbackground</font> <font color=#1b1baa>$clr</font>
}
<a id=GUI_helpers></a>
<i><font color=#4b5d50># ________________________ GUI helpers _________________________ #</font></i>
<a id=project::ReadNotes></a>
<b><font color=#ca14ca>proc</font></b> project::ReadNotes {prj} {
  <i><font color=#4b5d50># Reads notes of a project and commands for Commands tab.</font></i>
  <i><font color=#4b5d50>#   prj - project's name</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> COMSEP
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> al(PTP,run<font color=#1b1baa>$i</font>) [<b><font color=#3a6797>set</font></b> al(PTP,com<font color=#1b1baa>$i</font>) {}]
    <b><font color=#3a6797>set</font></b> al(PTP,runch<font color=#1b1baa>$i</font>) [<b><font color=#3a6797>set</font></b> al(PTP,comch<font color=#1b1baa>$i</font>) 0]
  }
  <b><font color=#3a6797>set</font></b> al(PTP,chbClearRun) 0
  <b><font color=#3a6797>set</font></b> al(PTP,chbClearCom) 0
  <b><font color=#3a6797>set</font></b> irun [<b><font color=#3a6797>set</font></b> icom 0]
  <b><font color=#3a6797>set</font></b> wtxt [<font color=#1b1baa>$obPrj</font> TexPrj]
  <font color=#1b1baa>$wtxt</font> delete 1.0 end
  <b><font color=#3a6797>set</font></b> fnotes [NotesFile <font color=#1b1baa>$prj</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$fnotes</font>]} {
    <b><font color=#3a6797>set</font></b> cont [readTextFile <font color=#1b1baa>$fnotes</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> ir [<b><font color=#3a6797>string</font></b> first run1<font color=#1b1baa>$COMSEP</font> <font color=#1b1baa>$cont</font>]]&gt;-1} {
      <i><font color=#4b5d50># get commands for Commands tab (project's and common)</font></i>
      <b><font color=#3a6797>foreach</font></b> com [<b><font color=#3a6797>split</font></b> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$cont</font> <font color=#1b1baa>$i</font> end] \n] {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$com</font> <font color=#1b1baa>$COMSEP</font>] run ch com1 com2
        <b><font color=#3a6797>set</font></b> ch [<b><font color=#3a6797>string</font></b> is true <font color=#653760>-strict</font> <font color=#1b1baa>$ch</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com1</font> ne {}} {
          <b><font color=#3a6797>set</font></b> al(PTP,run[<b><font color=#3a6797>incr</font></b> irun]) <font color=#1b1baa>$com1</font>
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ch</font>} {<b><font color=#3a6797>set</font></b> al(PTP,runch<font color=#1b1baa>$irun</font>) [<b><font color=#3a6797>set</font></b> al(PTP,chbClearRun) 1]}
        } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$com2</font> ne {}} {
          <b><font color=#3a6797>set</font></b> al(PTP,com[<b><font color=#3a6797>incr</font></b> icom]) <font color=#1b1baa>$com2</font>
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ch</font>} {<b><font color=#3a6797>set</font></b> al(PTP,comch<font color=#1b1baa>$icom</font>) [<b><font color=#3a6797>set</font></b> al(PTP,chbClearCom) 1]}
        }
      }
      <b><font color=#3a6797>set</font></b> cont [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$cont</font> 0 <font color=#1b1baa>$ir</font>-1]
    }
    <b><font color=#3a6797>set</font></b> cont [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$cont</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cont</font> ne {}} {<font color=#1b1baa>$wtxt</font> insert end <font color=#1b1baa>$cont</font>}
  }
  <font color=#1b1baa>$wtxt</font> edit reset; <font color=#1b1baa>$wtxt</font> edit modified no
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::SelectedPrj></a>
<b><font color=#ca14ca>proc</font></b> project::SelectedPrj {item} {
  <i><font color=#4b5d50># Gets a project name of selected item.</font></i>
  <i><font color=#4b5d50>#   item - selected item</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>set</font></b> tree [<font color=#1b1baa>$obPrj</font> TreePrj]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is digit <font color=#1b1baa>$item</font>]} {  ;<i><font color=#4b5d50># the item is an index</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$item</font>&lt;0 || <font color=#1b1baa>$item</font>&gt;=[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$prjlist</font>]} {<b><font color=#ca14ca>return</font></b> {}}
    <b><font color=#3a6797>set</font></b> prj [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$item</font>]
    <b><font color=#3a6797>set</font></b> item <font color=#1b1baa>$prjinfo($prj,ID)</font>
  } <b><font color=#3a6797>elseif</font></b> {![<font color=#1b1baa>$tree</font> exists <font color=#1b1baa>$item</font>]} {
    <b><font color=#ca14ca>return</font></b> {}
  }
  <b><font color=#3a6797>set</font></b> isel [<font color=#1b1baa>$tree</font> index <font color=#1b1baa>$item</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$isel</font>&lt;0 || <font color=#1b1baa>$isel</font>&gt;=[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$prjlist</font>]} {<b><font color=#ca14ca>return</font></b> {}}
  <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$tree</font> <font color=#1b1baa>$item</font> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$isel</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Select></a>
<b><font color=#ca14ca>proc</font></b> project::Select {{item <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Handles a selection in a list of projects.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al OPTS OPTS
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$item</font> eq {}} {<b><font color=#3a6797>set</font></b> item [Selected item no]}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$item</font> ne {}} {
    <b><font color=#3a6797>lassign</font></b> [SelectedPrj <font color=#1b1baa>$item</font>] tree item prj
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> eq {}} <b><font color=#ca14ca>return</font></b>
    ReadNotes <font color=#1b1baa>$prj</font>
    <b><font color=#3a6797>lassign</font></b> [ReadRems <font color=#1b1baa>$prj</font>] dmin prjinfo(<font color=#1b1baa>$prj</font>,prjrem)
    <b><font color=#3a6797>foreach</font></b> opt <font color=#1b1baa>$OPTS</font> {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$opt</font>) <font color=#1b1baa>$prjinfo($prj,$opt)</font>} e]} {
        Message <font color=#1b1baa>$e</font>
        <b><font color=#ca14ca>return</font></b>
      }
    }
    <b><font color=#3a6797>set</font></b> al(tablist) <font color=#1b1baa>$prjinfo($prj,tablist)</font>
    TabFileInfo
    <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$tree</font> selection] ne <font color=#1b1baa>$item</font>} {
      <font color=#1b1baa>$tree</font> selection set <font color=#1b1baa>$item</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dmin</font>&gt;0} {
      KlndDayRem <font color=#1b1baa>$dmin</font>
    } <b><font color=#3a6797>else</font></b> {
      KlndDay [<b><font color=#3a6797>clock</font></b> seconds] no
      KlndBorderText
    }
    ::klnd::blinking no
    <b><font color=#3a6797>set</font></b> klnddata(SAVEDATE) {}
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$klnddata(AFTERKLND)</font>}
    <b><font color=#3a6797>set</font></b> klnddata(AFTERKLND) [<b><font color=#3a6797>after</font></b> 200 alited::project::KlndUpdate]
    [<font color=#1b1baa>$obPrj</font> Labprj] configure <font color=#653760>-text</font> [msgcat::mc {For project}]\ <font color=#1b1baa>$al(prjname)</font>
    <b><font color=#3a6797>set</font></b> tip [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %f <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,prjName) <font color=#1b1baa>$</font>al(prjname)&quot;</font>] <font color=#1b1baa>$al(MC,alloffile)</font>]
    ::baltip tip [<font color=#1b1baa>$obPrj</font> ChbClearRun] <font color=#1b1baa>$tip</font>
    <b><font color=#3a6797>after</font></b> 200 <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>tree see <font color=#1b1baa>$</font>item; <font color=#1b1baa>$</font>tree focus <font color=#1b1baa>$</font>item&quot;</font>
    CheckPrjUseLeaf
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Selected></a>
<b><font color=#ca14ca>proc</font></b> project::Selected {what {domsg yes}} {
  <i><font color=#4b5d50># Gets a currently selected project's index.</font></i>
  <i><font color=#4b5d50>#   what - if &quot;index&quot;, selected item's index is returned</font></i>
  <i><font color=#4b5d50>#   domsg - if &quot;no&quot;, no message displayed if there is no selected project</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>set</font></b> tree [<font color=#1b1baa>$obPrj</font> TreePrj]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> isel [<font color=#1b1baa>$tree</font> selection]] eq {} && [<b><font color=#3a6797>set</font></b> isel [<font color=#1b1baa>$tree</font> focus]] eq {} && <font color=#1b1baa>$domsg</font>} {
    Message <font color=#1b1baa>$::alited::al(MC,prjsel)</font> 4
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$isel</font> ne {} && <font color=#1b1baa>$what</font> eq {index}} {
    <b><font color=#3a6797>set</font></b> isel [<font color=#1b1baa>$tree</font> index <font color=#1b1baa>$isel</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$isel</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::UpdateTree></a>
<b><font color=#ca14ca>proc</font></b> project::UpdateTree {} {
  <i><font color=#4b5d50># Fills a list of projects.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>set</font></b> tree [<font color=#1b1baa>$obPrj</font> TreePrj]
  <font color=#1b1baa>$tree</font> delete [<font color=#1b1baa>$tree</font> children {}]
  <b><font color=#3a6797>foreach</font></b> prj <font color=#1b1baa>$prjlist</font> {
    <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$prj</font>,ID) [<font color=#1b1baa>$tree</font> insert {} end <font color=#653760>-values</font> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$prj</font>]]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::FocusInTab></a>
<b><font color=#ca14ca>proc</font></b> project::FocusInTab {tab wid} {
  <i><font color=#4b5d50># Focuses on a widget in a tab.</font></i>
  <i><font color=#4b5d50>#   tab - the tab's path</font></i>
  <i><font color=#4b5d50>#   wid - the widget's path</font></i>

  <b><font color=#3a6797>variable</font></b> win
  <font color=#1b1baa>$win</font>.fra.fraR.nbk select <font color=#1b1baa>$win</font>.fra.fraR.nbk.<font color=#1b1baa>$tab</font>
  <b><font color=#134070>focus</font></b> <font color=#1b1baa>$wid</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CheckNewDir></a>
<b><font color=#ca14ca>proc</font></b> project::CheckNewDir {} {
  <i><font color=#4b5d50># Checks if the root directory exists. If no, tries to create it.</font></i>
  <i><font color=#4b5d50># Returns yes, if all is OK.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$al(prjroot)</font>]} {
    FocusInTab f1 [<font color=#1b1baa>$obPrj</font> chooserPath Dir]
    <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %d <font color=#1b1baa>$al(prjroot)</font>] \
      [msgcat::mc <font color=#8b2a0e>&quot;Directory \&quot;%d\&quot;\ndoesn't exist.\n\nCreate it?&quot;</font>]]
    <b><font color=#3a6797>if</font></b> {![alited::msg yesno ques <font color=#1b1baa>$msg</font> YES <font color=#653760>-geometry</font> root=<font color=#1b1baa>$win</font>]} {
      <b><font color=#ca14ca>return</font></b> no
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> mkdir <font color=#1b1baa>$al(prjroot)</font>} err]} {
      <b><font color=#3a6797>set</font></b> msg [msgcat::mc {Error at creating the directory.}]
      alited::msg ok err [<b><font color=#3a6797>append</font></b> msg \n\n <font color=#1b1baa>$err</font>] <font color=#653760>-geometry</font> root=<font color=#1b1baa>$win</font>
      <b><font color=#ca14ca>return</font></b> no
    }
  }
  <b><font color=#ca14ca>return</font></b> yes
}

<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ExistingProject></a>
<b><font color=#ca14ca>proc</font></b> project::ExistingProject {msgOnExist} {
  <i><font color=#4b5d50># Checks if a project (of entry field) exists.</font></i>
  <i><font color=#4b5d50>#   msgOnExist - yes, if message on existing, else on non-existing project</font></i>
  <i><font color=#4b5d50># Returns a project name if it exists or {} otherwise.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>set</font></b> pname <font color=#1b1baa>$al(prjname)</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$pname</font>]&gt;-1} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$msgOnExist</font>} {
      FocusInTab f1 [<font color=#1b1baa>$obPrj</font> EntName]
      <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$pname</font>] <font color=#1b1baa>$al(MC,prjexists)</font>]
      Message <font color=#1b1baa>$msg</font> 4
    }
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$msgOnExist</font>} {
      FocusInTab f1 [<font color=#1b1baa>$obPrj</font> EntName]
      <b><font color=#3a6797>set</font></b> msg [msgcat::mc \
        <font color=#8b2a0e>&quot;A project \&quot;%n\&quot; doesn't exists. Hit \[+\] button to create it.&quot;</font>]
      <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$pname</font>] <font color=#1b1baa>$msg</font>]
      Message <font color=#1b1baa>$msg</font> 4
    }
    <b><font color=#3a6797>set</font></b> pname {}
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$pname</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ValidProject></a>
<b><font color=#ca14ca>proc</font></b> project::ValidProject {} {
  <i><font color=#4b5d50># Checks if a project's options are valid.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> totalfiles
  <b><font color=#3a6797>set</font></b> al(prjname) [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$al(prjname)</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjname)</font> eq {} || ![CheckProjectName]} {
    <b><font color=#134070>bell</font></b>
    FocusInTab f1 [<font color=#1b1baa>$obPrj</font> EntName]
    <b><font color=#ca14ca>return</font></b> no
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjroot)</font> eq {}} {
    <b><font color=#134070>bell</font></b>
    FocusInTab f1 [<font color=#1b1baa>$obPrj</font> chooserPath Dir]
    <b><font color=#ca14ca>return</font></b> no
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjuseleafRE)</font> && <font color=#1b1baa>$al(prjleafRE)</font> eq {}} {
    <b><font color=#134070>bell</font></b>
    FocusInTab f2 [<font color=#1b1baa>$obPrj</font> EntLf]
    <b><font color=#ca14ca>return</font></b> no
  }
  <b><font color=#3a6797>set</font></b> al(prjroot) [<b><font color=#3a6797>file</font></b> nativename <font color=#1b1baa>$al(prjroot)</font>]
  <b><font color=#3a6797>if</font></b> {![CheckNewDir]} {<b><font color=#ca14ca>return</font></b> no}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjindent)</font>&lt;0 || <font color=#1b1baa>$al(prjindent)</font>&gt;8} {<b><font color=#3a6797>set</font></b> al(prjindent) 2}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjredunit)</font>&lt;<font color=#1b1baa>$al(minredunit)</font> || <font color=#1b1baa>$al(prjredunit)</font>&gt;100} {<b><font color=#3a6797>set</font></b> al(prjredunit) 20}
  <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %d <font color=#1b1baa>$al(prjroot)</font>] \
    [msgcat::mc {Checking %d. Wait a little...}]]
  Message <font color=#1b1baa>$msg</font> 5
  alited::tree::PrepareDirectoryContents
  <b><font color=#3a6797>set</font></b> totalfiles [<b><font color=#3a6797>llength</font></b> [alited::tree::GetDirectoryContents <font color=#1b1baa>$al(prjroot)</font>]]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$totalfiles</font> &gt;= <font color=#1b1baa>$al(MAXFILES)</font>} {
    <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$al(MAXFILES)</font>] \
      [msgcat::mc {Too big directory for a project: %n files or more.}]]
    Message <font color=#1b1baa>$msg</font> 4
    <b><font color=#3a6797>set</font></b> res no
  } <b><font color=#3a6797>else</font></b> {
    Message {}
    <b><font color=#3a6797>set</font></b> res yes
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CheckPrjLeaf></a>
<b><font color=#ca14ca>proc</font></b> project::CheckPrjLeaf {} {
  <i><font color=#4b5d50># Checks &quot;Regexp of a leaf&quot; field.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjleafRE)</font> eq {}} {
    <b><font color=#3a6797>set</font></b> al(prjleafRE) [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$al(RE,leaf)</font>]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CheckPrjUseLeaf></a>
<b><font color=#ca14ca>proc</font></b> project::CheckPrjUseLeaf {} {
  <i><font color=#4b5d50># Enables/disables the &quot;Regexp of a leaf&quot; field.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  CheckPrjLeaf
  <b><font color=#3a6797>set</font></b> al(prjuseleafRE) [<b><font color=#3a6797>string</font></b> is true <font color=#653760>-strict</font> <font color=#1b1baa>$al(prjuseleafRE)</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjuseleafRE)</font>} {<b><font color=#3a6797>set</font></b> _ normal} {<b><font color=#3a6797>set</font></b> _ disabled}
  [<font color=#1b1baa>$obPrj</font> EntLf] configure <font color=#653760>-state</font> <font color=#1b1baa>$_</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::StdLeafRE></a>
<b><font color=#ca14ca>proc</font></b> project::StdLeafRE {} {
  <i><font color=#4b5d50># Sets standard RE for leaf unit.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> al(prjleafRE) <font color=#1b1baa>$al(RE,leafDEF)</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndDay></a>
<b><font color=#ca14ca>proc</font></b> project::KlndDay {dsec {doblink yes}} {
  <i><font color=#4b5d50># Selects a date of reminder.</font></i>
  <i><font color=#4b5d50>#   dsec - date in seconds to select</font></i>
  <i><font color=#4b5d50>#   doblink - if yes, make the month blink</font></i>

  <b><font color=#3a6797>lassign</font></b> [ClockYMD <font color=#1b1baa>$dsec</font>] y m d
  <b><font color=#3a6797>set</font></b> m [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$m</font> { 0}]
  <b><font color=#3a6797>set</font></b> d [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$d</font> { 0}]
  ::klnd::selectedDay {} <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font> <font color=#1b1baa>$doblink</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndDayRem></a>
<b><font color=#ca14ca>proc</font></b> project::KlndDayRem {dmin} {
  <i><font color=#4b5d50># Selects a date of reminder before a current one.</font></i>
  <i><font color=#4b5d50>#   dmin - date in seconds to select</font></i>

  KlndDay <font color=#1b1baa>$dmin</font>
  <b><font color=#3a6797>after</font></b> idle {alited::project::KlndBorderText red}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Message></a>
<b><font color=#ca14ca>proc</font></b> project::Message {msg {mode 2}} {
  <i><font color=#4b5d50># Displays a message in statusbar of projects dialogue.</font></i>
  <i><font color=#4b5d50>#   msg - message</font></i>
  <i><font color=#4b5d50>#   mode - mode of Message</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  alited::Message <font color=#1b1baa>$msg</font> <font color=#1b1baa>$mode</font> [<font color=#1b1baa>$obPrj</font> LabMess]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KeyOnTree></a>
<b><font color=#ca14ca>proc</font></b> project::KeyOnTree {K} {
  <i><font color=#4b5d50># Handles key press on the tree.</font></i>
  <i><font color=#4b5d50>#   K - key</font></i>

  <b><font color=#3a6797>variable</font></b> prjlist
  Message {}
  <b><font color=#3a6797>set</font></b> icur [Selected index no]
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> is integer <font color=#653760>-strict</font> <font color=#1b1baa>$icur</font>]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>foreach</font></b> i [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>incr</font></b> icur] 0] {
    <b><font color=#3a6797>foreach</font></b> pr [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$i</font> end] {
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> compare <font color=#653760>-nocase</font> <font color=#1b1baa>$K</font> [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$pr</font> 0]]} {
        Select <font color=#1b1baa>$i</font>
        <b><font color=#ca14ca>return</font></b>
      }
      <b><font color=#3a6797>incr</font></b> i
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::focusTree></a>
<b><font color=#ca14ca>proc</font></b> project::focusTree {} {
  <i><font color=#4b5d50># Sets focus on the treeview.</font></i>

  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#134070>focus</font></b> <font color=#1b1baa>$win</font>
  <b><font color=#134070>focus</font></b> [<font color=#1b1baa>$obPrj</font> TreePrj]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ValidateIni></a>
<b><font color=#ca14ca>proc</font></b> project::ValidateIni {V} {
  <i><font color=#4b5d50># Validates values of alited.ini.</font></i>
  <i><font color=#4b5d50>#   V - %V wildcard of -validatecommand</font></i>

  <b><font color=#3a6797>variable</font></b> saveini
  <b><font color=#3a6797>set</font></b> saveini yes
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$V</font> eq {focusout}} {
    alited::ini::SaveIni
    <b><font color=#3a6797>set</font></b> saveini no
  }
  <b><font color=#ca14ca>return</font></b> 1
}
<a id=Files_tab's_procs></a>
<i><font color=#4b5d50># ________________________ Files tab's procs _________________________ #</font></i>
<a id=project::SelFiles></a>
<b><font color=#ca14ca>proc</font></b> project::SelFiles {{domsg yes}} {
  <i><font color=#4b5d50># Checks for a selection of file listbox.</font></i>
  <i><font color=#4b5d50>#   domsg - yes for error message shown</font></i>
  <i><font color=#4b5d50># Returns: list of listbox's path and the selection or {}.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> lbx [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>llength</font></b> [<b><font color=#3a6797>set</font></b> selidx [<font color=#1b1baa>$lbx</font> curselection]]]} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$domsg</font>} {Message [msgcat::mc {No selected files}] 4}
    <b><font color=#ca14ca>return</font></b> {}
  }
  <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$lbx</font> <font color=#1b1baa>$selidx</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CurrentFile></a>
<b><font color=#ca14ca>proc</font></b> project::CurrentFile {} {
  <i><font color=#4b5d50># Gets a current file of file listbox.</font></i>
  <i><font color=#4b5d50># Returns file name of first selected file or 1st in the list, if no selection.</font></i>

  <b><font color=#3a6797>lassign</font></b> [SelFiles no] lbx idx
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$lbx</font> ne {}} {
    <b><font color=#3a6797>set</font></b> res [<font color=#1b1baa>$lbx</font> get [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$idx</font> 0]]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> res {}
    <i><font color=#4b5d50># no selected file: try README of project</font></i>
    <b><font color=#3a6797>set</font></b> dircont [<b><font color=#3a6797>glob</font></b> <font color=#653760>-nocomplain</font> <font color=#653760>-directory</font> <font color=#1b1baa>$::alited::al(prjroot)</font> *]
    <b><font color=#3a6797>set</font></b> dircont [<b><font color=#3a6797>lsort</font></b> <font color=#653760>-dictionary</font> <font color=#1b1baa>$dircont</font>]
    <b><font color=#3a6797>foreach</font></b> fname {<b><font color=#3a6797>*</font></b>/README */README.*} {
      <b><font color=#3a6797>set</font></b> idx [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-nocase</font> <font color=#1b1baa>$dircont</font> <font color=#1b1baa>$fname</font>]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$idx</font>&gt;=0} {
        <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$dircont</font> <font color=#1b1baa>$idx</font>]
        <b><font color=#ca14ca>break</font></b>
      }
    }
    <b><font color=#3a6797>foreach</font></b> fname <font color=#1b1baa>$dircont</font> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$res</font> eq {} && [<b><font color=#3a6797>file</font></b> isfile <font color=#1b1baa>$fname</font>]} {<b><font color=#3a6797>set</font></b> res <font color=#1b1baa>$fname</font>}
    }
  }
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>file</font></b> normalize <font color=#1b1baa>$res</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::OpenFile></a>
<b><font color=#ca14ca>proc</font></b> project::OpenFile {y} {
  <i><font color=#4b5d50># Opens a file of listbox after double clicking.</font></i>
  <i><font color=#4b5d50>#   y - y-coordinate of clicking</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> lbx [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <b><font color=#3a6797>set</font></b> selid [<font color=#1b1baa>$lbx</font> nearest <font color=#1b1baa>$y</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$selid</font> != -1} {
    <font color=#1b1baa>$lbx</font> selection clear 0 end
    <font color=#1b1baa>$lbx</font> selection set <font color=#1b1baa>$selid</font>
    OpenSelFiles no
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::OpenSelFiles></a>
<b><font color=#ca14ca>proc</font></b> project::OpenSelFiles {{showmsg yes}} {
  <i><font color=#4b5d50># Opens selected files of listbox.</font></i>
  <i><font color=#4b5d50>#   showmsg - if yes, shows a message</font></i>
  <i><font color=#4b5d50># Files are open in a currently open project.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>set</font></b> prj <font color=#1b1baa>$al(prjname)</font>
  <b><font color=#3a6797>set</font></b> cprj <font color=#1b1baa>$curinfo(prjname)</font>
  <b><font color=#3a6797>set</font></b> al(prjname) <font color=#1b1baa>$curinfo(prjname)</font>
  <b><font color=#3a6797>lassign</font></b> [SelFiles] lbx selidx
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$lbx</font> ne {}} {
    <b><font color=#3a6797>update</font></b>
    <b><font color=#3a6797>set</font></b> fnames [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> balloon {}
    <b><font color=#3a6797>foreach</font></b> idx [<b><font color=#3a6797>lreverse</font></b> <font color=#1b1baa>$selidx</font>] {
      <b><font color=#3a6797>set</font></b> fn [<font color=#1b1baa>$lbx</font> get <font color=#1b1baa>$idx</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$fn</font>]} {
        <b><font color=#3a6797>lappend</font></b> fnames <font color=#1b1baa>$fn</font>
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-index</font> 0 <font color=#653760>-exact</font> <font color=#1b1baa>$prjinfo($cprj,tablist)</font> <font color=#1b1baa>$fn</font>]&lt;0} {
          <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$cprj</font>,tablist) [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$prjinfo($cprj,tablist)</font> 0 <font color=#1b1baa>$fn</font>]
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> balloon <font color=#1b1baa>$fn</font>
      }
    }
    <b><font color=#3a6797>set</font></b> llen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$fnames</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$showmsg</font>} {
      <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$llen</font>] [msgcat::mc {Open files: %n}]]
      Message <font color=#1b1baa>$msg</font> 3
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$llen</font>} {
      alited::file::OpenFile <font color=#1b1baa>$fnames</font> yes yes alited::info::Put
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$balloon</font> ne {}} {
      <b><font color=#3a6797>after</font></b> idle alited::Balloon1 <font color=#1b1baa>$balloon</font>
    }
  }
  <b><font color=#3a6797>set</font></b> al(prjname) <font color=#1b1baa>$prj</font>
  afterOpenCloseFiles
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::CloseSelFiles></a>
<b><font color=#ca14ca>proc</font></b> project::CloseSelFiles {} {
  <i><font color=#4b5d50># Closes selected files of listbox.</font></i>
  <i><font color=#4b5d50># Files are closed in a currently open project.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> pname [ExistingProject no]] eq {}} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>set</font></b> prj <font color=#1b1baa>$al(prjname)</font>
  <b><font color=#3a6797>set</font></b> cprj <font color=#1b1baa>$curinfo(prjname)</font>
  <b><font color=#3a6797>lassign</font></b> [SelFiles] lbx selidx
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$lbx</font> ne {}} {
    <b><font color=#3a6797>set</font></b> closecurr no
    <b><font color=#3a6797>set</font></b> fnamecurr [alited::bar::FileName]
    <b><font color=#3a6797>foreach</font></b> idx <font color=#1b1baa>$selidx</font> {
      <b><font color=#3a6797>set</font></b> fname [<font color=#1b1baa>$lbx</font> get <font color=#1b1baa>$idx</font>]
      <b><font color=#3a6797>if</font></b> {[alited::file::IsNoName <font color=#1b1baa>$fname</font>]} <b><font color=#ca14ca>continue</font></b>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> TID [alited::bar::FileTID <font color=#1b1baa>$fname</font>]] ne {}} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fname</font> eq <font color=#1b1baa>$fnamecurr</font>} {
          <b><font color=#3a6797>set</font></b> closecurr yes
        } <b><font color=#3a6797>else</font></b> {
          alited::bar::BAR <font color=#1b1baa>$TID</font> close no
        }
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> eq <font color=#1b1baa>$cprj</font> &&
      [<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-index</font> 0 <font color=#653760>-exact</font> <font color=#1b1baa>$prjinfo($cprj,tablist)</font> <font color=#1b1baa>$fname</font>]]&gt;=0} {
        <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$cprj</font>,tablist) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$prjinfo($cprj,tablist)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
      }
    }
    <b><font color=#3a6797>set</font></b> al(prjname) <font color=#1b1baa>$cprj</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$closecurr</font> && [<b><font color=#3a6797>set</font></b> TID [alited::bar::FileTID <font color=#1b1baa>$fnamecurr</font>]] ne {}} {
      alited::bar::BAR <font color=#1b1baa>$TID</font> close ;<i><font color=#4b5d50># this should be last to check for &quot;No name&quot; tab</font></i>
    }
    alited::bar::BAR draw
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> eq <font color=#1b1baa>$cprj</font>} {
      <b><font color=#3a6797>set</font></b> al(tablist) <font color=#1b1baa>$prjinfo($cprj,tablist)</font>
      TabFileInfo
    }
    <b><font color=#3a6797>set</font></b> al(prjname) <font color=#1b1baa>$prj</font>
    afterOpenCloseFiles
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::DetachSelFiles></a>
<b><font color=#ca14ca>proc</font></b> project::DetachSelFiles {} {
  <i><font color=#4b5d50># Detaches selected files.</font></i>

  <b><font color=#3a6797>lassign</font></b> [SelFiles] lbx selidx
  <b><font color=#3a6797>set</font></b> fnames [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$lbx</font> ne {}} {
    <b><font color=#3a6797>foreach</font></b> idx <font color=#1b1baa>$selidx</font> {<b><font color=#3a6797>lappend</font></b> fnames [<font color=#1b1baa>$lbx</font> get <font color=#1b1baa>$idx</font>]}
  }
  alited::file::Detach <font color=#1b1baa>$fnames</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::afterOpenCloseFiles></a>
<b><font color=#ca14ca>proc</font></b> project::afterOpenCloseFiles {} {
  <i><font color=#4b5d50># Actions after opening/closing files.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> flist [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <b><font color=#3a6797>set</font></b> fsels [<font color=#1b1baa>$flist</font> curselection]
  <b><font color=#3a6797>set</font></b> item [Selected index]
  GetProjects
  UpdateTree
  Select <font color=#1b1baa>$item</font>
  focusTree
  <b><font color=#3a6797>foreach</font></b> fsel <font color=#1b1baa>$fsels</font> {
    <b><font color=#3a6797>after</font></b> 300 <font color=#1b1baa>$flist</font> selection set <font color=#1b1baa>$fsel</font> <font color=#1b1baa>$fsel</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::SelectAllFiles></a>
<b><font color=#ca14ca>proc</font></b> project::SelectAllFiles {} {
  <i><font color=#4b5d50># Selects all files of listbox.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  [<font color=#1b1baa>$obPrj</font> LbxFlist] selection set 0 end
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::LbxPopup></a>
<b><font color=#ca14ca>proc</font></b> project::LbxPopup {X Y} {
  <i><font color=#4b5d50># Runs a popup menu on the project files listbox.</font></i>
  <i><font color=#4b5d50>#   X - x-coordinate of mouse pointer</font></i>
  <i><font color=#4b5d50>#   Y - y-coordinate of mouse pointer</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> filefilter
  <b><font color=#3a6797>set</font></b> popm [<font color=#1b1baa>$obPrj</font> LbxFlist].popup
  <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$popm</font>}
  <b><font color=#3a6797>lassign</font></b> [SelFiles] lbx selidx
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$filefilter</font> eq {}} {<b><font color=#3a6797>set</font></b> state normal} {<b><font color=#3a6797>set</font></b> state disabled}
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$selidx</font>]} {<b><font color=#3a6797>set</font></b> stateS normal} {<b><font color=#3a6797>set</font></b> stateS [<b><font color=#3a6797>set</font></b> state disabled]}
  <b><font color=#134070>menu</font></b> <font color=#1b1baa>$popm</font> <font color=#653760>-tearoff</font> 0
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$::alited::al(MC,openselfile)</font> <font color=#653760>-command</font> alited::project::OpenSelFiles <font color=#653760>-state</font> <font color=#1b1baa>$stateS</font>
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> [msgcat::mc {Close Selected Files}] \
    <font color=#653760>-command</font> alited::project::CloseSelFiles <font color=#653760>-state</font> <font color=#1b1baa>$state</font>
  <font color=#1b1baa>$popm</font> add separator
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$::alited::al(MC,detachsel)</font> <font color=#653760>-command</font> alited::project::DetachSelFiles <font color=#653760>-state</font> <font color=#1b1baa>$stateS</font>
  <font color=#1b1baa>$popm</font> add separator
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> [msgcat::mc {Select All}] <font color=#653760>-command</font> alited::project::SelectAllFiles <font color=#653760>-accelerator</font> Ctrl+A
  baltip::sleep 1000
  <font color=#1b1baa>$obPrj</font> themePopup <font color=#1b1baa>$popm</font>
  <b><font color=#134070>tk_popup</font></b> <font color=#1b1baa>$popm</font> <font color=#1b1baa>$X</font> <font color=#1b1baa>$Y</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ValidateDir></a>
<b><font color=#ca14ca>proc</font></b> project::ValidateDir {} {
  <i><font color=#4b5d50># Tries to get a project name at choosing root dir.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>update</font></b> idletasks ;<i><font color=#4b5d50>#  update ;# a bug of ttk?</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(prjname)</font> eq {}} {
    <b><font color=#3a6797>set</font></b> al(prjname) [<b><font color=#3a6797>file</font></b> tail <font color=#1b1baa>$al(prjroot)</font>]
  }
  <b><font color=#ca14ca>return</font></b> yes
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::TipOnFile></a>
<b><font color=#ca14ca>proc</font></b> project::TipOnFile {idx} {
  <i><font color=#4b5d50># Shows info on a file in the file list as a tooltip.</font></i>
  <i><font color=#4b5d50>#   idx - item index</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> lbx [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <b><font color=#3a6797>set</font></b> item [<font color=#1b1baa>$lbx</font> get <font color=#1b1baa>$idx</font>]
  <b><font color=#ca14ca>return</font></b> [alited::file::FileStat <font color=#1b1baa>$item</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::PopupMenu></a>
<b><font color=#ca14ca>proc</font></b> project::PopupMenu {x y X Y} {
  <i><font color=#4b5d50># Opens a popup menu in the project list.</font></i>
  <i><font color=#4b5d50>#   x - x-coordinate to identify an item</font></i>
  <i><font color=#4b5d50>#   y - y-coordinate to identify an item</font></i>
  <i><font color=#4b5d50>#   X - x-coordinate of the click</font></i>
  <i><font color=#4b5d50>#   Y - x-coordinate of the click</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>set</font></b> popm <font color=#1b1baa>$win</font>.popupmenu
  <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$popm</font>}
  <b><font color=#134070>menu</font></b> <font color=#1b1baa>$popm</font> <font color=#653760>-tearoff</font> 0
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$al(MC,prjadd)</font> \
    <font color=#653760>-command</font> alited::project::Add {<b><font color=#3a6797>*</font></b>}[<font color=#1b1baa>$obPrj</font> iconA add]
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$al(MC,prjchg)</font> \
    <font color=#653760>-command</font> alited::project::Change {<b><font color=#3a6797>*</font></b>}[<font color=#1b1baa>$obPrj</font> iconA change]
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$al(MC,prjdel1)</font> \
    <font color=#653760>-command</font> alited::project::Delete {<b><font color=#3a6797>*</font></b>}[<font color=#1b1baa>$obPrj</font> iconA delete]
  <font color=#1b1baa>$popm</font> add separator
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$al(MC,CrTemplPrj)</font> \
    <font color=#653760>-command</font> alited::project::Template {<b><font color=#3a6797>*</font></b>}[<font color=#1b1baa>$obPrj</font> iconA plus]
  <font color=#1b1baa>$popm</font> add command <font color=#653760>-label</font> <font color=#1b1baa>$al(MC,ViewDir)</font> \
    <font color=#653760>-command</font> alited::project::ViewDir {<b><font color=#3a6797>*</font></b>}[<font color=#1b1baa>$obPrj</font> iconA OpenFile]
  <font color=#1b1baa>$obPrj</font> themePopup <font color=#1b1baa>$popm</font>
  <b><font color=#134070>tk_popup</font></b> <font color=#1b1baa>$popm</font> <font color=#1b1baa>$X</font> <font color=#1b1baa>$Y</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::TabFileHeading></a>
<b><font color=#ca14ca>proc</font></b> project::TabFileHeading {} {
  <i><font color=#4b5d50># Show Files tab's heading.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> lbx [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <b><font color=#3a6797>set</font></b> txt [msgcat::mc {List of files (%n):}]
  <b><font color=#3a6797>set</font></b> txt [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n [<font color=#1b1baa>$lbx</font> index end]] <font color=#1b1baa>$txt</font>]
  [<font color=#1b1baa>$obPrj</font> LabFlist] configure <font color=#653760>-text</font> <font color=#1b1baa>$txt</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::TabFileFill></a>
<b><font color=#ca14ca>proc</font></b> project::TabFileFill {flist} {
  <i><font color=#4b5d50># Fills a listbox of files.</font></i>
  <i><font color=#4b5d50>#   flist - file list</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> lbx [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <font color=#1b1baa>$lbx</font> delete 0 end
  <b><font color=#3a6797>set</font></b> savfname {}
  <b><font color=#3a6797>foreach</font></b> tab [<b><font color=#3a6797>lsort</font></b> <font color=#653760>-index</font> 0 <font color=#653760>-dictionary</font> <font color=#1b1baa>$flist</font>] {
    <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$tab</font> \t] 0]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$savfname</font> ne <font color=#1b1baa>$fname</font>} {  ;<i><font color=#4b5d50># no duplicates</font></i>
      <font color=#1b1baa>$lbx</font> insert end <font color=#1b1baa>$fname</font>
      <b><font color=#3a6797>set</font></b> savfname <font color=#1b1baa>$fname</font>
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::TabFileInfo></a>
<b><font color=#ca14ca>proc</font></b> project::TabFileInfo {} {
  <i><font color=#4b5d50># Fills a listbox with a list of project files.</font></i>

  <b><font color=#3a6797>variable</font></b> filefilter
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$filefilter</font> ne {}} {
    TabFileFilter
    <b><font color=#ca14ca>return</font></b>
  }
  TabFileFill <font color=#1b1baa>$::alited::al(tablist)</font>
  TabFileHeading
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::TabFileFilter></a>
<b><font color=#ca14ca>proc</font></b> project::TabFileFilter {} {
  <i><font color=#4b5d50># Fills a listbox with a list of filtered files of all projects.</font></i>

  <b><font color=#3a6797>variable</font></b> filefilter
  <b><font color=#3a6797>variable</font></b> casefilter
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$filefilter</font> eq {}} {
    TabFileInfo
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>set</font></b> alltablist [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$casefilter</font>} {<b><font color=#3a6797>set</font></b> nocase {}} {<b><font color=#3a6797>set</font></b> nocase <font color=#653760>-nocase</font>}
  <b><font color=#3a6797>foreach</font></b> prj <font color=#1b1baa>$prjlist</font> {
    <b><font color=#3a6797>foreach</font></b> tab <font color=#1b1baa>$prjinfo($prj,tablist)</font> {
      <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$tab</font> \t] 0]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$nocase</font> *<font color=#1b1baa>$filefilter</font>* <font color=#1b1baa>$fname</font>]} {
        <b><font color=#3a6797>lappend</font></b> alltablist <font color=#1b1baa>$tab</font>
      }
    }
  }
  TabFileFill <font color=#1b1baa>$alltablist</font>
  TabFileHeading
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::postValidateFilter></a>
<b><font color=#ca14ca>proc</font></b> project::postValidateFilter {} {
  <i><font color=#4b5d50># Postvalidates the file filter change.</font></i>

  <b><font color=#3a6797>variable</font></b> filefilter
  <b><font color=#3a6797>variable</font></b> casefilter
  <b><font color=#3a6797>variable</font></b> savedfilefilter
  <b><font color=#3a6797>variable</font></b> savedcasefilter
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$savedfilefilter</font> ne <font color=#1b1baa>$filefilter</font> || <font color=#1b1baa>$savedcasefilter</font> ne <font color=#1b1baa>$casefilter</font>} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$filefilter</font> eq {}} {
      TabFileInfo
    } <b><font color=#3a6797>else</font></b> {
      TabFileFilter
    }
    <b><font color=#3a6797>set</font></b> savedfilefilter <font color=#1b1baa>$filefilter</font>
    <b><font color=#3a6797>set</font></b> savedcasefilter <font color=#1b1baa>$casefilter</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::preValidateFilter></a>
<b><font color=#ca14ca>proc</font></b> project::preValidateFilter {} {
  <i><font color=#4b5d50># Prevalidates the file filter change.</font></i>

  <b><font color=#3a6797>after</font></b> idle alited::project::postValidateFilter
  <b><font color=#ca14ca>return</font></b> 1
}
<a id=Buttons_for_project_list></a>
<i><font color=#4b5d50># ________________________ Buttons for project list _________________________ #</font></i>
<a id=project::Add></a>
<b><font color=#ca14ca>proc</font></b> project::Add {{showtotals yes}} {
  <i><font color=#4b5d50># &quot;Add project&quot; button's handler.</font></i>
  <i><font color=#4b5d50>#   showtotals - if yes, shows total number of files</font></i>
  <i><font color=#4b5d50># Returns yes, if the project is successfully added.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al OPTS OPTS
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  SaveNotes
  <b><font color=#3a6797>if</font></b> {![ValidProject] || [ExistingProject yes] ne {}} {<b><font color=#ca14ca>return</font></b> no}
  <b><font color=#3a6797>set</font></b> al(tablist) [<b><font color=#3a6797>list</font></b>]
  TabFileInfo
  <b><font color=#3a6797>set</font></b> pname <font color=#1b1baa>$al(prjname)</font>
  <b><font color=#3a6797>set</font></b> proot <font color=#1b1baa>$al(prjroot)</font>
  <b><font color=#3a6797>set</font></b> al(prjfile) [ProjectFileName <font color=#1b1baa>$pname</font>]
  <b><font color=#3a6797>set</font></b> al(prjbeforerun) {}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(PRJDEFAULT)</font>} {
    <i><font color=#4b5d50># use project defaults from &quot;Setup/Common/Projects&quot;, except for prjname & prjroot</font></i>
    <b><font color=#3a6797>foreach</font></b> opt <font color=#1b1baa>$OPTS</font> {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$opt</font>) <font color=#1b1baa>$al(DEFAULT,$opt)</font>}
    }
    <b><font color=#3a6797>set</font></b> al(prjname) <font color=#1b1baa>$pname</font>
    <b><font color=#3a6797>set</font></b> al(prjroot) <font color=#1b1baa>$proot</font>
  }
  alited::ini::SaveIni yes  ;<i><font color=#4b5d50># to initialize ini-file</font></i>
  <b><font color=#3a6797>foreach</font></b> opt <font color=#1b1baa>$OPTS</font> {
    <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,<font color=#1b1baa>$opt</font>) <font color=#1b1baa>$al($opt)</font>
  }
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$pname</font>,prjrem) {} ;<i><font color=#4b5d50># reminders</font></i>
  PutProjectOpts <font color=#1b1baa>$al(prjfile)</font> <font color=#1b1baa>$al(prjfile)</font> no
  GetProjects
  UpdateTree
  Select <font color=#1b1baa>$prjinfo($pname,ID)</font>
  UpdateMsg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$pname</font>] <font color=#1b1baa>$al(MC,prjnew)</font>] <font color=#1b1baa>$showtotals</font>
  <b><font color=#ca14ca>return</font></b> yes
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Change></a>
<b><font color=#ca14ca>proc</font></b> project::Change {} {
  <i><font color=#4b5d50># &quot;Change project&quot; button's handler.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> updateGUI
  SaveNotes
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> isel [Selected index]] eq {}} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>if</font></b> {![ValidProject]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$prjlist</font>]} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>!=<font color=#1b1baa>$isel</font> && [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$i</font>] eq <font color=#1b1baa>$al(prjname)</font>} {
      <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$al(prjname)</font>] <font color=#1b1baa>$al(MC,prjexists)</font>]
      Message <font color=#1b1baa>$msg</font> 4
      <b><font color=#ca14ca>return</font></b>
    }
  }
  <b><font color=#3a6797>set</font></b> oldprj [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$isel</font>]
  <b><font color=#3a6797>set</font></b> newprj <font color=#1b1baa>$al(prjname)</font>
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$newprj</font>,tablist) <font color=#1b1baa>$prjinfo($oldprj,tablist)</font>
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>unset</font></b> prjinfo(<font color=#1b1baa>$oldprj</font>,tablist)}
  <b><font color=#3a6797>set</font></b> oldname [ProjectFileName <font color=#1b1baa>$oldprj</font>]
  <b><font color=#3a6797>set</font></b> prjlist [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$isel</font> <font color=#1b1baa>$isel</font> <font color=#1b1baa>$newprj</font>]
  <b><font color=#3a6797>set</font></b> fname [ProjectFileName <font color=#1b1baa>$newprj</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$newprj</font> eq <font color=#1b1baa>$curinfo(prjname)</font>} SaveSettings
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$oldprj</font> eq <font color=#1b1baa>$curinfo(prjname)</font>} {
    <b><font color=#3a6797>set</font></b> curinfo(prjname) <font color=#1b1baa>$newprj</font>
    <b><font color=#3a6797>set</font></b> curinfo(prjfile) <font color=#1b1baa>$fname</font>
  }
  <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$newprj</font>,prjrem) <font color=#1b1baa>$prjinfo($oldprj,prjrem)</font> ;<i><font color=#4b5d50># reminders</font></i>
  PutProjectOpts <font color=#1b1baa>$fname</font> <font color=#1b1baa>$oldname</font> yes
  GetProjects
  UpdateTree
  Select <font color=#1b1baa>$prjinfo($newprj,ID)</font>
  <b><font color=#3a6797>set</font></b> updateGUI yes
  UpdateMsg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$isel</font>]] <font color=#1b1baa>$al(MC,prjupd)</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Delete></a>
<b><font color=#ca14ca>proc</font></b> project::Delete {} {
  <i><font color=#4b5d50># &quot;Delete project&quot; button's handler.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> isel [Selected index]] eq {}} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>set</font></b> geo <font color=#8b2a0e>&quot;-centerme <font color=#1b1baa>$</font>win&quot;</font>
  <b><font color=#3a6797>set</font></b> nametodel [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjlist</font> <font color=#1b1baa>$isel</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nametodel</font> eq <font color=#1b1baa>$curinfo(prjname)</font>} {
    Message <font color=#1b1baa>$al(MC,prjcantdel)</font> 4
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$nametodel</font>] <font color=#1b1baa>$al(MC,prjdelq)</font>]
  <b><font color=#3a6797>if</font></b> {![alited::msg yesno ques <font color=#1b1baa>$msg</font> NO {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$geo</font>]} {
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> delete [ProjectFileName <font color=#1b1baa>$nametodel</font>]} err]} {
    alited::msg ok err <font color=#1b1baa>$err</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$geo</font>
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> delete [NotesFile <font color=#1b1baa>$nametodel</font>]}
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> delete [RemsFile <font color=#1b1baa>$nametodel</font>]}
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> llen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$prjlist</font>]] && <font color=#1b1baa>$isel</font>&gt;=<font color=#1b1baa>$llen</font>} {
    <b><font color=#3a6797>set</font></b> isel [<b><font color=#3a6797>incr</font></b> llen -1]
  }
  GetProjects
  UpdateTree
  Select <font color=#1b1baa>$isel</font>
  Message [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$nametodel</font>] <font color=#1b1baa>$al(MC,prjdel2)</font>] 3
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Template></a>
<b><font color=#ca14ca>proc</font></b> project::Template {} {
  <i><font color=#4b5d50># Creates a project by template as set in Template tab.</font></i>
  <i><font color=#4b5d50># The template can contain directories or files (indented for subdirectories).</font></i>
  <i><font color=#4b5d50># The files satisfy glob-patterns: changelog*, license*, licence*, readme*.</font></i>
  <i><font color=#4b5d50># See also: TplDefault</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> curinfo
  <i><font color=#4b5d50># first, update the template list independently on errors</font></i>
  UpdateTplLists
  <i><font color=#4b5d50># then check the template for correctness</font></i>
  <b><font color=#3a6797>set</font></b> wtpl [<font color=#1b1baa>$obPrj</font> TexTemplate]
  <b><font color=#3a6797>set</font></b> namelist [<b><font color=#3a6797>set</font></b> errmess {}]
  <b><font color=#3a6797>set</font></b> margin [<b><font color=#3a6797>set</font></b> indent [<b><font color=#3a6797>set</font></b> spprev -1]]
  <b><font color=#3a6797>foreach</font></b> name [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$wtpl</font> get 1.0 end] \n] {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$name</font>]] eq {}} <b><font color=#ca14ca>continue</font></b>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$name</font>] ne [::apave::NormalizeFileName <font color=#1b1baa>$name</font>]} {
      <b><font color=#3a6797>set</font></b> errmess [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$name</font>] <font color=#1b1baa>$al(MC,incorrname)</font>]
      <b><font color=#ca14ca>break</font></b>
    }
    <b><font color=#3a6797>set</font></b> sporig [<font color=#1b1baa>$obPrj</font> leadingSpaces <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$margin</font>&lt;0} {<b><font color=#3a6797>set</font></b> margin <font color=#1b1baa>$sporig</font>}
    <b><font color=#3a6797>set</font></b> sp [<font color=#1b1baa>$obPrj</font> leadingSpaces [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> <font color=#1b1baa>$margin</font> end]]
    <b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>set</font></b> lastname {}  ;<i><font color=#4b5d50># root of project dir</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$sp</font> || <font color=#1b1baa>$margin</font>&gt;<font color=#1b1baa>$sporig</font>} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$indent</font>&lt;0} {<b><font color=#3a6797>set</font></b> indent <font color=#1b1baa>$sp</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$margin</font>&gt;<font color=#1b1baa>$sporig</font> || <font color=#1b1baa>$sp</font> % <font color=#1b1baa>$indent</font> || <font color=#1b1baa>$sp</font>&gt;(<font color=#1b1baa>$spprev</font>+<font color=#1b1baa>$indent</font>)} {
        <b><font color=#3a6797>set</font></b> errmess [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$name</font>] \
          [msgcat::mc {Incorrect indentation in Project template: %n}]]
        <b><font color=#ca14ca>break</font></b>
      }
      <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$namelist</font>]} {<font color=#1b1baa>$i</font>} {} {
        <b><font color=#3a6797>incr</font></b> i -1
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$namelist</font> <font color=#1b1baa>$i</font>] n1 s1
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$s1</font>&lt;<font color=#1b1baa>$sp</font>} {
          <b><font color=#3a6797>set</font></b> lastname <font color=#1b1baa>$n1</font>/
          <b><font color=#ca14ca>break</font></b>
        }
      }
    }
    <b><font color=#3a6797>lappend</font></b> namelist [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>file</font></b> nativename <font color=#1b1baa>$lastname$name</font>] <font color=#1b1baa>$sp</font>]
    <b><font color=#3a6797>set</font></b> spprev <font color=#1b1baa>$sp</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>errmess<font color=#1b1baa>$</font>namelist&quot;</font> eq {}} {
    <b><font color=#3a6797>set</font></b> errmess {The project template is empty!}
  } <b><font color=#3a6797>elseif</font></b> {[ExistingProject yes] ne {}} {
    <b><font color=#ca14ca>return</font></b>
  } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$al(prjroot)</font>]} {
    <b><font color=#3a6797>set</font></b> errmess {The project directory already exists! It isn't created with templates.}
    FocusInTab f1 [<font color=#1b1baa>$obPrj</font> chooserPath Dir]
    Message [msgcat::mc <font color=#1b1baa>$errmess</font>] 4
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$errmess</font> ne {}} {
    <b><font color=#3a6797>set</font></b> namelist {}  ;<i><font color=#4b5d50># skip the following foreach</font></i>
  } <b><font color=#3a6797>elseif</font></b> {![Add no]} {
    <b><font color=#ca14ca>return</font></b>
  }
  <i><font color=#4b5d50># the template is OK -&gt; create its dir/file tree</font></i>
  <b><font color=#3a6797>foreach</font></b> fn <font color=#1b1baa>$namelist</font> {
    <b><font color=#3a6797>set</font></b> fn [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$fn</font> 0]
    <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$al(prjroot)</font> <font color=#1b1baa>$fn</font>]
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-glob</font> <font color=#653760>-nocase</font> -- [<b><font color=#3a6797>file</font></b> tail <font color=#1b1baa>$fn</font>] {
      README* - CHANGELOG* {
        <b><font color=#3a6797>set</font></b> err [<b><font color=#3a6797>catch</font></b> {writeTextFile <font color=#1b1baa>$fname</font> {} 1} errmess]
      }
      LICENCE* - LICENSE* {
        <b><font color=#3a6797>set</font></b> fname0 [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$curinfo(prjroot)</font> <font color=#1b1baa>$fn</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$fname0</font>]} {
          <b><font color=#3a6797>set</font></b> err [<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> copy <font color=#1b1baa>$fname0</font> <font color=#1b1baa>$fname</font>} errmess]
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> err [<b><font color=#3a6797>catch</font></b> {writeTextFile <font color=#1b1baa>$fname</font> {} 1} errmess]
        }
      }
      <b><font color=#3a6797>default</font></b> {
        <b><font color=#3a6797>set</font></b> err [<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>file</font></b> mkdir <font color=#1b1baa>$fname</font>} errmess]
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$err</font>} <b><font color=#ca14ca>break</font></b>
    <b><font color=#3a6797>set</font></b> errmess {}
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$errmess</font> ne {}} {
    FocusInTab f3 <font color=#1b1baa>$wtpl</font>
    Message [msgcat::mc <font color=#1b1baa>$errmess</font>] 4
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::PendingTODOs></a>
<b><font color=#ca14ca>proc</font></b> project::PendingTODOs {} {
  <i><font color=#4b5d50># Displays all pending TODOs.</font></i>

  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  alited::ScriptSource todolist
  <b><font color=#3a6797>set</font></b> tdlist [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>foreach</font></b> prj <font color=#1b1baa>$prjlist</font> {
    <b><font color=#3a6797>lassign</font></b> [ReadRems <font color=#1b1baa>$prj</font>] dmin prjinfo(<font color=#1b1baa>$prj</font>,prjrem)
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prjinfo($prj,prjrem)</font> ne {}} {
      <b><font color=#3a6797>lappend</font></b> tdlist [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$prj</font> <font color=#1b1baa>$prjinfo($prj,prjrem)</font>]
    }
  }
  <b><font color=#3a6797>set</font></b> prj [alited::todolist::_run <font color=#1b1baa>$tdlist</font>]
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prj</font> ne {}} {
      Select <font color=#1b1baa>$prjinfo($prj,ID)</font>
      <b><font color=#3a6797>after</font></b> idle {<b><font color=#3a6797>after</font></b> 250 alited::project::Ok}
    } <b><font color=#3a6797>else</font></b> {
      KlndUpdate
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::UpdateMsg></a>
<b><font color=#ca14ca>proc</font></b> project::UpdateMsg {msg {showtotals yes}} {
  <i><font color=#4b5d50># Displays a message on project updating.</font></i>
  <i><font color=#4b5d50>#   msg - message of action (add/change)</font></i>
  <i><font color=#4b5d50>#   showtotals - if yes, shows total number of files</font></i>

  <b><font color=#3a6797>variable</font></b> totalfiles
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$showtotals</font>} {<b><font color=#3a6797>append</font></b> msg <font color=#8b2a0e>&quot; (<font color=#1b1baa>$</font>::alited::al(MC,files) : <font color=#1b1baa>$</font>totalfiles) &quot;</font>}
  Message <font color=#1b1baa>$msg</font> 3
}
<a id=Buttons></a>
<i><font color=#4b5d50># ________________________ Buttons _________________________ #</font></i>
<a id=project::Ok></a>
<b><font color=#ca14ca>proc</font></b> project::Ok {args} {
  <i><font color=#4b5d50># 'OK' button handler.</font></i>
  <i><font color=#4b5d50>#   args - possible arguments</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al obPav obPav _dirtree _dirtree
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>variable</font></b> updateGUI
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$curinfo(_NO2ENT)</font>} {
    <i><font color=#4b5d50># disables entering twice (at multiple double-clicks)</font></i>
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> isel [Selected index]] eq {} || ![ValidProject]} {
    focusTree
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {![ValidProject]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> pname [ExistingProject no]] eq {}} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> N [<b><font color=#3a6797>llength</font></b> [alited::bar::BAR listFlag m]]]} {
    <b><font color=#3a6797>set</font></b> msg [msgcat::mc <font color=#8b2a0e>&quot;All modified files (%n) will be saved.\n\nDo you agree?&quot;</font>]
    <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$N</font>] <font color=#1b1baa>$msg</font>]
    <b><font color=#3a6797>set</font></b> ans [alited::msg yesnocancel ques <font color=#1b1baa>$msg</font> YES <font color=#653760>-centerme</font> <font color=#1b1baa>$win</font>]
    <b><font color=#3a6797>switch</font></b> <font color=#1b1baa>$ans</font> {
      0 {<b><font color=#ca14ca>return</font></b>}
      2 {alited::bar::BAR unmarkTab}
    }
    <b><font color=#3a6797>if</font></b> {![alited::file::SaveAll]} {
      <font color=#1b1baa>$obPrj</font> res <font color=#1b1baa>$win</font> 0
      <b><font color=#ca14ca>return</font></b>
    }
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> N [<b><font color=#3a6797>llength</font></b> [alited::bar::BAR cget <font color=#653760>-select</font>]]]} {
    <b><font color=#3a6797>set</font></b> msg [msgcat::mc <font color=#8b2a0e>&quot;All selected files (%n) will remain open\nin the project you are switching to.\n\nDo you agree?&quot;</font>]
    <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$N</font>] <font color=#1b1baa>$msg</font>]
    <b><font color=#3a6797>if</font></b> {![alited::msg yesno ques <font color=#1b1baa>$msg</font> YES <font color=#653760>-centerme</font> <font color=#1b1baa>$win</font>]} <b><font color=#ca14ca>return</font></b>
  }
  ::apave::withdraw <font color=#1b1baa>$win</font>
  <b><font color=#3a6797>set</font></b> curinfo(_NO2ENT) 1
  <b><font color=#3a6797>set</font></b> fname [ProjectFileName <font color=#1b1baa>$pname</font>]
  <b><font color=#3a6797>catch</font></b> {alited::run::Cancel}  ;<i><font color=#4b5d50># possibly open Run dialogue: discard its settings</font></i>
  RestoreSettings
  alited::ini::SaveIni
  <i><font color=#4b5d50># setting al(project::Ok) to skip &quot;No name&quot; & SaveCurrentIni at closing all</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> al(project::Ok) 1]} {
    <b><font color=#3a6797>set</font></b> tabs [alited::bar::BAR listTab]
    alited::file::CloseAll 1 <font color=#653760>-skipsel</font>  ;<i><font color=#4b5d50># the selected tabs aren't closed</font></i>
    <b><font color=#3a6797>set</font></b> selfiles [<b><font color=#3a6797>list</font></b>]                ;<i><font color=#4b5d50># -&gt; get their file names to reopen afterwards</font></i>
    <b><font color=#3a6797>foreach</font></b> tid [alited::bar::BAR listFlag s] {
      <b><font color=#3a6797>lappend</font></b> selfiles [alited::bar::FileName <font color=#1b1baa>$tid</font>]
    }
    alited::file::CloseAll 1   ;<i><font color=#4b5d50># close all tabs</font></i>
    <b><font color=#3a6797>set</font></b> comms [<b><font color=#3a6797>info</font></b> commands]
    <b><font color=#3a6797>foreach</font></b> tab <font color=#1b1baa>$tabs</font> {
      <b><font color=#3a6797>set</font></b> tab [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$tab</font> 0]
      <b><font color=#3a6797>foreach</font></b> c <font color=#1b1baa>$comms</font> {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>regexp</font></b> <font color=#8b2a0e>&quot;\[._\]<font color=#1b1baa>$</font>tab\(\[.\]internal\$|\$\)&quot;</font> <font color=#1b1baa>$c</font>]} {
          <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$c</font>}
          <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>rename</font></b> <font color=#1b1baa>$c</font> {}}
        }
      }
    }
    <font color=#1b1baa>$obPav</font> untouchWidgets clear *btsBar*  ;<i><font color=#4b5d50># remove bartabs references to the untouched</font></i>
    <b><font color=#3a6797>set</font></b> al(prjname) <font color=#1b1baa>$pname</font>
    <b><font color=#3a6797>set</font></b> al(prjfile) <font color=#1b1baa>$fname</font>
    alited::ini::ReadIni <font color=#1b1baa>$fname</font>
    alited::bar::FillBar [<font color=#1b1baa>$obPav</font> BtsBar]
    <b><font color=#3a6797>set</font></b> fnames [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$selfiles</font>]} {<font color=#1b1baa>$i</font>} {} { ;<i><font color=#4b5d50># reopen selected files of previous project</font></i>
      <b><font color=#3a6797>incr</font></b> i -1
      <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$selfiles</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>if</font></b> {[alited::bar::FileTID <font color=#1b1baa>$fname</font>] eq {}} {
        <b><font color=#3a6797>lappend</font></b> fnames <font color=#1b1baa>$fname</font>
      }
    }
    <b><font color=#3a6797>set</font></b> TID [<b><font color=#3a6797>lindex</font></b> [alited::bar::BAR listTab] <font color=#1b1baa>$al(curtab)</font> 0]
    <b><font color=#3a6797>catch</font></b> {alited::bar::BAR <font color=#1b1baa>$TID</font> show no no}
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$fnames</font>]} {alited::file::OpenFile <font color=#1b1baa>$fnames</font> yes yes}
    alited::main::UpdateProjectInfo
    alited::ini::GetUserDirs
    alited::file::MakeThemHighlighted
    alited::favor::ShowFavVisit
    [<font color=#1b1baa>$obPav</font> Tree] selection set {}  ;<i><font color=#4b5d50># new project - no group selected</font></i>
    <b><font color=#3a6797>update</font></b>
  }
  <b><font color=#3a6797>unset</font></b> al(project::Ok)
  alited::file::CheckForNew yes
  <b><font color=#3a6797>after</font></b> 200 {<b><font color=#3a6797>after</font></b> idle alited::main::FocusText}
  <b><font color=#3a6797>set</font></b> _dirtree [<b><font color=#3a6797>list</font></b>] ;<i><font color=#4b5d50># free its memory</font></i>
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$al(TREE,isunits)</font>} {
    <b><font color=#3a6797>after</font></b> 200 {<b><font color=#3a6797>after</font></b> idle {alited::tree::RecreateTree; alited::tree::SeeTreeItem}}
  }
  <b><font color=#3a6797>set</font></b> updateGUI no ;<i><font color=#4b5d50># GUI will be updating anyway</font></i>
  <font color=#1b1baa>$obPrj</font> res <font color=#1b1baa>$win</font> 1
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Close></a>
<b><font color=#ca14ca>proc</font></b> project::Close {args} {
  <i><font color=#4b5d50># 'Close' button handler.</font></i>
  <i><font color=#4b5d50>#   args - possible arguments</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> win
  SaveData
  SaveNotes
  RestoreSettings
  <font color=#1b1baa>$obPrj</font> res <font color=#1b1baa>$win</font> 0
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Help></a>
<b><font color=#ca14ca>proc</font></b> project::Help {} {
  <i><font color=#4b5d50># 'Help' button handler.</font></i>

  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>set</font></b> th {}
  <b><font color=#3a6797>set</font></b> ts [<b><font color=#3a6797>string</font></b> range [<font color=#1b1baa>$win</font>.fra.fraR.nbk select] end-1 end]
  <b><font color=#3a6797>switch</font></b> <font color=#1b1baa>$ts</font> {
    f2 - f3 - f4 - f5 {<b><font color=#3a6797>set</font></b> th [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$ts</font> end]}
  }
  alited::Help <font color=#1b1baa>$win</font> <font color=#1b1baa>$th</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::HelpMe></a>
<b><font color=#ca14ca>proc</font></b> project::HelpMe {} {
  <i><font color=#4b5d50># 'Help' for start.</font></i>

  <b><font color=#3a6797>variable</font></b> win
  alited::HelpMe <font color=#1b1baa>$win</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::OnProjectEnter></a>
<b><font color=#ca14ca>proc</font></b> project::OnProjectEnter {} {
  <i><font color=#4b5d50># Actions on entering a project.</font></i>

  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> msgtodo
  <b><font color=#3a6797>variable</font></b> itemtodo
  <b><font color=#3a6797>lassign</font></b> [SortRems <font color=#1b1baa>$prjinfo($::alited::al(prjname)</font>,prjrem)] dmin - outdated
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$outdated</font>} {
    <b><font color=#3a6797>set</font></b> tab1 <font color=#1b1baa>$win</font>.fra.fraR.nbk.f1
    <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$win</font>.fra.fraR.nbk select] ne <font color=#1b1baa>$tab1</font>} {
      <font color=#1b1baa>$win</font>.fra.fraR.nbk select <font color=#1b1baa>$tab1</font>
    }
    KlndDayRem <font color=#1b1baa>$dmin</font>
    <b><font color=#3a6797>set</font></b> msgtodo [msgcat::mc {TODO reminders for the past: %d.}]
    <b><font color=#3a6797>set</font></b> dmin [ClockFormat <font color=#1b1baa>$dmin</font>]
    <b><font color=#3a6797>set</font></b> msgtodo [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %d <font color=#1b1baa>$dmin</font>] <font color=#1b1baa>$msgtodo</font>]
    Message <font color=#1b1baa>$msgtodo</font> 6
    <b><font color=#3a6797>set</font></b> itemtodo [Selected item no]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ProcMessage></a>
<b><font color=#ca14ca>proc</font></b> project::ProcMessage {} {
  <i><font color=#4b5d50># Handles clicking on message label.</font></i>
  <i><font color=#4b5d50># Shows the message and if it is about TODO, selects the corresponding project.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> msgtodo
  <b><font color=#3a6797>variable</font></b> itemtodo
  <b><font color=#3a6797>set</font></b> msg [baltip cget [<font color=#1b1baa>$obPrj</font> LabMess] <font color=#653760>-text</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$msgtodo</font> eq <font color=#1b1baa>$msg</font>} {
    Message <font color=#1b1baa>$msg</font> 6
    Select <font color=#1b1baa>$itemtodo</font>
  } <b><font color=#3a6797>else</font></b> {
    Message <font color=#1b1baa>$msg</font> 3
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ProjectEnter></a>
<b><font color=#ca14ca>proc</font></b> project::ProjectEnter {} {
  <i><font color=#4b5d50># Processes double-clicking and pressing Enter on the project list.</font></i>
  <i><font color=#4b5d50># Cancels selecting projects if there are old reminders.</font></i>

  OnProjectEnter
  Ok
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_button></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_button {ev} {
  <i><font color=#4b5d50># Fire an event handler (paste/undo/redo) on a reminder.</font></i>
  <i><font color=#4b5d50>#   ev - event to fire</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  ::apave::eventOnText [<font color=#1b1baa>$obPrj</font> TexKlnd] <font color=#1b1baa>$ev</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_paste></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_paste {} {
  <i><font color=#4b5d50># Pastes a text to a reminder.</font></i>

  Klnd_button &lt;&lt;Paste&gt;&gt;
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_undo></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_undo {} {
  <i><font color=#4b5d50># Undoes changes of a reminder.</font></i>

  Klnd_button &lt;&lt;Undo&gt;&gt;
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_redo></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_redo {} {
  <i><font color=#4b5d50># Redoes changes of a reminder.</font></i>

  Klnd_button &lt;&lt;Redo&gt;&gt;
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_delete></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_delete {} {
  <i><font color=#4b5d50># Clears a reminder.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  [<font color=#1b1baa>$obPrj</font> TexKlnd] replace 1.0 end {}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_moveTODO></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_moveTODO {wrem todo date1 date2} {
  <i><font color=#4b5d50># Moves current TODO to a new date.</font></i>
  <i><font color=#4b5d50>#   wrem - text widget of TODO</font></i>
  <i><font color=#4b5d50>#   todo - text of TODO</font></i>
  <i><font color=#4b5d50>#   date1 - old date (in seconds)</font></i>
  <i><font color=#4b5d50>#   date2 - new date (in seconds)</font></i>

  <b><font color=#3a6797>variable</font></b> klnddata
  <i><font color=#4b5d50># get TODO of new date</font></i>
  <b><font color=#3a6797>lassign</font></b> [ClockYMD <font color=#1b1baa>$date2</font>] y m d
  KlndClick <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>
  <b><font color=#3a6797>set</font></b> todonew [<b><font color=#3a6797>string</font></b> trimright [<font color=#1b1baa>$wrem</font> get 1.0 end]]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$todonew</font> ne {}} {
    <i><font color=#4b5d50># there is TODO on new day</font></i>
    Message <font color=#1b1baa>$::alited::al(MC,tododupl)</font> 4
    <i><font color=#4b5d50># return to old day</font></i>
    <b><font color=#3a6797>lassign</font></b> [ClockYMD <font color=#1b1baa>$date1</font>] y m d
    KlndClick <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>
  } <b><font color=#3a6797>else</font></b> {
    <i><font color=#4b5d50># select the new date</font></i>
    <b><font color=#3a6797>set</font></b> klnddata(SAVEDATE) [ClockFormat <font color=#1b1baa>$date2</font>]
    KlndDay <font color=#1b1baa>$date2</font> no
  }
  <font color=#1b1baa>$wrem</font> replace 1.0 end <font color=#1b1baa>$todo</font>
  ::hl_tcl::hl_text <font color=#1b1baa>$wrem</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_next></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_next {{days 1}} {
  <i><font color=#4b5d50># Moves a reminder to *days*.</font></i>
  <i><font color=#4b5d50>#   days - days to move to</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>set</font></b> wrem [<font color=#1b1baa>$obPrj</font> TexKlnd]
  <b><font color=#3a6797>set</font></b> todo [<b><font color=#3a6797>string</font></b> trimright [<font color=#1b1baa>$wrem</font> get 1.0 end]]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$todo</font> eq {}} {
    <b><font color=#134070>bell</font></b>
    FocusInTab f1 <font color=#1b1baa>$wrem</font>
    <b><font color=#ca14ca>return</font></b>
  }
  Klnd_delete
  <b><font color=#3a6797>set</font></b> date1 [ClockScan <font color=#1b1baa>$klnddata(SAVEDATE)</font>]
  <b><font color=#3a6797>set</font></b> date2 [<b><font color=#3a6797>clock</font></b> add <font color=#1b1baa>$date1</font> <font color=#1b1baa>$days</font> days]
  <b><font color=#3a6797>after</font></b> 100 [<b><font color=#3a6797>list</font></b> alited::project::Klnd_moveTODO <font color=#1b1baa>$wrem</font> <font color=#1b1baa>$todo</font> <font color=#1b1baa>$date1</font> <font color=#1b1baa>$date2</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_next2></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_next2 {} {
  <i><font color=#4b5d50># Moves a reminder to 7 days.</font></i>

  Klnd_next 7
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_previous></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_previous {} {
  <i><font color=#4b5d50># Moves a reminder back to 1 day.</font></i>

  Klnd_next -1
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Klnd_previous2></a>
<b><font color=#ca14ca>proc</font></b> project::Klnd_previous2 {} {
  <i><font color=#4b5d50># Moves a reminder back to 7 days.</font></i>

  Klnd_next -7
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndPopup></a>
<b><font color=#ca14ca>proc</font></b> project::KlndPopup {w y m d X Y} {
  <i><font color=#4b5d50># Handles a popup menu for the calendar.</font></i>
  <i><font color=#4b5d50>#   w - day widget clicked</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   d - day</font></i>
  <i><font color=#4b5d50>#   X - X-coordinate of pointer</font></i>
  <i><font color=#4b5d50>#   Y - Y-coordinate of pointer</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  KlndClick <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>
  ::klnd::selectedDay {} <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font> no
  <b><font color=#3a6797>set</font></b> popm <font color=#1b1baa>$w</font>.popup
  <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$popm</font>}
  <b><font color=#134070>menu</font></b> <font color=#1b1baa>$popm</font> <font color=#653760>-tearoff</font> 0
  <b><font color=#3a6797>foreach</font></b> img {delete - previous2 previous - next next2} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$img</font> eq {-}} {
      <font color=#1b1baa>$popm</font> add separator
    } <b><font color=#3a6797>else</font></b> {
      <font color=#1b1baa>$popm</font> add command <font color=#653760>-image</font> alimg_<font color=#1b1baa>$img</font>  <font color=#653760>-compound</font> left \
        <font color=#653760>-label</font> <font color=#1b1baa>$::alited::al(MC,prjT$img)</font> <font color=#653760>-command</font> alited::project::Klnd_<font color=#1b1baa>$img</font>
    }
  }
  <font color=#1b1baa>$obPrj</font> themePopup <font color=#1b1baa>$popm</font>
  <b><font color=#134070>tk_popup</font></b> <font color=#1b1baa>$popm</font> <font color=#1b1baa>$X</font> <font color=#1b1baa>$Y</font>
  KlndUpdate
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ViewDir></a>
<b><font color=#ca14ca>proc</font></b> project::ViewDir {} {
  <i><font color=#4b5d50># Shows file chooser just to view the project's dir</font></i>

  alited::tool::e_menu EX=4 d=<font color=#1b1baa>$::alited::al(prjroot)</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::RunComs></a>
<b><font color=#ca14ca>proc</font></b> project::RunComs {} {
  <i><font color=#4b5d50># Handles running commands of Commands tab.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> prjinfo
  SaveNotes [CurrProject]
  <b><font color=#3a6797>set</font></b> comtorun {}
  <b><font color=#3a6797>set</font></b> comcnt 0
  <i><font color=#4b5d50># collect commands executed on the current project</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists prjinfo(<font color=#1b1baa>$al(prjname)</font>,prjroot)]} {
    <b><font color=#3a6797>set</font></b> dir <font color=#1b1baa>$prjinfo($al(prjname)</font>,prjroot)
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(PTP,runch$i)</font> && <font color=#1b1baa>$al(PTP,run$i)</font> ne {}} {
        <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$comcnt</font>} {
          <b><font color=#3a6797>append</font></b> comtorun <font color=#8b2a0e>&quot;cd <font color=#1b1baa>$</font>dir\n&quot;</font>
        }
        <b><font color=#3a6797>append</font></b> comtorun <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(PTP,run<font color=#1b1baa>$</font>i)\n&quot;</font>
        <b><font color=#3a6797>incr</font></b> comcnt
      }
    }
  }
  <i><font color=#4b5d50># collect general commands executed per project</font></i>
  <b><font color=#3a6797>foreach</font></b> prj <font color=#1b1baa>$prjlist</font> {
    <b><font color=#3a6797>set</font></b> dir <font color=#1b1baa>$prjinfo($prj,prjroot)</font>
    <b><font color=#3a6797>set</font></b> com {}
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(PTP,comch$i)</font> && <font color=#1b1baa>$al(PTP,com$i)</font> ne {}} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com</font> eq {}} {
          <b><font color=#3a6797>append</font></b> com <font color=#8b2a0e>&quot;cd <font color=#1b1baa>$</font>dir\n&quot;</font>
        }
        <b><font color=#3a6797>append</font></b> com <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(PTP,com<font color=#1b1baa>$</font>i)\n&quot;</font>
        <b><font color=#3a6797>incr</font></b> comcnt
      }
    }
    <b><font color=#3a6797>append</font></b> comtorun <font color=#1b1baa>$com</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$comtorun</font> eq {}} {
    <b><font color=#134070>focus</font></b> [<font color=#1b1baa>$obPrj</font> Entrun1]
    <b><font color=#134070>bell</font></b>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> msg [msgcat::mc {%n commands will be executed!}]
    <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %n <font color=#1b1baa>$comcnt</font>] <font color=#1b1baa>$msg</font>]
    <b><font color=#3a6797>if</font></b> {[alited::msg yesno ques <font color=#1b1baa>$msg</font> YES <font color=#653760>-centerme</font> <font color=#1b1baa>$win</font>]} {
      alited::tool::Run_in_e_menu <font color=#1b1baa>$comtorun</font>
    }
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ChecksRun></a>
<b><font color=#ca14ca>proc</font></b> project::ChecksRun {} {
  <i><font color=#4b5d50># Sets checks of &quot;Commands / Run for project&quot;.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> al(PTP,runch<font color=#1b1baa>$i</font>) <font color=#1b1baa>$al(PTP,chbClearRun)</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::ChecksCom></a>
<b><font color=#ca14ca>proc</font></b> project::ChecksCom {} {
  <i><font color=#4b5d50># Sets checks of &quot;Commands / Run for all&quot;.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> al(PTP,comch<font color=#1b1baa>$i</font>) <font color=#1b1baa>$al(PTP,chbClearCom)</font>
  }
}
<a id=Template_procs></a>
<i><font color=#4b5d50># ________________________ Template procs _________________________ #</font></i>
<a id=project::TplDefaultText></a>
<b><font color=#ca14ca>proc</font></b> project::TplDefaultText {} {
  <i><font color=#4b5d50># Gets default contents of project template.</font></i>

  <b><font color=#ca14ca>return</font></b> \
{doc
data
  hlp
  img
  msg
lib
  theme
  utils
    tkcon
src
CHANGELOG.md
LICENSE
README.md}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::TplDefault></a>
<b><font color=#ca14ca>proc</font></b> project::TplDefault {} {
  <i><font color=#4b5d50># Sets default contents of project template.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> cbx [<font color=#1b1baa>$obPrj</font> CbxTpl]
  <font color=#1b1baa>$cbx</font> set Default
  <font color=#1b1baa>$cbx</font> selection clear
  <font color=#1b1baa>$obPrj</font> displayText [<font color=#1b1baa>$obPrj</font> TexTemplate] [TplDefaultText]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::UpdateTplLists></a>
<b><font color=#ca14ca>proc</font></b> project::UpdateTplLists {} {
  <i><font color=#4b5d50># Updates lists of template data, setting the current template on the top.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> wtpl [<font color=#1b1baa>$obPrj</font> TexTemplate]
  <b><font color=#3a6797>set</font></b> cbx [<font color=#1b1baa>$obPrj</font> CbxTpl]
  <b><font color=#3a6797>set</font></b> al(PTP,name) [<b><font color=#3a6797>string</font></b> trim [<font color=#1b1baa>$cbx</font> get]]
  RemoveFromTplList <font color=#1b1baa>$al(PTP,name)</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$al(PTP,name)</font> eq {}} {
    <b><font color=#3a6797>set</font></b> al(PTP,name) Template\ #[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$al(PTP,names)</font>]
  }
  <b><font color=#3a6797>set</font></b> tpltext [<b><font color=#3a6797>string</font></b> trimright [<font color=#1b1baa>$wtpl</font> get 1.0 end]]
  <b><font color=#3a6797>set</font></b> al(PTP,names) [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$al(PTP,names)</font> 0 <font color=#1b1baa>$al(PTP,name)</font>]
  <b><font color=#3a6797>set</font></b> al(PTP,list) [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$al(PTP,list)</font> 0 <font color=#1b1baa>$al(PTP,name)</font> <font color=#1b1baa>$tpltext</font>]
  <b><font color=#3a6797>set</font></b> maxlen 16
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> al(PTP,names) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$al(PTP,names)</font> <font color=#1b1baa>$maxlen</font> end]}
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> al(PTP,list) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$al(PTP,list)</font> <font color=#1b1baa>$maxlen</font>+<font color=#1b1baa>$maxlen</font> end]}
  <b><font color=#3a6797>set</font></b> ltmp [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>foreach</font></b> {n c} <font color=#1b1baa>$al(PTP,list)</font> {
    <b><font color=#3a6797>set</font></b> t {}
    <b><font color=#3a6797>foreach</font></b> l [<b><font color=#3a6797>lrange</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$c</font> \n] 0 200] {<b><font color=#3a6797>append</font></b> t [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$l</font>] \n}
    <b><font color=#3a6797>lappend</font></b> ltmp <font color=#1b1baa>$n</font> [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$t</font>]
  }
  <b><font color=#3a6797>set</font></b> al(PTP,list) <font color=#1b1baa>$ltmp</font>
  <font color=#1b1baa>$cbx</font> set <font color=#1b1baa>$al(PTP,name)</font>
  <font color=#1b1baa>$cbx</font> configure <font color=#653760>-values</font> <font color=#1b1baa>$al(PTP,names)</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::UpdateTplText></a>
<b><font color=#ca14ca>proc</font></b> project::UpdateTplText {} {
  <i><font color=#4b5d50># Updates the template text.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$al(PTP,list)</font> <font color=#1b1baa>$al(PTP,name)</font>]
  <font color=#1b1baa>$obPrj</font> displayText [<font color=#1b1baa>$obPrj</font> TexTemplate] [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$al(PTP,list)</font> <font color=#1b1baa>$i</font>+1]
  UpdateTplLists
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::RemoveFromTplList></a>
<b><font color=#ca14ca>proc</font></b> project::RemoveFromTplList {val} {
  <i><font color=#4b5d50># Removes a template name from the lists of template data.</font></i>
  <i><font color=#4b5d50>#   val - name of template to be removed</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$val</font> eq {}} <b><font color=#ca14ca>return</font></b>
  <i><font color=#4b5d50># remove from list of template names</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$al(PTP,names)</font> <font color=#1b1baa>$val</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> al(PTP,names) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$al(PTP,names)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
  }
  <i><font color=#4b5d50># remove from list of template pairs &quot;name contents&quot;</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$al(PTP,list)</font> <font color=#1b1baa>$val</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> al(PTP,list) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$al(PTP,list)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>+1]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::DeleteFromTplList></a>
<b><font color=#ca14ca>proc</font></b> project::DeleteFromTplList {} {
  <i><font color=#4b5d50># Deletes a template name from the list of project templates.</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>set</font></b> cbx [<font color=#1b1baa>$obPrj</font> CbxTpl]
  RemoveFromTplList [<b><font color=#3a6797>string</font></b> trim [<font color=#1b1baa>$cbx</font> get]]
  <font color=#1b1baa>$cbx</font> configure <font color=#653760>-values</font> <font color=#1b1baa>$::alited::al(PTP,names)</font>
  <font color=#1b1baa>$cbx</font> set {}
}
<a id=Calendar></a>
<i><font color=#4b5d50># ________________________ Calendar _________________________ #</font></i>
<a id=project::KlndUpdate></a>
<b><font color=#ca14ca>proc</font></b> project::KlndUpdate {} {
  <i><font color=#4b5d50># Updates calendar data.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists prjinfo(<font color=#1b1baa>$al(prjname)</font>,prjrem)]} {
    <b><font color=#3a6797>set</font></b> prjinfo(<font color=#1b1baa>$al(prjname)</font>,prjrem) {}
  }
  ::klnd::update {} {} {} <font color=#1b1baa>$prjinfo($al(prjname)</font>,prjrem)
  <b><font color=#3a6797>lassign</font></b> [::klnd::selectedDay] y m d
  KlndClick <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndInDate></a>
<b><font color=#ca14ca>proc</font></b> project::KlndInDate {{y {}} {m {}} {d {}}} {
  <i><font color=#4b5d50># Gets a date in seconds.</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   d - day</font></i>
  <i><font color=#4b5d50># If *y* is omitted or y/m/d not valid, gets a current date in seconds.</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$y</font> ne {}} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> date [ClockScan <font color=#1b1baa>$y</font>/<font color=#1b1baa>$m</font>/<font color=#1b1baa>$d</font>]}]} {
      <b><font color=#3a6797>set</font></b> y {}
    }
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$y</font> eq {}} {<b><font color=#3a6797>set</font></b> date [<b><font color=#3a6797>clock</font></b> seconds]}
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$date</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndOutDate></a>
<b><font color=#ca14ca>proc</font></b> project::KlndOutDate {{y {}} {m {}} {d {}}} {
  <i><font color=#4b5d50># Gets a date formatted.</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   d - day</font></i>
  <i><font color=#4b5d50># If *y* is omitted or y/m/d not valid, gets a current date formatted.</font></i>

  <b><font color=#ca14ca>return</font></b> [ClockFormat [KlndInDate <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>]]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndDate></a>
<b><font color=#ca14ca>proc</font></b> project::KlndDate {date} {
  <i><font color=#4b5d50># Formats a calendar date by alited's format (Preferences/Templates).</font></i>
  <i><font color=#4b5d50>#   date - the date to be formatted</font></i>

  <b><font color=#3a6797>set</font></b> seconds [ClockScan <font color=#1b1baa>$date</font>]
  <b><font color=#ca14ca>return</font></b> [alited::tool::FormatDate <font color=#1b1baa>$seconds</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndText></a>
<b><font color=#ca14ca>proc</font></b> project::KlndText {dt} {
  <i><font color=#4b5d50># Gets a reminder text for a date.</font></i>
  <i><font color=#4b5d50>#   dt - date</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [KlndSearch <font color=#1b1baa>$dt</font> <font color=#1b1baa>$al(prjname)</font>]]&gt;-1} {
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$prjinfo($al(prjname)</font>,prjrem) <font color=#1b1baa>$i</font> 1]
  }
  <b><font color=#ca14ca>return</font></b> {}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndClick></a>
<b><font color=#ca14ca>proc</font></b> project::KlndClick {y m d} {
  <i><font color=#4b5d50># Processes a click on a calendar day.</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   d - day</font></i>

  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>set</font></b> klnddata(date) [KlndOutDate <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>]
  <i><font color=#4b5d50># first, save a previous reminder at need</font></i>
  <b><font color=#3a6797>set</font></b> klnddata(SAVEDATE) <font color=#1b1baa>$klnddata(date)</font>
  <b><font color=#3a6797>set</font></b> klnddata(SAVEPRJ) [CurrProject]
  <i><font color=#4b5d50># then display a new reminder's text</font></i>
  <b><font color=#3a6797>set</font></b> klndtex [<font color=#1b1baa>$obPrj</font> TexKlnd]
  <font color=#1b1baa>$obPrj</font> displayText <font color=#1b1baa>$klndtex</font> [KlndText <font color=#1b1baa>$klnddata(date)</font>]
  alited::ini::HighlightFileText <font color=#1b1baa>$klndtex</font> .md 0 <font color=#653760>-cmdpos</font> ::apave::None \
    <font color=#653760>-cmd</font> alited::project::KlndTextModified
  [<font color=#1b1baa>$obPrj</font> LabKlndDate] configure <font color=#653760>-text</font> [KlndDate <font color=#1b1baa>$klnddata(date)</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndSearch></a>
<b><font color=#ca14ca>proc</font></b> project::KlndSearch {date prjname} {
  <i><font color=#4b5d50># Search a date in calendar data.</font></i>
  <i><font color=#4b5d50># Returns index of found item or -1 if not found.</font></i>

  <b><font color=#3a6797>variable</font></b> prjinfo
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>set</font></b> res -1
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-index</font> 0 <font color=#653760>-exact</font> <font color=#1b1baa>$prjinfo($prjname,prjrem)</font> <font color=#1b1baa>$date</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::KlndTextModified></a>
<b><font color=#ca14ca>proc</font></b> project::KlndTextModified {wtxt args} {
  <i><font color=#4b5d50># Processes modifications of calendar text.</font></i>
  <i><font color=#4b5d50>#   wtxt - text's path</font></i>
  <i><font color=#4b5d50>#   args - not used arguments</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> aft _KLND_TextModified
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$al($aft)</font>}
  <b><font color=#3a6797>set</font></b> al(<font color=#1b1baa>$aft</font>) [<b><font color=#3a6797>after</font></b> idle alited::project::Klnd_save]
}
<a id=GUI></a>
<i><font color=#4b5d50># ________________________ GUI _________________________ #</font></i>
<a id=project::MainFrame></a>
<b><font color=#ca14ca>proc</font></b> project::MainFrame {} {
  <i><font color=#4b5d50># Creates a main frame of &quot;Project&quot; dialogue.</font></i>

  <b><font color=#ca14ca>return</font></b> {
    {fraTreePrj - - 10 1 {<font color=#653760>-st</font> nswe <font color=#653760>-pady</font> 4 <font color=#653760>-rw</font> 1}}
    {.TreePrj - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both}
      {<font color=#653760>-h</font> 16 <font color=#653760>-show</font> headings <font color=#653760>-columns</font> {C1} <font color=#653760>-displaycolumns</font> {C1}
      <font color=#653760>-popup</font> {alited::project::PopupMenu %x %y %X %Y}
      <font color=#653760>-onevent</font> {&lt;&lt;TreeviewSelect&gt;&gt; alited::project::Select
      &lt;Delete&gt; alited::project::Delete
      &lt;Double-Button-1&gt; alited::project::ProjectEnter
      &lt;Return&gt; alited::project::ProjectEnter}}}
    {.sbvPrjs + L - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both}}
    {fraR fraTreePrj L 10 1 {<font color=#653760>-st</font> nsew <font color=#653760>-cw</font> 1 <font color=#653760>-pady</font> 4}}
    {fraR.nbk - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both} {
      f1 {<font color=#653760>-text</font> {<font color=#1b1baa>$al(MC,info)</font>}}
      f2 {<font color=#653760>-text</font> {<font color=#1b1baa>$al(MC,prjOptions)</font>}}
      f3 {<font color=#653760>-text</font> Templates}
      f4 {<font color=#653760>-text</font> Commands}
      f5 {<font color=#653760>-text</font> Files}
      <font color=#653760>-traverse</font> yes <font color=#653760>-select</font> f1
    }}
    {fraB1 fraTreePrj T 1 1 {<font color=#653760>-st</font> ew <font color=#653760>-pady</font> 0}}
    {.btTad - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-anchor</font> n}
      {<font color=#653760>-com</font> alited::project::Add <font color=#653760>-tip</font> {<font color=#1b1baa>$::alited::al(MC,prjadd)</font>} <font color=#653760>-image</font> alimg_add-big}}
    {.btTch - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}
      {<font color=#653760>-com</font> alited::project::Change <font color=#653760>-tip</font> {<font color=#1b1baa>$::alited::al(MC,prjchg)</font>} <font color=#653760>-image</font> alimg_change-big}}
    {.btTdel - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}
      {<font color=#653760>-com</font> alited::project::Delete <font color=#653760>-tip</font> {<font color=#1b1baa>$::alited::al(MC,prjdel1)</font>}
      <font color=#653760>-image</font> alimg_delete-big}}
    {.btTtpl - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}
      {<font color=#653760>-com</font> alited::project::Template <font color=#653760>-tip</font> {<font color=#1b1baa>$::alited::al(MC,CrTemplPrj)</font>}
      <font color=#653760>-image</font> alimg_plus-big}}
    {.sev - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-padx</font> 4 <font color=#653760>-fill</font> y}}
    {.btTtview - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}
      {<font color=#653760>-image</font> alimg_folder-big <font color=#653760>-com</font> alited::project::ViewDir <font color=#653760>-tip</font> {<font color=#1b1baa>$::alited::al(MC,ViewDir)</font>}}}
    {.btTtdl - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}
      {<font color=#653760>-com</font> alited::project::PendingTODOs <font color=#653760>-tip</font> {<font color=#1b1baa>$::alited::al(MC,prjTmore)</font>}
      <font color=#653760>-image</font> alimg_more-big}}
    {LabMess fraB1 L 1 1 {<font color=#653760>-st</font> nsew <font color=#653760>-pady</font> 0 <font color=#653760>-padx</font> 3} {<font color=#653760>-style</font> TLabelFS}}
    {seh fraB1 T 1 2 {<font color=#653760>-st</font> nsew <font color=#653760>-pady</font> 2}}
    {fraB2 + T 1 2 {<font color=#653760>-st</font> nsew} {<font color=#653760>-padding</font> {2 2}}}
    {.ButHelp - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-anchor</font> s <font color=#653760>-padx</font> 2}
      {<font color=#653760>-t</font> {<font color=#1b1baa>$::alited::al(MC,help)</font>} <font color=#653760>-tip</font> F1 <font color=#653760>-com</font> alited::project::Help}}
    {.h_ - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both <font color=#653760>-padx</font> 8} {<font color=#653760>-w</font> 50}}
    {.ButOK - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-anchor</font> s <font color=#653760>-padx</font> 2}
      {<font color=#653760>-t</font> {<font color=#1b1baa>$::alited::al(MC,select)</font>} <font color=#653760>-com</font> alited::project::Ok}}
    {.butClose - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-anchor</font> s} {<font color=#653760>-t</font> Close <font color=#653760>-com</font> alited::project::Close}}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Tab1></a>
<b><font color=#ca14ca>proc</font></b> project::Tab1 {} {
  <i><font color=#4b5d50># Creates a main tab of &quot;Project&quot;.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> klnddata
  <b><font color=#3a6797>set</font></b> klnddata(SAVEDATE) [<b><font color=#3a6797>set</font></b> klnddata(SAVEPRJ) {}]
  <b><font color=#3a6797>set</font></b> monofont <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>font actual apaveFontMono<font color=#1b1baa>]</font> -weight bold -size <font color=#1b1baa>$</font>al(FONTSIZE,small)&quot;</font>
  <b><font color=#3a6797>set</font></b> klnddata(toobar) <font color=#8b2a0e>&quot;LabKlndDate <font color=#1b1baa>{{}</font> <font color=#1b1baa>{}</font> <font color=#1b1baa>{</font>-font <font color=#1b1baa>{$</font>monofont<font color=#1b1baa>}}}</font>&quot;</font>
  <b><font color=#3a6797>foreach</font></b> img {- delete paste undo redo - previous2 previous next next2} {
    <i><font color=#4b5d50># -method option for possible disable/enable BuT_alimg_delete etc.</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$img</font> eq {-}} {
      <b><font color=#3a6797>append</font></b> klnddata(toobar) <font color=#8b2a0e>&quot; sev 4&quot;</font>
      <b><font color=#ca14ca>continue</font></b>
    }
    <b><font color=#3a6797>append</font></b> klnddata(toobar) <font color=#8b2a0e>&quot; alimg_<font color=#1b1baa>$</font>img \{<font color=#1b1baa>{}</font> -tip <font color=#1b1baa>{$</font>al(MC,prjT<font color=#1b1baa>$</font>img)<font color=#1b1baa>}</font> \</font>
<font color=#8b2a0e>      -com alited::project::Klnd_<font color=#1b1baa>$</font>img -method yes \}&quot;</font>
  }
  <b><font color=#3a6797>set</font></b> klnddata(vsbltext) yes
  <b><font color=#3a6797>set</font></b> klnddata(date) [KlndOutDate]
  <b><font color=#3a6797>after</font></b> idle alited::project::KlndUpdate
  <b><font color=#ca14ca>return</font></b> {
    {v_ - - 1 1}
    {fra1 v_ T 1 2 {<font color=#653760>-st</font> nsew <font color=#653760>-cw</font> 1}}
    {.labName - - 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,prjName)</font>} <font color=#653760>-foreground</font> <font color=#1b1baa>$al(FG,DEFopts)</font> <font color=#653760>-font</font> {<font color=#1b1baa>$::apave::FONTMAINBOLD</font>}}}
    {.EntName + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 5} {<font color=#653760>-tvar</font> ::alited::al(prjname) <font color=#653760>-w</font> 50}}
    {.labDir .labName T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 8 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> <font color=#8b2a0e>&quot;Root directory:&quot;</font>}}
    {.Dir + L 1 9 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 5 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-tvar</font> ::alited::al(prjroot) <font color=#653760>-w</font> 50 <font color=#653760>-validate</font> focus
      <font color=#653760>-validatecommand</font> alited::project::ValidateDir}}
    {lab fra1 T 1 1 {<font color=#653760>-st</font> w <font color=#653760>-pady</font> 4 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> <font color=#8b2a0e>&quot;Notes:&quot;</font>}}
    {fra2 + T 2 1 {<font color=#653760>-st</font> nsew <font color=#653760>-rw</font> 1 <font color=#653760>-cw</font> 99}}
    {.TexPrj - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both <font color=#653760>-padx</font> 3}
      {<font color=#653760>-h</font> 20 <font color=#653760>-w</font> 40 <font color=#653760>-wrap</font> word <font color=#653760>-tabnext</font> *.spx <font color=#653760>-tip</font> {<font color=#653760>-BALTIP</font> {<font color=#1b1baa>$al(MC,notes)</font>} <font color=#653760>-MAXEXP</font> 1}}}
    {.sbv + L - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}}
    {frasp lab L 1 1 {<font color=#653760>-st</font> nsew}}
    {.lab - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left} {<font color=#653760>-t</font> {TODO days ahead:}}}
    {.spx - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-padx</font> 8}
      {<font color=#653760>-tvar</font> ::alited::al(todoahead) <font color=#653760>-from</font> 0 <font color=#653760>-to</font> 365 <font color=#653760>-w</font> 5 <font color=#653760>-justify</font> center
      <font color=#653760>-com</font> alited::project::Select <font color=#653760>-validate</font> all
      <font color=#653760>-validatecommand</font> {alited::project::ValidateIni %V}}}
    {fra3 fra2 L 2 1 {<font color=#653760>-st</font> nsew} {<font color=#653760>-relief</font> groove <font color=#653760>-borderwidth</font> 2}}
    {.seh - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> x}}
    {.daT - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both}
      {<font color=#653760>-tvar</font> ::alited::project::klnddata(date)
      <font color=#653760>-com</font> {alited::project::KlndUpdate; alited::project::KlndBorderText}
      <font color=#653760>-dateformat</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>::alited::al(TPL,%d)&quot;</font>
      <font color=#653760>-tip</font> {alited::project::KlndText %D} <font color=#653760>-weeks</font> <font color=#1b1baa>$::alited::al(klndweeks)</font>
      <font color=#653760>-popup</font> {alited::project::KlndPopup %W %y %m %d %X %Y} <font color=#653760>-width</font> 3}}
    {fra3.fra - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}}
    {.seh2 - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x}}
    {.too - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> top}
      {<font color=#653760>-relief</font> flat <font color=#653760>-borderwidth</font> 0 <font color=#653760>-array</font> {<font color=#1b1baa>$::alited::project::klnddata(toobar)</font>}}}
    {.TexKlnd - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}
      {<font color=#653760>-wrap</font> none <font color=#653760>-tabnext</font> {alited::Tnext *.texPrj} <font color=#653760>-w</font> 4 <font color=#653760>-h</font> 8
      <font color=#653760>-tip</font> {<font color=#653760>-BALTIP</font> {<font color=#1b1baa>$al(MC,prjTtext)</font>} <font color=#653760>-MAXEXP</font> 1}}}
}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Tab2></a>
<b><font color=#ca14ca>proc</font></b> project::Tab2 {} {
  <i><font color=#4b5d50># Creates Options tab of &quot;Project&quot;.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>lassign</font></b> [alited::FgFgBold] fg al(FG,DEFopts)
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$al(PRJDEFAULT)</font>} {
    <b><font color=#3a6797>set</font></b> al(FG,DEFopts) <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>fg -afteridle <font color=#1b1baa>{</font>grid forget %w<font color=#1b1baa>}</font>&quot;</font> ;<i><font color=#4b5d50># no heading message</font></i>
  }
  <b><font color=#ca14ca>return</font></b> {
    {v_ - - 1 10}
    {lab1 + T 1 2 {<font color=#653760>-st</font> nsew <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,DEFopts)</font>} <font color=#653760>-foreground</font> <font color=#1b1baa>$al(FG,DEFopts)</font> <font color=#653760>-font</font> {<font color=#1b1baa>$::apave::FONTMAINBOLD</font>}}}
    {fra2 + T 1 2 {<font color=#653760>-st</font> nsew <font color=#653760>-cw</font> 1}}
    {.labIgn - - 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,Ign:)</font>}}}
    {.entIgn + L 1 8 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 5 <font color=#653760>-padx</font> 3} {<font color=#653760>-tvar</font> ::alited::al(prjdirign) <font color=#653760>-w</font> 50}}
    {.labEOL .labIgn T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,EOL:)</font>}}}
    {.cbxEOL + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-tvar</font> ::alited::al(prjEOL) <font color=#653760>-values</font> {{} LF CR CRLF} <font color=#653760>-w</font> 9 <font color=#653760>-state</font> readonly}}
    {.labIndent .labEOL T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,indent:)</font>}}}
    {.spxIndent + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-tvar</font> ::alited::al(prjindent) <font color=#653760>-from</font> 0 <font color=#653760>-to</font> 8 <font color=#653760>-com</font> {alited::pref::CheckIndent <font color=#8b2a0e>&quot;&quot;</font>}}}
    {.chbIndAuto + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-var</font> ::alited::al(prjindentAuto) <font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,indentAuto)</font>}}}
    {.labRedunit .labIndent T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,redunit)</font>}}}
    {.spxRedunit + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-tvar</font> ::alited::al(prjredunit) <font color=#653760>-from</font> <font color=#1b1baa>$al(minredunit)</font> <font color=#653760>-to</font> 100}}
    {.labmaxcom .labRedunit T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {Maximum Run commands}}}
    {.spxMaxcom + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-tvar</font> ::alited::al(prjmaxcoms) <font color=#653760>-from</font> 4 <font color=#653760>-to</font> 99 <font color=#653760>-tabnext</font> alited::Tnext}}
    {.labMult .labmaxcom T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,multiline)</font>} <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,notrecomm)</font>}}}
    {.swiMult + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-var</font> ::alited::al(prjmultiline) <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,notrecomm)</font>}}}
    {.labTrWs .labMult T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,trailwhite)</font>}}}
    {.swiTrWs + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 1} {<font color=#653760>-var</font> ::alited::al(prjtrailwhite)}}
    {.seh .labTrWs T 1 9}
    {.labUself + T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,useleafRE)</font>}}}
    {.swiUself + L 1 1 {<font color=#653760>-st</font> sw <font color=#653760>-pady</font> 1}
      {<font color=#653760>-var</font> ::alited::al(prjuseleafRE) <font color=#653760>-com</font> alited::project::CheckPrjUseLeaf}}
    {.butStd + L 1 7 {<font color=#653760>-st</font> e} {<font color=#653760>-t</font> Standard <font color=#653760>-com</font> alited::project::StdLeafRE}}
    {.labLf .labUself T 1 1 {<font color=#653760>-st</font> e <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,leafRE)</font>}}}
    {.EntLf + L 1 8 {<font color=#653760>-st</font> sew <font color=#653760>-pady</font> 1} {<font color=#653760>-tvar</font> ::alited::al(prjleafRE)}}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Tab3></a>
<b><font color=#ca14ca>proc</font></b> project::Tab3 {} {
  <i><font color=#4b5d50># Creates Templates tab of &quot;Project&quot;.</font></i>

  <b><font color=#ca14ca>return</font></b> {
    {v_ - - 1 9}
    {lab1 + T 1 9 {<font color=#653760>-st</font> nsew <font color=#653760>-pady</font> 1 <font color=#653760>-padx</font> 3} {<font color=#653760>-t</font> {<font color=#1b1baa>$al(MC,TemplPrj)</font>}}}
    {lab2 + T 1 1 {<font color=#653760>-st</font> ew <font color=#653760>-pady</font> 5 <font color=#653760>-padx</font> 3}
      {<font color=#653760>-t</font> Template: <font color=#653760>-foreground</font> <font color=#1b1baa>$al(FG,DEFopts)</font> <font color=#653760>-font</font> {<font color=#1b1baa>$::apave::FONTMAINBOLD</font>}}}
    {CbxTpl + L 1 3 {<font color=#653760>-st</font> ew <font color=#653760>-pady</font> 5}
      {<font color=#653760>-w</font> 40 <font color=#653760>-h</font> 12 <font color=#653760>-cbxsel</font> {<font color=#1b1baa>$al(PTP,name)</font>} <font color=#653760>-tvar</font> ::alited::al(PTP,name)
      <font color=#653760>-values</font> {<font color=#1b1baa>$al(PTP,names)</font>} <font color=#653760>-clearcom</font> alited::project::DeleteFromTplList
      <font color=#653760>-selcombobox</font> alited::project::UpdateTplText}}
    {fraTlist + T 1 8 {<font color=#653760>-st</font> nswe <font color=#653760>-padx</font> 3 <font color=#653760>-cw</font> 1 <font color=#653760>-rw</font> 1}}
    {.TexTemplate - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1}
      {<font color=#653760>-h</font> 20 <font color=#653760>-w</font> 40 <font color=#653760>-tabnext</font> <font color=#8b2a0e>&quot;*.butTplDef *.cbxTpl&quot;</font> <font color=#653760>-wrap</font> none}}
    {.sbv + L - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}}
    {butTplDef fraTlist T 1 1 {<font color=#653760>-st</font> w <font color=#653760>-padx</font> 4 <font color=#653760>-pady</font> 4}
      {<font color=#653760>-t</font> Standard <font color=#653760>-com</font> alited::project::TplDefault <font color=#653760>-tabnext</font> alited::Tnext}}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Tab4></a>
<b><font color=#ca14ca>proc</font></b> project::Tab4 {} {
  <i><font color=#4b5d50># Creates Commands tab of &quot;Project&quot;.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>set</font></b> al(PTP,chbClearRun) 0
  <b><font color=#3a6797>set</font></b> al(PTP,chbClearCom) 0
  <b><font color=#3a6797>set</font></b> al(PTP,chbClearTip) [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %f [msgcat::mc General]] <font color=#1b1baa>$al(MC,alloffile)</font>]
  <b><font color=#ca14ca>return</font></b> {
    {v_ - - 1 3}
    {Labprj + T 1 2 {} {<font color=#653760>-foreground</font> <font color=#1b1baa>$al(FG,DEFopts)</font> <font color=#653760>-font</font> {<font color=#1b1baa>$::apave::FONTMAINBOLD</font>}}}
    {ChbClearRun labprj L 1 1 {<font color=#653760>-st</font> w}
      {<font color=#653760>-var</font> ::alited::al(PTP,chbClearRun) <font color=#653760>-com</font> alited::project::ChecksRun <font color=#653760>-takefocus</font> 0}}
    {tcl {
        <b><font color=#3a6797>set</font></b> prt labprj
        <b><font color=#3a6797>set</font></b> ent Entrun
        <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$::alited::al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
          <b><font color=#3a6797>set</font></b> lwid <font color=#8b2a0e>&quot;lab<font color=#1b1baa>$</font>i <font color=#1b1baa>$</font>prt T 1 1 <font color=#1b1baa>{</font>-st nse<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-t <font color=#1b1baa>{$</font>::alited::al(MC,com) <font color=#1b1baa>$</font>i:<font color=#1b1baa>}}</font>&quot;</font>
          %C <font color=#1b1baa>$lwid</font>
          <b><font color=#3a6797>set</font></b> lwid <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ent<font color=#1b1baa>$</font>i lab<font color=#1b1baa>$</font>i L 1 1 <font color=#1b1baa>{</font>-cw 1 -st ew<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-tvar ::alited::al(PTP,run<font color=#1b1baa>$</font>i)<font color=#1b1baa>}</font>&quot;</font>
          %C <font color=#1b1baa>$lwid</font>
          <b><font color=#3a6797>set</font></b> lwid <font color=#8b2a0e>&quot;chb<font color=#1b1baa>$</font>i <font color=#1b1baa>$</font>ent<font color=#1b1baa>$</font>i L 1 1 <font color=#1b1baa>{}</font> <font color=#1b1baa>{</font>-t <font color=#1b1baa>{</font>Run it<font color=#1b1baa>}</font> \</font>
<font color=#8b2a0e>            -var ::alited::al(PTP,runch<font color=#1b1baa>$</font>i) -takefocus 0<font color=#1b1baa>}</font>&quot;</font>
          %C <font color=#1b1baa>$lwid</font>
          <b><font color=#3a6797>set</font></b> prt lab<font color=#1b1baa>$i</font>
          <b><font color=#3a6797>set</font></b> ent ent
        }
        <b><font color=#3a6797>set</font></b> lwid {seh1 lab6 T 1 3}
        %C <font color=#1b1baa>$lwid</font>
        <b><font color=#3a6797>set</font></b> lwid {labcom seh1 T 1 2 {} \
          {<font color=#653760>-t</font> General <font color=#653760>-foreground</font> <font color=#1b1baa>$::alited::al(FG,DEFopts)</font> <font color=#653760>-font</font> {<font color=#1b1baa>$::apave::FONTMAINBOLD</font>}}}
        %C <font color=#1b1baa>$lwid</font>
        <b><font color=#3a6797>set</font></b> lwid {chbClearCom labcom L 1 1 {<font color=#653760>-st</font> w} \
          {<font color=#653760>-var</font> ::alited::al(PTP,chbClearCom) <font color=#653760>-com</font> alited::project::ChecksCom <font color=#653760>-takefocus</font> 0 \
          <font color=#653760>-tip</font> {<font color=#1b1baa>$al(PTP,chbClearTip)</font>}}}
        %C <font color=#1b1baa>$lwid</font>
        <b><font color=#3a6797>set</font></b> prt labcom
        <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$::alited::al(cmdNum)</font>} {<b><font color=#3a6797>incr</font></b> i} {
          <b><font color=#3a6797>set</font></b> lwid <font color=#8b2a0e>&quot;labc<font color=#1b1baa>$</font>i <font color=#1b1baa>$</font>prt T 1 1 <font color=#1b1baa>{</font>-st nse<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-t <font color=#1b1baa>{$</font>::alited::al(MC,com) <font color=#1b1baa>$</font>i:<font color=#1b1baa>}}</font>&quot;</font>
          %C <font color=#1b1baa>$lwid</font>
          <b><font color=#3a6797>set</font></b> lwid <font color=#8b2a0e>&quot;entc<font color=#1b1baa>$</font>i labc<font color=#1b1baa>$</font>i L 1 1 <font color=#1b1baa>{</font>-cw 1 -st ew<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-tvar ::alited::al(PTP,com<font color=#1b1baa>$</font>i)<font color=#1b1baa>}</font>&quot;</font>
          %C <font color=#1b1baa>$lwid</font>
          <b><font color=#3a6797>set</font></b> lwid <font color=#8b2a0e>&quot;chbc<font color=#1b1baa>$</font>i entc<font color=#1b1baa>$</font>i L 1 1 <font color=#1b1baa>{}</font> <font color=#1b1baa>{</font>-t <font color=#1b1baa>{</font>Run it<font color=#1b1baa>}</font> -var ::alited::al(PTP,comch<font color=#1b1baa>$</font>i) -takefocus 0<font color=#1b1baa>}</font>&quot;</font>
          %C <font color=#1b1baa>$lwid</font>
          <b><font color=#3a6797>set</font></b> prt labc<font color=#1b1baa>$i</font>
        }
      }
    }
    {seh2 labc6 T 1 3}
    {h_ seh2 T 1 1}
    {butRun h_ L 1 2 {<font color=#653760>-st</font> ew} {<font color=#653760>-t</font> Run <font color=#653760>-com</font> alited::project::RunComs <font color=#653760>-tip</font> {<font color=#1b1baa>$al(MC,saving)</font> & <font color=#1b1baa>$al(MC,run)</font>} <font color=#653760>-tabnext</font> alited::Tnext}}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::Tab5></a>
<b><font color=#ca14ca>proc</font></b> project::Tab5 {} {
  <i><font color=#4b5d50># Creates Files tab of &quot;Project&quot;.</font></i>

  alited::ini::ProjectsToolbar
  <b><font color=#ca14ca>return</font></b> {
    {frat - - 1 9 {<font color=#653760>-st</font> ew}}
    {frat.ToolTop + T - - pack {<font color=#653760>-array</font> {<font color=#1b1baa>$::alited::al(atools)</font>} <font color=#653760>-relief</font> groove <font color=#653760>-borderwidth</font> 1}}
    {labFilter + T 1 1 {<font color=#653760>-st</font> nse <font color=#653760>-padx</font> 1 <font color=#653760>-pady</font> 8} {<font color=#653760>-t</font> {All files filter:}}}
    {EntFilter + L 1 1 {<font color=#653760>-st</font> nswe <font color=#653760>-padx</font> 1 <font color=#653760>-cw</font> 1 <font color=#653760>-pady</font> 8} {<font color=#653760>-tvar</font> ::alited::project::filefilter <font color=#653760>-validate</font> all <font color=#653760>-validatecommand</font> alited::project::preValidateFilter}}
    {ChbFilter + L 1 1 {<font color=#653760>-st</font> nsw <font color=#653760>-padx</font> 1} {<font color=#653760>-var</font> ::alited::project::casefilter <font color=#653760>-t</font> {Match case} <font color=#653760>-com</font> alited::project::postValidateFilter}}
    {seh_ labFilter T 1 3}
    {LabFlist + T 1 3 {<font color=#653760>-pady</font> 3 <font color=#653760>-padx</font> 3} {<font color=#653760>-foreground</font> <font color=#1b1baa>$al(FG,DEFopts)</font> <font color=#653760>-font</font> {<font color=#1b1baa>$::apave::FONTMAINBOLD</font>}}}
    {fraFlist + T 1 3 {<font color=#653760>-st</font> nswe <font color=#653760>-padx</font> 3 <font color=#653760>-rw</font> 1}}
    {.LbxFlist - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-expand</font> 1} {<font color=#653760>-takefocus</font> 0 <font color=#653760>-selectmode</font> multiple <font color=#653760>-popup</font> {alited::project::LbxPopup %X %Y}}}
    {.sbvFlist + L - - {<b><font color=#134070>pack</font></b> <font color=#653760>-side</font> left}}
  }
}
<a id=Main></a>
<i><font color=#4b5d50># ________________________ Main _________________________ #</font></i>
<a id=project::_create></a>
<b><font color=#ca14ca>proc</font></b> project::_create {} {
  <i><font color=#4b5d50># Creates and opens Projects dialogue.</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> obPrj
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> geo
  <b><font color=#3a6797>variable</font></b> prjlist
  <b><font color=#3a6797>variable</font></b> oldTab
  <b><font color=#3a6797>variable</font></b> ilast
  <b><font color=#3a6797>variable</font></b> curinfo
  <b><font color=#3a6797>set</font></b> curinfo(_NO2ENT) 0
  <b><font color=#3a6797>set</font></b> tipson [baltip::cget <font color=#653760>-on</font>]
  baltip::configure <font color=#653760>-on</font> <font color=#1b1baa>$al(TIPS,Projects)</font>
  ::apave::APave create <font color=#1b1baa>$obPrj</font> <font color=#1b1baa>$win</font>
  <font color=#1b1baa>$obPrj</font> makeWindow <font color=#1b1baa>$win</font>.fra <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>al(MC,icobox) :: <font color=#1b1baa>$</font>::alited::PRJDIR&quot;</font>
  <b><font color=#3a6797>set</font></b> nbk <font color=#1b1baa>$win</font>.fra.fraR.nbk
  <font color=#1b1baa>$obPrj</font> paveWindow \
    <font color=#1b1baa>$win</font>.fra [MainFrame] \
    <font color=#1b1baa>$nbk</font>.f1 [Tab1] \
    <font color=#1b1baa>$nbk</font>.f2 [Tab2] \
    <font color=#1b1baa>$nbk</font>.f3 [Tab3] \
    <font color=#1b1baa>$nbk</font>.f4 [Tab4] \
    <font color=#1b1baa>$nbk</font>.f5 [Tab5]
  <b><font color=#3a6797>set</font></b> tree [<font color=#1b1baa>$obPrj</font> TreePrj]
  <font color=#1b1baa>$tree</font> heading C1 <font color=#653760>-text</font> <font color=#1b1baa>$al(MC,project)</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$oldTab</font> ne {}} {<font color=#1b1baa>$nbk</font> select <font color=#1b1baa>$oldTab</font>}
  UpdateTree
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$win</font> &lt;<font color=#1b1baa>$al(acc_2)</font>&gt; <font color=#8b2a0e>&quot;alited::ini::ToolByKey <font color=#1b1baa>$</font>nbk ToolPrjEM&quot;</font>
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$win</font> &lt;<font color=#1b1baa>$al(acc_3)</font>&gt; <font color=#8b2a0e>&quot;alited::ini::ToolByKey <font color=#1b1baa>$</font>nbk ToolPrjRun&quot;</font>
  <b><font color=#3a6797>foreach</font></b> ev {KeyPress ButtonPress} {
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$tree</font> &lt;<font color=#1b1baa>$ev</font>&gt; {+ alited::project::KeyOnTree %K}
  }
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$win</font> &lt;F1&gt; <font color=#8b2a0e>&quot;<font color=#1b1baa>[$</font>obPrj ButHelp<font color=#1b1baa>]</font> invoke&quot;</font>
  <b><font color=#134070>bind</font></b> [<font color=#1b1baa>$obPrj</font> LabMess] &lt;Button-1&gt; alited::project::ProcMessage
  <b><font color=#3a6797>set</font></b> lbx [<font color=#1b1baa>$obPrj</font> LbxFlist]
  <b><font color=#3a6797>foreach</font></b> a {a A} {
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lbx</font> &lt;Control-<font color=#1b1baa>$a</font>&gt; alited::project::SelectAllFiles
  }
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lbx</font> &lt;Double-Button-1&gt; {alited::project::OpenFile %y}
  ::baltip tip <font color=#1b1baa>$lbx</font> {alited::project::TipOnFile %i} <font color=#653760>-shiftX</font> 10
  <b><font color=#3a6797>after</font></b> 500 alited::project::HelpMe ;<i><font color=#4b5d50># show an introduction after a short pause</font></i>
  <b><font color=#3a6797>set</font></b> prjtex [<font color=#1b1baa>$obPrj</font> TexPrj]
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$prjtex</font> &lt;FocusOut&gt; alited::project::SaveNotes
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ilast</font>&gt;-1} {Select <font color=#1b1baa>$ilast</font>}
  <font color=#1b1baa>$obPrj</font> displayText [<font color=#1b1baa>$obPrj</font> TexTemplate] <font color=#1b1baa>$al(PTP,text)</font>
  alited::ini::HighlightFileText <font color=#1b1baa>$prjtex</font> .md 0 <font color=#653760>-cmdpos</font> ::apave::None
  <b><font color=#3a6797>set</font></b> res [<font color=#1b1baa>$obPrj</font> showModal <font color=#1b1baa>$win</font> <font color=#653760>-geometry</font> <font color=#1b1baa>$geo</font> <font color=#653760>-minsize</font> {600 400} <font color=#653760>-resizable</font> 1 \
    <font color=#653760>-onclose</font> alited::project::Close <font color=#653760>-focus</font> [<font color=#1b1baa>$obPrj</font> TreePrj]]
  <b><font color=#3a6797>set</font></b> oldTab [<font color=#1b1baa>$nbk</font> select]
  <b><font color=#3a6797>set</font></b> al(PTP,text) [<b><font color=#3a6797>string</font></b> trimright [[<font color=#1b1baa>$obPrj</font> TexTemplate] get 1.0 end]]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$res</font>] &lt; 2} {<b><font color=#3a6797>set</font></b> res <font color=#8b2a0e>&quot;&quot;</font>}
  <i><font color=#4b5d50># save the new geometry of the dialogue</font></i>
  <b><font color=#3a6797>set</font></b> geo [<b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font>]
  alited::main::ShowHeader yes
  baltip::configure {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$tipson</font>
  ::klnd::clearup
  <b><font color=#3a6797>array</font></b> unset curinfo *
  <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$win</font>}
  <font color=#1b1baa>$obPrj</font> destroy
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=project::_run></a>
<b><font color=#ca14ca>proc</font></b> project::_run {{checktodo yes}} {
  <i><font color=#4b5d50># Runs Projects dialogue.</font></i>
  <i><font color=#4b5d50>#   checktodo - if yes, checks for outdated TODOs</font></i>

  <b><font color=#3a6797>namespace</font></b> upvar ::alited al al
  <b><font color=#3a6797>variable</font></b> win
  <b><font color=#3a6797>variable</font></b> msgtodo
  <b><font color=#3a6797>variable</font></b> updateGUI
  <b><font color=#3a6797>variable</font></b> saveini
  <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$win</font>]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>set</font></b> updateGUI [<b><font color=#3a6797>set</font></b> saveini no]
  <b><font color=#3a6797>set</font></b> msgtodo {}
  <b><font color=#3a6797>update</font></b>  ;<i><font color=#4b5d50># if run from menu: there may be unupdated space under it (in some DE)</font></i>
  SaveSettings
  GetProjects
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$checktodo</font> && ![IsOutdated <font color=#1b1baa>$al(prjname)</font>]} {
    <b><font color=#3a6797>after</font></b> 200 {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> prj [alited::project::CheckOutdated]] ne {}} {
        alited::project::Select <font color=#1b1baa>$::alited::project::prjinfo($prj,ID)</font>
      }
    }
  }
  <b><font color=#3a6797>after</font></b> 200 alited::project::OnProjectEnter
  <b><font color=#3a6797>set</font></b> res [_create]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$updateGUI</font>} alited::main::UpdateAll ;<i><font color=#4b5d50># settings may be changed as for GUI</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$saveini</font>} alited::ini::SaveIni
}
<a id=EOF></a>
<i><font color=#4b5d50># _________________________________ EOF _________________________________ #</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>project.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>