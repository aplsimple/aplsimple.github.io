<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>
<script>document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
</script>
<link rel="stylesheet" href="../../../css/style.css">

<title>clrpick.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../../../index.html"><font color=#1a1a1a size=6>  <b>clrpick.tcl</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">clrpick.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#clrpick.tcl">clrpick.tcl</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#color::"></a><span class=tooltiptext> color::</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::GetOptions">GetOptions</a><span class=tooltiptext> color::GetOptions : Gets current settings of options.
Returns a list of selected color options:
moveall - value of moveall option
fgcolor - value of foreground (inverse) color
bgcolor - value of background (selected) color</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::ShowAtXY">ShowAtXY</a><span class=tooltiptext> color::ShowAtXY : Shows the picker at X,Y coordinates, checking the coordinates against the screen, incl. decors
win - window's path
x - window's X coordinate
y - window's Y coordinate</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::InitValues">InitValues</a><span class=tooltiptext> color::InitValues</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::Config">Config</a><span class=tooltiptext> color::Config</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::BuildDialog">BuildDialog</a><span class=tooltiptext> color::BuildDialog</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::SetRGBValue">SetRGBValue</a><span class=tooltiptext> color::SetRGBValue</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::XToRgb">XToRgb</a><span class=tooltiptext> color::XToRgb</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::RgbToX">RgbToX</a><span class=tooltiptext> color::RgbToX</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::DrawColorScale">DrawColorScale</a><span class=tooltiptext> color::DrawColorScale</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::CreateSelector">CreateSelector</a><span class=tooltiptext> color::CreateSelector</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::InvertBg">InvertBg</a><span class=tooltiptext> color::InvertBg</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::ReverseFinalFg">ReverseFinalFg</a><span class=tooltiptext> color::ReverseFinalFg</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::RedrawFinalColor">RedrawFinalColor</a><span class=tooltiptext> color::RedrawFinalColor</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::RedrawColorBars">RedrawColorBars</a><span class=tooltiptext> color::RedrawColorBars</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::DrawOthers">DrawOthers</a><span class=tooltiptext> color::DrawOthers</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::StickSelectors">StickSelectors</a><span class=tooltiptext> color::StickSelectors</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::LittleSwatch">LittleSwatch</a><span class=tooltiptext> color::LittleSwatch</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::StartMove">StartMove</a><span class=tooltiptext> color::StartMove</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::MoveSelector">MoveSelector</a><span class=tooltiptext> color::MoveSelector</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::ReleaseMouse">ReleaseMouse</a><span class=tooltiptext> color::ReleaseMouse</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::ResizeColorBars">ResizeColorBars</a><span class=tooltiptext> color::ResizeColorBars</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::HandleSelEntry">HandleSelEntry</a><span class=tooltiptext> color::HandleSelEntry</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::HandleRGBEntry">HandleRGBEntry</a><span class=tooltiptext> color::HandleRGBEntry</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::EnterLeaveColorBar">EnterLeaveColorBar</a><span class=tooltiptext> color::EnterLeaveColorBar</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::OkCmd0">OkCmd0</a><span class=tooltiptext> color::OkCmd0</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::Loupe">Loupe</a><span class=tooltiptext> color::Loupe</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::OkCmd">OkCmd</a><span class=tooltiptext> color::OkCmd</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#color::CancelCmd">CancelCmd</a><span class=tooltiptext> color::CancelCmd</span></div></li></ul>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->



<pre class="code"><i><font color=#4b5d50># clrpick.tcl --<a id=clrpick.tcl></a></font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Color selection dialog for platforms that do not support a</font></i>
<i><font color=#4b5d50>#    standard color selection dialog.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Copyright (c) 1996 Sun Microsystems, Inc.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># See the file &quot;license.terms&quot; for information on usage and redistribution</font></i>
<i><font color=#4b5d50># of this file, and for a DISCLAIMER OF ALL WARRANTIES.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># ToDo:</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    (1): Find out how many free colors are left in the colormap and</font></i>
<i><font color=#4b5d50>#         don't allocate too many colors.</font></i>
<i><font color=#4b5d50>#    (2): Implement HSV color selection.</font></i>
<i><font color=#4b5d50>#</font></i>

<i><font color=#4b5d50># Make sure namespaces exist</font></i>
<b><font color=#ca14ca>namespace</font></b> eval ::tk {}
<b><font color=#ca14ca>namespace</font></b> eval ::tk::dialog {}
<b><font color=#ca14ca>namespace</font></b> eval ::tk::dialog::color {
  <b><font color=#3a6797>namespace</font></b> import ::tk::msgcat::*
}
::msgcat::mcload [<b><font color=#3a6797>file</font></b> join [<b><font color=#3a6797>file</font></b> dirname [<b><font color=#3a6797>info</font></b> script]] msgs]

<i><font color=#4b5d50># ::tk::dialog::color:: --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Create a color dialog and let the user choose a color. This function</font></i>
<i><font color=#4b5d50>#    should not be called directly. It is called by the tk_chooseColor</font></i>
<i><font color=#4b5d50>#    function when a native color selector widget does not exist</font></i>
<i><font color=#4b5d50>#<a id=color::></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color:: {args} {

  <b><font color=#3a6797>variable</font></b> ::tk::Priv
  <b><font color=#3a6797>set</font></b> dataName __tk__color
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::<font color=#1b1baa>$dataName</font> data
  <b><font color=#3a6797>set</font></b> w .<font color=#1b1baa>$dataName</font>

  <i><font color=#4b5d50># The lines variables track the start and end indices of the line</font></i>
  <i><font color=#4b5d50># elements in the colorbar canvases.</font></i>
  <b><font color=#3a6797>set</font></b> data(lines,red,start)   0
  <b><font color=#3a6797>set</font></b> data(lines,red,last)   -1
  <b><font color=#3a6797>set</font></b> data(lines,green,start) 0
  <b><font color=#3a6797>set</font></b> data(lines,green,last) -1
  <b><font color=#3a6797>set</font></b> data(lines,blue,start)  0
  <b><font color=#3a6797>set</font></b> data(lines,blue,last)  -1

  <i><font color=#4b5d50># This is the actual number of lines that are drawn in each color strip.</font></i>
  <i><font color=#4b5d50># Note that the bars may be of any width.</font></i>
  <i><font color=#4b5d50># However, NUM_COLORBARS must be a number that evenly divides 256.</font></i>
  <i><font color=#4b5d50># Such as 256, 128, 64, etc.</font></i>
  <b><font color=#3a6797>set</font></b> data(NUM_COLORBARS) 32 ;<i><font color=#4b5d50>#16</font></i>

  <i><font color=#4b5d50># BARS_WIDTH is the number of pixels wide the color bar portion of the</font></i>
  <i><font color=#4b5d50># canvas is. This number must be a multiple of NUM_COLORBARS</font></i>
  <b><font color=#3a6797>set</font></b> data(BARS_WIDTH) [<b><font color=#3a6797>expr</font></b> <font color=#1b1baa>$data(NUM_COLORBARS)</font>*14]

  <i><font color=#4b5d50># PLGN_WIDTH is the number of pixels wide of the triangular selection</font></i>
  <i><font color=#4b5d50># polygon. This also results in the definition of the padding on the</font></i>
  <i><font color=#4b5d50># left and right sides which is half of PLGN_WIDTH. Make this number even.</font></i>
  <b><font color=#3a6797>set</font></b> data(PLGN_HEIGHT) 16 ;<i><font color=#4b5d50>#10</font></i>

  <i><font color=#4b5d50># PLGN_HEIGHT is the height of the selection polygon and the height of the</font></i>
  <i><font color=#4b5d50># selection rectangle at the bottom of the color bar. No restrictions.</font></i>
  <b><font color=#3a6797>set</font></b> data(PLGN_WIDTH) 12 ;<i><font color=#4b5d50>#10</font></i>

  Config <font color=#1b1baa>$dataName</font> <font color=#1b1baa>$args</font>
  InitValues <font color=#1b1baa>$dataName</font>

  <b><font color=#3a6797>set</font></b> sc [<b><font color=#134070>winfo</font></b> screen <font color=#1b1baa>$data(-parent)</font>]
  <b><font color=#3a6797>set</font></b> winExists [<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$w</font>]
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$winExists</font> || <font color=#1b1baa>$sc</font> ne [<b><font color=#134070>winfo</font></b> screen <font color=#1b1baa>$w</font>]} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$winExists</font>} {
      <b><font color=#134070>destroy</font></b> <font color=#1b1baa>$w</font>
    }
    <b><font color=#134070>toplevel</font></b> <font color=#1b1baa>$w</font> <font color=#653760>-class</font> TkColorDialog <font color=#653760>-screen</font> <font color=#1b1baa>$sc</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>tk</font></b> windowingsystem] eq <font color=#8b2a0e>&quot;x11&quot;</font>} {<b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$w</font> <font color=#653760>-type</font> dialog}
    BuildDialog <font color=#1b1baa>$w</font>
  }

  <i><font color=#4b5d50># Dialog boxes should be transient with respect to their parent,</font></i>
  <i><font color=#4b5d50># so that they will always stay on top of their parent window.  However,</font></i>
  <i><font color=#4b5d50># some window managers will create the window as withdrawn if the parent</font></i>
  <i><font color=#4b5d50># window is withdrawn or iconified.  Combined with the grab we put on the</font></i>
  <i><font color=#4b5d50># window, this can hang the entire application.  Therefore we only make</font></i>
  <i><font color=#4b5d50># the dialog transient if the parent is viewable.</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> viewable [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$data(-parent)</font>]] } {
    <b><font color=#134070>wm</font></b> transient <font color=#1b1baa>$w</font> <font color=#1b1baa>$data(-parent)</font>
  }

  <i><font color=#4b5d50># 5. Withdraw the window, then update all the geometry information</font></i>
  <i><font color=#4b5d50># so we know how big it wants to be, then center the window in the</font></i>
  <i><font color=#4b5d50># display (Motif style) and de-iconify it.</font></i>

  <b><font color=#134070>wm</font></b> title <font color=#1b1baa>$w</font> <font color=#1b1baa>$data(-title)</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists data(-geometry)] && <font color=#1b1baa>$data(-geometry)</font> ne {-}} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> geo <font color=#1b1baa>$data(-geometry)</font>] eq {}} {
      <b><font color=#3a6797>set</font></b> X [<b><font color=#134070>winfo</font></b> rootx <font color=#1b1baa>$data(-parent)</font>]
      <b><font color=#3a6797>set</font></b> Y [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> rooty <font color=#1b1baa>$data(-parent)</font>]+32}]
      <b><font color=#3a6797>set</font></b> geo +<font color=#1b1baa>$X</font>+<font color=#1b1baa>$Y</font>
    } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> match pointer+*+* <font color=#1b1baa>$geo</font>]} {  ;<i><font color=#4b5d50># e.g.  pointer+10+10</font></i>
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$geo</font> +] -&gt; X Y
      <b><font color=#3a6797>set</font></b> geo +[<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> pointerx .]+<font color=#1b1baa>$X</font>}]+[<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> pointery .]+<font color=#1b1baa>$Y</font>}]
    }
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lrange</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$geo</font> +] end-1 end] X Y
    <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> after 0 [<b><font color=#3a6797>list</font></b> ::tk::dialog::color::ShowAtXY <font color=#1b1baa>$w</font> <font color=#1b1baa>$X</font> <font color=#1b1baa>$Y</font>]]
    <b><font color=#3a6797>unset</font></b> data(-geometry)
  } <b><font color=#3a6797>else</font></b> {
    ::tk::PlaceWindow <font color=#1b1baa>$w</font> widget <font color=#1b1baa>$data(-parent)</font>
    <b><font color=#134070>wm</font></b> deiconify <font color=#1b1baa>$w</font>
  }

  <i><font color=#4b5d50># 6. Set a grab and claim the focus too.</font></i>

  ::tk::SetFocusGrab <font color=#1b1baa>$w</font> <font color=#1b1baa>$data(okBtn)</font>

  <i><font color=#4b5d50># 7. Wait for the user to respond, then restore the focus and</font></i>
  <i><font color=#4b5d50># return the index of the selected button.  Restore the focus</font></i>
  <i><font color=#4b5d50># before deleting the window, since otherwise the window manager</font></i>
  <i><font color=#4b5d50># may take the focus away so we can't redirect it.  Finally,</font></i>
  <i><font color=#4b5d50># restore any grab that was in effect.</font></i>

  <b><font color=#3a6797>vwait</font></b> ::tk::Priv(selectColor)
  <b><font color=#3a6797>set</font></b> result <font color=#1b1baa>$Priv(selectColor)</font>
  <b><font color=#3a6797>set</font></b> ::tk::dialog::color::fgsel [<font color=#1b1baa>$data(finalCanvas)</font> cget <font color=#653760>-text</font>]
  <b><font color=#3a6797>set</font></b> ::tk::dialog::color::bgsel <font color=#1b1baa>$result</font>
  ::tk::RestoreFocusGrab <font color=#1b1baa>$w</font> <font color=#1b1baa>$data(okBtn)</font>
  <b><font color=#3a6797>unset</font></b> data

  <i><font color=#4b5d50># for backward compatibility:</font></i>
  <i><font color=#4b5d50># if any of new options (-tonemoves, -moveall) present</font></i>
  <i><font color=#4b5d50># then return a list: color + values of these options</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-regexp</font> <font color=#1b1baa>$args</font> <font color=#8b2a0e>&quot;(\[-\]tonemoves|\[-\]moveall)&quot;</font>] &gt; -1} {
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$result</font> <font color=#1b1baa>$::tk::dialog::color::moveall</font> \
      <font color=#1b1baa>$::tk::dialog::color::tonemoves</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$result</font>
}
<a id=color::GetOptions></a>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::GetOptions {} {
  <i><font color=#4b5d50># Gets current settings of options.</font></i>
  <i><font color=#4b5d50># Returns a list of selected color options:</font></i>
  <i><font color=#4b5d50>#   moveall - value of moveall option</font></i>
  <i><font color=#4b5d50>#   fgcolor - value of foreground (inverse) color</font></i>
  <i><font color=#4b5d50>#   bgcolor - value of background (selected) color</font></i>

  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$::tk::dialog::color::moveall</font> <font color=#1b1baa>$::tk::dialog::color::fgsel</font> <font color=#1b1baa>$::tk::dialog::color::bgsel</font>]
}
<a id=color::ShowAtXY></a>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::ShowAtXY {win x y} {
  <i><font color=#4b5d50># Shows the picker at X,Y coordinates, checking the coordinates against the screen, incl. decors</font></i>
  <i><font color=#4b5d50>#   win - window's path</font></i>
  <i><font color=#4b5d50>#   x - window's X coordinate</font></i>
  <i><font color=#4b5d50>#   y - window's Y coordinate</font></i>

  <b><font color=#3a6797>set</font></b> w [<b><font color=#134070>winfo</font></b> reqwidth <font color=#1b1baa>$win</font>]
  <b><font color=#3a6797>set</font></b> h [<b><font color=#134070>winfo</font></b> reqheight <font color=#1b1baa>$win</font>]
  <b><font color=#3a6797>set</font></b> scrw [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> vrootwidth .] - 12}]
  <b><font color=#3a6797>set</font></b> scrh [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> vrootheight .] - 36}]
  <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$x</font> + <font color=#1b1baa>$w</font>) &gt; <font color=#1b1baa>$scrw</font> } {
    <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$scrw</font> - <font color=#1b1baa>$w</font>}]
  }
  <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$y</font> + <font color=#1b1baa>$h</font>) &gt; <font color=#1b1baa>$scrh</font> } {
    <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$scrh</font> - <font color=#1b1baa>$h</font>}]
  }
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match -* <font color=#1b1baa>$x</font>]} {<b><font color=#3a6797>set</font></b> x +[<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$x</font> +]}
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match -* <font color=#1b1baa>$y</font>]} {<b><font color=#3a6797>set</font></b> y +[<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$y</font> +]}
  <b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font> <font color=#1b1baa>$x$y</font>
  <b><font color=#134070>wm</font></b> deiconify <font color=#1b1baa>$win</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::InitValues --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Get called during initialization or when user resets NUM_COLORBARS</font></i>
<i><font color=#4b5d50>#<a id=color::InitValues></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::InitValues {dataName} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::<font color=#1b1baa>$dataName</font> data

  <i><font color=#4b5d50># IntensityIncr is the difference in color intensity between a colorbar</font></i>
  <i><font color=#4b5d50># and its neighbors.</font></i>
  <b><font color=#3a6797>set</font></b> data(intensityIncr) [<b><font color=#3a6797>expr</font></b> {256 / <font color=#1b1baa>$data(NUM_COLORBARS)</font>}]

  <i><font color=#4b5d50># ColorbarWidth is the width of each colorbar</font></i>
  <b><font color=#3a6797>set</font></b> data(colorbarWidth) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data(BARS_WIDTH)</font> / <font color=#1b1baa>$data(NUM_COLORBARS)</font>}]

  <i><font color=#4b5d50># Indent is the width of the space at the left and right side of the</font></i>
  <i><font color=#4b5d50># colorbar. It is always half the selector polygon width, because the</font></i>
  <i><font color=#4b5d50># polygon extends into the space.</font></i>
  <b><font color=#3a6797>set</font></b> data(indent) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data(PLGN_WIDTH)</font> / 2}]

  <b><font color=#3a6797>set</font></b> data(colorPad) 2
  <b><font color=#3a6797>set</font></b> data(selPad)   [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data(PLGN_WIDTH)</font> / 2}]

  <i><font color=#4b5d50>#</font></i>
  <i><font color=#4b5d50># minX is the x coordinate of the first colorbar</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>set</font></b> data(minX) <font color=#1b1baa>$data(indent)</font>

  <i><font color=#4b5d50>#</font></i>
  <i><font color=#4b5d50># maxX is the x coordinate of the last colorbar</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>set</font></b> data(maxX) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data(BARS_WIDTH)</font> + <font color=#1b1baa>$data(indent)</font>-1}]

  <i><font color=#4b5d50>#</font></i>
  <i><font color=#4b5d50># canvasWidth is the width of the entire canvas, including the indents</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>set</font></b> data(canvasWidth) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data(BARS_WIDTH)</font> + <font color=#1b1baa>$data(PLGN_WIDTH)</font>}]

  <i><font color=#4b5d50># Set the initial color, specified by -initialcolor, or the</font></i>
  <i><font color=#4b5d50># color chosen by the user the last time.</font></i>
  <b><font color=#3a6797>set</font></b> data(selection) <font color=#1b1baa>$data(-initialcolor)</font>
  <b><font color=#3a6797>set</font></b> data(finalColor)  <font color=#1b1baa>$data(-initialcolor)</font>
  <b><font color=#3a6797>set</font></b> rgb [<b><font color=#134070>winfo</font></b> rgb . <font color=#1b1baa>$data(selection)</font>]

  <b><font color=#3a6797>set</font></b> data(red,intensity)   [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$rgb</font> 0]/0x100}]
  <b><font color=#3a6797>set</font></b> data(green,intensity) [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$rgb</font> 1]/0x100}]
  <b><font color=#3a6797>set</font></b> data(blue,intensity)  [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$rgb</font> 2]/0x100}]
}

<i><font color=#4b5d50># ::tk::dialog::color::Config  --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Parses the command line arguments to tk_chooseColor</font></i>
<i><font color=#4b5d50>#<a id=color::Config></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::Config {dataName argList} {
  <b><font color=#3a6797>variable</font></b> ::tk::Priv
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::<font color=#1b1baa>$dataName</font> data

  <i><font color=#4b5d50># 1: the configuration specs</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists Priv(selectColor)] && <font color=#1b1baa>$Priv(selectColor)</font> ne <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#3a6797>set</font></b> defaultColor <font color=#1b1baa>$Priv(selectColor)</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> defaultColor [. cget <font color=#653760>-background</font>]
  }

  <b><font color=#3a6797>set</font></b> specs [<b><font color=#3a6797>list</font></b> \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-moveall</font> {} {} 0] \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-tonemoves</font> {} {} 1] \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-geometry</font> {} {} -] \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-initialcolor</font> {} {} <font color=#1b1baa>$defaultColor</font>] \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-parent</font> {} {} .] \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-title</font> {} {} [mc <font color=#8b2a0e>&quot;Color&quot;</font>]] \
    [<b><font color=#3a6797>list</font></b> <font color=#653760>-inifile</font> {} {} {}] \
    ]

  <i><font color=#4b5d50># 2: parse the arguments</font></i>
  <i><font color=#4b5d50>#</font></i>
  tclParseConfigSpec ::tk::dialog::color::<font color=#1b1baa>$dataName</font> <font color=#1b1baa>$specs</font> <font color=#8b2a0e>&quot;&quot;</font> <font color=#1b1baa>$argList</font>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(-title)</font> eq <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#3a6797>set</font></b> data(-title) <font color=#8b2a0e>&quot; &quot;</font>
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#134070>winfo</font></b> rgb . <font color=#1b1baa>$data(-initialcolor)</font>} err]} {
    <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#653760>-errorcode</font> \
      [<b><font color=#3a6797>list</font></b> TK LOOKUP COLOR <font color=#1b1baa>$data(-initialcolor)</font>] <font color=#1b1baa>$err</font>
  }

  <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$data(-parent)</font>]} {
    <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#653760>-errorcode</font> [<b><font color=#3a6797>list</font></b> TK LOOKUP WINDOW <font color=#1b1baa>$data(-parent)</font>] \
      <font color=#8b2a0e>&quot;bad window path name \&quot;<font color=#1b1baa>$</font>data(-parent)\&quot;&quot;</font>
  }
}

<i><font color=#4b5d50># ::tk::dialog::color::BuildDialog --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Build the dialog.</font></i>
<i><font color=#4b5d50>#<a id=color::BuildDialog></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::BuildDialog {w} {

  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#134070>wm</font></b> withdraw <font color=#1b1baa>$w</font>

  <i><font color=#4b5d50># let the dialog's background = the app's</font></i>
  <font color=#1b1baa>$w</font> configure <font color=#653760>-background</font> [<b><font color=#134070>ttk::style</font></b> lookup <font color=#8b2a0e>&quot;.&quot;</font> <font color=#653760>-background</font>]

  <i><font color=#4b5d50># TopFrame contains the color strips and the color selection</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>set</font></b> topFrame [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$w</font>.top <font color=#653760>-relief</font> flat]

  <i><font color=#4b5d50># StripsFrame contains the colorstrips and the individual RGB entries</font></i>
  <b><font color=#3a6797>set</font></b> stripsFrame [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$topFrame</font>.colorStrip]

  <b><font color=#3a6797>set</font></b> maxWidth [::tk::mcmaxamp &Red &Green &Blue]
  <b><font color=#3a6797>set</font></b> maxWidth [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$maxWidth</font>&lt;6 ? 6 : <font color=#1b1baa>$maxWidth</font>}]
  <b><font color=#3a6797>set</font></b> colorList {
    red   <font color=#8b2a0e>&quot;Red&quot;</font>
    green <font color=#8b2a0e>&quot;Green&quot;</font>
    blue  <font color=#8b2a0e>&quot;Blue&quot;</font>
  }
  <b><font color=#3a6797>foreach</font></b> {color l} <font color=#1b1baa>$colorList</font> {
    <i><font color=#4b5d50># each f frame contains an [R|G|B] entry and the equiv. color strip.</font></i>
    <b><font color=#3a6797>set</font></b> f [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$stripsFrame</font>.<font color=#1b1baa>$color</font>]

    <i><font color=#4b5d50># The box frame contains the label and entry widget for an [R|G|B]</font></i>
    <b><font color=#3a6797>set</font></b> box [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$f</font>.box]
    <b><font color=#134070>ttk::label</font></b> <font color=#1b1baa>$box</font>.label {<b><font color=#3a6797>*</font></b>}[<b><font color=#134070>ttk::style</font></b> config TLabel] <font color=#653760>-text</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>mc <font color=#1b1baa>$</font>l<font color=#1b1baa>]</font>:&quot;</font> \
      <font color=#653760>-width</font> <font color=#1b1baa>$maxWidth</font> <font color=#653760>-anchor</font> ne
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$box</font>.label &lt;&lt;AltUnderlined&gt;&gt; [<b><font color=#3a6797>list</font></b> focus <font color=#1b1baa>$box</font>.entry]

    <b><font color=#134070>ttk::entry</font></b> <font color=#1b1baa>$box</font>.entry <font color=#653760>-textvariable</font> \
      ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>](<font color=#1b1baa>$color</font>,intensity) <font color=#653760>-width</font> 4
    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$box</font>.label <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-pady</font> 6
    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$box</font>.entry <font color=#653760>-side</font> left <font color=#653760>-anchor</font> n <font color=#653760>-pady</font> 4 <font color=#653760>-padx</font> 2
    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$box</font> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both

    <b><font color=#3a6797>set</font></b> height [<b><font color=#3a6797>expr</font></b> { [<b><font color=#134070>winfo</font></b> reqheight <font color=#1b1baa>$box</font>.entry] + 1}]

    <b><font color=#3a6797>catch</font></b> {::apave::obj untouchWidgets <font color=#1b1baa>$f</font>.sel}
    <b><font color=#134070>canvas</font></b> <font color=#1b1baa>$f</font>.color <font color=#653760>-height</font> [<b><font color=#3a6797>expr</font></b> <font color=#1b1baa>$height</font>-2] \
      <font color=#653760>-width</font> <font color=#1b1baa>$data(BARS_WIDTH)</font> <font color=#653760>-relief</font> sunken <font color=#653760>-bd</font> 3
    <b><font color=#134070>canvas</font></b> <font color=#1b1baa>$f</font>.sel <font color=#653760>-height</font> [<b><font color=#3a6797>expr</font></b> <font color=#1b1baa>$data(PLGN_HEIGHT)</font>+2] \
      <font color=#653760>-width</font> <font color=#1b1baa>$data(canvasWidth)</font> <font color=#653760>-highlightthickness</font> 0 \
      <font color=#653760>-bg</font> [<b><font color=#134070>ttk::style</font></b> lookup . <font color=#653760>-background</font>]
    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$f</font>.color <font color=#653760>-expand</font> yes <font color=#653760>-fill</font> both
    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$f</font>.sel <font color=#653760>-expand</font> yes <font color=#653760>-fill</font> both

    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$f</font> <font color=#653760>-side</font> top <font color=#653760>-fill</font> x <font color=#653760>-pady</font> 1

    <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$color</font>,entry) <font color=#1b1baa>$box</font>.entry
    <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$color</font>,col) <font color=#1b1baa>$f</font>.color
    <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$color</font>,sel) <font color=#1b1baa>$f</font>.sel

    <b><font color=#3a6797>set</font></b> data(cbc1) red
    <b><font color=#3a6797>set</font></b> data(cbc2) [<b><font color=#134070>ttk::style</font></b> lookup . <font color=#653760>-bordercolor</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(cbc2)</font> eq {}} {<b><font color=#3a6797>set</font></b> data(cbc2) grey}
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$data($color,col)</font> &lt;Configure&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::DrawColorScale <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font> 1]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$data($color,col)</font> &lt;Enter&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::EnterLeaveColorBar <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$data(cbc1)</font>]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$data($color,col)</font> &lt;Leave&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::EnterLeaveColorBar <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$data(cbc2)</font>]

    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$data($color,sel)</font> &lt;Enter&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::EnterLeaveColorBar <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$data(cbc1)</font>]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$data($color,sel)</font> &lt;Leave&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::EnterLeaveColorBar <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$data(cbc2)</font>]

    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$box</font>.entry &lt;Return&gt; [<b><font color=#3a6797>list</font></b> tk::dialog::color::HandleRGBEntry <font color=#1b1baa>$w</font>]
  }

  <b><font color=#3a6797>set</font></b> mainentry ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>](selection)

  <i><font color=#4b5d50># for setting the mutual move of selectors:</font></i>
  <b><font color=#3a6797>set</font></b> ::tk::dialog::color::tonemoves <font color=#1b1baa>$data(-tonemoves)</font>
  <b><font color=#3a6797>set</font></b> ::tk::dialog::color::moveall <font color=#1b1baa>$data(-moveall)</font>
  <b><font color=#3a6797>set</font></b> ::tk::dialog::color::fgsel {}
  <b><font color=#3a6797>set</font></b> ::tk::dialog::color::bgsel {}
  <b><font color=#134070>pack</font></b> [<b><font color=#134070>ttk::checkbutton</font></b> <font color=#1b1baa>$stripsFrame</font>.moveallColorSel <font color=#653760>-text</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>mc <font color=#1b1baa>{</font>Move all<font color=#1b1baa>}]</font>    &quot;</font> \
    <font color=#653760>-variable</font> ::tk::dialog::color::moveall <font color=#653760>-command</font> \
    <font color=#8b2a0e>&quot;::tk::dialog::color::StickSelectors <font color=#1b1baa>$</font>w 1&quot;</font>] <font color=#653760>-padx</font> 2 <font color=#653760>-side</font> left
  <b><font color=#3a6797>set</font></b> foc [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$stripsFrame</font>.foc]
  <b><font color=#3a6797>foreach</font></b> l { 804000 004000 004080 008080 800080 808000 \
              ffff00 ff00ff 00ffff 0000ff 00ff00 ff0000} {
    <b><font color=#3a6797>set</font></b> fl [<b><font color=#134070>frame</font></b> <font color=#1b1baa>$stripsFrame</font>.foc.<font color=#1b1baa>$l</font> <font color=#653760>-bd</font> 3 <font color=#653760>-relief</font> raised <font color=#653760>-height</font> 24 <font color=#653760>-width</font> 24]
    <font color=#1b1baa>$fl</font> configure <font color=#653760>-bg</font> #<font color=#1b1baa>$l</font>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$fl</font> &lt;Button-1&gt; [<b><font color=#3a6797>list</font></b> tk::dialog::color::LittleSwatch <font color=#1b1baa>$w</font> <font color=#1b1baa>$mainentry</font> #<font color=#1b1baa>$l</font>]
    <b><font color=#134070>pack</font></b> <font color=#1b1baa>$fl</font> <font color=#653760>-expand</font> yes <font color=#653760>-anchor</font> nw <font color=#653760>-padx</font> 2 <font color=#653760>-side</font> left
  }
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$foc</font> <font color=#653760>-expand</font> yes <font color=#653760>-anchor</font> nw <font color=#653760>-fill</font> both <font color=#653760>-pady</font> 4 <font color=#653760>-side</font> right

  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$stripsFrame</font> <font color=#653760>-side</font> left <font color=#653760>-fill</font> both <font color=#653760>-pady</font> 4

  <i><font color=#4b5d50># The selFrame contains a frame that demonstrates the currently</font></i>
  <i><font color=#4b5d50># selected color</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>set</font></b> selFrame [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$topFrame</font>.sel]
  <b><font color=#3a6797>set</font></b> lab [<b><font color=#134070>ttk::label</font></b> <font color=#1b1baa>$selFrame</font>.lab {<b><font color=#3a6797>*</font></b>}[<b><font color=#134070>ttk::style</font></b> config TLabel] \
    <font color=#653760>-text</font> [mc <font color=#8b2a0e>&quot;Selection:&quot;</font>]]
  <b><font color=#3a6797>set</font></b> ent [<b><font color=#134070>ttk::entry</font></b> <font color=#1b1baa>$selFrame</font>.ent <font color=#653760>-textvariable</font> <font color=#1b1baa>$mainentry</font> <font color=#653760>-width</font> 14]
  <b><font color=#3a6797>set</font></b> f1  [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$selFrame</font>.f1 <font color=#653760>-relief</font> sunken]
  <b><font color=#3a6797>set</font></b> data(finalCanvas) [<b><font color=#134070>label</font></b> <font color=#1b1baa>$f1</font>.demo <font color=#653760>-bd</font> 1 <font color=#653760>-width</font> 6 <font color=#653760>-height</font> 6]

  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$lab</font> <font color=#653760>-side</font> top <font color=#653760>-padx</font> 4 <font color=#653760>-anchor</font> sw
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$ent</font> <font color=#653760>-side</font> top <font color=#653760>-padx</font> 4 <font color=#653760>-pady</font> 2 <font color=#653760>-anchor</font> n
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$f1</font> <font color=#653760>-expand</font> yes <font color=#653760>-anchor</font> nw <font color=#653760>-fill</font> both <font color=#653760>-padx</font> 4 <font color=#653760>-pady</font> 4
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$data(finalCanvas)</font> <font color=#653760>-expand</font> yes <font color=#653760>-fill</font> both <font color=#653760>-anchor</font> s

  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$ent</font> &lt;Return&gt; [<b><font color=#3a6797>list</font></b> tk::dialog::color::HandleSelEntry <font color=#1b1baa>$w</font>]
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$data(finalCanvas)</font> &lt;Button-1&gt; [<b><font color=#3a6797>list</font></b> tk::dialog::color::ReverseFinalFg <font color=#1b1baa>$w</font>]

  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$selFrame</font> <font color=#653760>-side</font> left <font color=#653760>-fill</font> none <font color=#653760>-anchor</font> nw
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$topFrame</font> <font color=#653760>-side</font> top <font color=#653760>-expand</font> yes <font color=#653760>-fill</font> both <font color=#653760>-anchor</font> nw

  <i><font color=#4b5d50># the botFrame frame contains the buttons</font></i>
  <i><font color=#4b5d50>#</font></i>
  <b><font color=#3a6797>set</font></b> botFrame [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$w</font>.bot <font color=#653760>-relief</font> raised]

  <b><font color=#134070>ttk::button</font></b> <font color=#1b1baa>$botFrame</font>.ok0 <font color=#653760>-text</font> [mc <font color=#8b2a0e>&quot;From clipboard&quot;</font>] \
      <font color=#653760>-command</font> [<b><font color=#3a6797>list</font></b> tk::dialog::color::OkCmd0 <font color=#1b1baa>$w</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> aloupe [<b><font color=#3a6797>info</font></b> commands ::aloupe::run]] ne <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#134070>ttk::button</font></b> <font color=#1b1baa>$botFrame</font>.loupe <font color=#653760>-text</font> [mc <font color=#8b2a0e>&quot;Loupe&quot;</font>] \
        <font color=#653760>-command</font> [<b><font color=#3a6797>list</font></b> tk::dialog::color::Loupe <font color=#1b1baa>$w</font>]
  }
  <b><font color=#134070>ttk::button</font></b> <font color=#1b1baa>$botFrame</font>.ok <font color=#653760>-text</font> [<b><font color=#3a6797>string</font></b> map {& <font color=#8b2a0e>&quot;&quot;</font>} [mc <font color=#8b2a0e>&quot;OK&quot;</font>]] \
      <font color=#653760>-command</font> [<b><font color=#3a6797>list</font></b> tk::dialog::color::OkCmd <font color=#1b1baa>$w</font>]
  <b><font color=#134070>ttk::button</font></b> <font color=#1b1baa>$botFrame</font>.cancel <font color=#653760>-text</font> [<b><font color=#3a6797>string</font></b> map {& <font color=#8b2a0e>&quot;&quot;</font>} [mc <font color=#8b2a0e>&quot;Cancel&quot;</font>]] \
      <font color=#653760>-command</font> [<b><font color=#3a6797>list</font></b> tk::dialog::color::CancelCmd <font color=#1b1baa>$w</font>]

  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> clb [<b><font color=#134070>clipboard</font></b> get]}] && \
  [<b><font color=#3a6797>regexp</font></b> {^(#*\d{3,6}|[[:alnum:] ]{3,})$} <font color=#1b1baa>$clb</font>]} {
    <b><font color=#3a6797>set</font></b> data(okBtn) <font color=#1b1baa>$botFrame</font>.ok0
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> data(okBtn) <font color=#1b1baa>$botFrame</font>.ok
  }
  <b><font color=#3a6797>set</font></b> data(cancelBtn)  <font color=#1b1baa>$botFrame</font>.cancel

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$aloupe</font> eq <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#134070>grid</font></b> <font color=#1b1baa>$botFrame</font>.ok0 x x x <font color=#1b1baa>$botFrame</font>.ok <font color=#1b1baa>$botFrame</font>.cancel <font color=#653760>-sticky</font> ew
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#134070>grid</font></b> <font color=#1b1baa>$botFrame</font>.ok0 <font color=#1b1baa>$botFrame</font>.loupe x x x <font color=#1b1baa>$botFrame</font>.ok <font color=#1b1baa>$botFrame</font>.cancel <font color=#653760>-sticky</font> ew <font color=#653760>-padx</font> 2
  }
  <b><font color=#134070>grid</font></b> configure <font color=#1b1baa>$botFrame</font>.ok <font color=#1b1baa>$botFrame</font>.cancel <font color=#653760>-padx</font> 2 <font color=#653760>-pady</font> 4
  <b><font color=#134070>grid</font></b> columnconfigure <font color=#1b1baa>$botFrame</font> 2 <font color=#653760>-weight</font> 2 <font color=#653760>-uniform</font> space
  <b><font color=#134070>pack</font></b> <font color=#1b1baa>$botFrame</font> <font color=#653760>-side</font> bottom <font color=#653760>-fill</font> x

  <i><font color=#4b5d50># Accelerator bindings</font></i>
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lab</font> &lt;&lt;AltUnderlined&gt;&gt; [<b><font color=#3a6797>list</font></b> focus <font color=#1b1baa>$ent</font>]
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> &lt;KeyPress-Escape&gt; [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$data(cancelBtn)</font> invoke]
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> &lt;Alt-Key&gt; [<b><font color=#3a6797>list</font></b> tk::AltKeyInDialog <font color=#1b1baa>$w</font> %A]

  <b><font color=#134070>wm</font></b> protocol <font color=#1b1baa>$w</font> WM_DELETE_WINDOW [<b><font color=#3a6797>list</font></b> tk::dialog::color::CancelCmd <font color=#1b1baa>$w</font>]
  <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lab</font> &lt;Destroy&gt; [<b><font color=#3a6797>list</font></b> tk::dialog::color::CancelCmd <font color=#1b1baa>$w</font>]

  ::tk::dialog::color::StickSelectors <font color=#1b1baa>$w</font> 1
  <b><font color=#134070>wm</font></b> resizable <font color=#1b1baa>$w</font> 0 0
}

<i><font color=#4b5d50># ::tk::dialog::color::SetRGBValue --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Sets the current selection of the dialog box</font></i>
<i><font color=#4b5d50>#<a id=color::SetRGBValue></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::SetRGBValue {w color} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>set</font></b> data(red,intensity)   [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$color</font> 0]
  <b><font color=#3a6797>set</font></b> data(green,intensity) [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$color</font> 1]
  <b><font color=#3a6797>set</font></b> data(blue,intensity)  [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$color</font> 2]

  RedrawColorBars <font color=#1b1baa>$w</font> all

  <i><font color=#4b5d50># Now compute the new x value of each colorbars pointer polygon</font></i>
  <b><font color=#3a6797>foreach</font></b> color {red green blue} {
    <b><font color=#3a6797>set</font></b> x [RgbToX <font color=#1b1baa>$w</font> <font color=#1b1baa>$data($color,intensity)</font>]
    MoveSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$data($color,sel)</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$x</font> 0
  }
}

<i><font color=#4b5d50># ::tk::dialog::color::XToRgb --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Converts a screen coordinate to intensity</font></i>
<i><font color=#4b5d50>#<a id=color::XToRgb></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::XToRgb {w x} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> {round(1.0 * (<font color=#1b1baa>$x</font> * <font color=#1b1baa>$data(intensityIncr)</font>)/ <font color=#1b1baa>$data(colorbarWidth)</font>)}]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$x</font> &gt; 255} {<b><font color=#3a6797>set</font></b> x 255}
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$x</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::RgbToX</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Converts an intensity to screen coordinate.</font></i>
<i><font color=#4b5d50>#<a id=color::RgbToX></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::RgbToX {w color} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {(<font color=#1b1baa>$color</font> * <font color=#1b1baa>$data(colorbarWidth)</font>/ <font color=#1b1baa>$data(intensityIncr)</font>)}]
}

<i><font color=#4b5d50># ::tk::dialog::color::DrawColorScale --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Draw color scale is called whenever the size of one of the color</font></i>
<i><font color=#4b5d50>#    scale canvases is changed.</font></i>
<i><font color=#4b5d50>#<a id=color::DrawColorScale></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::DrawColorScale {w c {create 0}} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <i><font color=#4b5d50># col: color bar canvas</font></i>
  <i><font color=#4b5d50># sel: selector canvas</font></i>
  <b><font color=#3a6797>set</font></b> col <font color=#1b1baa>$data($c,col)</font>
  <b><font color=#3a6797>set</font></b> sel <font color=#1b1baa>$data($c,sel)</font>

  <i><font color=#4b5d50># First handle the case that we are creating everything for the first time.</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$create</font>} {
    <i><font color=#4b5d50># First remove all the lines that already exist.</font></i>
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$data(lines,$c,last)</font> &gt; <font color=#1b1baa>$data(lines,$c,start)</font>} {
      <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i <font color=#1b1baa>$data(lines,$c,start)</font>} {<font color=#1b1baa>$i</font> &lt;= <font color=#1b1baa>$data(lines,$c,last)</font>} {<b><font color=#3a6797>incr</font></b> i} {
        <font color=#1b1baa>$sel</font> delete <font color=#1b1baa>$i</font>
      }
    }
    <i><font color=#4b5d50># Delete the selector if it exists</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists data(<font color=#1b1baa>$c</font>,index)]} {
      <font color=#1b1baa>$sel</font> delete <font color=#1b1baa>$data($c,index)</font>
    }

    <i><font color=#4b5d50># Draw the selection polygons</font></i>
    CreateSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font>
    <font color=#1b1baa>$sel</font> bind <font color=#1b1baa>$data($c,index)</font> &lt;ButtonPress-1&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::StartMove <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(selPad)</font> 1]
    <font color=#1b1baa>$sel</font> bind <font color=#1b1baa>$data($c,index)</font> &lt;B1-Motion&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::MoveSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(selPad)</font>]
    <font color=#1b1baa>$sel</font> bind <font color=#1b1baa>$data($c,index)</font> &lt;ButtonRelease-1&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::ReleaseMouse <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(selPad)</font>]

    <b><font color=#3a6797>set</font></b> height [<b><font color=#134070>winfo</font></b> height <font color=#1b1baa>$col</font>]
    <i><font color=#4b5d50># Create an invisible region under the colorstrip to catch mouse clicks</font></i>
    <i><font color=#4b5d50># that aren't on the selector.</font></i>
    <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,clickRegion) [<font color=#1b1baa>$sel</font> create rectangle 0 0 \
      <font color=#1b1baa>$data(canvasWidth)</font> <font color=#1b1baa>$height</font> <font color=#653760>-fill</font> {} <font color=#653760>-outline</font> {}]

    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$col</font> &lt;ButtonPress-1&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::StartMove <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(colorPad)</font>]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$col</font> &lt;B1-Motion&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::MoveSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(colorPad)</font>]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$col</font> &lt;ButtonRelease-1&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::ReleaseMouse <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(colorPad)</font>]

    <font color=#1b1baa>$sel</font> bind <font color=#1b1baa>$data($c,clickRegion)</font> &lt;ButtonPress-1&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::StartMove <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(selPad)</font>]
    <font color=#1b1baa>$sel</font> bind <font color=#1b1baa>$data($c,clickRegion)</font> &lt;B1-Motion&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::MoveSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(selPad)</font>]
    <font color=#1b1baa>$sel</font> bind <font color=#1b1baa>$data($c,clickRegion)</font> &lt;ButtonRelease-1&gt; \
      [<b><font color=#3a6797>list</font></b> tk::dialog::color::ReleaseMouse <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$c</font> %x <font color=#1b1baa>$data(selPad)</font>]
  } <b><font color=#3a6797>else</font></b> {
    <i><font color=#4b5d50># l is the canvas index of the first colorbar.</font></i>
    <b><font color=#3a6797>set</font></b> l <font color=#1b1baa>$data(lines,$c,start)</font>
  }

  <i><font color=#4b5d50># Draw the color bars.</font></i>
  <b><font color=#3a6797>set</font></b> highlightW [<b><font color=#3a6797>expr</font></b> {[<font color=#1b1baa>$col</font> cget <font color=#653760>-highlightthickness</font>] + [<font color=#1b1baa>$col</font> cget <font color=#653760>-bd</font>]}]
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} { <font color=#1b1baa>$i</font> &lt; <font color=#1b1baa>$data(NUM_COLORBARS)</font>} { <b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> intensity [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font> * <font color=#1b1baa>$data(intensityIncr)</font>}]
    <b><font color=#3a6797>set</font></b> startx [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font> * <font color=#1b1baa>$data(colorbarWidth)</font> + <font color=#1b1baa>$highlightW</font>}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c</font> eq <font color=#8b2a0e>&quot;red&quot;</font>} {
      <b><font color=#3a6797>set</font></b> color [<b><font color=#3a6797>format</font></b> <font color=#8b2a0e>&quot;#%02x%02x%02x&quot;</font> \
        <font color=#1b1baa>$intensity</font> <font color=#1b1baa>$data(green,intensity)</font> <font color=#1b1baa>$data(blue,intensity)</font>]
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$c</font> eq <font color=#8b2a0e>&quot;green&quot;</font>} {
      <b><font color=#3a6797>set</font></b> color [<b><font color=#3a6797>format</font></b> <font color=#8b2a0e>&quot;#%02x%02x%02x&quot;</font> \
        <font color=#1b1baa>$data(red,intensity)</font> <font color=#1b1baa>$intensity</font> <font color=#1b1baa>$data(blue,intensity)</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> color [<b><font color=#3a6797>format</font></b> <font color=#8b2a0e>&quot;#%02x%02x%02x&quot;</font> \
        <font color=#1b1baa>$data(red,intensity)</font> <font color=#1b1baa>$data(green,intensity)</font> <font color=#1b1baa>$intensity</font>]
    }

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$create</font>} {
      <b><font color=#3a6797>incr</font></b> startx 4
      <b><font color=#3a6797>set</font></b> index [<font color=#1b1baa>$col</font> create rect <font color=#1b1baa>$startx</font> <font color=#1b1baa>$highlightW</font> \
        [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$startx</font> +<font color=#1b1baa>$data(colorbarWidth)</font>}] \
        [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> height <font color=#1b1baa>$col</font>] + <font color=#1b1baa>$highlightW</font>}] \
        <font color=#653760>-fill</font> <font color=#1b1baa>$color</font> <font color=#653760>-outline</font> <font color=#1b1baa>$color</font>]
    } <b><font color=#3a6797>else</font></b> {
      <font color=#1b1baa>$col</font> itemconfigure <font color=#1b1baa>$l</font> <font color=#653760>-fill</font> <font color=#1b1baa>$color</font> <font color=#653760>-outline</font> <font color=#1b1baa>$color</font>
      <b><font color=#3a6797>incr</font></b> l
    }
  }
  <font color=#1b1baa>$sel</font> raise <font color=#1b1baa>$data($c,index)</font>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$create</font>} {
    <b><font color=#3a6797>set</font></b> data(lines,<font color=#1b1baa>$c</font>,last) <font color=#1b1baa>$index</font>
    <b><font color=#3a6797>set</font></b> data(lines,<font color=#1b1baa>$c</font>,start) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$index</font> - <font color=#1b1baa>$data(NUM_COLORBARS)</font> + 1}]
  }

  RedrawFinalColor <font color=#1b1baa>$w</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::CreateSelector --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Creates and draws the selector polygon at the position</font></i>
<i><font color=#4b5d50>#    $data($c,intensity).</font></i>
<i><font color=#4b5d50>#<a id=color::CreateSelector></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::CreateSelector {w sel c } {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,index) [<font color=#1b1baa>$sel</font> create polygon \
    0 <font color=#1b1baa>$data(PLGN_HEIGHT)</font> \
    <font color=#1b1baa>$data(PLGN_WIDTH)</font> <font color=#1b1baa>$data(PLGN_HEIGHT)</font> \
    <font color=#1b1baa>$data(indent)</font> 0]
  <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,x) [RgbToX <font color=#1b1baa>$w</font> <font color=#1b1baa>$data($c,intensity)</font>]
  <font color=#1b1baa>$sel</font> move <font color=#1b1baa>$data($c,index)</font> <font color=#1b1baa>$data($c,x)</font> 0
  EnterLeaveColorBar <font color=#1b1baa>$w</font> <font color=#1b1baa>$c</font> <font color=#1b1baa>$data(cbc2)</font>
}

<i><font color=#4b5d50># Inverts colors from light to dark and vice versa to get &quot;fg&quot; from &quot;bg&quot;.</font></i>
<i><font color=#4b5d50># It's simplified way, just to not include the bulky HSV code.</font></i>
<i><font color=#4b5d50>#  r - red component</font></i>
<i><font color=#4b5d50>#  g - green component</font></i>
<i><font color=#4b5d50>#  b - blue component</font></i>
<i><font color=#4b5d50># Returns {R G B} list of inverted colors.</font></i>
<a id=color::InvertBg></a>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::InvertBg {r g b} {
  <b><font color=#3a6797>set</font></b> c [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$r</font>&lt;100 && <font color=#1b1baa>$g</font>&lt;100 || <font color=#1b1baa>$r</font>&lt;100 && <font color=#1b1baa>$b</font>&lt;100 || <font color=#1b1baa>$b</font>&lt;100 && <font color=#1b1baa>$g</font>&lt;100 ||
    (<font color=#1b1baa>$r</font>+<font color=#1b1baa>$g</font>+<font color=#1b1baa>$b</font>)&lt;300 ? 255 : 0}]
  <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>string</font></b> toupper [<b><font color=#3a6797>format</font></b> <font color=#8b2a0e>&quot;#%02x%02x%02x&quot;</font> <font color=#1b1baa>$c</font> <font color=#1b1baa>$c</font> <font color=#1b1baa>$c</font>]]
  <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$res</font> {
    {#000000} {<b><font color=#3a6797>set</font></b> res black}
    {#FFFFFF} {<b><font color=#3a6797>set</font></b> res white}
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<a id=color::ReverseFinalFg></a>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::ReverseFinalFg {w} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>set</font></b> testcolors [<b><font color=#3a6797>list</font></b> 000000 FFFFFF 804000 004000 004080 008080 800080 808000 \
    ffff00 ff00ff 00ffff 0000ff 00ff00 ff0000]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> data(idxFinalColor)]&gt;=[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$testcolors</font>]} {<b><font color=#3a6797>set</font></b> data(idxFinalColor) 0}
  <b><font color=#3a6797>set</font></b> fg #[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$testcolors</font> <font color=#1b1baa>$data(idxFinalColor)</font>]
  <font color=#1b1baa>$data(finalCanvas)</font> configure <font color=#653760>-fg</font> <font color=#1b1baa>$fg</font> <font color=#653760>-text</font> <font color=#1b1baa>$fg</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::RedrawFinalColor</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Combines the intensities of the three colors into the final color</font></i>
<i><font color=#4b5d50>#<a id=color::RedrawFinalColor></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::RedrawFinalColor {w} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>set</font></b> color [<b><font color=#3a6797>format</font></b> <font color=#8b2a0e>&quot;#%02x%02x%02x&quot;</font> <font color=#1b1baa>$data(red,intensity)</font> \
    <font color=#1b1baa>$data(green,intensity)</font> <font color=#1b1baa>$data(blue,intensity)</font>]

  <i><font color=#4b5d50>#$data(finalCanvas) configure -bg $color</font></i>
  <b><font color=#3a6797>set</font></b> fg [InvertBg <font color=#1b1baa>$data(red,intensity)</font> <font color=#1b1baa>$data(green,intensity)</font> <font color=#1b1baa>$data(blue,intensity)</font>]
  <font color=#1b1baa>$data(finalCanvas)</font> configure <font color=#653760>-bg</font> <font color=#1b1baa>$color</font> <font color=#653760>-fg</font> <font color=#1b1baa>$fg</font> <font color=#653760>-text</font> <font color=#1b1baa>$fg</font> <font color=#653760>-font</font> {<font color=#653760>-weight</font> bold}
  <b><font color=#3a6797>set</font></b> data(idxFinalColor) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$fg</font> ne <font color=#8b2a0e>&quot;#000000&quot;</font>}]
  <b><font color=#3a6797>set</font></b> data(finalColor) <font color=#1b1baa>$color</font>
  <b><font color=#3a6797>set</font></b> data(selection) <font color=#1b1baa>$color</font>
  <b><font color=#3a6797>set</font></b> data(finalRGB) [<b><font color=#3a6797>list</font></b> \
    <font color=#1b1baa>$data(red,intensity)</font> \
    <font color=#1b1baa>$data(green,intensity)</font> \
    <font color=#1b1baa>$data(blue,intensity)</font>]
}

<i><font color=#4b5d50># ::tk::dialog::color::RedrawColorBars --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Only redraws the colors on the color strips that were not manipulated.</font></i>
<i><font color=#4b5d50># Params: color of colorstrip that changed. If color is not [red|green|blue]</font></i>
<i><font color=#4b5d50>#         Then all colorstrips will be updated</font></i>
<i><font color=#4b5d50>#<a id=color::RedrawColorBars></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::RedrawColorBars {w colorChanged} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>switch</font></b> <font color=#1b1baa>$colorChanged</font> {
    red {
      DrawColorScale <font color=#1b1baa>$w</font> green
      DrawColorScale <font color=#1b1baa>$w</font> blue
    }
    green {
      DrawColorScale <font color=#1b1baa>$w</font> red
      DrawColorScale <font color=#1b1baa>$w</font> blue
    }
    blue {
      DrawColorScale <font color=#1b1baa>$w</font> red
      DrawColorScale <font color=#1b1baa>$w</font> green
    }
    <b><font color=#3a6797>default</font></b> {
      DrawColorScale <font color=#1b1baa>$w</font> red
      DrawColorScale <font color=#1b1baa>$w</font> green
      DrawColorScale <font color=#1b1baa>$w</font> blue
    }
  }
  RedrawFinalColor <font color=#1b1baa>$w</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::DrawOthers</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Draws other selectors if the &quot;Move all&quot; mode is set</font></i>
<i><font color=#4b5d50>#<a id=color::DrawOthers></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::DrawOthers {w color} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tk::dialog::color::moveall</font>} {
    <b><font color=#3a6797>set</font></b> dif1 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data($color,intensity)</font> - <font color=#1b1baa>$data($color,stickypos)</font>}]
    <b><font color=#3a6797>foreach</font></b> c {red green blue} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c</font>!=<font color=#1b1baa>$color</font> && [<b><font color=#3a6797>set</font></b> pos1 <font color=#1b1baa>$data($c,stickypos)</font>] &gt; -1} {
        <b><font color=#3a6797>set</font></b> intens [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$pos1</font> + <font color=#1b1baa>$dif1</font>}]
        <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,intensity) [<b><font color=#3a6797>expr</font></b> {max(0,min(255,<font color=#1b1baa>$intens</font>))}]
        RedrawColorBars <font color=#1b1baa>$w</font> <font color=#1b1baa>$c</font>
      }
    }
  }
}

<i><font color=#4b5d50># ::tk::dialog::color::StickSelectors</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Saves (sticks) all selectors' positions</font></i>
<i><font color=#4b5d50># in order to restore (unstick) them if possible</font></i>
<i><font color=#4b5d50>#<a id=color::StickSelectors></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::StickSelectors {w {clear 0}} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tk::dialog::color::moveall</font>} {
    <b><font color=#3a6797>foreach</font></b> c {red green blue} {
      <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,stickypos) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$clear</font> ? -1 : <font color=#1b1baa>$data($c,intensity)</font>}]
    }
  }
}

<i><font color=#4b5d50># ::tk::dialog::color::LittleSwatch</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Swatching a color</font></i>
<i><font color=#4b5d50>#<a id=color::LittleSwatch></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::LittleSwatch {w e c} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$e</font> <font color=#1b1baa>$c</font>
  HandleSelEntry <font color=#1b1baa>$w</font>
}

<i><font color=#4b5d50>#----------------------------------------------------------------------</font></i>
<i><font color=#4b5d50>#            Event handlers</font></i>
<i><font color=#4b5d50>#----------------------------------------------------------------------</font></i>

<i><font color=#4b5d50># ::tk::dialog::color::StartMove --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Handles a mousedown button event over the selector polygon.</font></i>
<i><font color=#4b5d50>#    Adds the bindings for moving the mouse while the button is</font></i>
<i><font color=#4b5d50>#    pressed.  Sets the binding for the button-release event.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Params: sel is the selector canvas window, color is the color of the strip.</font></i>
<i><font color=#4b5d50>#<a id=color::StartMove></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::StartMove {w sel color x delta {dontMove 0}} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  StickSelectors <font color=#1b1baa>$w</font>
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$dontMove</font>} {
    MoveSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$x</font> <font color=#1b1baa>$delta</font>
  }
}

<i><font color=#4b5d50># ::tk::dialog::color::MoveSelector --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Moves the polygon selector so that its middle point has the same</font></i>
<i><font color=#4b5d50># x value as the specified x. If x is outside the bounds [0,255],</font></i>
<i><font color=#4b5d50># the selector is set to the closest endpoint.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Params: sel is the selector canvas, c is [red|green|blue]</font></i>
<i><font color=#4b5d50>#         x is a x-coordinate.</font></i>
<i><font color=#4b5d50>#<a id=color::MoveSelector></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::MoveSelector {w sel color x delta} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>incr</font></b> x -<font color=#1b1baa>$delta</font>

  <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x</font> &lt; 0 } {
    <b><font color=#3a6797>set</font></b> x 0
  } <b><font color=#3a6797>elseif</font></b> { <font color=#1b1baa>$x</font> &gt; <font color=#1b1baa>$data(BARS_WIDTH)</font>} {
    <b><font color=#3a6797>set</font></b> x <font color=#1b1baa>$data(BARS_WIDTH)</font>
  }
  <b><font color=#3a6797>set</font></b> diff [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x</font> - <font color=#1b1baa>$data($color,x)</font> + 1}]
  <font color=#1b1baa>$sel</font> move <font color=#1b1baa>$data($color,index)</font> <font color=#1b1baa>$diff</font> 0
  <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$color</font>,x) [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data($color,x)</font> + <font color=#1b1baa>$diff</font>}]

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tk::dialog::color::tonemoves</font>} {
    <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$color</font>,intensity) [XToRgb <font color=#1b1baa>$w</font> <font color=#1b1baa>$x</font>]
    RedrawColorBars <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font>
    <i><font color=#4b5d50># Move other selectors if &quot;Move all&quot; mode is set</font></i>
    DrawOthers <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font>
  }

  <i><font color=#4b5d50># Return the x value that it was actually set at</font></i>
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$x</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::ReleaseMouse</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Removes mouse tracking bindings, updates the colorbars.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Params: sel is the selector canvas, color is the color of the strip,</font></i>
<i><font color=#4b5d50>#         x is the x-coord of the mouse.</font></i>
<i><font color=#4b5d50>#<a id=color::ReleaseMouse></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::ReleaseMouse {w sel color x delta} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>set</font></b> x [MoveSelector <font color=#1b1baa>$w</font> <font color=#1b1baa>$sel</font> <font color=#1b1baa>$color</font> <font color=#1b1baa>$x</font> <font color=#1b1baa>$delta</font>]

  <i><font color=#4b5d50># Determine exactly what color we are looking at.</font></i>
  <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$color</font>,intensity) [XToRgb <font color=#1b1baa>$w</font> <font color=#1b1baa>$x</font>]
  RedrawColorBars <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font>

  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$::tk::dialog::color::tonemoves</font>} {
    DrawOthers <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font>
  }
  StickSelectors <font color=#1b1baa>$w</font>

  HandleSelEntry <font color=#1b1baa>$w</font>
}
<i><font color=#4b5d50># ::tk::dialog::color::ResizeColorbars --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Completely redraws the colorbars, including resizing the</font></i>
<i><font color=#4b5d50>#    colorstrips</font></i>
<i><font color=#4b5d50>#<a id=color::ResizeColorBars></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::ResizeColorBars {w} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$data(BARS_WIDTH)</font> &lt; <font color=#1b1baa>$data(NUM_COLORBARS)</font>) ||
  ((<font color=#1b1baa>$data(BARS_WIDTH)</font> % <font color=#1b1baa>$data(NUM_COLORBARS)</font>) != 0)} {
    <b><font color=#3a6797>set</font></b> data(BARS_WIDTH) <font color=#1b1baa>$data(NUM_COLORBARS)</font>
  }
  InitValues [<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>]
  <b><font color=#3a6797>foreach</font></b> color {red green blue} {
    <font color=#1b1baa>$data($color,col)</font> configure <font color=#653760>-width</font> <font color=#1b1baa>$data(canvasWidth)</font>
    DrawColorScale <font color=#1b1baa>$w</font> <font color=#1b1baa>$color</font> 1
  }
}

<i><font color=#4b5d50># ::tk::dialog::color::HandleSelEntry --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Handles the return keypress event in the &quot;Selection:&quot; entry</font></i>
<i><font color=#4b5d50>#<a id=color::HandleSelEntry></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::HandleSelEntry {w} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  StickSelectors <font color=#1b1baa>$w</font> 1
  <b><font color=#3a6797>set</font></b> text [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$data(selection)</font>]
  <i><font color=#4b5d50># Check to make sure that the color is valid</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> color [<b><font color=#134070>winfo</font></b> rgb . <font color=#1b1baa>$text</font>]} ]} {
    <b><font color=#3a6797>set</font></b> data(selection) <font color=#1b1baa>$data(finalColor)</font>
    <b><font color=#ca14ca>return</font></b>
  }

  <b><font color=#3a6797>set</font></b> R [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$color</font> 0]/0x100}]
  <b><font color=#3a6797>set</font></b> G [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$color</font> 1]/0x100}]
  <b><font color=#3a6797>set</font></b> B [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$color</font> 2]/0x100}]

  SetRGBValue <font color=#1b1baa>$w</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>R <font color=#1b1baa>$</font>G <font color=#1b1baa>$</font>B&quot;</font>
  <b><font color=#3a6797>set</font></b> data(selection) <font color=#1b1baa>$text</font>
}

<i><font color=#4b5d50># ::tk::dialog::color::HandleRGBEntry --</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#    Handles the return keypress event in the R, G or B entry</font></i>
<i><font color=#4b5d50>#<a id=color::HandleRGBEntry></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::HandleRGBEntry {w} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data

  StickSelectors <font color=#1b1baa>$w</font> 1
  <b><font color=#3a6797>foreach</font></b> c {red green blue} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {
      <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,intensity) [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$data($c,intensity)</font>)}]
    }]} {
      <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,intensity) 0
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data($c,intensity)</font> &lt; 0} {
      <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,intensity) 0
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data($c,intensity)</font> &gt; 255} {
      <b><font color=#3a6797>set</font></b> data(<font color=#1b1baa>$c</font>,intensity) 255
    }
  }
  SetRGBValue <font color=#1b1baa>$w</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>data(red,intensity) \</font>
<font color=#8b2a0e>  <font color=#1b1baa>$</font>data(green,intensity) <font color=#1b1baa>$</font>data(blue,intensity)&quot;</font>
}

<i><font color=#4b5d50># mouse cursor enters/leaves a color bar</font></i>
<i><font color=#4b5d50>#<a id=color::EnterLeaveColorBar></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::EnterLeaveColorBar {w color fill} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <font color=#1b1baa>$data($color,sel)</font> itemconfigure <font color=#1b1baa>$data($color,index)</font> <font color=#653760>-fill</font> <font color=#1b1baa>$fill</font>
}

<i><font color=#4b5d50># user hits &quot;From clipboard&quot; button</font></i>
<i><font color=#4b5d50>#<a id=color::OkCmd0></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::OkCmd0 {w {clb <font color=#8b2a0e>&quot;&quot;</font>}} {
  <b><font color=#3a6797>set</font></b> mainentry <font color=#8b2a0e>&quot;.<font color=#1b1baa>[</font>winfo name <font color=#1b1baa>$</font>w<font color=#1b1baa>]</font>.top.sel.ent&quot;</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clb</font> eq <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> clb [<b><font color=#134070>clipboard</font></b> get]}]} <b><font color=#ca14ca>return</font></b>
  }
  <i><font color=#4b5d50># try #RGB and RGB</font></i>
  <b><font color=#3a6797>foreach</font></b> c {<font color=#8b2a0e>&quot;&quot;</font> <font color=#8b2a0e>&quot;#&quot;</font>} {
    <b><font color=#3a6797>catch</font></b> {
      <font color=#1b1baa>$mainentry</font> delete 0 end
      <font color=#1b1baa>$mainentry</font> insert 0 <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>c<font color=#1b1baa>$</font>clb&quot;</font>
      tk::dialog::color::HandleSelEntry <font color=#1b1baa>$w</font>
    }
  }
}

<i><font color=#4b5d50># user hits &quot;Loupe&quot; button</font></i>
<i><font color=#4b5d50>#<a id=color::Loupe></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::Loupe {w} {
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(-inifile)</font> ne {}} {
    <b><font color=#3a6797>set</font></b> inifile [<b><font color=#3a6797>list</font></b> <font color=#653760>-inifile</font> <font color=#1b1baa>$data(-inifile)</font>]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> inifile []
  }
  ::aloupe::run <font color=#653760>-exit</font> no <font color=#653760>-parent</font> <font color=#1b1baa>$w</font> <font color=#653760>-commandname</font> [mc <font color=#8b2a0e>&quot;Color&quot;</font>] \
    <font color=#653760>-command</font> <font color=#8b2a0e>&quot;::tk::dialog::color::OkCmd0 <font color=#1b1baa>$</font>w %c&quot;</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$inifile</font>
}

<i><font color=#4b5d50># user hits OK button</font></i>
<i><font color=#4b5d50>#<a id=color::OkCmd></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::OkCmd {w} {
  <b><font color=#3a6797>variable</font></b> ::tk::Priv
  <b><font color=#3a6797>upvar</font></b> ::tk::dialog::color::[<b><font color=#134070>winfo</font></b> name <font color=#1b1baa>$w</font>] data
  <b><font color=#3a6797>set</font></b> Priv(selectColor) <font color=#1b1baa>$data(finalColor)</font>
}

<i><font color=#4b5d50># user hits Cancel button or destroys window</font></i>
<i><font color=#4b5d50>#<a id=color::CancelCmd></a></font></i>
<b><font color=#ca14ca>proc</font></b> ::tk::dialog::color::CancelCmd {w} {
  <b><font color=#3a6797>variable</font></b> ::tk::Priv
  <b><font color=#3a6797>set</font></b> Priv(selectColor) <font color=#8b2a0e>&quot;&quot;</font>
}<a id=EOF></a>
<i><font color=#4b5d50># _________________________________ EOF _________________________________ #</font></i>
<i><font color=#4b5d50>#RUNF1: ~/PG/github/pave/tests/test2_pave.tcl 23 9 12 &quot;small icons&quot;</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../../../index.html"><font color=#1a1a1a size=6>  <b>clrpick.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Document generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>