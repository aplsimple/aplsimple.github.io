<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>
<link rel="stylesheet" href="../../../css/style.css">

<title>klnd2.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../../../index.html"><font color=#1a1a1a size=6>  <b>README.md</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">klnd2.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#klnd2.tcl">&nbsp;&nbsp;klnd2.tcl</a></b></li>
<li><b><a href="#my">my</a></b></li>
<li><b><a href="#Go_month/year">&nbsp;&nbsp;Go month/year</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#my::IsDay2">IsDay2</a><span class=tooltiptext> my::IsDay2 : Check if a button shows a day.
obj - index of calendar
i - button index</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::GoYear2">GoYear2</a><span class=tooltiptext> my::GoYear2 : Shifts the year backward/forward.
obj - index of calendar
i - increment for the current year
dobreak - yes when called from 'bind'</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::GoMonth2">GoMonth2</a><span class=tooltiptext> my::GoMonth2 : Shifts the month backward/forward.
obj - index of calendar
i - increment for the current month
dobreak - yes when called from 'bind'</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::fgMayHL">fgMayHL</a><span class=tooltiptext> my::fgMayHL : Gets a foreground color (possibly highlighting).
fg - default foreground color
y - year
m - month
d - day</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::ShowMonth2">ShowMonth2</a><span class=tooltiptext> my::ShowMonth2 : Displays a month's days.
obj - index of calendar
m - month
y - year
doenter - yes, if perform Enter2 proc
dopopup - yes, if bind a popup menu</span></div></li></ul>
<li><b><a href="#Current_day">&nbsp;&nbsp;Current day</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#my::SetCurrentDay2">SetCurrentDay2</a><span class=tooltiptext> my::SetCurrentDay2 : Goes to the current date.
obj - index of calendar</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::HighlightCurrentDay2">HighlightCurrentDay2</a><span class=tooltiptext> my::HighlightCurrentDay2 : Highlights the current day's button.
obj - index of calendar</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::FormatDay2">FormatDay2</a><span class=tooltiptext> my::FormatDay2 : Gets a date formatted according to a current format.
obj - index of calendar
y - year of the date
m - month of the date
d - day of the date</span></div></li></ul>
<li><b><a href="#Event_handlers">&nbsp;&nbsp;Event handlers</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#my::Enter2">Enter2</a><span class=tooltiptext> my::Enter2 : Highlights a button and makes it current.
obj - index of calendar
i - button index
focusin - yes, if the button is clicked and focused</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::BindButtons2">BindButtons2</a><span class=tooltiptext> my::BindButtons2 : Binds events to buttons of a calendar.
obj - index of calendar</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#my::ButtonTip">ButtonTip</a><span class=tooltiptext> my::ButtonTip : Gets a button's tip.
obj - index of calendar
tipcom - a caller's command returning a tip
w - current day button's path
The tipcom command can include wildcards:
%W - a current day button's path
%D - a current day's value as Y/M/D</span></div></li></ul>
<li><b><a href="#Widgets">&nbsp;&nbsp;Widgets</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#my::MainWidgets2">MainWidgets2</a><span class=tooltiptext> my::MainWidgets2 : Forms main widgets of calendar.
obj - index of calendar
ownname - frame for calendar</span></div></li></ul>
<li><b><a href="#UI">UI</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#klnd::labelPath">labelPath</a><span class=tooltiptext> klnd::labelPath : Gets a title label path.
obj - index of the calendar
Useful to change the label's attributes.
If *obj* omitted, returns a path of last created label.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#klnd::blinking">blinking</a><span class=tooltiptext> klnd::blinking : Makes a calendar label blink.
doit - if yes, starts blinking, else stops it</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#klnd::update">update</a><span class=tooltiptext> klnd::update : Redraws a calendar.
obj - index of the calendar
year - year to redraw
month - month to redraw</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#klnd::selectedDay">selectedDay</a><span class=tooltiptext> klnd::selectedDay : Gets a selected day.
obj - index of the calendar
y - year
m - month
d - day
doblink - if yes, make the month blink
If y/m/d are set, they define currently selected date.
Returns a list of year, month, day</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#klnd::getDaylist">getDaylist</a><span class=tooltiptext> klnd::getDaylist : Gets a day list which was set initially and possibly changed by a user.
pobj - apave object
min - minimal index of calendar widget
max - maximal index of calendar widget
The pobj is the same as passed to klnd::calendar2.
See also: calendar2</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#klnd::calendar2">calendar2</a><span class=tooltiptext> klnd::calendar2 : The main procedure of the calendar embedded widget.
pobj - apave object
w - container widget for *ownname*
ownname - frame widget for calendar
args - options of the calendar
Returns a list of widgets for apave layout.</span></div></li></ul>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->

The <i><font color=#1b1baa>klnd</font></i> package provides a calendar widget to use along with <a href="../pave/index.html">apave</a> package.
</p><p>
  Features:
</p><p>
<li>displays localized days' and months' names</li>
<li>gets a chosen day through <code><font color=#653760>-value</font></code> or <code><font color=#653760>-tvar</font></code> (variable name) option</li>
<li>uses arrow keys to navigate through days, months and years</li>
<li>provides hot keys to navigate through months and years</li>
<li>provides buttons to navigate through months and years</li>
<li>provides a button and a hot key to set a current date</li>
<li>buttons' tips</li>
<li>shown at +X+Y coordinates / under a widget / in a parent's center / in a screen's center or under the mouse pointer</li>
<li>customizable title, date format, first week day (Sunday/Monday)</li>
<li>themeable (with ttk and <a href="../pave/index.html">apave</a> themes)</li>
<li>may be a modal (by default) or non-modal window</li>
</p><p>
  The calendar looks like this:
</p><p>
  <img src="../pave/files/widgdat2.png" class="media" alt="">
</p><p>
<h1><font color=#ca14ca> Synopsis</font></h1>
</p><p>
  To directly call the calendar, use the following commands:
<pre class="code"><b><font color=#3a6797>package</font></b> require klnd
klnd::calendar ?-option value ... ?

<i><font color=#4b5d50># or this way</font></i>
<b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::apaveDir</font> pickers klnd klnd.tcl]
klnd::calendar ?-option value ... ?</pre>  where <code><font color=#653760>-option</font></code> may be:
<pre class="code"><font color=#653760>-value</font> - sets an input date (omittable)
<font color=#653760>-tvar</font> - sets a variable name to hold the input/output value (omittable)
<font color=#653760>-dateformat</font> - sets the input/output date format (%D by default)
<font color=#653760>-weekday</font> - sets a first week day: %w for Sunday, %u for Monday (default)
<font color=#653760>-modal</font> - `yes` if the calendar should be a modal window (default)
<font color=#653760>-title</font> - sets the calendar's title
<font color=#653760>-geometry</font> - sets the calendar's geometry
<font color=#653760>-entry</font> - sets a widget's path to show the calendar under
<font color=#653760>-parent</font> - sets a parent toplevel window to center the calendar in
<font color=#653760>-centerme</font> - `yes` if the calendar should be centered in the screen</pre>  If <code><font color=#653760>-value</font></code> and <code><font color=#653760>-tvar</font></code> options are both set, the <code><font color=#653760>-tvar</font></code> is preferred. If both omitted, a current system date is used as input.
</p><p>
  The calendar returns a chosen date (setting also the <code><font color=#653760>-tvar</font></code> variable if any) or "" at no choice.
</p><p>
  The priority of geometry options: <code><font color=#653760>-geometry</font>, <font color=#653760>-entry</font>, <font color=#653760>-parent</font>, <font color=#653760>-centerme</font></code>. At no geometry option given, the calendar is shown under the mouse pointer.
</p><p>
  The <code><font color=#653760>-parent</font></code> option may be used along with <code><font color=#653760>-geometry</font>, <font color=#653760>-entry</font></code>, as it allows a child window to inherit the parent's attributes.
</p><p>
<h1><font color=#ca14ca> Hot keys</font></h1>
</p><p>
  The calendar provides the hotkeys Left, Right, Up, Down, PageUp, PageDown, Home, End and F3 to navigate through days, months and years.
</p><p>
  The Enter / Space keys or Double-Click are used to pick a date.
</p><p>
<h1><font color=#ca14ca> Usage in apave package</font></h1>
</p><p>
  With <a href="../pave/index.html">apave</a> package, the calendar can be used in two forms: <em>date picker</em> and <em>embedded calendar</em>:
</p><p>
<li><em>date picker</em> presents an entry field to hold an input/output date and a button to choose a date from the picker</li>
</p><p>
<li><em>embedded calendar</em> presents a full set of widgets to display a selected month of year</li>
</p><p>
  An example of using <em>date picker</em> for <a href="../pave/index.html">apave</a> layout:
<pre class="code">{dat1 labDat1 L 1 1 {} {<font color=#653760>-tvar</font> ::N::dat1 <font color=#653760>-title</font> {Date of the event} <font color=#653760>-dateformat</font> %d.%m.%Y <font color=#653760>-weekday</font> %w}}</pre>  This example includes <code><font color=#653760>-tvar</font></code> option meaning a variable name to hold the date.
</p><p>
The <em>embedded calendar</em> differs from this with <code>daT</code> type of widget used instead of <code>dat</code>. Also, this form of calendar doesn't allow using the keyboard; only the mouse is used in it.
</p><p>
  The below example is taken from <a href="../alited/index.html">alited</a>'s source:
<pre class="code">{.daT - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-fill</font> both} {<font color=#653760>-tvar</font> alited::project::klnddata(date) <font color=#653760>-com</font> {alited::project::KlndUpdate} <font color=#653760>-dateformat</font> <font color=#1b1baa>$alited::project::klnddata(dateformat)</font> <font color=#653760>-tip</font> {alited::project::KlndTip %W %D}}}</pre>  This example includes <code><font color=#653760>-com</font></code> option to run a command at clicking a day. This command can use <code>::klnd::update</code> to highlight some days in the calendar. In <a href="../alited/index.html">alited</a> these days contain  reminders of TODOs being dead-lines.
</p><p>
  Options of embedded calendar:
<pre class="code"><font color=#653760>-com</font>, <font color=#653760>-command</font> - a command to run at left-click
<font color=#653760>-popup</font> - a command to run at right-click
<font color=#653760>-currentmonth</font> - a current month to display, in form of <font color=#8b2a0e>&quot;year/month&quot;</font>
<font color=#653760>-united</font> - if yes, means <font color=#8b2a0e>&quot;united&quot;</font> calendars
<font color=#653760>-daylist</font> - a list of selected days for <font color=#8b2a0e>&quot;united&quot;</font> calendars
<font color=#653760>-hllist</font> - a list of highlighted days
<font color=#653760>-tip</font> - a command to get a day's tip</pre>A command of <code><font color=#653760>-com</font>, <font color=#653760>-command</font>, <font color=#653760>-popup</font></code> options can use wildcards: <code>%y</code>, <code>%m</code>, <code>%d</code> for year, month, day, <code>%X</code>, <code>%Y</code> for mouse pointer's coordinates.
</p><p>
A command of <code><font color=#653760>-tip</font></code> option can use wildcards: <code>%W</code> for a day widget's path, <code>%D</code> for a day.
</p><p>
  UI procedures of embedded calendar:
</p><p>
<li><code>::klnd::labelPath</code> - gets a title label's path, to change its attributes</li>
<li><code>::klnd::selectedDay</code> - gets a selected day</li>
<li><code>::klnd::getDaylist</code> - gets a list of selected days (for united calendars)</li>
<li><code>::klnd::update</code> - redraws a calendar for a month</li>
</p><p>
  The procedures use <code>obj</code> argument, which is just an index of a calendar (beginning with 1). If omitted or equal to {}, <code>obj</code> means a last created calendar.
</p><p>
  The multiple embedded calendars may be united with <code><font color=#653760>-united</font> yes</code> option, so that a user can select a list of days inside them.
</p><p>

</p>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../../../index.html"><font color=#1a1a1a size=6>  <b>klnd2.tcl</b></font></div></td></table>

<pre class="code"><i><font color=#4b5d50>###########################################################<a id=klnd2.tcl></a></font></i>
<i><font color=#4b5d50># Name:    klnd2.tcl</font></i>
<i><font color=#4b5d50># Author:  Alex Plotnikov  (aplsimple@gmail.com)</font></i>
<i><font color=#4b5d50># Date:    01/18/2022</font></i>
<i><font color=#4b5d50># Brief:   Handles calendar widget for apave package.</font></i>
<i><font color=#4b5d50># License: MIT.</font></i>
<i><font color=#4b5d50>###########################################################</font></i>

<b><font color=#3a6797>package</font></b> require Tk
<a id=my></a>
<i><font color=#4b5d50># ________________________ my _________________________ #</font></i>

<b><font color=#ca14ca>namespace</font></b> eval ::klnd {
  <b><font color=#3a6797>namespace</font></b> export calendar2
  <b><font color=#ca14ca>namespace</font></b> eval my {}
}
<a id=Go_month/year></a>
<i><font color=#4b5d50>## ________________________ Go month/year _________________________ ##</font></i>
<a id=my::IsDay2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::IsDay2 {obj i} {
  <i><font color=#4b5d50># Check if a button shows a day.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   i - button index</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {![<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> w [<font color=#1b1baa>$p($obj)</font> BuT<font color=#1b1baa>$obj</font>-<font color=#1b1baa>${i}</font>KLND]}] && \
    [<b><font color=#3a6797>string</font></b> length [TrimN [<font color=#1b1baa>$w</font> cget <font color=#653760>-text</font>]]]}]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::GoYear2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::GoYear2 {obj i {dobreak no}} {
  <i><font color=#4b5d50># Shifts the year backward/forward.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   i - increment for the current year</font></i>
  <i><font color=#4b5d50>#   dobreak - yes when called from 'bind'</font></i>

  <b><font color=#3a6797>variable</font></b> p
  ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(mvis$obj)</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$p(yvis$obj)</font>+(<font color=#1b1baa>$i</font>)}] yes yes
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dobreak</font>} {<b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> break}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::GoMonth2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::GoMonth2 {obj i {dobreak no}} {
  <i><font color=#4b5d50># Shifts the month backward/forward.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   i - increment for the current month</font></i>
  <i><font color=#4b5d50>#   dobreak - yes when called from 'bind'</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>set</font></b> m [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$p(mvis$obj)</font>+(<font color=#1b1baa>$i</font>)}]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$m</font>&gt;12} {<b><font color=#3a6797>set</font></b> m 1; <b><font color=#3a6797>incr</font></b> p(yvis<font color=#1b1baa>$obj</font>)}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$m</font>&lt;1} {<b><font color=#3a6797>set</font></b> m 12; <b><font color=#3a6797>incr</font></b> p(yvis<font color=#1b1baa>$obj</font>) -1}
  ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$p(yvis$obj)</font> yes yes
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dobreak</font>} {<b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> break}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::fgMayHL></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::fgMayHL {obj fg y m d} {
  <i><font color=#4b5d50># Gets a foreground color (possibly highlighting).</font></i>
  <i><font color=#4b5d50>#   fg - default foreground color</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   d - day</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>foreach</font></b> item <font color=#1b1baa>$p(hllist$obj)</font> {
    <i><font color=#4b5d50># date format for highlighting is %Y/%m/%d</font></i>
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$item</font> 0] /] yh mh dh
    <b><font color=#3a6797>set</font></b> dh [TrimN <font color=#1b1baa>$dh</font>]
    <b><font color=#3a6797>set</font></b> mh [TrimN <font color=#1b1baa>$mh</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$y</font>==<font color=#1b1baa>$yh</font> && <font color=#1b1baa>$m</font>==<font color=#1b1baa>$mh</font> && <font color=#1b1baa>$d</font>==<font color=#1b1baa>$dh</font>} {
      <b><font color=#3a6797>set</font></b> fg red
      <b><font color=#ca14ca>break</font></b>
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$fg</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::ShowMonth2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::ShowMonth2 {obj m y {doenter yes} {dopopup no}} {
  <i><font color=#4b5d50># Displays a month's days.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   doenter - yes, if perform Enter2 proc</font></i>
  <i><font color=#4b5d50>#   dopopup - yes, if bind a popup menu</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {max(<font color=#1b1baa>$y</font>,[::klnd::minYear])}]
  <b><font color=#3a6797>set</font></b> m [TrimN <font color=#1b1baa>$m</font>]
  <i><font color=#4b5d50># if calendars are linked with united, no display of year in a title</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(united$obj)</font>} {<b><font color=#3a6797>set</font></b> yd {}} {<b><font color=#3a6797>set</font></b> yd <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>y&quot;</font>}
  [<font color=#1b1baa>$p($obj)</font> LabMonth<font color=#1b1baa>$obj</font>] configure <font color=#653760>-text</font>  <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>lindex <font color=#1b1baa>$</font>p(months<font color=#1b1baa>$</font>obj) <font color=#1b1baa>[</font>expr <font color=#1b1baa>{$</font>m-1<font color=#1b1baa>}]]$</font>yd&quot;</font> \
    <font color=#653760>-font</font> [::apave::obj boldDefFont [<b><font color=#3a6797>expr</font></b> {[::apave::obj basicFontSize]+2}]]
  <i><font color=#4b5d50># highlight color</font></i>
  <b><font color=#3a6797>set</font></b> hlcolor red ;<i><font color=#4b5d50>#[lindex [::apave::obj csGet] 17]</font></i>
  <i><font color=#4b5d50># display day names</font></i>
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;8} {<b><font color=#3a6797>incr</font></b> i} {
    [<font color=#1b1baa>$p($obj)</font> LabDay<font color=#1b1baa>$obj$i</font>] configure <font color=#653760>-text</font> <font color=#8b2a0e>&quot; <font color=#1b1baa>[</font>lindex <font color=#1b1baa>$</font>p(days<font color=#1b1baa>$</font>obj) <font color=#1b1baa>$</font>i-1<font color=#1b1baa>]</font>&quot;</font>
  }
  <i><font color=#4b5d50># 1st day of the month's first week:</font></i>
  <b><font color=#3a6797>set</font></b> day1st [<b><font color=#3a6797>clock</font></b> scan <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>m/1/<font color=#1b1baa>$</font>y&quot;</font> <font color=#653760>-format</font> %D]
  <b><font color=#3a6797>set</font></b> i0 [<b><font color=#3a6797>clock</font></b> format <font color=#1b1baa>$day1st</font> <font color=#653760>-format</font> %w]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(weekday$obj)</font> eq {%u}} {<b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i0</font>} {<b><font color=#3a6797>incr</font></b> i0 -1} {<b><font color=#3a6797>set</font></b> i0 6}}
  <i><font color=#4b5d50># get the last day of month</font></i>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> yl <font color=#1b1baa>$y</font>] && [<b><font color=#3a6797>set</font></b> ml <font color=#1b1baa>$m</font>]==12} {<b><font color=#3a6797>set</font></b> ml 1; <b><font color=#3a6797>incr</font></b> yl}
  <b><font color=#3a6797>set</font></b> lday [<b><font color=#3a6797>clock</font></b> format [<b><font color=#3a6797>clock</font></b> scan <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>incr ml<font color=#1b1baa>]</font>/1/<font color=#1b1baa>$</font>yl 1 day ago&quot;</font>] <font color=#653760>-format</font> %d]
  <b><font color=#3a6797>set</font></b> iday [<b><font color=#3a6797>set</font></b> p(icurr<font color=#1b1baa>$obj</font>) 0]
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;38} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> fg <font color=#1b1baa>$p(fg1)</font>
    <b><font color=#3a6797>set</font></b> bg <font color=#1b1baa>$p(bg1)</font>
    <b><font color=#3a6797>set</font></b> wbut [<font color=#1b1baa>$p($obj)</font> BuT<font color=#1b1baa>$obj</font>-<font color=#1b1baa>${i}</font>KLND]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>&lt;=<font color=#1b1baa>$i0</font> || <font color=#1b1baa>$iday</font>&gt;=<font color=#1b1baa>$lday</font>} {
      <b><font color=#3a6797>set</font></b> ttl {   }
      <b><font color=#3a6797>set</font></b> att <font color=#8b2a0e>&quot;-takefocus 0 -activebackground <font color=#1b1baa>$</font>p(bg1) -overrelief flat&quot;</font>
      <b><font color=#3a6797>set</font></b> script {}
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> ttl [<b><font color=#3a6797>incr</font></b> iday]
      <b><font color=#3a6797>set</font></b> att <font color=#8b2a0e>&quot;-takefocus 0 -activeforeground <font color=#1b1baa>$</font>p(fg0) -activebackground <font color=#1b1baa>$</font>p(bg0) -overrelief raised&quot;</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doenter</font> && (<font color=#1b1baa>$iday</font>==<font color=#1b1baa>$p(dvis$obj)</font> || (<font color=#1b1baa>$iday</font>==<font color=#1b1baa>$lday</font> && <font color=#1b1baa>$iday</font>&lt;<font color=#1b1baa>$p(dvis$obj)</font>))} {
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$p(after$obj)</font>}
        <b><font color=#3a6797>set</font></b> p(after<font color=#1b1baa>$obj</font>) [<b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;::klnd::my::Enter2 <font color=#1b1baa>$</font>obj <font color=#1b1baa>$</font>i&quot;</font>]
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iday</font>==1} {<b><font color=#3a6797>set</font></b> p(d1st) <font color=#1b1baa>$i</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$y</font>==<font color=#1b1baa>$p(y)</font> && <font color=#1b1baa>$m</font>==<font color=#1b1baa>$p(m)</font> && <font color=#1b1baa>$iday</font>==<font color=#1b1baa>$p(d)</font>} {
        <b><font color=#3a6797>set</font></b> p(icurr<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$i</font>  ;<i><font color=#4b5d50># button's index of the current date</font></i>
      }
      <b><font color=#3a6797>set</font></b> dt [FormatDay2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$iday</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$p(daylist$obj)</font> <font color=#1b1baa>$dt</font>]&gt;-1} {
        <b><font color=#3a6797>set</font></b> fg <font color=#1b1baa>$p(fgsel)</font>
        <b><font color=#3a6797>set</font></b> bg <font color=#1b1baa>$p(bgsel)</font>
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$p(currentdate)</font> eq <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>y/<font color=#1b1baa>$</font>m/<font color=#1b1baa>$</font>iday&quot;</font>} {
        <b><font color=#3a6797>set</font></b> fg <font color=#1b1baa>$p(fg2)</font>
        <b><font color=#3a6797>set</font></b> bg <font color=#1b1baa>$p(bg2)</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dopopup</font>} {
        <b><font color=#3a6797>set</font></b> script [MapYMD <font color=#1b1baa>$p(popup$obj)</font> <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$iday</font>]
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dopopup</font> && <font color=#1b1baa>$p(popup$obj)</font> ne {}} {
      <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wbut</font> &lt;Button-3&gt; <font color=#1b1baa>$script</font>
    }
    <b><font color=#3a6797>lappend</font></b> ttls [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$ttl</font>]
    <i><font color=#4b5d50># as last refuge: highlighting fg by hllist</font></i>
    <b><font color=#3a6797>set</font></b> fg [fgMayHL <font color=#1b1baa>$obj</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$iday</font>]
    <font color=#1b1baa>$wbut</font> configure {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$att</font> <font color=#653760>-relief</font> flat <font color=#653760>-fg</font> <font color=#1b1baa>$fg</font> <font color=#653760>-bg</font> <font color=#1b1baa>$bg</font> <font color=#653760>-text</font> <font color=#1b1baa>$ttl</font>
  }
  <b><font color=#3a6797>set</font></b> wnums [WeekNumbers <font color=#1b1baa>$day1st</font> <font color=#1b1baa>$ttls</font>]
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;6} {} {
    <b><font color=#3a6797>set</font></b> wnum [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$wnums</font> <font color=#1b1baa>$i</font>]
    <b><font color=#3a6797>set</font></b> wbut [<font color=#1b1baa>$p($obj)</font> BuTW[<b><font color=#3a6797>incr</font></b> i]]
    <font color=#1b1baa>$wbut</font> configure {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$::klnd::TMPATTW</font> <font color=#653760>-text</font> <font color=#1b1baa>$wnum</font>
  }
  <b><font color=#3a6797>set</font></b> p(mvis<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$m</font>  ;<i><font color=#4b5d50># month & year currently visible</font></i>
  <b><font color=#3a6797>set</font></b> p(yvis<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$y</font>
}
<a id=Current_day></a>
<i><font color=#4b5d50>## ________________________ Current day _________________________ ##</font></i>
<a id=my::SetCurrentDay2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::SetCurrentDay2 {obj} {
  <i><font color=#4b5d50># Goes to the current date.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>set</font></b> p(dvis<font color=#1b1baa>$obj</font>) 0
  ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(m)</font> <font color=#1b1baa>$p(y)</font>
  Enter2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(icurr$obj)</font> 1
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::HighlightCurrentDay2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::HighlightCurrentDay2 {obj} {
  <i><font color=#4b5d50># Highlights the current day's button.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(currentmonth)</font> eq <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>p(yvis<font color=#1b1baa>$</font>obj)/<font color=#1b1baa>[</font>TrimN <font color=#1b1baa>$</font>p(mvis<font color=#1b1baa>$</font>obj)<font color=#1b1baa>]</font>&quot;</font>} {
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists p(wcurr<font color=#1b1baa>$obj</font>)]} {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> p(wcurr<font color=#1b1baa>$obj</font>) [<font color=#1b1baa>$p($obj)</font> BuT<font color=#1b1baa>$obj</font>-<font color=#1b1baa>$p(icurr$obj)</font>KLND]}
    }
    <b><font color=#3a6797>catch</font></b> {
      <b><font color=#3a6797>set</font></b> day [<font color=#1b1baa>$p(wcurr$obj)</font> cget <font color=#653760>-text</font>]
      <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$p(wcurr$obj)</font> cget <font color=#653760>-bg</font>] ne <font color=#1b1baa>$p(bgsel)</font> && [TrimN <font color=#1b1baa>$day</font>] ne {}} {
        <b><font color=#3a6797>set</font></b> fg [fgMayHL <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(fg2)</font> <font color=#1b1baa>$p(yvis$obj)</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$day</font>]
        <font color=#1b1baa>$p(wcurr$obj)</font> configure <font color=#653760>-fg</font> <font color=#1b1baa>$fg</font> <font color=#653760>-bg</font> <font color=#1b1baa>$p(bg2)</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(united$obj)</font>} {
        <i><font color=#4b5d50># if calendars are linked with united, one COMMON day selected for all</font></i>
        <b><font color=#3a6797>set</font></b> p(wcurrdate) <font color=#1b1baa>$p(wcurr$obj)</font>
      }
    }
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>info</font></b> exists p(wunited<font color=#1b1baa>$obj</font>)] && [<b><font color=#3a6797>info</font></b> exists p(wcurr<font color=#1b1baa>$obj</font>)] && \
      <font color=#1b1baa>$p(wunited$obj)</font> eq <font color=#1b1baa>$p(wcurr$obj)</font>}]
  }
  <b><font color=#ca14ca>return</font></b> no
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::FormatDay2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::FormatDay2 {obj y m d} {
  <i><font color=#4b5d50># Gets a date formatted according to a current format.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   y - year of the date</font></i>
  <i><font color=#4b5d50>#   m - month of the date</font></i>
  <i><font color=#4b5d50>#   d - day of the date</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>clock</font></b> format [<b><font color=#3a6797>clock</font></b> scan <font color=#1b1baa>$m</font>/<font color=#1b1baa>$d</font>/<font color=#1b1baa>$y</font> <font color=#653760>-format</font> %D] <font color=#653760>-format</font> <font color=#1b1baa>$p(dformat$obj)</font> <font color=#653760>-locale</font> <font color=#1b1baa>$p(loc$obj)</font>]
}
<a id=Event_handlers></a>
<i><font color=#4b5d50>## ________________________ Event handlers _________________________ ##</font></i>
<a id=my::Enter2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::Enter2 {obj i {focusin 0}} {
  <i><font color=#4b5d50># Highlights a button and makes it current.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   i - button index</font></i>
  <i><font color=#4b5d50>#   focusin - yes, if the button is clicked and focused</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> isday [IsDay2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$i</font>]}]} {<b><font color=#3a6797>set</font></b> isday no}
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$isday</font>} {<b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> break}
  <b><font color=#3a6797>set</font></b> w [<font color=#1b1baa>$p($obj)</font> BuT<font color=#1b1baa>$obj</font>-<font color=#1b1baa>${i}</font>KLND]
  <b><font color=#3a6797>set</font></b> p(dvis<font color=#1b1baa>$obj</font>) [<font color=#1b1baa>$w</font> cget <font color=#653760>-text</font>]
  <b><font color=#3a6797>set</font></b> date [FormatDay2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(yvis$obj)</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(dvis$obj)</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$focusin</font>} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(daylist$obj)</font> ne {-}} {
      <i><font color=#4b5d50># add/delete the date to/from the list of selected days</font></i>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> di [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$p(daylist$obj)</font> <font color=#1b1baa>$date</font>]]&gt;-1} {
        <b><font color=#3a6797>set</font></b> p(daylist<font color=#1b1baa>$obj</font>) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$p(daylist$obj)</font> <font color=#1b1baa>$di</font> <font color=#1b1baa>$di</font>]
        ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(yvis$obj)</font> no
        <b><font color=#ca14ca>return</font></b>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>lappend</font></b> p(daylist<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$date</font>
      }
    }
  }
  ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(yvis$obj)</font> no
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$focusin</font>} {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$p(tvar$obj)</font> <font color=#1b1baa>$date</font>}
    <b><font color=#3a6797>set</font></b> p(olddate<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$date</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(united$obj)</font>} {
      <i><font color=#4b5d50># if calendars are linked with united, unselect previously selected COMMON day</font></i>
      <i><font color=#4b5d50># and then highlight the current date</font></i>
      <b><font color=#3a6797>catch</font></b> {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(daylist$obj)</font> eq {-}} {
          <font color=#1b1baa>$p(wunited)</font> configure <font color=#653760>-fg</font> <font color=#1b1baa>$p(fg1)</font> <font color=#653760>-bg</font> <font color=#1b1baa>$p(bg1)</font>
        }
        <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$p(wcurr$obj)</font> cget <font color=#653760>-bg</font>] ne <font color=#1b1baa>$p(bgsel)</font>} {
          <b><font color=#3a6797>set</font></b> fg [fgMayHL <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(fg2)</font> <font color=#1b1baa>$p(yvis$obj)</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(dvis$obj)</font>]
          <font color=#1b1baa>$p(wcurr$obj)</font> configure <font color=#653760>-fg</font> <font color=#1b1baa>$fg</font> <font color=#653760>-bg</font> <font color=#1b1baa>$p(bg2)</font>
        }
      }
    }
  }
  <b><font color=#3a6797>set</font></b> p(ienter) <font color=#1b1baa>$i</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(tvar$obj)</font> ne {}} {
    <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$p(tvar$obj)</font> <font color=#1b1baa>$date</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(olddate$obj)</font> eq <font color=#1b1baa>$date</font>} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(daylist$obj)</font> ne {-}} {
        ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(yvis$obj)</font> no
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>catch</font></b> {
          <i><font color=#4b5d50># unselect previously selected day of THIS month</font></i>
          <b><font color=#3a6797>if</font></b> {![HighlightCurrentDay2 <font color=#1b1baa>$obj</font>]} {
            <font color=#1b1baa>$p(wunited$obj)</font> configure <font color=#653760>-fg</font> <font color=#1b1baa>$p(fg1)</font> <font color=#653760>-bg</font> <font color=#1b1baa>$p(bg1)</font>
          }
        }
        <i><font color=#4b5d50># show selected day</font></i>
        <b><font color=#3a6797>set</font></b> fg [fgMayHL <font color=#1b1baa>$obj</font> <font color=#1b1baa>$p(fgsel)</font> <font color=#1b1baa>$p(yvis$obj)</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(dvis$obj)</font>]
        <font color=#1b1baa>$w</font> configure <font color=#653760>-fg</font> <font color=#1b1baa>$fg</font> <font color=#653760>-bg</font> <font color=#1b1baa>$p(bgsel)</font>
      }
      <i><font color=#4b5d50># save the selected widget for THIS month</font></i>
      <i><font color=#4b5d50># and as COMMON for calendars linked with united</font></i>
      <b><font color=#3a6797>set</font></b> p(wunited<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$w</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(united$obj)</font>} {<b><font color=#3a6797>set</font></b> p(wunited) <font color=#1b1baa>$w</font>}
    }
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$focusin</font> && <font color=#1b1baa>$p(com$obj)</font> ne {}} {
    <b><font color=#3a6797>eval</font></b> [MapYMD <font color=#1b1baa>$p(com$obj)</font> <font color=#1b1baa>$p(yvis$obj)</font> <font color=#1b1baa>$p(mvis$obj)</font> <font color=#1b1baa>$p(dvis$obj)</font>]
  }
  HighlightCurrentDay2 <font color=#1b1baa>$obj</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::BindButtons2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::BindButtons2 {obj} {
  <i><font color=#4b5d50># Binds events to buttons of a calendar.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;38} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> but [<font color=#1b1baa>$p($obj)</font> BuT<font color=#1b1baa>$obj</font>-<font color=#1b1baa>${i}</font>KLND]
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$but</font> &lt;Button-1&gt; <font color=#8b2a0e>&quot;::klnd::my::Enter2 <font color=#1b1baa>$</font>obj <font color=#1b1baa>$</font>i 1&quot;</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=my::ButtonTip></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::ButtonTip {obj tipcom w} {
  <i><font color=#4b5d50># Gets a button's tip.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   tipcom - a caller's command returning a tip</font></i>
  <i><font color=#4b5d50>#   w - current day button's path</font></i>
  <i><font color=#4b5d50># The tipcom command can include wildcards:</font></i>
  <i><font color=#4b5d50>#   %W - a current day button's path</font></i>
  <i><font color=#4b5d50>#   %D - a current day's value as Y/M/D</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>set</font></b> res {}
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>set</font></b> y <font color=#1b1baa>$p(yvis$obj)</font>
    <b><font color=#3a6797>set</font></b> m <font color=#1b1baa>$p(mvis$obj)</font>
    <b><font color=#3a6797>set</font></b> d [TrimN [<font color=#1b1baa>$w</font> cget <font color=#653760>-text</font>]]
    <b><font color=#3a6797>set</font></b> d [<b><font color=#3a6797>clock</font></b> format [<b><font color=#3a6797>clock</font></b> scan <font color=#1b1baa>$m</font>/<font color=#1b1baa>$d</font>/<font color=#1b1baa>$y</font> <font color=#653760>-format</font> %D] <font color=#653760>-format</font> %Y/%m/%d]
    <b><font color=#3a6797>set</font></b> tipcom [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %W <font color=#1b1baa>$w</font> %D <font color=#1b1baa>$d</font>] <font color=#1b1baa>$tipcom</font>]
    <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>eval</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$tipcom</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<a id=Widgets></a>
<i><font color=#4b5d50>## ________________________ Widgets _________________________ ##</font></i>
<a id=my::MainWidgets2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::my::MainWidgets2 {obj ownname} {
  <i><font color=#4b5d50># Forms main widgets of calendar.</font></i>
  <i><font color=#4b5d50>#   obj - index of calendar</font></i>
  <i><font color=#4b5d50>#   ownname - frame for calendar</font></i>

  <b><font color=#3a6797>variable</font></b> p
  <b><font color=#3a6797>set</font></b> ::klnd::TMPTIP {}
  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(tip$obj)</font> ne {}} {
      <b><font color=#3a6797>set</font></b> tipcom [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$p(tip)</font>] ;<i><font color=#4b5d50># possible bad list</font></i>
      <b><font color=#3a6797>set</font></b> ::klnd::TMPTIP \
        <font color=#8b2a0e>&quot;-tip <font color=#1b1baa>{</font> -BALTIP %W -COMMAND <font color=#1b1baa>{</font>::klnd::my::ButtonTip <font color=#1b1baa>$</font>obj <font color=#1b1baa>{$</font>tipcom<font color=#1b1baa>}</font> %w<font color=#1b1baa>}</font> <font color=#1b1baa>}</font>&quot;</font>
    }
  }
  <b><font color=#3a6797>set</font></b> p(tipF3<font color=#1b1baa>$obj</font>) \
    <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>::msgcat::mc <font color=#1b1baa>{</font>Current date<font color=#1b1baa>}]</font>: \</font>
<font color=#8b2a0e>      <font color=#1b1baa>[</font>clock format <font color=#1b1baa>[</font>CurrentDate<font color=#1b1baa>]</font> -format <font color=#1b1baa>$</font>p(dformat<font color=#1b1baa>$</font>obj) -locale <font color=#1b1baa>$</font>p(loc<font color=#1b1baa>$</font>obj)<font color=#1b1baa>]</font>&quot;</font>
  <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.laB - - 1 10 <font color=#1b1baa>{</font>-st nsew<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-bg <font color=#1b1baa>$</font>p(bg1)<font color=#1b1baa>}</font>&quot;</font>]
  <i><font color=#4b5d50># if calendars are united, no display of tool bar</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(united$obj)</font>} {
    <b><font color=#3a6797>lappend</font></b> res \
      <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.laB.LabMonth<font color=#1b1baa>$</font>obj - - - - <font color=#1b1baa>{</font>pack -fill x -expand 1<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-anchor center -w 18<font color=#1b1baa>}</font>&quot;</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lappend</font></b> res \
    <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.laB.tool - - - - <font color=#1b1baa>{</font>pack -side top<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-array <font color=#1b1baa>{</font> \</font>
<font color=#8b2a0e>      IM_KLND_0 <font color=#1b1baa>{{</font>::klnd::my::SetCurrentDay2 <font color=#1b1baa>$</font>obj<font color=#1b1baa>}</font> -tip <font color=#1b1baa>{$</font>p(tipF3<font color=#1b1baa>$</font>obj)@@-under 5<font color=#1b1baa>}}</font> sev 3 \</font>
<font color=#8b2a0e>      IM_KLND_1 <font color=#1b1baa>{{</font>::klnd::my::GoYear2 <font color=#1b1baa>$</font>obj -1<font color=#1b1baa>}</font> -tip <font color=#1b1baa>{$</font>::klnd::my::prevY\n(Home)@@-under 5<font color=#1b1baa>}}</font> h_ 1 \</font>
<font color=#8b2a0e>      IM_KLND_2 <font color=#1b1baa>{{</font>::klnd::my::GoMonth2 <font color=#1b1baa>$</font>obj -1<font color=#1b1baa>}</font> -tip <font color=#1b1baa>{$</font>::klnd::my::prevM\n(PageUp)@@-under 5<font color=#1b1baa>}}</font> h_ 2 \</font>
<font color=#8b2a0e>      LabMonth<font color=#1b1baa>$</font>obj <font color=#1b1baa>{{}</font> <font color=#1b1baa>{</font>-fill x -expand 1<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-anchor center -w 18<font color=#1b1baa>}}</font> h_ 1 \</font>
<font color=#8b2a0e>      IM_KLND_3 <font color=#1b1baa>{{</font>::klnd::my::GoMonth2 <font color=#1b1baa>$</font>obj 1<font color=#1b1baa>}</font> -tip <font color=#1b1baa>{$</font>::klnd::my::nextM\n(PageDown)@@-under 5<font color=#1b1baa>}}</font> h_ 2 \</font>
<font color=#8b2a0e>      IM_KLND_4 <font color=#1b1baa>{{</font>::klnd::my::GoYear2 <font color=#1b1baa>$</font>obj 1<font color=#1b1baa>}</font> -tip <font color=#1b1baa>{$</font>::klnd::my::nextY\n(End)@@-under 5<font color=#1b1baa>}}</font> \</font>
<font color=#8b2a0e>    <font color=#1b1baa>}}</font>&quot;</font>
  }
  <b><font color=#3a6797>set</font></b> ::klnd::TMPATTW <font color=#8b2a0e>&quot;-font <font color=#1b1baa>{$</font>::apave::FONTMAIN<font color=#1b1baa>}</font> -padx 0 -pady 0 \</font>
<font color=#8b2a0e>    -activeforeground <font color=#1b1baa>$</font>p(fgh) -activebackground <font color=#1b1baa>$</font>p(bg1) -foreground <font color=#1b1baa>$</font>p(fgh) \</font>
<font color=#8b2a0e>    -relief flat -overrelief flat -takefocus 0 -highlightthickness 0 -width 2&quot;</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p(weeks)</font>} {<b><font color=#3a6797>set</font></b> ::klnd::TMPPACKW {}} {<b><font color=#3a6797>set</font></b> ::klnd::TMPPACKW forget}
  <b><font color=#3a6797>lappend</font></b> res <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.frAW <font color=#1b1baa>$</font>ownname.laB T - - <font color=#1b1baa>{</font>-padx 0<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-bg <font color=#1b1baa>$</font>p(bg1) -w 0 -borderwidth 0<font color=#1b1baa>}</font>&quot;</font>
  <b><font color=#3a6797>lappend</font></b> res <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.frAW.labw - - 1 1 <font color=#1b1baa>{</font>pack <font color=#1b1baa>$</font>::klnd::TMPPACKW -pady 0<font color=#1b1baa>}</font>&quot;</font>
  <i><font color=#4b5d50># 1st day of the month's first week:</font></i>
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;7} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>lappend</font></b> res <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.frAW.BuTW<font color=#1b1baa>$</font>i + T 1 1 <font color=#1b1baa>{</font>pack <font color=#1b1baa>$</font>::klnd::TMPPACKW -pady 1<font color=#1b1baa>}</font> <font color=#1b1baa>{$</font>::klnd::TMPATTW<font color=#1b1baa>}</font>&quot;</font>
  }
  <b><font color=#3a6797>lappend</font></b> res <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>ownname.laBDays <font color=#1b1baa>$</font>ownname.frAW L - - <font color=#1b1baa>{</font>-st nsew<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-bg <font color=#1b1baa>$</font>p(bg1)<font color=#1b1baa>}</font>&quot;</font>
  <b><font color=#3a6797>lappend</font></b> res \
    [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ownname</font>.laBDays.tcl <font color=#8b2a0e>&quot; \</font>
<font color=#8b2a0e>      set wt - ; \</font>
<font color=#8b2a0e>      for <font color=#1b1baa>{</font>set i 1<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>\$i&lt;45<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>incr i<font color=#1b1baa>}</font> <font color=#1b1baa>{</font> \</font>
<font color=#8b2a0e>        if <font color=#1b1baa>{</font>\$i&lt;8<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>set cur <font color=#1b1baa>$</font>ownname.laBDays.LabDay<font color=#1b1baa>$</font>obj\$i<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>set cur <font color=#1b1baa>$</font>ownname.laBDays.BuT<font color=#1b1baa>$</font>obj-\[expr <font color=#1b1baa>{</font>\$i-7<font color=#1b1baa>}</font>\]KLND<font color=#1b1baa>}</font> ; \</font>
<font color=#8b2a0e>        if <font color=#1b1baa>{</font>(\$i%7)!=1<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>set p L; set pw \$pr<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>set p T; set pw \$wt; set wt \$cur<font color=#1b1baa>}</font> ; \</font>
<font color=#8b2a0e>        if <font color=#1b1baa>{</font>\$i&lt;8<font color=#1b1baa>}</font> <font color=#1b1baa>{</font> \</font>
<font color=#8b2a0e>          set lwid \&quot;\$cur \$pw \$p 1 1 <font color=#1b1baa>{</font>-st ew -pady 0<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-anchor center -foreground <font color=#1b1baa>$</font>p(fgh) -background <font color=#1b1baa>$</font>p(bg1)<font color=#1b1baa>}</font>\&quot; \</font>
<font color=#8b2a0e>        <font color=#1b1baa>}</font> else <font color=#1b1baa>{</font> \</font>
<font color=#8b2a0e>          set lwid \&quot;\$cur \$pw \$p 1 1 <font color=#1b1baa>{</font>-st ew -pady 1<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>-relief flat -overrelief raised -takefocus 0  -padx 8 -pady 0 -font <font color=#1b1baa>{$</font>::apave::FONTMAIN<font color=#1b1baa>}</font> -com <font color=#1b1baa>{</font>::klnd::my::Enter2 <font color=#1b1baa>$</font>obj \[expr <font color=#1b1baa>{</font>\$i-7<font color=#1b1baa>}</font>\]<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>::klnd::TMPTIP -highlightthickness 0 -w <font color=#1b1baa>$</font>p(width) -background <font color=#1b1baa>$</font>p(bg1)<font color=#1b1baa>}</font>\&quot; \</font>
<font color=#8b2a0e>        <font color=#1b1baa>}</font> ; \</font>
<font color=#8b2a0e>        %C \$lwid ; \</font>
<font color=#8b2a0e>        set pr \$cur \</font>
<font color=#8b2a0e>      <font color=#1b1baa>}</font>&quot;</font>
    ]
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<a id=UI></a>
<i><font color=#4b5d50># ________________________ UI _________________________ #</font></i>
<a id=klnd::labelPath></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::labelPath {{obj {}}} {
  <i><font color=#4b5d50># Gets a title label path.</font></i>
  <i><font color=#4b5d50>#   obj - index of the calendar</font></i>
  <i><font color=#4b5d50># Useful to change the label's attributes.</font></i>
  <i><font color=#4b5d50># If *obj* omitted, returns a path of last created label.</font></i>

  <b><font color=#3a6797>variable</font></b> my::p
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$obj</font> eq {}} {<b><font color=#3a6797>set</font></b> obj <font color=#1b1baa>$my::p(objNUM)</font>}
  <b><font color=#ca14ca>return</font></b> [<font color=#1b1baa>$my::p($obj)</font> LabMonth<font color=#1b1baa>$obj</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=klnd::blinking></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::blinking {doit} {
  <i><font color=#4b5d50># Makes a calendar label blink.</font></i>
  <i><font color=#4b5d50>#   doit - if yes, starts blinking, else stops it</font></i>

  <b><font color=#3a6797>lassign</font></b> [::apave::obj csGet] - fgnorm - bgnorm
  <b><font color=#3a6797>lassign</font></b> [::apave::obj csGet 45] - - - - - bgblink fgblink
  <b><font color=#3a6797>set</font></b> lab [::klnd::labelPath]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doit</font>} {
    <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;::apave::blinkWidget <font color=#1b1baa>$</font>lab <font color=#1b1baa>$</font>fgnorm <font color=#1b1baa>$</font>bgnorm <font color=#1b1baa>$</font>fgblink <font color=#1b1baa>$</font>bgblink 100 4&quot;</font>
  } <b><font color=#3a6797>else</font></b> {
    ::apave::blinkWidget <font color=#1b1baa>$lab</font> <font color=#1b1baa>$fgnorm</font> <font color=#1b1baa>$bgnorm</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=klnd::update></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::update {{obj {}} {year {}} {month {}} {hllist {}}} {
  <i><font color=#4b5d50># Redraws a calendar.</font></i>
  <i><font color=#4b5d50>#   obj - index of the calendar</font></i>
  <i><font color=#4b5d50>#   year - year to redraw</font></i>
  <i><font color=#4b5d50>#   month - month to redraw</font></i>

  <b><font color=#3a6797>variable</font></b> my::p
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$obj</font> eq {}} {
    <b><font color=#3a6797>set</font></b> obj <font color=#1b1baa>$my::p(objNUM)</font>
    <b><font color=#3a6797>set</font></b> year <font color=#1b1baa>$my::p(yvis$obj)</font>
    <b><font color=#3a6797>set</font></b> month <font color=#1b1baa>$my::p(mvis$obj)</font>
    <b><font color=#3a6797>set</font></b> my::p(hllist<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$hllist</font>
  }
  my::ShowMonth2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$month</font> <font color=#1b1baa>$year</font> yes yes
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=klnd::selectedDay></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::selectedDay {{obj {}} {y {}} {m {}} {d {}} {doblink yes}} {
  <i><font color=#4b5d50># Gets a selected day.</font></i>
  <i><font color=#4b5d50>#   obj - index of the calendar</font></i>
  <i><font color=#4b5d50>#   y - year</font></i>
  <i><font color=#4b5d50>#   m - month</font></i>
  <i><font color=#4b5d50>#   d - day</font></i>
  <i><font color=#4b5d50>#   doblink - if yes, make the month blink</font></i>
  <i><font color=#4b5d50># If y/m/d are set, they define currently selected date.</font></i>
  <i><font color=#4b5d50># Returns a list of year, month, day</font></i>

  <b><font color=#3a6797>variable</font></b> my::p
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$obj</font> eq {}} {<b><font color=#3a6797>set</font></b> obj <font color=#1b1baa>$my::p(objNUM)</font>}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$y</font> ne {}} {
    <b><font color=#3a6797>set</font></b> my::p(yvis<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$y</font>
    <b><font color=#3a6797>set</font></b> my::p(mvis<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$m</font>
    <b><font color=#3a6797>set</font></b> my::p(dvis<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$d</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$my::p(tvar$obj)</font> ne {}} {
      <b><font color=#3a6797>set</font></b> p(olddate<font color=#1b1baa>$obj</font>) [my::FormatDay2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$y</font> <font color=#1b1baa>$m</font> <font color=#1b1baa>$d</font>]
      <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$my::p(tvar$obj)</font> <font color=#1b1baa>$p(olddate$obj)</font>
    }
    <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;::klnd::my::ShowMonth2 <font color=#1b1baa>$</font>obj <font color=#1b1baa>$</font>m <font color=#1b1baa>$</font>y yes yes; ::klnd::blinking <font color=#1b1baa>$</font>doblink&quot;</font>
  }
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$my::p(yvis$obj)</font> <font color=#1b1baa>$my::p(mvis$obj)</font> <font color=#1b1baa>$my::p(dvis$obj)</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=klnd::getDaylist></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::getDaylist {pobj {min 0} {max 9999999}} {
  <i><font color=#4b5d50># Gets a day list which was set initially and possibly changed by a user.</font></i>
  <i><font color=#4b5d50>#   pobj - apave object</font></i>
  <i><font color=#4b5d50>#   min - minimal index of calendar widget</font></i>
  <i><font color=#4b5d50>#   max - maximal index of calendar widget</font></i>
  <i><font color=#4b5d50># The pobj is the same as passed to klnd::calendar2.</font></i>
  <i><font color=#4b5d50># See also: calendar2</font></i>

  <b><font color=#3a6797>variable</font></b> my::p
  <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> objNUM <font color=#1b1baa>$my::p(objNUM)</font>}]} {
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> obj 0} {<font color=#1b1baa>$obj</font>&lt;<font color=#1b1baa>$objNUM</font>} {} {
      <b><font color=#3a6797>incr</font></b> obj
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$my::p($obj)</font> eq <font color=#1b1baa>$pobj</font> && [<b><font color=#3a6797>info</font></b> exist my::p(daylist<font color=#1b1baa>$obj</font>)]} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$my::p(daylist$obj)</font> ne {-} && <font color=#1b1baa>$min</font>&lt;=<font color=#1b1baa>$obj</font> && <font color=#1b1baa>$obj</font>&lt;=<font color=#1b1baa>$max</font>} {
          <b><font color=#3a6797>foreach</font></b> d <font color=#1b1baa>$my::p(daylist$obj)</font> {
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$res</font> <font color=#1b1baa>$d</font>]&lt;0} {
              <b><font color=#3a6797>lappend</font></b> res <font color=#1b1baa>$d</font>
            }
          }
        }
      }
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=klnd::calendar2></a>
<b><font color=#ca14ca>proc</font></b> ::klnd::calendar2 {pobj w ownname args} {
  <i><font color=#4b5d50># The main procedure of the calendar embedded widget.</font></i>
  <i><font color=#4b5d50>#   pobj - apave object</font></i>
  <i><font color=#4b5d50>#   w - container widget for *ownname*</font></i>
  <i><font color=#4b5d50>#   ownname - frame widget for calendar</font></i>
  <i><font color=#4b5d50>#   args - options of the calendar</font></i>
  <i><font color=#4b5d50># Returns a list of widgets for apave layout.</font></i>

  <b><font color=#3a6797>variable</font></b> my::p
  <b><font color=#3a6797>set</font></b> obj [<b><font color=#3a6797>incr</font></b> my::p(objNUM)]
  <b><font color=#3a6797>set</font></b> my::p(<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$pobj</font>
  my::InitSettings
  my::InitCalendar {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$my::p(currentmonth)</font> eq {}} {
    <b><font color=#3a6797>lassign</font></b> [::klnd::currentYearMonthDay] year month day
    <b><font color=#3a6797>set</font></b> my::p(currentmonth) <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>year/<font color=#1b1baa>$</font>month&quot;</font>
    <b><font color=#3a6797>set</font></b> my::p(currentdate) <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>year/<font color=#1b1baa>$</font>month/<font color=#1b1baa>$</font>day&quot;</font>
  }
  <i><font color=#4b5d50># save options for current calendar</font></i>
  <b><font color=#3a6797>foreach</font></b> opt {weekday months days loc yvis mvis dvis \
  com tvar dformat united currentmonth daylist popup hllist tip} {
    <b><font color=#3a6797>set</font></b> my::p(<font color=#1b1baa>$opt$obj</font>) <font color=#1b1baa>$my::p($opt)</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$my::p(daylist)</font> ne {-} && <font color=#1b1baa>$my::p(united)</font>} {
    <i><font color=#4b5d50># for calendars united, initialize day lists per month</font></i>
    <b><font color=#3a6797>set</font></b> my::p(daylist<font color=#1b1baa>$obj</font>) [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>foreach</font></b> date <font color=#1b1baa>$my::p(daylist)</font> {
      <b><font color=#3a6797>set</font></b> d [<b><font color=#3a6797>clock</font></b> format [<b><font color=#3a6797>clock</font></b> scan <font color=#1b1baa>$date</font> <font color=#653760>-format</font> <font color=#1b1baa>$my::p(dformat)</font>] <font color=#653760>-format</font> %Y/%N/%d]
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$d</font> /] y m
      <b><font color=#3a6797>set</font></b> m [my::TrimN <font color=#1b1baa>$m</font>]
      <b><font color=#3a6797>lappend</font></b> my::p(daylist<font color=#1b1baa>$obj</font>) <font color=#1b1baa>$date</font>
    }
  }
  <i><font color=#4b5d50># if calendars are united, it's selected at start</font></i>
  <i><font color=#4b5d50># and saved as previously selected one</font></i>
  <b><font color=#3a6797>set</font></b> my::p(olddate<font color=#1b1baa>$obj</font>) {}
  <i><font color=#4b5d50># binds for day buttons and show and work with the calendar</font></i>
  <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;::klnd::my::BindButtons2 <font color=#1b1baa>$</font>obj; \</font>
<font color=#8b2a0e>    ::klnd::my::ShowMonth2 <font color=#1b1baa>$</font>obj <font color=#1b1baa>$</font>my::p(m) <font color=#1b1baa>$</font>my::p(y) yes yes&quot;</font>
  <b><font color=#3a6797>set</font></b> res [my::MainWidgets2 <font color=#1b1baa>$obj</font> <font color=#1b1baa>$ownname</font>]
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<a id=EOF></a>
<i><font color=#4b5d50># _________________________________ EOF _________________________________ #</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../../../index.html"><font color=#1a1a1a size=6>  <b>klnd2.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>