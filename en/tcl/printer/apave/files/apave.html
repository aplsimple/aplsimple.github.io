<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>
<link rel="stylesheet" href="../css/style.css">

<title>apave.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../index.html"><font color=#1a1a1a size=6>  <b>README.md</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">apave.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#apave.tcl">apave.tcl</a></b></li>
<li><b><a href="#Independent_procs">Independent procs</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#::iswindows">iswindows</a><span class=tooltiptext> ::iswindows : Checks for "platform is MS Windows".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#::isunix">isunix</a><span class=tooltiptext> ::isunix : Checks for "platform is Unix".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#::isKDE">isKDE</a><span class=tooltiptext> ::isKDE : Checks for "desktop is KDE".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#::asKDE">asKDE</a><span class=tooltiptext> ::asKDE : Checks for DE behaving as weird as KDE.</span></div></li></ul>
<li><b><a href="#apave_NS">apave NS</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#obj">obj</a><span class=tooltiptext> obj : Calls a method of APave class.
com - a method
args - arguments of the method
It can (and must) be used only for temporary tasks.
For persistent tasks, use a "normal" apave object.
Returns the command's result.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#None">None</a><span class=tooltiptext> None : Useful when to do nothing is better than to do something.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#autoexec">autoexec</a><span class=tooltiptext> autoexec : Imitates Tcl's auto_execok.
comm - a command to find
ext - file's extension (for Windows)
If it doesn't get the command from Tcl's auto_execok,
it tries to knock at its file by itself.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#openDoc">openDoc</a><span class=tooltiptext> openDoc : Opens a document.
url - document's file name, www link, e-mail etc.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#countChar">countChar</a><span class=tooltiptext> countChar : Counts a character in a string.
str - a string
ch - a character

Returns a number of non-escaped occurences of character *ch* in
string *str*.

See also:
[wiki.tcl-lang.org](https://wiki.tcl-lang.org/page/Reformatting+Tcl+code+indentation)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#traceRemove">traceRemove</a><span class=tooltiptext> traceRemove : Cancels tracing of a variable.
v - variable's name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#initBaltip">initBaltip</a><span class=tooltiptext> initBaltip : Initializes baltip package.</span></div></li></ul>
<li><b><a href="#Integers">&nbsp;&nbsp;Integers</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#getN">getN</a><span class=tooltiptext> getN : Gets a number from a string
sn - string containing a number
defn - default value when sn is not a number
min - minimal value allowed
max - maximal value allowed</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#p+">p+</a><span class=tooltiptext> p+ : Sums two text positions straightforward: lines & columns separately.
p1 - 1st position
p2 - 2nd position
The lines may be with "-".
Reasons for this:
1. expr $p1+$p2 doesn't work, e.g. 309.10+1.4=310.5 instead of 310.14
2. do it without a text widget's path (for text's arithmetic)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#pint">pint</a><span class=tooltiptext> pint : Gets int part of text position, e.g. "4" for "4.end".
pos - position in text</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#intInRange">intInRange</a><span class=tooltiptext> intInRange : Checks whether an integer is in min-max range.
int - the integer
min - minimum of the range
max - maximum of the range</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#IsRoundInt">IsRoundInt</a><span class=tooltiptext> IsRoundInt : Checks whether an integer equals roundly to other integer.
i1 - integer to compare
i2 - integer to be compared (rounded) to i1</span></div></li></ul>
<li><b><a href="#Lists,_arrays">&nbsp;&nbsp;Lists, arrays</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#lsearchFile">lsearchFile</a><span class=tooltiptext> lsearchFile : Searches a file name in a list, using normalized file names.
flist - list of file names
fname - file name to find
Returns an index of found file name or -1 if it's not found.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#RestoreArray">RestoreArray</a><span class=tooltiptext> RestoreArray : Tries restoring an array 1:1.
arName - fully qualified array name
arSave - saved array's value (got with "array get")
At restoring, new items of $arName are deleted and existing items are updated,
so that after restoring *array get $arName* is equal to $arSave.
Note: "array unset $arName *; array set $arName $arSave" doesn't ensure this equality.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#EnsureArray">EnsureArray</a><span class=tooltiptext> EnsureArray : Ensures restoring an array at calling a proc.
arName - fully qualified array name
args - proc name & arguments</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#PushInList">PushInList</a><span class=tooltiptext> PushInList : Pushes an item in a list: deletes an old instance, inserts a new one.
listName - the list's variable name
item - item to push
pos - position in the list to push in
max - maximum length of the list</span></div></li></ul>
<li><b><a href="#Widgets">&nbsp;&nbsp;Widgets</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#checkGeometry">checkGeometry</a><span class=tooltiptext> checkGeometry : Checks a window's geometry.
geo - the geometry
Returns a "normalized" geometry (+0+0 if input not correct).</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#repaintWindow">repaintWindow</a><span class=tooltiptext> repaintWindow : Shows a window and, optionally, focuses on a widget of it.
win - the window's path
wfoc - the widget's path or a command to get it
Returns yes, if the window is shown successfully.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#rootModalWindow">rootModalWindow</a><span class=tooltiptext> rootModalWindow : Gets a parent modal window for a given one.
pwin - default parent</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#splitGeometry">splitGeometry</a><span class=tooltiptext> splitGeometry : Gets widget's geometry components.
geom - geometry
X - default X-coordinate
Y - default Y-coordinate
Returns a list of width, height, X and Y (coordinates are always with + or -)
and also a flag "negative coordinates, calculated from bottom right".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#focusFirst">focusFirst</a><span class=tooltiptext> focusFirst : Sets a focus on a first widget of a parent widget.
w - the parent widget
dofocus - if no, means "only return the widget's path"
res - used for recursive call
Returns a path to a focused widget or "".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#focusedWidget">focusedWidget</a><span class=tooltiptext> focusedWidget : Gets a flag "is a widget can be focused".
w - widget's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#MouseOnWidget">MouseOnWidget</a><span class=tooltiptext> MouseOnWidget : Places the mouse pointer on a widget.
w1 - the widget's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#CursorAtEnd">CursorAtEnd</a><span class=tooltiptext> CursorAtEnd : Sets the cursor at the end of a field.
w - the field's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#focusByForce">focusByForce</a><span class=tooltiptext> focusByForce : Focuses a widget.
foc - widget's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#KeyAccelerator">KeyAccelerator</a><span class=tooltiptext> KeyAccelerator : Returns a key accelerator.
acc - key name, may contain 2 items (e.g. Control-D Control-d)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#InvertBg">InvertBg</a><span class=tooltiptext> InvertBg : Gets a "inverted" color (white/black) for an color.
clr - color (#hhh or #hhhhhh)
B - "black" color
W - "white" color
Returns a list of "black/white" and normalized input color</span></div></li></ul>
<li><b><a href="#Blinking_widgets">&nbsp;&nbsp;&nbsp;&nbsp;Blinking widgets</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#blinkWidget">blinkWidget</a><span class=tooltiptext> blinkWidget</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#blinkWidgetImage">blinkWidgetImage</a><span class=tooltiptext> blinkWidgetImage : Makes a widget's image blink.
w - widget's path
img1 - main image
img2 - flashed image
cnt - count of flashes
ms - millisec between flashes</span></div></li></ul>
<li><b><a href="#File_names">&nbsp;&nbsp;File names</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#HomeDir">HomeDir</a><span class=tooltiptext> HomeDir : For Tcl 9.0 & Windows: gets a home directory ("~").</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#checkHomeDir">checkHomeDir</a><span class=tooltiptext> checkHomeDir : For Tcl 9.0 & Windows: checks a command for "~".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#UnixPath">UnixPath</a><span class=tooltiptext> UnixPath : Makes a path "unix-like" to be good for Tcl.
path - the path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#NormalizeName">NormalizeName</a><span class=tooltiptext> NormalizeName : Removes spec.characters from a name (sort of normalizing it).
name - the name</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#NormalizeFileName">NormalizeFileName</a><span class=tooltiptext> NormalizeFileName : Removes spec.characters from a file/dir name (sort of normalizing it).
name - the name of file/dir</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#FileTail">FileTail</a><span class=tooltiptext> FileTail : Extracts a tail path from a full file path.
E.g. FileTail /a/b /a/b/cd/ef => cd/ef
basepath - base path
fullpath - full path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#FileRelativeTail">FileRelativeTail</a><span class=tooltiptext> FileRelativeTail : Gets a base relative path.
E.g. FileRelativeTail /a/b /a/b/cd/ef => ../ef
basepath - base path
fullpath - full path</span></div></li></ul>
<li><b><a href="#Borrowed_from_BWidget">&nbsp;&nbsp;Borrowed from BWidget</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#place">place</a><span class=tooltiptext> place</span></div></li></ul>
<li><b><a href="#EONS_apave">&nbsp;&nbsp;EONS apave</a></b></li>
<li><b><a href="#APave">APave</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#constructor">constructor</a><span class=tooltiptext> constructor : Creates APave object.
win - window's name (path)
args - additional arguments</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#destructor">destructor</a><span class=tooltiptext> destructor : Clears variables used in the object.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#initInput">initInput</a><span class=tooltiptext> initInput : Initializes input and clears variables made in previous session.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#varInput">varInput</a><span class=tooltiptext> varInput : Gets variables made and filled in a previous session
as a list of "varname varvalue" pairs where varname
is of form: namespace::var$widgetname.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#valueInput">valueInput</a><span class=tooltiptext> valueInput : Gets input variables' values.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#input">input</a><span class=tooltiptext> input : Makes and runs an input dialog.
icon - icon (omitted if equals to "")
ttl - title of window
iopts - list of widgets and their attributes
args - list of dialog's attributes
The `iopts` contains lists of three items:
name - name of widgets
prompt - prompt for entering data
valopts - value options
The `valopts` is a list specific for a widget's type, however
a first item of `valopts` is always an initial input value.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#vieweditFile">vieweditFile</a><span class=tooltiptext> vieweditFile : Views or edits a file.
fname - name of file
prepcom - a command performing before and after creating a dialog
args - additional options
It's a sort of stub for calling *editfile* method.
See also: editfile</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#editfile">editfile</a><span class=tooltiptext> editfile : Edits or views a file with a set of main colors
fname - name of file
fg - foreground color of text widget
bg - background color of text widget
cc - caret's color of text widget
prepcom - a command performing before and after creating a dialog
args - additional options (`-readonly 1` for viewing the file).
If *fg* isn't empty, all three colors are used to color a text.
See also:
[aplsimple.github.io](https://aplsimple.github.io/en/tcl/pave/index.html)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#onTop">onTop</a><span class=tooltiptext> onTop : Sets -topmost attribute for windows or gets a list of topmost windows.
wpar - parent window's path
top - -topmost attribute's value
wtoplist - list of windows to process
res - used to get the result
Returns a list of "topmost=$top" windows found on $wpar path.</span></div></li></ul>
<li><b><a href="#EONS">EONS</a></b></li>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->

<h1><font color=#ca14ca> apave</font></h1>
</p><p>
A library for GUI development with Tcl/Tk.
</p><p>
Docs:
</p><p>
<a href="https://aplsimple.github.io/en/tcl/pave">Full description</a>
</p><p>

</p>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../index.html"><font color=#1a1a1a size=6>  <b>apave.tcl</b></font></div></td></table>

<pre class="code"><i><font color=#4b5d50>###########################################################<a id=apave.tcl></a></font></i>
<i><font color=#4b5d50># Name:    apave.tcl</font></i>
<i><font color=#4b5d50># Author:  Alex Plotnikov  (aplsimple@gmail.com)</font></i>
<i><font color=#4b5d50># Date:    12/09/2021</font></i>
<i><font color=#4b5d50># Brief:   Handles APave class creating input dialogs.</font></i>
<i><font color=#4b5d50># License: MIT.</font></i>
<i><font color=#4b5d50>###########################################################</font></i>

<b><font color=#3a6797>package</font></b> require Tk
<b><font color=#3a6797>package</font></b> provide apave 4.6.0

<b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join [<b><font color=#3a6797>file</font></b> dirname [<b><font color=#3a6797>info</font></b> script]] apavedialog.tcl]
<a id=Independent_procs></a>
<i><font color=#4b5d50># ________________________ Independent procs _________________________ #</font></i>
<a id=::iswindows></a>
<b><font color=#ca14ca>proc</font></b> ::iswindows {} {
  <i><font color=#4b5d50># Checks for &quot;platform is MS Windows&quot;.</font></i>

  <b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> eq {windows}}
}
<a id=::isunix></a>
<b><font color=#ca14ca>proc</font></b> ::isunix {} {
  <i><font color=#4b5d50># Checks for &quot;platform is Unix&quot;.</font></i>

  <b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> eq {unix}}
}
<a id=::isKDE></a>
<b><font color=#ca14ca>proc</font></b> ::isKDE {} {
  <i><font color=#4b5d50># Checks for &quot;desktop is KDE&quot;.</font></i>

  <b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>info</font></b> exists ::env(XDG_CURRENT_DESKTOP)] && <font color=#1b1baa>$::env(XDG_CURRENT_DESKTOP)</font> eq {KDE}}
}
<a id=::asKDE></a>
<b><font color=#ca14ca>proc</font></b> ::asKDE {} {
  <i><font color=#4b5d50># Checks for DE behaving as weird as KDE.</font></i>

  <b><font color=#3a6797>expr</font></b> {[::isKDE] && ![<b><font color=#3a6797>package</font></b> vsatisfies [<b><font color=#3a6797>package</font></b> require Tcl] 8.6.11-]}
}<a id=apave_NS></a>
<i><font color=#4b5d50># ________________________ apave NS _________________________ #</font></i>

<b><font color=#ca14ca>namespace</font></b> eval ::apave {

<b><font color=#3a6797>namespace</font></b> export obj openDoc textsplit focusByForce *TextFile undo* *Option*

mainWindowOfApp .

<b><font color=#3a6797>variable</font></b> _OBJ_ {}
<a id=obj></a>
<b><font color=#ca14ca>proc</font></b> obj {com args} {
  <i><font color=#4b5d50># Calls a method of APave class.</font></i>
  <i><font color=#4b5d50>#   com - a method</font></i>
  <i><font color=#4b5d50>#   args - arguments of the method</font></i>
  <i><font color=#4b5d50># It can (and must) be used only for temporary tasks.</font></i>
  <i><font color=#4b5d50># For persistent tasks, use a &quot;normal&quot; apave object.</font></i>
  <i><font color=#4b5d50># Returns the command's result.</font></i>

  <b><font color=#3a6797>variable</font></b> _OBJ_
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$_OBJ_</font> eq {}} {<b><font color=#3a6797>set</font></b> _OBJ_ [::apave::APave new]}
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> exported [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$com</font> eq <font color=#8b2a0e>&quot;EXPORT&quot;</font>}]]} {
    <b><font color=#3a6797>set</font></b> com [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0]
    <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$args</font> 1 end]
    <b><font color=#ca14ca>oo::objdefine</font></b> <font color=#1b1baa>$_OBJ_</font> <font color=#8b2a0e>&quot;export <font color=#1b1baa>$</font>com&quot;</font>
  }
  <b><font color=#3a6797>set</font></b> res [<font color=#1b1baa>$_OBJ_</font> <font color=#1b1baa>$com</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$exported</font>} {
    <b><font color=#ca14ca>oo::objdefine</font></b> <font color=#1b1baa>$_OBJ_</font> <font color=#8b2a0e>&quot;unexport <font color=#1b1baa>$</font>com&quot;</font>
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=None></a>
<b><font color=#ca14ca>proc</font></b> None {args} {
  <i><font color=#4b5d50># Useful when to do nothing is better than to do something.</font></i>

}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=autoexec></a>
<b><font color=#ca14ca>proc</font></b> autoexec {comm {ext <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Imitates Tcl's auto_execok.</font></i>
  <i><font color=#4b5d50>#   comm - a command to find</font></i>
  <i><font color=#4b5d50>#   ext - file's extension (for Windows)</font></i>
  <i><font color=#4b5d50># If it doesn't get the command from Tcl's auto_execok,</font></i>
  <i><font color=#4b5d50># it tries to knock at its file by itself.</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ext</font> ne {} && [::iswindows]} {<b><font color=#3a6797>append</font></b> comm <font color=#1b1baa>$ext</font>}
  <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>auto_execok</font></b> <font color=#1b1baa>$comm</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$res</font> eq {} && [<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$comm</font>]} {
    <b><font color=#3a6797>set</font></b> res <font color=#1b1baa>$comm</font>
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=openDoc></a>
<b><font color=#ca14ca>proc</font></b> openDoc {url} {
  <i><font color=#4b5d50># Opens a document.</font></i>
  <i><font color=#4b5d50>#   url - document's file name, www link, e-mail etc.</font></i>

  <b><font color=#3a6797>set</font></b> commands {xdg-open open start}
  <b><font color=#3a6797>foreach</font></b> opener <font color=#1b1baa>$commands</font> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opener</font> eq <font color=#8b2a0e>&quot;start&quot;</font>} {
      <b><font color=#3a6797>set</font></b> command [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>auto_execok</font></b> start] {}]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> command [<b><font color=#3a6797>auto_execok</font></b> <font color=#1b1baa>$opener</font>]
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$command</font>]} {
      <b><font color=#ca14ca>break</font></b>
    }
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$command</font>] == 0} {
    <b><font color=#3a6797>puts</font></b> <font color=#8b2a0e>&quot;ERROR: couldn't find any opener&quot;</font>
  }
  <i><font color=#4b5d50># remove the tailing &quot; &&quot; (as e_menu can set)</font></i>
  <b><font color=#3a6797>set</font></b> url [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$url</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#8b2a0e>&quot;* &&quot;</font> <font color=#1b1baa>$url</font>]} {<b><font color=#3a6797>set</font></b> url [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$url</font> 0 end-2]}
  <b><font color=#3a6797>set</font></b> url [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$url</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>exec</font></b> -- {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$command</font> <font color=#1b1baa>$url</font> &} <b><font color=#3a6797>error</font></b>]} {
    <b><font color=#3a6797>puts</font></b> <font color=#8b2a0e>&quot;ERROR: couldn't execute '<font color=#1b1baa>$</font>command':\n<font color=#1b1baa>$</font>error&quot;</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=countChar></a>
<b><font color=#ca14ca>proc</font></b> countChar {str ch} {
  <i><font color=#4b5d50># Counts a character in a string.</font></i>
  <i><font color=#4b5d50>#   str - a string</font></i>
  <i><font color=#4b5d50>#   ch - a character</font></i>
  <i><font color=#4b5d50>#</font></i>
  <i><font color=#4b5d50># Returns a number of non-escaped occurences of character *ch* in</font></i>
  <i><font color=#4b5d50># string *str*.</font></i>
  <i><font color=#4b5d50>#</font></i>
  <i><font color=#4b5d50># See also:</font></i>
  <i><font color=#4b5d50># [wiki.tcl-lang.org](https://wiki.tcl-lang.org/page/Reformatting+Tcl+code+indentation)</font></i>

  <b><font color=#3a6797>set</font></b> icnt 0
  <b><font color=#3a6797>while</font></b> {[<b><font color=#3a6797>set</font></b> idx [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$ch</font> <font color=#1b1baa>$str</font>]] &gt;= 0} {
    <b><font color=#3a6797>set</font></b> backslashes 0
    <b><font color=#3a6797>set</font></b> nidx <font color=#1b1baa>$idx</font>
    <b><font color=#3a6797>while</font></b> {[<b><font color=#3a6797>string</font></b> equal [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$str</font> [<b><font color=#3a6797>incr</font></b> nidx -1]] \\]} {
      <b><font color=#3a6797>incr</font></b> backslashes
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$backslashes</font> % 2 == 0} { <b><font color=#3a6797>incr</font></b> icnt }
    <b><font color=#3a6797>set</font></b> str [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$str</font> [<b><font color=#3a6797>incr</font></b> idx] end]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$icnt</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=traceRemove></a>
<b><font color=#ca14ca>proc</font></b> traceRemove {v} {
  <i><font color=#4b5d50># Cancels tracing of a variable.</font></i>
  <i><font color=#4b5d50>#   v - variable's name</font></i>

  <b><font color=#3a6797>foreach</font></b> t [<b><font color=#3a6797>trace</font></b> info variable <font color=#1b1baa>$v</font>] {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$t</font> o c
    <b><font color=#3a6797>trace</font></b> remove variable <font color=#1b1baa>$v</font> <font color=#1b1baa>$o</font> <font color=#1b1baa>$c</font>
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=initBaltip></a>
<b><font color=#ca14ca>proc</font></b> initBaltip {} {
  <i><font color=#4b5d50># Initializes baltip package.</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> command ::baltip] eq {}} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::apave::ISBALTIP</font>} {
      <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::SRCDIR</font> baltip baltip.tcl]
    } <b><font color=#3a6797>else</font></b> {
      <i><font color=#4b5d50># disabling baltip facilities with stub proc (no source &quot;baltip.src&quot;)</font></i>
      <b><font color=#ca14ca>namespace</font></b> eval ::baltip {
        <b><font color=#3a6797>variable</font></b> expproc [<b><font color=#3a6797>list</font></b> configure cget tip update hide repaint \
          optionlist tippath clear sleep showBalloon showTip]
        <b><font color=#3a6797>foreach</font></b> _ <font color=#1b1baa>$expproc</font> {
        ; <b><font color=#ca14ca>proc</font></b> <font color=#1b1baa>$_</font> {args} {<b><font color=#ca14ca>return</font></b> {}}
          <b><font color=#3a6797>namespace</font></b> export <font color=#1b1baa>$_</font>
        }
        <b><font color=#3a6797>namespace</font></b> ensemble create
        <b><font color=#ca14ca>namespace</font></b> eval my {
        ; <b><font color=#ca14ca>proc</font></b> BindToEvent {args} {}
        }
      }
    }
  }
}
<a id=Integers></a>
<i><font color=#4b5d50>## ________________________ Integers _________________________ ##</font></i>

<a id=getN></a>
<b><font color=#ca14ca>proc</font></b> getN {sn {defn 0} {min <font color=#8b2a0e>&quot;&quot;</font>} {max <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Gets a number from a string</font></i>
  <i><font color=#4b5d50>#   sn - string containing a number</font></i>
  <i><font color=#4b5d50>#   defn - default value when sn is not a number</font></i>
  <i><font color=#4b5d50>#   min - minimal value allowed</font></i>
  <i><font color=#4b5d50>#   max - maximal value allowed</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$sn</font> eq <font color=#8b2a0e>&quot;&quot;</font> || [<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> sn [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$sn</font>}]}]} {<b><font color=#3a6797>set</font></b> sn <font color=#1b1baa>$defn</font>}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$max</font> ne <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#3a6797>set</font></b> sn [<b><font color=#3a6797>expr</font></b> {min(<font color=#1b1baa>$max</font>,<font color=#1b1baa>$sn</font>)}]
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$min</font> ne <font color=#8b2a0e>&quot;&quot;</font>} {
    <b><font color=#3a6797>set</font></b> sn [<b><font color=#3a6797>expr</font></b> {max(<font color=#1b1baa>$min</font>,<font color=#1b1baa>$sn</font>)}]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$sn</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=p+></a>
<b><font color=#ca14ca>proc</font></b> p+ {p1 p2} {
  <i><font color=#4b5d50># Sums two text positions straightforward: lines & columns separately.</font></i>
  <i><font color=#4b5d50>#   p1 - 1st position</font></i>
  <i><font color=#4b5d50>#   p2 - 2nd position</font></i>
  <i><font color=#4b5d50># The lines may be with &quot;-&quot;.</font></i>
  <i><font color=#4b5d50># Reasons for this:</font></i>
  <i><font color=#4b5d50>#  1. expr $p1+$p2 doesn't work, e.g. 309.10+1.4=310.5 instead of 310.14</font></i>
  <i><font color=#4b5d50>#  2. do it without a text widget's path (for text's arithmetic)</font></i>

  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$p1</font> .] l11 c11
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$p2</font> .] l21 c21
  <b><font color=#3a6797>foreach</font></b> n {l11 c11 l21 c21} {
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> is digit <font color=#653760>-strict</font> [<b><font color=#3a6797>string</font></b> trimleft [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$n</font>] -]]} {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$n</font> 0}
  }
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>incr</font></b> l11 <font color=#1b1baa>$l21</font>].[<b><font color=#3a6797>incr</font></b> c11 <font color=#1b1baa>$c21</font>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=pint></a>
<b><font color=#ca14ca>proc</font></b> pint {pos} {
  <i><font color=#4b5d50># Gets int part of text position, e.g. &quot;4&quot; for &quot;4.end&quot;.</font></i>
  <i><font color=#4b5d50>#   pos - position in text</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> first . <font color=#1b1baa>$pos</font>]]&gt;0} {<b><font color=#3a6797>incr</font></b> i -1} {<b><font color=#3a6797>set</font></b> i end}
  <b><font color=#3a6797>expr</font></b> {int([<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$pos</font> 0 <font color=#1b1baa>$i</font>])}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=intInRange></a>
<b><font color=#ca14ca>proc</font></b> intInRange {int min max} {
  <i><font color=#4b5d50># Checks whether an integer is in min-max range.</font></i>
  <i><font color=#4b5d50>#   int - the integer</font></i>
  <i><font color=#4b5d50>#   min - minimum of the range</font></i>
  <i><font color=#4b5d50>#   max - maximum of the range</font></i>

  <b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> is integer <font color=#653760>-strict</font> <font color=#1b1baa>$int</font>] && <font color=#1b1baa>$int</font>&gt;=<font color=#1b1baa>$min</font> && <font color=#1b1baa>$int</font>&lt;=<font color=#1b1baa>$max</font>}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=IsRoundInt></a>
<b><font color=#ca14ca>proc</font></b> IsRoundInt {i1 i2} {
  <i><font color=#4b5d50># Checks whether an integer equals roundly to other integer.</font></i>
  <i><font color=#4b5d50>#   i1 - integer to compare</font></i>
  <i><font color=#4b5d50>#   i2 - integer to be compared (rounded) to i1</font></i>

  <b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i1</font>&gt;(<font color=#1b1baa>$i2</font>-3) && <font color=#1b1baa>$i1</font>&lt;(<font color=#1b1baa>$i2</font>+3)}
}
<a id=Lists,_arrays></a>
<i><font color=#4b5d50>## _______________________ Lists, arrays _______________________ ##</font></i>
<a id=lsearchFile></a>
<b><font color=#ca14ca>proc</font></b> lsearchFile {flist fname} {
  <i><font color=#4b5d50># Searches a file name in a list, using normalized file names.</font></i>
  <i><font color=#4b5d50>#   flist - list of file names</font></i>
  <i><font color=#4b5d50>#   fname - file name to find</font></i>
  <i><font color=#4b5d50># Returns an index of found file name or -1 if it's not found.</font></i>

  <b><font color=#3a6797>set</font></b> i 0
  <b><font color=#3a6797>set</font></b> fname [<b><font color=#3a6797>file</font></b> normalize <font color=#1b1baa>$fname</font>]
  <b><font color=#3a6797>foreach</font></b> fn <font color=#1b1baa>$flist</font> {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>file</font></b> normalize <font color=#1b1baa>$fn</font>] eq <font color=#1b1baa>$fname</font>} {
      <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$i</font>
    }
    <b><font color=#3a6797>incr</font></b> i
  }
  <b><font color=#ca14ca>return</font></b> -1
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=RestoreArray></a>
<b><font color=#ca14ca>proc</font></b> RestoreArray {arName arSave} {
  <i><font color=#4b5d50># Tries restoring an array 1:1.</font></i>
  <i><font color=#4b5d50>#   arName - fully qualified array name</font></i>
  <i><font color=#4b5d50>#   arSave - saved array's value (got with &quot;array get&quot;)</font></i>
  <i><font color=#4b5d50># At restoring, new items of $arName are deleted and existing items are updated,</font></i>
  <i><font color=#4b5d50># so that after restoring *array get $arName* is equal to $arSave.</font></i>
  <i><font color=#4b5d50># Note: &quot;array unset $arName *; array set $arName $arSave&quot; doesn't ensure this equality.</font></i>

  <b><font color=#3a6797>set</font></b> ar <font color=#1b1baa>$arName</font>
  <b><font color=#3a6797>array</font></b> set artmp <font color=#1b1baa>$arSave</font>
  <b><font color=#3a6797>set</font></b> tmp1 [<b><font color=#3a6797>array</font></b> names artmp]
  <b><font color=#3a6797>set</font></b> tmp2 [<b><font color=#3a6797>array</font></b> names <font color=#1b1baa>$arName</font>]
  <b><font color=#3a6797>foreach</font></b> n <font color=#1b1baa>$tmp2</font> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$n</font> ni <font color=#1b1baa>$tmp1</font>} {<b><font color=#3a6797>unset</font></b> [<b><font color=#3a6797>set</font></b> ar](<font color=#1b1baa>$n</font>)} {<b><font color=#3a6797>set</font></b> [<b><font color=#3a6797>set</font></b> ar](<font color=#1b1baa>$n</font>) <font color=#1b1baa>$artmp($n)</font>}
  }
  <b><font color=#3a6797>foreach</font></b> n <font color=#1b1baa>$tmp1</font> {
    <i><font color=#4b5d50># deleted items can break 1:1 equality (not the case with alited)</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$n</font> ni <font color=#1b1baa>$tmp2</font>} {<b><font color=#3a6797>set</font></b> [<b><font color=#3a6797>set</font></b> ar](<font color=#1b1baa>$n</font>) <font color=#1b1baa>$artmp($n)</font>}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=EnsureArray></a>
<b><font color=#ca14ca>proc</font></b> EnsureArray {arName args} {
  <i><font color=#4b5d50># Ensures restoring an array at calling a proc.</font></i>
  <i><font color=#4b5d50>#   arName - fully qualified array name</font></i>
  <i><font color=#4b5d50>#   args - proc name & arguments</font></i>

  <b><font color=#3a6797>set</font></b> arSave [<b><font color=#3a6797>array</font></b> get <font color=#1b1baa>$arName</font>]
  {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
  RestoreArray <font color=#1b1baa>$arName</font> <font color=#1b1baa>$arSave</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=PushInList></a>
<b><font color=#ca14ca>proc</font></b> PushInList {listName item {pos 0} {max 16}} {
  <i><font color=#4b5d50># Pushes an item in a list: deletes an old instance, inserts a new one.</font></i>
  <i><font color=#4b5d50>#   listName - the list's variable name</font></i>
  <i><font color=#4b5d50>#   item - item to push</font></i>
  <i><font color=#4b5d50>#   pos - position in the list to push in</font></i>
  <i><font color=#4b5d50>#   max - maximum length of the list</font></i>

  <b><font color=#3a6797>upvar</font></b> <font color=#1b1baa>$listName</font> ln
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$item</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
  }
  <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$item</font>]
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$max</font> end]}
}
<a id=Widgets></a>
<i><font color=#4b5d50>## ________________________ Widgets _________________________ ##</font></i>
<a id=checkGeometry></a>
<b><font color=#ca14ca>proc</font></b> checkGeometry {geo} {
  <i><font color=#4b5d50># Checks a window's geometry.</font></i>
  <i><font color=#4b5d50>#   geo - the geometry</font></i>
  <i><font color=#4b5d50># Returns a &quot;normalized&quot; geometry (+0+0 if input not correct).</font></i>

  <b><font color=#3a6797>if</font></b> {!([<b><font color=#3a6797>regexp</font></b> {^\d+x\d+\+-?\d+\+-?\d+$} <font color=#1b1baa>$geo</font>] ||
  [<b><font color=#3a6797>regexp</font></b> {^\+-?\d+\+-?\d+$} <font color=#1b1baa>$geo</font>] || [<b><font color=#3a6797>regexp</font></b> {^\d+x\d+$} <font color=#1b1baa>$geo</font>])} {
    <b><font color=#3a6797>set</font></b> geo +0+0
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$geo</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=repaintWindow></a>
<b><font color=#ca14ca>proc</font></b> repaintWindow {win {wfoc <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Shows a window and, optionally, focuses on a widget of it.</font></i>
  <i><font color=#4b5d50>#   win - the window's path</font></i>
  <i><font color=#4b5d50>#   wfoc - the widget's path or a command to get it</font></i>
  <i><font color=#4b5d50># Returns yes, if the window is shown successfully.</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$win</font>]} {
    <i><font color=#4b5d50># esp. for KDE</font></i>
    <b><font color=#3a6797>if</font></b> {[isKDE]} { ;<i><font color=#4b5d50># KDE is KDE, Tk is Tk, and never the twain shall meet</font></i>
      <b><font color=#134070>wm</font></b> withdraw <font color=#1b1baa>$win</font>
      <b><font color=#134070>wm</font></b> deiconify <font color=#1b1baa>$win</font>
      <b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$win</font> <font color=#653760>-topmost</font> [<b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$win</font> <font color=#653760>-topmost</font>]
    }
    <b><font color=#3a6797>update</font></b>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wfoc</font> ne {}} {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> wfoc [{<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$wfoc</font>]}
      <b><font color=#134070>focus</font></b> <font color=#1b1baa>$wfoc</font>
    }
    <b><font color=#ca14ca>return</font></b> yes
  }
  <b><font color=#ca14ca>return</font></b> no
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=rootModalWindow></a>
<b><font color=#ca14ca>proc</font></b> rootModalWindow {pwin} {
  <i><font color=#4b5d50># Gets a parent modal window for a given one.</font></i>
  <i><font color=#4b5d50>#   pwin - default parent</font></i>

  <b><font color=#3a6797>set</font></b> root <font color=#1b1baa>$pwin</font>
  <b><font color=#3a6797>foreach</font></b> w [<b><font color=#134070>winfo</font></b> children <font color=#1b1baa>$pwin</font>] {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> ismapped <font color=#1b1baa>$w</font>] && [InfoFind <font color=#1b1baa>$w</font> yes] ne {}} {
      <b><font color=#3a6797>set</font></b> root [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$w</font>]
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$root</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=splitGeometry></a>
<b><font color=#ca14ca>proc</font></b> splitGeometry {geom {X +0} {Y +0}} {
  <i><font color=#4b5d50># Gets widget's geometry components.</font></i>
  <i><font color=#4b5d50>#   geom - geometry</font></i>
  <i><font color=#4b5d50>#   X - default X-coordinate</font></i>
  <i><font color=#4b5d50>#   Y - default Y-coordinate</font></i>
  <i><font color=#4b5d50># Returns a list of width, height, X and Y (coordinates are always with + or -)</font></i>
  <i><font color=#4b5d50># and also a flag &quot;negative coordinates, calculated from bottom right&quot;.</font></i>

  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$geom</font> x+-] w h
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>regexp</font></b> <font color=#653760>-inline</font> <font color=#653760>-all</font> {([+-][[:digit:]]+)} <font color=#1b1baa>$geom</font>] -&gt; x y
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$geom</font> ne {}} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$x</font> in {<font color=#8b2a0e>&quot;&quot;</font> 0} || [<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x</font>+0}}]} {<b><font color=#3a6797>set</font></b> x <font color=#1b1baa>$X</font>}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$y</font> in {<font color=#8b2a0e>&quot;&quot;</font> 0} || [<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y</font>+0}}]} {<b><font color=#3a6797>set</font></b> y <font color=#1b1baa>$Y</font>}
  }
  <b><font color=#3a6797>set</font></b> neg [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> first - <font color=#1b1baa>$geom</font>]&gt;=0 && [<b><font color=#3a6797>string</font></b> first + <font color=#1b1baa>$geom</font>]&lt;0}]
  <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$w</font> <font color=#1b1baa>$h</font> <font color=#1b1baa>$x</font> <font color=#1b1baa>$y</font> <font color=#1b1baa>$neg</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=focusFirst></a>
<b><font color=#ca14ca>proc</font></b> focusFirst {w {dofocus yes} {res {}}} {
  <i><font color=#4b5d50># Sets a focus on a first widget of a parent widget.</font></i>
  <i><font color=#4b5d50>#  w - the parent widget</font></i>
  <i><font color=#4b5d50>#  dofocus - if no, means &quot;only return the widget's path&quot;</font></i>
  <i><font color=#4b5d50>#  res - used for recursive call</font></i>
  <i><font color=#4b5d50># Returns a path to a focused widget or &quot;&quot;.</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$w</font> ne {}} {
    <b><font color=#3a6797>foreach</font></b> w [<b><font color=#134070>winfo</font></b> children <font color=#1b1baa>$w</font>] {
      <b><font color=#3a6797>if</font></b> {[focusedWidget <font color=#1b1baa>$w</font>]} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dofocus</font>} {<b><font color=#3a6797>after</font></b> 200 <font color=#8b2a0e>&quot;catch <font color=#1b1baa>{</font>focus -force <font color=#1b1baa>$</font>w<font color=#1b1baa>}</font>&quot;</font>}
        <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$w</font>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> res [focusFirst <font color=#1b1baa>$w</font> <font color=#1b1baa>$dofocus</font>]] ne {}} <b><font color=#ca14ca>break</font></b>
      }
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=focusedWidget></a>
<b><font color=#ca14ca>proc</font></b> focusedWidget {w} {
  <i><font color=#4b5d50># Gets a flag &quot;is a widget can be focused&quot;.</font></i>
  <i><font color=#4b5d50>#   w - widget's path</font></i>

  <b><font color=#3a6797>set</font></b> wclass [<b><font color=#3a6797>string</font></b> tolower [<b><font color=#134070>winfo</font></b> class <font color=#1b1baa>$w</font>]]
  <b><font color=#3a6797>foreach</font></b> c [<b><font color=#3a6797>list</font></b> entry text button box list view] {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match *<font color=#1b1baa>$c</font> <font color=#1b1baa>$wclass</font>]} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> state [<font color=#1b1baa>$w</font> cget <font color=#653760>-state</font>]}]} {<b><font color=#3a6797>set</font></b> state normal}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$state</font> ne {disabled}} {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> focus [<font color=#1b1baa>$w</font> cget <font color=#653760>-takefocus</font>]}]} {<b><font color=#3a6797>set</font></b> focus no}
        <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {![<b><font color=#3a6797>string</font></b> is boolean <font color=#653760>-strict</font> <font color=#1b1baa>$focus</font>] || <font color=#1b1baa>$focus</font>}]
      }
      <b><font color=#ca14ca>break</font></b>
    }
  }
  <b><font color=#ca14ca>return</font></b> no
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=MouseOnWidget></a>
<b><font color=#ca14ca>proc</font></b> MouseOnWidget {w1} {
  <i><font color=#4b5d50># Places the mouse pointer on a widget.</font></i>
  <i><font color=#4b5d50>#   w1 - the widget's path</font></i>

  <b><font color=#3a6797>update</font></b>
  <b><font color=#3a6797>set</font></b> w2 [<b><font color=#134070>winfo</font></b> parent <font color=#1b1baa>$w1</font>]
  <b><font color=#3a6797>set</font></b> w3 [<b><font color=#134070>winfo</font></b> parent <font color=#1b1baa>$w2</font>]
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<b><font color=#134070>winfo</font></b> geometry <font color=#1b1baa>$w1</font>] +x] w h x1 y1
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<b><font color=#134070>winfo</font></b> geometry <font color=#1b1baa>$w2</font>] +x] - - x2 y2
  <b><font color=#134070>event</font></b> generate <font color=#1b1baa>$w3</font> &lt;Motion&gt; <font color=#653760>-warp</font> 1 \
    <font color=#653760>-x</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x1</font>+<font color=#1b1baa>$x2</font>+int(<font color=#1b1baa>$w</font>/2)}] <font color=#653760>-y</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y1</font>+<font color=#1b1baa>$y2</font>+int(<font color=#1b1baa>$h</font>/2)}]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=CursorAtEnd></a>
<b><font color=#ca14ca>proc</font></b> CursorAtEnd {w} {
  <i><font color=#4b5d50># Sets the cursor at the end of a field.</font></i>
  <i><font color=#4b5d50>#   w - the field's path</font></i>

  <b><font color=#134070>focus</font></b> <font color=#1b1baa>$w</font>
  <font color=#1b1baa>$w</font> selection clear
  <font color=#1b1baa>$w</font> icursor end
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=focusByForce></a>
<b><font color=#ca14ca>proc</font></b> focusByForce {foc {cnt 10}} {
  <i><font color=#4b5d50># Focuses a widget.</font></i>
  <i><font color=#4b5d50>#   foc - widget's path</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> cnt -1]&gt;0} {
    <b><font color=#3a6797>after</font></b> idle after 5 ::apave::focusByForce <font color=#1b1baa>$foc</font> <font color=#1b1baa>$cnt</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>focus</font></b> <font color=#653760>-force</font> [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$foc</font>]; <b><font color=#134070>focus</font></b> <font color=#1b1baa>$foc</font>}
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=KeyAccelerator></a>
<b><font color=#ca14ca>proc</font></b> KeyAccelerator {acc} {
  <i><font color=#4b5d50># Returns a key accelerator.</font></i>
  <i><font color=#4b5d50>#   acc - key name, may contain 2 items (e.g. Control-D Control-d)</font></i>

  <b><font color=#3a6797>set</font></b> acc [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$acc</font> 0]
  <b><font color=#3a6797>string</font></b> map {Control Ctrl - + bracketleft [ bracketright ]} <font color=#1b1baa>$acc</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=InvertBg></a>
<b><font color=#ca14ca>proc</font></b> InvertBg {clr {B #000000} {W #FFFFFF}} {
  <i><font color=#4b5d50># Gets a &quot;inverted&quot; color (white/black) for an color.</font></i>
  <i><font color=#4b5d50>#   clr - color (#hhh or #hhhhhh)</font></i>
  <i><font color=#4b5d50>#   B - &quot;black&quot; color</font></i>
  <i><font color=#4b5d50>#   W - &quot;white&quot; color</font></i>
  <i><font color=#4b5d50># Returns a list of &quot;black/white&quot; and normalized input color</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$clr</font>]==4} {
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$clr</font> {}] -&gt; r g b
    <b><font color=#3a6797>set</font></b> clr #<font color=#1b1baa>$r$r$g$g$b$b</font>
  }
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#134070>winfo</font></b> rgb . <font color=#1b1baa>$clr</font>] r g b
  <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$r</font>%256+<font color=#1b1baa>$b</font>%256)&lt;15 && (<font color=#1b1baa>$g</font>%256)&gt;180 || <font color=#1b1baa>$r</font>+1.5*<font color=#1b1baa>$g</font>+0.5*<font color=#1b1baa>$b</font> &gt; 100000} {
    <b><font color=#3a6797>set</font></b> res <font color=#1b1baa>$B</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> res <font color=#1b1baa>$W</font>
  }
  <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$res</font> <font color=#1b1baa>$clr</font>
}
<a id=Blinking_widgets></a>
<i><font color=#4b5d50>### ________________________ Blinking widgets _________________________ ###</font></i>
<a id=blinkWidget></a>
<b><font color=#ca14ca>proc</font></b> blinkWidget {w {fg #000} {bg #fff} {fg2 {}} {bg2 red} \
  {pause 1000} {count -1} {mode 1}} {
  <i><font color=#4b5d50># Makes a widget blink.</font></i>
  <i><font color=#4b5d50>#   w - the widget's path</font></i>
  <i><font color=#4b5d50>#   fg - normal foreground color</font></i>
  <i><font color=#4b5d50>#   bg - normal background color</font></i>
  <i><font color=#4b5d50>#   fg2 - blinking foreground color (if {}, stops the blinking)</font></i>
  <i><font color=#4b5d50>#   bg2 - blinking background color</font></i>
  <i><font color=#4b5d50>#   pause - pause in millisec between blinkings</font></i>
  <i><font color=#4b5d50>#   count - means how many times do blinking</font></i>
  <i><font color=#4b5d50>#   mode - for recursive calls</font></i>

  <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$w</font>]} <b><font color=#ca14ca>return</font></b>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$count</font>==0 || <font color=#1b1baa>$fg2</font> eq {}} {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$::apave::BLINKWIDGET1</font>}
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$::apave::BLINKWIDGET2</font>}
    <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>w configure -foreground <font color=#1b1baa>$</font>fg; <font color=#1b1baa>$</font>w configure -background <font color=#1b1baa>$</font>bg&quot;</font>
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$mode</font>==1} {
    <b><font color=#3a6797>incr</font></b> count -1
    <font color=#1b1baa>$w</font> configure <font color=#653760>-foreground</font> <font color=#1b1baa>$fg2</font>
    <font color=#1b1baa>$w</font> configure <font color=#653760>-background</font> <font color=#1b1baa>$bg2</font>
    <b><font color=#3a6797>set</font></b> ::apave::BLINKWIDGET1 [<b><font color=#3a6797>after</font></b> \
      <font color=#1b1baa>$pause</font> ::apave::blinkWidget <font color=#1b1baa>$w</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fg2</font> <font color=#1b1baa>$bg2</font> <font color=#1b1baa>$pause</font> <font color=#1b1baa>$count</font> 2]
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$mode</font>==2} {
    <font color=#1b1baa>$w</font> configure <font color=#653760>-foreground</font> <font color=#1b1baa>$fg</font>
    <font color=#1b1baa>$w</font> configure <font color=#653760>-background</font> <font color=#1b1baa>$bg</font>
    <b><font color=#3a6797>set</font></b> ::apave::BLINKWIDGET2 [<b><font color=#3a6797>after</font></b> \
      <font color=#1b1baa>$pause</font> ::apave::blinkWidget <font color=#1b1baa>$w</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fg2</font> <font color=#1b1baa>$bg2</font> <font color=#1b1baa>$pause</font> <font color=#1b1baa>$count</font> 1]
  }
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=blinkWidgetImage></a>
<b><font color=#ca14ca>proc</font></b> blinkWidgetImage {w img1 {img2 alimg_none} {cnt 6} {ms 100}} {
  <i><font color=#4b5d50># Makes a widget's image blink.</font></i>
  <i><font color=#4b5d50>#   w - widget's path</font></i>
  <i><font color=#4b5d50>#   img1 - main image</font></i>
  <i><font color=#4b5d50>#   img2 - flashed image</font></i>
  <i><font color=#4b5d50>#   cnt - count of flashes</font></i>
  <i><font color=#4b5d50>#   ms - millisec between flashes</font></i>

  <b><font color=#3a6797>set</font></b> imgcur <font color=#1b1baa>$img1</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cnt</font>&gt;0} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cnt</font> % 2} {<b><font color=#3a6797>set</font></b> imgcur <font color=#1b1baa>$img2</font>}
    <b><font color=#3a6797>after</font></b> <font color=#1b1baa>$ms</font> <font color=#8b2a0e>&quot;::apave::blinkWidgetImage <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>img1 <font color=#1b1baa>$</font>img2 <font color=#1b1baa>[</font>incr cnt -1<font color=#1b1baa>]</font> <font color=#1b1baa>$</font>ms&quot;</font>
  }
  <font color=#1b1baa>$w</font> configure <font color=#653760>-image</font> <font color=#1b1baa>$imgcur</font>
}
<a id=File_names></a>
<i><font color=#4b5d50>## ________________________ File names _________________________ ##</font></i>
<a id=HomeDir></a>
<b><font color=#ca14ca>proc</font></b> HomeDir {} {
  <i><font color=#4b5d50># For Tcl 9.0 & Windows: gets a home directory (&quot;~&quot;).</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> hd [<b><font color=#3a6797>file</font></b> home]}]} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::env(HOME)]} {<b><font color=#3a6797>set</font></b> hd <font color=#1b1baa>$::env(HOME)</font>} {<b><font color=#3a6797>set</font></b> hd ~}
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$hd</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=checkHomeDir></a>
<b><font color=#ca14ca>proc</font></b> checkHomeDir {com} {
  <i><font color=#4b5d50># For Tcl 9.0 & Windows: checks a command for &quot;~&quot;.</font></i>

  <b><font color=#3a6797>set</font></b> hd [HomeDir]
  <b><font color=#3a6797>set</font></b> com [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> { ~/} <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>hd/&quot;</font> \&quot;~/ \&quot;<font color=#1b1baa>$hd</font>/ '~/ '<font color=#1b1baa>$hd</font>/ \\n~/ \\n<font color=#1b1baa>$hd</font>/ \n~/ \n<font color=#1b1baa>$hd</font>/ \{~/ \{<font color=#1b1baa>$hd</font>/] <font color=#1b1baa>$com</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match ~/* <font color=#1b1baa>$com</font>]} {<b><font color=#3a6797>set</font></b> com <font color=#1b1baa>$hd</font>[<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$com</font> 1 end]}
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$com</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=UnixPath></a>
<b><font color=#ca14ca>proc</font></b> UnixPath {path} {
  <i><font color=#4b5d50># Makes a path &quot;unix-like&quot; to be good for Tcl.</font></i>
  <i><font color=#4b5d50>#   path - the path</font></i>

  <b><font color=#3a6797>set</font></b> path [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$path</font> <font color=#8b2a0e>&quot;\{\}&quot;</font>]  ;<i><font color=#4b5d50># possibly braced if contains spaces</font></i>
  <b><font color=#3a6797>set</font></b> path [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \\ / %H [HomeDir]] <font color=#1b1baa>$path</font>]
  checkHomeDir <font color=#1b1baa>$path</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=NormalizeName></a>
<b><font color=#ca14ca>proc</font></b> NormalizeName {name} {
  <i><font color=#4b5d50># Removes spec.characters from a name (sort of normalizing it).</font></i>
  <i><font color=#4b5d50>#   name - the name</font></i>

  <b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \\ {} \{ {} \} {} \[ {} \] {} \t {} \n {} \r {} \&quot; {}] <font color=#1b1baa>$name</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=NormalizeFileName></a>
<b><font color=#ca14ca>proc</font></b> NormalizeFileName {name} {
  <i><font color=#4b5d50># Removes spec.characters from a file/dir name (sort of normalizing it).</font></i>
  <i><font color=#4b5d50>#   name - the name of file/dir</font></i>

  <b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$name</font>]
  <b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \
    <b><font color=#3a6797>*</font></b> _ ? _ ~ _ / _ \\ _ \{ _ \} _ \[ _ \] _ \t _ \n _ \r _ \
    | _ &lt; _ &gt; _ & _ , _ : _ \; _ \&quot; _ ' _ ` _] <font color=#1b1baa>$name</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=FileTail></a>
<b><font color=#ca14ca>proc</font></b> FileTail {basepath fullpath} {
  <i><font color=#4b5d50># Extracts a tail path from a full file path.</font></i>
  <i><font color=#4b5d50># E.g. FileTail /a/b /a/b/cd/ef =&gt; cd/ef</font></i>
  <i><font color=#4b5d50>#   basepath - base path</font></i>
  <i><font color=#4b5d50>#   fullpath - full path</font></i>

  <b><font color=#3a6797>set</font></b> lbase [<b><font color=#3a6797>file</font></b> split <font color=#1b1baa>$basepath</font>]
  <b><font color=#3a6797>set</font></b> lfull [<b><font color=#3a6797>file</font></b> split <font color=#1b1baa>$fullpath</font>]
  <b><font color=#3a6797>set</font></b> ll [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lfull</font>] - [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lbase</font>] - 1}]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ll</font>&gt;-1} {
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>file</font></b> join {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$lfull</font> end-<font color=#1b1baa>$ll</font> end]]
  }
  <b><font color=#ca14ca>return</font></b> {}
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=FileRelativeTail></a>
<b><font color=#ca14ca>proc</font></b> FileRelativeTail {basepath fullpath} {
  <i><font color=#4b5d50># Gets a base relative path.</font></i>
  <i><font color=#4b5d50># E.g. FileRelativeTail /a/b /a/b/cd/ef =&gt; ../ef</font></i>
  <i><font color=#4b5d50>#   basepath - base path</font></i>
  <i><font color=#4b5d50>#   fullpath - full path</font></i>

  <b><font color=#3a6797>set</font></b> tail [FileTail <font color=#1b1baa>$basepath</font> <font color=#1b1baa>$fullpath</font>]
  <b><font color=#3a6797>set</font></b> lev [<b><font color=#3a6797>llength</font></b> [<b><font color=#3a6797>file</font></b> split <font color=#1b1baa>$tail</font>]]
  <b><font color=#3a6797>set</font></b> base {}
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 1} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$lev</font>} {<b><font color=#3a6797>incr</font></b> i} {<b><font color=#3a6797>append</font></b> base ../}
  <b><font color=#3a6797>append</font></b> base [<b><font color=#3a6797>file</font></b> tail <font color=#1b1baa>$tail</font>]
}
<a id=Borrowed_from_BWidget></a>
<i><font color=#4b5d50>## ________________________ Borrowed from BWidget _________________________ ##</font></i>

<i><font color=#4b5d50>#  Command BWidget::place ----&gt; apave::place</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Notes:</font></i>
<i><font color=#4b5d50>#  For Windows systems with more than one monitor the available screen area may</font></i>
<i><font color=#4b5d50>#  have negative positions. Geometry settings with negative numbers are used</font></i>
<i><font color=#4b5d50>#  under X to place wrt the right or bottom of the screen. On windows, Tk</font></i>
<i><font color=#4b5d50>#  continues to do this. However, a geometry such as 100x100+-200-100 can be</font></i>
<i><font color=#4b5d50>#  used to place a window onto a secondary monitor. Passing the + gets Tk</font></i>
<i><font color=#4b5d50>#  to pass the remainder unchanged so the Windows manager then handles -200</font></i>
<i><font color=#4b5d50>#  which is a position on the left hand monitor.</font></i>
<i><font color=#4b5d50>#  I've tested this for left, right, above and below the primary monitor.</font></i>
<i><font color=#4b5d50>#  Currently there is no way to ask Tk the extent of the Windows desktop in</font></i>
<i><font color=#4b5d50>#  a multi monitor system. Nor what the legal co-ordinate range might be.</font></i>
<i><font color=#4b5d50>#</font></i>
<a id=place></a>
<b><font color=#ca14ca>proc</font></b> place { path w h args } {

  <b><font color=#3a6797>update</font></b> idletasks

  <i><font color=#4b5d50># If the window is not mapped, it may have any current size.</font></i>
  <i><font color=#4b5d50># Then use required size, but bound it to the screen width.</font></i>
  <i><font color=#4b5d50># This is mostly inexact, because any toolbars will still be removed</font></i>
  <i><font color=#4b5d50># which may reduce size.</font></i>
  <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$w</font> == 0 && [<b><font color=#134070>winfo</font></b> ismapped <font color=#1b1baa>$path</font>] } {
    <b><font color=#3a6797>set</font></b> w [<b><font color=#134070>winfo</font></b> width <font color=#1b1baa>$path</font>]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$w</font> == 0 } {
      <b><font color=#3a6797>set</font></b> w [<b><font color=#134070>winfo</font></b> reqwidth <font color=#1b1baa>$path</font>]
    }
    <b><font color=#3a6797>set</font></b> vsw [<b><font color=#134070>winfo</font></b> vrootwidth  <font color=#1b1baa>$path</font>]
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$w</font> &gt; <font color=#1b1baa>$vsw</font> } { <b><font color=#3a6797>set</font></b> w <font color=#1b1baa>$vsw</font> }
  }

  <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$h</font> == 0 && [<b><font color=#134070>winfo</font></b> ismapped <font color=#1b1baa>$path</font>] } {
    <b><font color=#3a6797>set</font></b> h [<b><font color=#134070>winfo</font></b> height <font color=#1b1baa>$path</font>]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$h</font> == 0 } {
      <b><font color=#3a6797>set</font></b> h [<b><font color=#134070>winfo</font></b> reqheight <font color=#1b1baa>$path</font>]
    }
    <b><font color=#3a6797>set</font></b> vsh [<b><font color=#134070>winfo</font></b> vrootheight <font color=#1b1baa>$path</font>]
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$h</font> &gt; <font color=#1b1baa>$vsh</font> } { <b><font color=#3a6797>set</font></b> h <font color=#1b1baa>$vsh</font> }
  }

  <b><font color=#3a6797>set</font></b> arglen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$args</font>]
  <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$arglen</font> &gt; 3 } {
    <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#8b2a0e>&quot;apave::place: bad number of argument&quot;</font>
  }

  <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$arglen</font> &gt; 0 } {
    <b><font color=#3a6797>set</font></b> where [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0]
    <b><font color=#3a6797>set</font></b> list  [<b><font color=#3a6797>list</font></b> at center left right above below]
    <b><font color=#3a6797>set</font></b> idx   [<b><font color=#3a6797>lsearch</font></b> <font color=#1b1baa>$list</font> <font color=#1b1baa>$where</font>]
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$idx</font> == -1 } {
      <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#8b2a0e>&quot;apave::place: bad position: <font color=#1b1baa>$</font>where <font color=#1b1baa>$</font>list&quot;</font>
    }
    <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$idx</font> == 0 } {
      <b><font color=#3a6797>set</font></b> err [<b><font color=#3a6797>catch</font></b> {
        <i><font color=#4b5d50># purposely removed the {} around these expressions - [PT]</font></i>
        <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> int([<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 1])]
        <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> int([<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 2])]
      } e]
      <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$err</font> } {
        <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#8b2a0e>&quot;apave::place: bad position: <font color=#1b1baa>$</font>e&quot;</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> eq {windows}} {
        <i><font color=#4b5d50># handle windows multi-screen. -100 != +-100</font></i>
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 1] 0] ne {-}} {
          <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x</font>
        }
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 2] 0] ne {-}} {
          <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y</font>
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x</font> &gt;= 0 } {
          <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x</font>
        }
        <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$y</font> &gt;= 0 } {
          <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y</font>
        }
      }
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$arglen</font> == 2 } {
        <b><font color=#3a6797>set</font></b> widget [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 1]
        <b><font color=#3a6797>if</font></b> { ![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$widget</font>] } {
          <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#8b2a0e>&quot;apave::place: \&quot;<font color=#1b1baa>$</font>widget\&quot; does not exist&quot;</font>
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> widget .
      }
      <b><font color=#3a6797>set</font></b> sw [<b><font color=#134070>winfo</font></b> screenwidth  <font color=#1b1baa>$path</font>]
      <b><font color=#3a6797>set</font></b> sh [<b><font color=#134070>winfo</font></b> screenheight <font color=#1b1baa>$path</font>]
      <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$idx</font> == 1 } {
        <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$arglen</font> == 2 } {
          <i><font color=#4b5d50># center to widget</font></i>
          <b><font color=#3a6797>set</font></b> x0 [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> rootx <font color=#1b1baa>$widget</font>] + ([<b><font color=#134070>winfo</font></b> width  <font color=#1b1baa>$widget</font>] - <font color=#1b1baa>$w</font>)/2}]
          <b><font color=#3a6797>set</font></b> y0 [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> rooty <font color=#1b1baa>$widget</font>] + ([<b><font color=#134070>winfo</font></b> height <font color=#1b1baa>$widget</font>] - <font color=#1b1baa>$h</font>)/2}]
        } <b><font color=#3a6797>else</font></b> {
          <i><font color=#4b5d50># center to screen</font></i>
          <b><font color=#3a6797>set</font></b> x0 [<b><font color=#3a6797>expr</font></b> {(<font color=#1b1baa>$sw</font> - <font color=#1b1baa>$w</font>)/2 - [<b><font color=#134070>winfo</font></b> vrootx <font color=#1b1baa>$path</font>]}]
          <b><font color=#3a6797>set</font></b> y0 [<b><font color=#3a6797>expr</font></b> {(<font color=#1b1baa>$sh</font> - <font color=#1b1baa>$h</font>)/2 - [<b><font color=#134070>winfo</font></b> vrooty <font color=#1b1baa>$path</font>]}]
        }
        <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x0</font>
        <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y0</font>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> ne {windows}} {
          <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x0</font>+<font color=#1b1baa>$w</font> &gt; <font color=#1b1baa>$sw</font> } {<b><font color=#3a6797>set</font></b> x {-0}; <b><font color=#3a6797>set</font></b> x0 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$sw</font>-<font color=#1b1baa>$w</font>}]}
          <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x0</font> &lt; 0 }      {<b><font color=#3a6797>set</font></b> x {+0}}
          <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$y0</font>+<font color=#1b1baa>$h</font> &gt; <font color=#1b1baa>$sh</font> } {<b><font color=#3a6797>set</font></b> y {-0}; <b><font color=#3a6797>set</font></b> y0 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$sh</font>-<font color=#1b1baa>$h</font>}]}
          <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$y0</font> &lt; 0 }      {<b><font color=#3a6797>set</font></b> y {+0}}
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> x0 [<b><font color=#134070>winfo</font></b> rootx <font color=#1b1baa>$widget</font>]
        <b><font color=#3a6797>set</font></b> y0 [<b><font color=#134070>winfo</font></b> rooty <font color=#1b1baa>$widget</font>]
        <b><font color=#3a6797>set</font></b> x1 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x0</font> + [<b><font color=#134070>winfo</font></b> width  <font color=#1b1baa>$widget</font>]}]
        <b><font color=#3a6797>set</font></b> y1 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y0</font> + [<b><font color=#134070>winfo</font></b> height <font color=#1b1baa>$widget</font>]}]
        <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$idx</font> == 2 || <font color=#1b1baa>$idx</font> == 3 } {
          <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y0</font>
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> ne {windows}} {
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$y0</font>+<font color=#1b1baa>$h</font> &gt; <font color=#1b1baa>$sh</font> } {<b><font color=#3a6797>set</font></b> y {-0}; <b><font color=#3a6797>set</font></b> y0 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$sh</font>-<font color=#1b1baa>$h</font>}]}
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$y0</font> &lt; 0 }      {<b><font color=#3a6797>set</font></b> y {+0}}
          }
          <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$idx</font> == 2 } {
            <i><font color=#4b5d50># try left, then right if out, then 0 if out</font></i>
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x0</font> &gt;= <font color=#1b1baa>$w</font> } {
              <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x0</font>-<font color=#1b1baa>$w</font>}]
            } <b><font color=#3a6797>elseif</font></b> { <font color=#1b1baa>$x1</font>+<font color=#1b1baa>$w</font> &lt;= <font color=#1b1baa>$sw</font> } {
              <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x1</font>
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> x {+0}
            }
          } <b><font color=#3a6797>else</font></b> {
            <i><font color=#4b5d50># try right, then left if out, then 0 if out</font></i>
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x1</font>+<font color=#1b1baa>$w</font> &lt;= <font color=#1b1baa>$sw</font> } {
              <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x1</font>
            } <b><font color=#3a6797>elseif</font></b> { <font color=#1b1baa>$x0</font> &gt;= <font color=#1b1baa>$w</font> } {
              <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x0</font>-<font color=#1b1baa>$w</font>}]
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> x {-0}
            }
          }
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x0</font>
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> ne {windows}} {
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x0</font>+<font color=#1b1baa>$w</font> &gt; <font color=#1b1baa>$sw</font> } {<b><font color=#3a6797>set</font></b> x {-0}; <b><font color=#3a6797>set</font></b> x0 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$sw</font>-<font color=#1b1baa>$w</font>}]}
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$x0</font> &lt; 0 }      {<b><font color=#3a6797>set</font></b> x {+0}}
          }
          <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$idx</font> == 4 } {
            <i><font color=#4b5d50># try top, then bottom, then 0</font></i>
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$h</font> &lt;= <font color=#1b1baa>$y0</font> } {
              <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y0</font>-<font color=#1b1baa>$h</font>}]
            } <b><font color=#3a6797>elseif</font></b> { <font color=#1b1baa>$y1</font>+<font color=#1b1baa>$h</font> &lt;= <font color=#1b1baa>$sh</font> } {
              <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y1</font>
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> y {+0}
            }
          } <b><font color=#3a6797>else</font></b> {
            <i><font color=#4b5d50># try bottom, then top, then 0</font></i>
            <b><font color=#3a6797>if</font></b> { <font color=#1b1baa>$y1</font>+<font color=#1b1baa>$h</font> &lt;= <font color=#1b1baa>$sh</font> } {
              <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y1</font>
            } <b><font color=#3a6797>elseif</font></b> { <font color=#1b1baa>$h</font> &lt;= <font color=#1b1baa>$y0</font> } {
              <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y0</font>-<font color=#1b1baa>$h</font>}]
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> y {-0}
            }
          }
        }
      }
    }

    <i><font color=#4b5d50>## If there's not a + or - in front of the number, we need to add one.</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is integer [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$x</font> 0]]} { <b><font color=#3a6797>set</font></b> x +<font color=#1b1baa>$x</font> }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is integer [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$y</font> 0]]} { <b><font color=#3a6797>set</font></b> y +<font color=#1b1baa>$y</font> }

    <b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$path</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>${</font>w<font color=#1b1baa>}</font>x<font color=#1b1baa>${</font>h<font color=#1b1baa>}${</font>x<font color=#1b1baa>}${</font>y<font color=#1b1baa>}</font>&quot;</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$path</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>${</font>w<font color=#1b1baa>}</font>x<font color=#1b1baa>${</font>h<font color=#1b1baa>}</font>&quot;</font>
  }
  <b><font color=#3a6797>update</font></b> idletasks
}
<a id=EONS_apave></a>
<i><font color=#4b5d50>## ________________________ EONS apave _________________________ ##</font></i>

}
<a id=APave></a>
<i><font color=#4b5d50># ________________________ APave _________________________ #</font></i>

<b><font color=#ca14ca>oo::class</font></b> create ::apave::APave {

superclass ::apave::APaveDialog

<b><font color=#3a6797>variable</font></b> _savedvv
<a id=constructor></a>
<b><font color=#ca14ca>constructor</font></b> {args} {
  <i><font color=#4b5d50># Creates APave object.</font></i>
  <i><font color=#4b5d50>#   win - window's name (path)</font></i>
  <i><font color=#4b5d50>#   args - additional arguments</font></i>

  <b><font color=#3a6797>set</font></b> _savedvv [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> [<b><font color=#ca14ca>self</font></b> next]]} { <b><font color=#3a6797>next</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> }
}
<a id=destructor></a>
<b><font color=#ca14ca>destructor</font></b> {
  <i><font color=#4b5d50># Clears variables used in the object.</font></i>

  <b><font color=#ca14ca>my</font></b> initInput
  <b><font color=#3a6797>unset</font></b> _savedvv
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> [<b><font color=#ca14ca>self</font></b> next]]} <b><font color=#3a6797>next</font></b>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=initInput></a>
<b><font color=#ca14ca>method</font></b> initInput {} {
  <i><font color=#4b5d50># Initializes input and clears variables made in previous session.</font></i>

  <b><font color=#3a6797>foreach</font></b> {vn vv} <font color=#1b1baa>$_savedvv</font> {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>unset</font></b> <font color=#1b1baa>$vn</font>}
  }
  <b><font color=#3a6797>set</font></b> _savedvv [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> Widgetopts [<b><font color=#3a6797>list</font></b>]
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=varInput></a>
<b><font color=#ca14ca>method</font></b> varInput {} {
  <i><font color=#4b5d50># Gets variables made and filled in a previous session</font></i>
  <i><font color=#4b5d50># as a list of &quot;varname varvalue&quot; pairs where varname</font></i>
  <i><font color=#4b5d50># is of form: namespace::var$widgetname.</font></i>

  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$_savedvv</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=valueInput></a>
<b><font color=#ca14ca>method</font></b> valueInput {} {
  <i><font color=#4b5d50># Gets input variables' values.</font></i>

  <b><font color=#3a6797>set</font></b> _values {}
  <b><font color=#3a6797>foreach</font></b> {vnam -} [<b><font color=#ca14ca>my</font></b> varInput] {
    <b><font color=#3a6797>lappend</font></b> _values [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vnam</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$_values</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=input></a>
<b><font color=#ca14ca>method</font></b> input {icon ttl iopts args} {
  <i><font color=#4b5d50># Makes and runs an input dialog.</font></i>
  <i><font color=#4b5d50>#  icon - icon (omitted if equals to &quot;&quot;)</font></i>
  <i><font color=#4b5d50>#  ttl - title of window</font></i>
  <i><font color=#4b5d50>#  iopts - list of widgets and their attributes</font></i>
  <i><font color=#4b5d50>#  args - list of dialog's attributes</font></i>
  <i><font color=#4b5d50># The `iopts` contains lists of three items:</font></i>
  <i><font color=#4b5d50>#   name - name of widgets</font></i>
  <i><font color=#4b5d50>#   prompt - prompt for entering data</font></i>
  <i><font color=#4b5d50>#   valopts - value options</font></i>
  <i><font color=#4b5d50># The `valopts` is a list specific for a widget's type, however</font></i>
  <i><font color=#4b5d50># a first item of `valopts` is always an initial input value.</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iopts</font> ne {}} {
    <b><font color=#ca14ca>my</font></b> initInput  ;<i><font color=#4b5d50># clear away all internal vars</font></i>
  }
  <b><font color=#3a6797>set</font></b> pady <font color=#8b2a0e>&quot;-pady 2&quot;</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> focusopt [::apave::getOption <font color=#653760>-focus</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]] ne {}} {
    <b><font color=#3a6797>set</font></b> focusopt <font color=#8b2a0e>&quot;-focus <font color=#1b1baa>$</font>focusopt&quot;</font>
  }
  <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> fraM + T 1 98 <font color=#8b2a0e>&quot;-st nsew <font color=#1b1baa>$</font>pady -rw 1&quot;</font>]
  <b><font color=#3a6797>set</font></b> savedvv [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> frameprev {}
  <b><font color=#3a6797>foreach</font></b> {name prompt valopts} <font color=#1b1baa>$iopts</font> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$name</font> eq {}} <b><font color=#ca14ca>continue</font></b>
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$prompt</font> prompt gopts attrs
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attrs <font color=#653760>-method</font> {} <font color=#653760>-toprev</font> {}] ismeth toprev
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> toupper <font color=#1b1baa>$name</font> 0] eq <font color=#1b1baa>$name</font>} {
      <b><font color=#3a6797>set</font></b> ismeth yes  ;<i><font color=#4b5d50># overcomes the above setting</font></i>
      <b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>string</font></b> tolower <font color=#1b1baa>$name</font> 0]
    }
    <b><font color=#3a6797>set</font></b> ismeth [<b><font color=#3a6797>string</font></b> is true <font color=#653760>-strict</font> <font color=#1b1baa>$ismeth</font>]
    <b><font color=#3a6797>set</font></b> gopts <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>pady <font color=#1b1baa>$</font>gopts&quot;</font>
    <b><font color=#3a6797>set</font></b> typ [<b><font color=#3a6797>string</font></b> tolower [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> 0 1]]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> eq <font color=#8b2a0e>&quot;v_&quot;</font> || <font color=#1b1baa>$typ</font> eq <font color=#8b2a0e>&quot;se&quot;</font>} {
      <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> fraM.<font color=#1b1baa>$name</font> - - - - <font color=#8b2a0e>&quot;pack -fill x <font color=#1b1baa>$</font>gopts&quot;</font>]
      <b><font color=#ca14ca>continue</font></b>
    }
    <b><font color=#3a6797>set</font></b> tvar <font color=#8b2a0e>&quot;-tvar&quot;</font>
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$typ</font> {
      ch { <b><font color=#3a6797>set</font></b> tvar <font color=#8b2a0e>&quot;-var&quot;</font> }
      sp { <b><font color=#3a6797>set</font></b> gopts <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>gopts -expand 0 -side left&quot;</font>}
    }
    <b><font color=#3a6797>set</font></b> framename fraM.fra<font color=#1b1baa>$name</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> in {lb te tb}} {  ;<i><font color=#4b5d50># the widgets sized vertically</font></i>
      <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$framename</font> - - - - <font color=#8b2a0e>&quot;pack -expand 1 -fill both&quot;</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$framename</font> - - - - <font color=#8b2a0e>&quot;pack -fill x&quot;</font>]
    }
    <b><font color=#3a6797>set</font></b> vv [<b><font color=#ca14ca>my</font></b> varName <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>set</font></b> ff [<b><font color=#ca14ca>my</font></b> FieldName <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>set</font></b> Name [<b><font color=#3a6797>string</font></b> toupper <font color=#1b1baa>$name</font> 0]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ismeth</font> && <font color=#1b1baa>$typ</font> ni {ra}} {
      <i><font color=#4b5d50># -method option forces making &quot;WidgetName&quot; method from &quot;widgetName&quot;</font></i>
      <b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$ff</font> <font color=#1b1baa>$Name</font> -
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> ne {la} && <font color=#1b1baa>$toprev</font> eq {}} {
      <b><font color=#3a6797>set</font></b> takfoc [::apave::parseOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-takefocus</font> 1]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$focusopt</font> eq {} && <font color=#1b1baa>$takfoc</font>} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> in {fi di cl fo da}} {
          <b><font color=#3a6797>set</font></b> _ en*<font color=#1b1baa>$name</font>  ;<i><font color=#4b5d50># 'entry-like mega-widgets'</font></i>
        } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$typ</font> eq <font color=#8b2a0e>&quot;ft&quot;</font>} {
          <b><font color=#3a6797>set</font></b> _ te*<font color=#1b1baa>$name</font>  ;<i><font color=#4b5d50># ftx - 'text-like mega-widget'</font></i>
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> _ <font color=#1b1baa>$name</font>
        }
        <b><font color=#3a6797>set</font></b> focusopt <font color=#8b2a0e>&quot;-focus <font color=#1b1baa>$</font>_&quot;</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> in {lb tb te}} {<b><font color=#3a6797>set</font></b> anc nw} {<b><font color=#3a6797>set</font></b> anc w}
      <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> fraM.fra<font color=#1b1baa>$name</font>.labB<font color=#1b1baa>$name</font> - - - - \
        <font color=#8b2a0e>&quot;pack -side left -anchor <font color=#1b1baa>$</font>anc -padx 3&quot;</font> \
        <font color=#8b2a0e>&quot;-t \&quot;<font color=#1b1baa>$</font>prompt\&quot; -font \</font>
<font color=#8b2a0e>        \&quot;-family <font color=#1b1baa>{[</font>my basicTextFont<font color=#1b1baa>]}</font> -size <font color=#1b1baa>[</font>my basicFontSize<font color=#1b1baa>]</font>\&quot;&quot;</font>]
    }
    <i><font color=#4b5d50># for most widgets:</font></i>
    <i><font color=#4b5d50>#   1st item of 'valopts' list is the current value</font></i>
    <i><font color=#4b5d50>#   2nd and the rest of 'valopts' are a list of values</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> ni {fc te la}} {
      <i><font color=#4b5d50># curr.value can be set with a variable, so 'subst' is applied</font></i>
      <b><font color=#3a6797>set</font></b> vsel [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$valopts</font> 0]
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> vsel [<b><font color=#3a6797>subst</font></b> <font color=#653760>-nocommands</font> <font color=#653760>-nobackslashes</font> <font color=#1b1baa>$vsel</font>]}
      <b><font color=#3a6797>set</font></b> vlist [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$valopts</font> 1 end]
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> msgLab [::apave::getOption <font color=#653760>-msgLab</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]] ne {}} {
      <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-msgLab</font>]
    }
    <i><font color=#4b5d50># define a current widget's info</font></i>
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$typ</font> {
      lb - tb {
        <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> <font color=#1b1baa>$vlist</font>
        <b><font color=#3a6797>lappend</font></b> attrs <font color=#653760>-lvar</font> <font color=#1b1baa>$vv</font>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vsel</font> ni {{} -}} {
          <b><font color=#3a6797>lappend</font></b> attrs <font color=#653760>-lbxsel</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>::apave::UFF<font color=#1b1baa>$</font>vsel<font color=#1b1baa>$</font>::apave::UFF&quot;</font>
        }
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - \
          <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill both <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#1b1baa>$attrs</font>]
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> fraM.fra<font color=#1b1baa>$name</font>.sbv<font color=#1b1baa>$name</font> <font color=#1b1baa>$ff</font> L - - <font color=#8b2a0e>&quot;pack -fill y&quot;</font>]
      }
      cb {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> <font color=#1b1baa>$vsel</font>}}
        <b><font color=#3a6797>lappend</font></b> attrs <font color=#653760>-tvar</font> <font color=#1b1baa>$vv</font> <font color=#653760>-values</font> <font color=#1b1baa>$vlist</font>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vsel</font> ni {{} -}} {
          <b><font color=#3a6797>lappend</font></b> attrs <font color=#653760>-cbxsel</font> <font color=#1b1baa>$::apave::UFF$vsel$::apave::UFF</font>
        }
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill x <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#1b1baa>$attrs</font>]
      }
      fc {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> {}}}
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill x <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;-tvar <font color=#1b1baa>$</font>vv -values \{<font color=#1b1baa>$</font>valopts\} <font color=#1b1baa>$</font>attrs&quot;</font>]
      }
      op {
        <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> <font color=#1b1baa>$vsel</font>
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - <font color=#8b2a0e>&quot;pack -fill x <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>vv <font color=#1b1baa>$</font>vlist&quot;</font>]
      }
      ra {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> <font color=#1b1baa>$vsel</font>}}
        <b><font color=#3a6797>set</font></b> padx 0
        <b><font color=#3a6797>foreach</font></b> vo <font color=#1b1baa>$vlist</font> {
          <b><font color=#3a6797>set</font></b> name <font color=#1b1baa>$name</font>
          <b><font color=#3a6797>set</font></b> FF <font color=#1b1baa>$ff</font>[<b><font color=#3a6797>incr</font></b> nnn]
          <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$FF</font> - - - - <font color=#8b2a0e>&quot;pack -side left <font color=#1b1baa>$</font>gopts -padx <font color=#1b1baa>$</font>padx&quot;</font> <font color=#8b2a0e>&quot;-var <font color=#1b1baa>$</font>vv -value \&quot;<font color=#1b1baa>$</font>vo\&quot; -t \&quot;<font color=#1b1baa>$</font>vo\&quot; <font color=#1b1baa>$</font>attrs&quot;</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ismeth</font>} {
            <b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$FF</font> <font color=#1b1baa>$Name$nnn</font> -
          }
          <b><font color=#3a6797>set</font></b> padx [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$padx</font> ? 0 : 9}]
        }
      }
      te {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {
          <b><font color=#3a6797>set</font></b> valopts [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \\n \n \\t \t] <font color=#1b1baa>$valopts</font>]
          <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \\\\ \\ \\\} \} \\\{ \{] <font color=#1b1baa>$valopts</font>]
        }
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>dict</font></b> exist <font color=#1b1baa>$attrs</font> <font color=#653760>-state</font>] && [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$attrs</font> <font color=#653760>-state</font>] eq <font color=#8b2a0e>&quot;disabled&quot;</font>} \
        {
          <i><font color=#4b5d50># disabled text widget cannot be filled with a text, so we should</font></i>
          <i><font color=#4b5d50># compensate this through a home-made attribute (-disabledtext)</font></i>
          <b><font color=#3a6797>set</font></b> disattr <font color=#8b2a0e>&quot;-disabledtext \{<font color=#1b1baa>[</font>set <font color=#1b1baa>$</font>vv<font color=#1b1baa>]</font>\}&quot;</font>
        } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>dict</font></b> exist <font color=#1b1baa>$attrs</font> <font color=#653760>-readonly</font>] && [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$attrs</font> <font color=#653760>-readonly</font>] || [<b><font color=#3a6797>dict</font></b> exist <font color=#1b1baa>$attrs</font> <font color=#653760>-ro</font>] && [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$attrs</font> <font color=#653760>-ro</font>]} {
          <b><font color=#3a6797>set</font></b> disattr <font color=#8b2a0e>&quot;-rotext \{<font color=#1b1baa>[</font>set <font color=#1b1baa>$</font>vv<font color=#1b1baa>]</font>\}&quot;</font>
          <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-readonly</font> <font color=#653760>-ro</font>]
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> disattr {}
        }
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill both <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs <font color=#1b1baa>$</font>disattr&quot;</font>]
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> fraM.fra<font color=#1b1baa>$name</font>.sbv<font color=#1b1baa>$name</font> <font color=#1b1baa>$ff</font> L - - <font color=#8b2a0e>&quot;pack -fill y&quot;</font>]
      }
      la {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prompt</font> ne {}} { <b><font color=#3a6797>set</font></b> prompt <font color=#8b2a0e>&quot;-t \&quot;<font color=#1b1baa>$</font>prompt\&quot; &quot;</font> } ;<i><font color=#4b5d50># prompt as -text</font></i>
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - <font color=#8b2a0e>&quot;pack -anchor w <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>prompt<font color=#1b1baa>$</font>attrs&quot;</font>]
        <b><font color=#ca14ca>continue</font></b>
      }
      bu - bt - ch {
        <b><font color=#3a6797>set</font></b> prompt {}
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$toprev</font> eq {}} {
          <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - \
            <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill both <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>tvar <font color=#1b1baa>$</font>vv <font color=#1b1baa>$</font>attrs&quot;</font>]
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$frameprev</font>.<font color=#1b1baa>$name</font> - - - - \
            <font color=#8b2a0e>&quot;pack -side left <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>tvar <font color=#1b1baa>$</font>vv <font color=#1b1baa>$</font>attrs&quot;</font>]
        }
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vv</font> ne {}} {
          <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {
            <b><font color=#3a6797>catch</font></b> {
              <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vsel</font> eq {}} {<b><font color=#3a6797>set</font></b> vsel 0}
              <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> <font color=#1b1baa>$vsel</font>
            }
          }
        }
      }
      <b><font color=#3a6797>default</font></b> {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vlist</font> ne {}} {<b><font color=#3a6797>lappend</font></b> attrs <font color=#653760>-values</font> <font color=#1b1baa>$vlist</font>}
        <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ff</font> - - - - \
          <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill x <font color=#1b1baa>$</font>gopts&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>tvar <font color=#1b1baa>$</font>vv <font color=#1b1baa>$</font>attrs&quot;</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vv</font> ne {}} {
          <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> <font color=#1b1baa>$vsel</font>}}
        }
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$msgLab</font> ne {}} {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$msgLab</font> lab msg attlab
      <b><font color=#3a6797>set</font></b> lab [<b><font color=#ca14ca>my</font></b> parentWName [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$inopts</font> end 0]].<font color=#1b1baa>$lab</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$msg</font> ne {}} {<b><font color=#3a6797>set</font></b> msg <font color=#8b2a0e>&quot;-t <font color=#1b1baa>{$</font>msg<font color=#1b1baa>}</font>&quot;</font>}
      <b><font color=#3a6797>append</font></b> msg <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>attlab&quot;</font>
      <b><font color=#3a6797>lappend</font></b> inopts [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$lab</font> - - - - <font color=#8b2a0e>&quot;pack -side left -expand 1 -fill x&quot;</font> <font color=#1b1baa>$msg</font>]
    }
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$vv</font>]} {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font> {}}
    <b><font color=#3a6797>lappend</font></b> _savedvv <font color=#1b1baa>$vv</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vv</font>]
    <b><font color=#3a6797>set</font></b> frameprev <font color=#1b1baa>$framename</font>
  }
  <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$args</font> <font color=#653760>-titleHELP</font> {} <font color=#653760>-buttons</font> {} <font color=#653760>-comOK</font> 1 \
    <font color=#653760>-titleOK</font> OK <font color=#653760>-titleCANCEL</font> Cancel <font color=#653760>-centerme</font> {}] \
    titleHELP buttons comOK titleOK titleCANCEL centerme
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$titleHELP</font> eq {}} {
    <b><font color=#3a6797>set</font></b> butHelp {}
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$titleHELP</font> title command
    <b><font color=#3a6797>set</font></b> butHelp [<b><font color=#3a6797>list</font></b> butHELP <font color=#1b1baa>$title</font> <font color=#1b1baa>$command</font>]
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$titleCANCEL</font> eq {}} {
    <b><font color=#3a6797>set</font></b> butCancel {}
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> butCancel <font color=#8b2a0e>&quot;butCANCEL <font color=#1b1baa>$</font>titleCANCEL destroy&quot;</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$centerme</font> eq {}} {
    <b><font color=#3a6797>set</font></b> centerme {<font color=#653760>-centerme</font> 1}
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> centerme <font color=#8b2a0e>&quot;-centerme <font color=#1b1baa>$</font>centerme&quot;</font>
  }
  <b><font color=#3a6797>set</font></b> args [::apave::removeOptions <font color=#1b1baa>$args</font> \
    <font color=#653760>-titleHELP</font> <font color=#653760>-buttons</font> <font color=#653760>-comOK</font> <font color=#653760>-titleOK</font> <font color=#653760>-titleCANCEL</font> <font color=#653760>-centerme</font>]
  <b><font color=#3a6797>lappend</font></b> args {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$focusopt</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> PrepArgs {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>] args
    <b><font color=#3a6797>set</font></b> res [<b><font color=#ca14ca>my</font></b> Query <font color=#1b1baa>$icon</font> <font color=#1b1baa>$ttl</font> {} \
      <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>butHelp <font color=#1b1baa>$</font>buttons butOK <font color=#1b1baa>$</font>titleOK <font color=#1b1baa>$</font>comOK <font color=#1b1baa>$</font>butCancel&quot;</font> \
      butOK <font color=#1b1baa>$inopts</font> <font color=#1b1baa>$args</font> {} {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$centerme</font> <font color=#653760>-input</font> yes]} e]
  } <b><font color=#3a6797>then</font></b> {
    <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$Dlgpath</font>}  ;<i><font color=#4b5d50># Query's window</font></i>
    <b><font color=#3a6797>set</font></b> under \n[<b><font color=#3a6797>string</font></b> repeat _ 80]\n\n
    ::apave::obj ok err <font color=#8b2a0e>&quot;ERROR&quot;</font> <font color=#8b2a0e>&quot;\n<font color=#1b1baa>$</font>e<font color=#1b1baa>$</font>under <font color=#1b1baa>$</font>inopts<font color=#1b1baa>$</font>under <font color=#1b1baa>$</font>args<font color=#1b1baa>$</font>under <font color=#1b1baa>$</font>centerme&quot;</font> \
      <font color=#653760>-t</font> 1 <font color=#653760>-head</font> <font color=#8b2a0e>&quot;\nAPave error: \n&quot;</font> <font color=#653760>-hfg</font> red <font color=#653760>-weight</font> bold <font color=#653760>-w</font> 80
    <b><font color=#ca14ca>return</font></b> 0
  }
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$res</font> 0]} {  ;<i><font color=#4b5d50># restore old values if OK not chosen</font></i>
    <b><font color=#3a6797>foreach</font></b> {vn vv} <font color=#1b1baa>$_savedvv</font> {
      <i><font color=#4b5d50># tk_optionCascade (destroyed now) was tracing its variable =&gt; catch</font></i>
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vn</font> <font color=#1b1baa>$vv</font>}
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=vieweditFile></a>
<b><font color=#ca14ca>method</font></b> vieweditFile {fname {prepcom <font color=#8b2a0e>&quot;&quot;</font>} args} {
  <i><font color=#4b5d50># Views or edits a file.</font></i>
  <i><font color=#4b5d50>#   fname - name of file</font></i>
  <i><font color=#4b5d50>#   prepcom - a command performing before and after creating a dialog</font></i>
  <i><font color=#4b5d50>#   args - additional options</font></i>
  <i><font color=#4b5d50># It's a sort of stub for calling *editfile* method.</font></i>
  <i><font color=#4b5d50># See also: editfile</font></i>

  <b><font color=#ca14ca>my</font></b> editfile <font color=#1b1baa>$fname</font> {} {} {} <font color=#1b1baa>$prepcom</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=editfile></a>
<b><font color=#ca14ca>method</font></b> editfile {fname fg bg cc {prepcom <font color=#8b2a0e>&quot;&quot;</font>} args} {
  <i><font color=#4b5d50># Edits or views a file with a set of main colors</font></i>
  <i><font color=#4b5d50>#   fname - name of file</font></i>
  <i><font color=#4b5d50>#   fg - foreground color of text widget</font></i>
  <i><font color=#4b5d50>#   bg - background color of text widget</font></i>
  <i><font color=#4b5d50>#   cc - caret's color of text widget</font></i>
  <i><font color=#4b5d50>#   prepcom - a command performing before and after creating a dialog</font></i>
  <i><font color=#4b5d50>#   args - additional options (`-readonly 1` for viewing the file).</font></i>
  <i><font color=#4b5d50># If *fg* isn't empty, all three colors are used to color a text.</font></i>
  <i><font color=#4b5d50># See also:</font></i>
  <i><font color=#4b5d50># [aplsimple.github.io](https://aplsimple.github.io/en/tcl/pave/index.html)</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fname</font> eq {}} {
    <b><font color=#ca14ca>return</font></b> false
  }
  <b><font color=#3a6797>set</font></b> newfile 0
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> filetxt [::apave::readTextFile <font color=#1b1baa>$fname</font> {} yes]}]} {
    <b><font color=#ca14ca>return</font></b> false
  }
  <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$args</font> <font color=#653760>-rotext</font> {} <font color=#653760>-readonly</font> 1 <font color=#653760>-ro</font> 1] rotext readonly ro
  <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-buttons</font> {}] buttadd
  <b><font color=#3a6797>set</font></b> btns {Close 0}  ;<i><font color=#4b5d50># by default 'view' mode</font></i>
  <b><font color=#3a6797>set</font></b> oper VIEW
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rotext</font> eq {} && (!<font color=#1b1baa>$readonly</font> || !<font color=#1b1baa>$ro</font>)} {
    <b><font color=#3a6797>set</font></b> btns {Save 1 Close 0}
    <b><font color=#3a6797>set</font></b> oper EDIT
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fg</font> eq {}} {
    <b><font color=#3a6797>set</font></b> tclr {}
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> tclr <font color=#8b2a0e>&quot;-fg <font color=#1b1baa>$</font>fg -bg <font color=#1b1baa>$</font>bg -cc <font color=#1b1baa>$</font>cc&quot;</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prepcom</font> eq {}} {<b><font color=#3a6797>set</font></b> aa {}} {<b><font color=#3a6797>set</font></b> aa [<font color=#1b1baa>$prepcom</font> filetxt]}
  <b><font color=#3a6797>set</font></b> res [<b><font color=#ca14ca>my</font></b> misc {} <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>oper: <font color=#1b1baa>$</font>fname&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>filetxt&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>buttadd <font color=#1b1baa>$</font>btns&quot;</font> \
    TEXT <font color=#653760>-text</font> 1 <font color=#653760>-w</font> {100 80} <font color=#653760>-h</font> 32 {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$tclr</font> \
    <font color=#653760>-post</font> <font color=#1b1baa>$prepcom</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$aa</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
  <b><font color=#3a6797>set</font></b> data [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$res</font> 2 end]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$res</font> 0]] eq <font color=#8b2a0e>&quot;1&quot;</font>} {
    <b><font color=#3a6797>set</font></b> data [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$data</font> [<b><font color=#3a6797>string</font></b> first <font color=#8b2a0e>&quot; &quot;</font> <font color=#1b1baa>$data</font>]+1 end]
    <b><font color=#3a6797>set</font></b> data [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$data</font>]
    <b><font color=#3a6797>set</font></b> res [::apave::writeTextFile <font color=#1b1baa>$fname</font> data]
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$newfile</font>} {
    <b><font color=#3a6797>file</font></b> delete <font color=#1b1baa>$fname</font>
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<i><font color=#4b5d50>#_______________________</font></i>
<a id=onTop></a>
<b><font color=#ca14ca>method</font></b> onTop {wpar top {wtoplist -} {res <font color=#8b2a0e>&quot;&quot;</font>}} {
  <i><font color=#4b5d50># Sets -topmost attribute for windows or gets a list of topmost windows.</font></i>
  <i><font color=#4b5d50>#   wpar - parent window's path</font></i>
  <i><font color=#4b5d50>#   top - -topmost attribute's value</font></i>
  <i><font color=#4b5d50>#   wtoplist - list of windows to process</font></i>
  <i><font color=#4b5d50>#   res - used to get the result</font></i>
  <i><font color=#4b5d50># Returns a list of &quot;topmost=$top&quot; windows found on $wpar path.</font></i>

  <b><font color=#3a6797>set</font></b> res {}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wtoplist</font> ne <font color=#8b2a0e>&quot;-&quot;</font>} {
    <i><font color=#4b5d50># sets the attribute</font></i>
    <b><font color=#3a6797>foreach</font></b> w <font color=#1b1baa>$wtoplist</font> {<b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$w</font> <font color=#653760>-topmost</font> <font color=#1b1baa>$top</font>}
  } <b><font color=#3a6797>else</font></b> {
    <i><font color=#4b5d50># gets a list of topmost windows</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wpar</font> ne {}} {
      <b><font color=#3a6797>catch</font></b> {
        <b><font color=#3a6797>set</font></b> res [<b><font color=#ca14ca>my</font></b> onTop [<b><font color=#134070>winfo</font></b> parent <font color=#1b1baa>$wpar</font>] <font color=#1b1baa>$top</font> - <font color=#1b1baa>$res</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$wpar</font> <font color=#653760>-topmost</font>]==<font color=#1b1baa>$top</font>} {<b><font color=#3a6797>lappend</font></b> res <font color=#1b1baa>$wpar</font>}
      }
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
}
<a id=EONS></a>
<i><font color=#4b5d50># ________________________ EONS _________________________ #</font></i>

}<a id=EOF></a>
<i><font color=#4b5d50># ________________________ EOF _________________________ #</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../index.html"><font color=#1a1a1a size=6>  <b>apave.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>