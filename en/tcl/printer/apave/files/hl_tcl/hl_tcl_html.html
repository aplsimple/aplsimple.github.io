<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>

<title>hl_tcl_html.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>hl_tcl_html.tcl</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">hl_tcl_html.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#hl_tcl_html.tcl">hl_tcl_html.tcl</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#hl_tcl_html::insertTag">insertTag</a><span class=tooltiptext> hl_tcl_html::insertTag : Inserts a html tag into Tcl code.
pN - variable's name for a position of the tag
tN - variable's name for the tag
lcodeN - variable's name for the list of code lines</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#hl_tcl_html::highlight">highlight</a><span class=tooltiptext> hl_tcl_html::highlight : Processes html file to find and highlight embedded Tcl code.
htmlfile - file name
darkedit - flag "the text widget has dark background" ("no" by default)
args - list of tag pairs
A tag pair consists of:
tag1 - opening tag(s) of Tcl code snippet
tag2 - ending tag(s) of Tcl code snippet</span></div></li></ul>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->



<pre class="code"><i><font color=#4b5d50># _______________________________________________________________________ #<a id=hl_tcl_html.tcl></a></font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Highlighting Tcl code with html tags.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Scripted by Alex Plotnikov (aplsimple@gmail.com).</font></i>
<i><font color=#4b5d50># License: MIT.</font></i>
<i><font color=#4b5d50># _______________________________________________________________________ #</font></i>

<b><font color=#3a6797>package</font></b> require Tk
<b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join [<b><font color=#3a6797>file</font></b> dirname [<b><font color=#3a6797>info</font></b> script]] hl_tcl.tcl]

<b><font color=#ca14ca>namespace</font></b> eval ::hl_tcl_html {
}
<a id=hl_tcl_html::insertTag></a>
<b><font color=#ca14ca>proc</font></b>  ::hl_tcl_html::insertTag {pN tN lcodeN} {
  <i><font color=#4b5d50># Inserts a html tag into Tcl code.</font></i>
  <i><font color=#4b5d50>#   pN - variable's name for a position of the tag</font></i>
  <i><font color=#4b5d50>#   tN - variable's name for the tag</font></i>
  <i><font color=#4b5d50>#   lcodeN - variable's name for the list of code lines</font></i>

  <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$pN</font> p <font color=#1b1baa>$tN</font> t <font color=#1b1baa>$lcodeN</font> lcode
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$p</font> .] l c
  <b><font color=#3a6797>incr</font></b> l -1
  <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lcode</font> <font color=#1b1baa>$l</font>]
  <b><font color=#3a6797>set</font></b> line1 [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 0 <font color=#1b1baa>$c</font>-1]
  <b><font color=#3a6797>set</font></b> line2 [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$c</font> end]
  <b><font color=#3a6797>set</font></b> lcode [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$lcode</font> <font color=#1b1baa>$l</font> <font color=#1b1baa>$l</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>line1<font color=#1b1baa>$</font>t<font color=#1b1baa>$</font>line2&quot;</font>]
}
<a id=hl_tcl_html::highlight></a>
<b><font color=#ca14ca>proc</font></b> ::hl_tcl_html::highlight {htmlfile darkedit args} {
  <i><font color=#4b5d50># Processes html file to find and highlight embedded Tcl code.</font></i>
  <i><font color=#4b5d50>#   htmlfile - file name</font></i>
  <i><font color=#4b5d50>#   darkedit - flag &quot;the text widget has dark background&quot; (&quot;no&quot; by default)</font></i>
  <i><font color=#4b5d50>#   args - list of tag pairs</font></i>
  <i><font color=#4b5d50># A tag pair consists of:</font></i>
  <i><font color=#4b5d50>#   tag1 - opening tag(s) of Tcl code snippet</font></i>
  <i><font color=#4b5d50>#   tag2 - ending tag(s) of Tcl code snippet</font></i>

  <b><font color=#3a6797>set</font></b> txt .hl_tcl_Temp
  <b><font color=#134070>text</font></b> <font color=#1b1baa>$txt</font>
  <b><font color=#3a6797>set</font></b> chan [<b><font color=#3a6797>open</font></b> <font color=#1b1baa>$htmlfile</font>]
  <b><font color=#3a6797>chan</font></b> configure <font color=#1b1baa>$chan</font> <font color=#653760>-encoding</font> utf-8
  <b><font color=#3a6797>set</font></b> text [<b><font color=#3a6797>read</font></b> <font color=#1b1baa>$chan</font>]
  <b><font color=#3a6797>close</font></b> <font color=#1b1baa>$chan</font>
  <b><font color=#3a6797>lassign</font></b> [::hl_tcl::hl_colors 1 <font color=#1b1baa>$darkedit</font>] clrCOM clrCOMTK clrSTR clrVAR clrCMN clrPROC clrOPT
  <b><font color=#3a6797>lassign</font></b> [::hl_tcl::addingColors <font color=#1b1baa>$darkedit</font>] -&gt; clrCMN2
  <b><font color=#3a6797>set</font></b> cs {}
  <b><font color=#3a6797>foreach</font></b> {tag1 tag2} <font color=#1b1baa>$args</font> {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> cs <font color=#1b1baa>$tag1</font>]} {
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$tag2</font> ,] clrCOM clrCOMTK clrSTR clrVAR clrCMN clrPROC clrOPT
      <b><font color=#ca14ca>continue</font></b>
    }
    <b><font color=#3a6797>set</font></b> ic [<b><font color=#3a6797>set</font></b> ic2 0]
    <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$ic</font>&gt;=0 && <font color=#1b1baa>$ic2</font>&gt;=0} {
      <b><font color=#3a6797>set</font></b> ic [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$tag1</font> <font color=#1b1baa>$text</font> <font color=#1b1baa>$ic</font>]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ic</font>&gt;=0} {
        <b><font color=#3a6797>incr</font></b> ic [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$tag1</font>]
        <b><font color=#3a6797>set</font></b> ic2 [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$tag2</font> <font color=#1b1baa>$text</font> <font color=#1b1baa>$ic</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ic2</font>&gt;=0} {
          <b><font color=#3a6797>set</font></b> code [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$text</font> <font color=#1b1baa>$ic</font> <font color=#1b1baa>$ic2</font>-1]
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>regexp</font></b> <font color=#8b2a0e>&quot;&lt;font color=#\[0-9a-fA-F\]<font color=#1b1baa>{</font>6<font color=#1b1baa>}</font>&gt;&quot;</font> <font color=#1b1baa>$code</font>]} {
            <b><font color=#3a6797>set</font></b> ic [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$ic2</font>+[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$tag2</font>]}]
            <b><font color=#ca14ca>continue</font></b>  ;<i><font color=#4b5d50># already processed</font></i>
          }
          <b><font color=#3a6797>set</font></b> code [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> <font color=#8b2a0e>&quot;&quot;&quot; \&quot; &quot;</font>&<font color=#8b2a0e>&quot; & &lt; &quot;</font>&lt;<font color=#8b2a0e>&quot; &gt; &quot;</font>&gt;<font color=#8b2a0e>&quot;<font color=#1b1baa>]</font> <font color=#1b1baa>$</font>code<font color=#1b1baa>]</font></font>
<font color=#8b2a0e>          ::hl_tcl::hl_init <font color=#1b1baa>$</font>txt -dark <font color=#1b1baa>$</font>darkedit -seen 99999999</font>
<font color=#8b2a0e>          <font color=#1b1baa>$</font>txt replace 1.0 end <font color=#1b1baa>$</font>code</font>
<font color=#8b2a0e>          ::hl_tcl::hl_text <font color=#1b1baa>$</font>txt</font>
<font color=#8b2a0e>          set taglist <font color=#1b1baa>[</font>list<font color=#1b1baa>]</font></font>
<font color=#8b2a0e>          foreach tag <font color=#1b1baa>{</font>tagCOM tagCOMTK tagSTR tagVAR tagCMN tagCMN2 tagPROC tagOPT<font color=#1b1baa>}</font> <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>            foreach <font color=#1b1baa>{</font>p1 p2<font color=#1b1baa>}</font> <font color=#1b1baa>[$</font>txt tag ranges <font color=#1b1baa>$</font>tag<font color=#1b1baa>]</font> <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>              lassign <font color=#1b1baa>[</font>split <font color=#1b1baa>$</font>p1 .<font color=#1b1baa>]</font> l1 c1</font>
<font color=#8b2a0e>              lassign <font color=#1b1baa>[</font>split <font color=#1b1baa>$</font>p2 .<font color=#1b1baa>]</font> l2 c2</font>
<font color=#8b2a0e>              lappend taglist <font color=#1b1baa>[</font>list <font color=#1b1baa>[</font>format %06d <font color=#1b1baa>$</font>l1<font color=#1b1baa>][</font>format %06d <font color=#1b1baa>$</font>c1<font color=#1b1baa>]</font> <font color=#1b1baa>$</font>tag 1 <font color=#1b1baa>$</font>p1<font color=#1b1baa>]</font></font>
<font color=#8b2a0e>              lappend taglist <font color=#1b1baa>[</font>list <font color=#1b1baa>[</font>format %06d <font color=#1b1baa>$</font>l2<font color=#1b1baa>][</font>format %06d <font color=#1b1baa>$</font>c2<font color=#1b1baa>]</font> <font color=#1b1baa>$</font>tag 2 <font color=#1b1baa>$</font>p2<font color=#1b1baa>]</font></font>
<font color=#8b2a0e>            <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>          <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>          set taglist <font color=#1b1baa>[</font>lsort -decreasing <font color=#1b1baa>$</font>taglist<font color=#1b1baa>]</font></font>
<font color=#8b2a0e>          set lcode <font color=#1b1baa>[</font>split <font color=#1b1baa>$</font>code \n<font color=#1b1baa>]</font></font>
<font color=#8b2a0e>          foreach tagdat <font color=#1b1baa>$</font>taglist <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>            lassign <font color=#1b1baa>$</font>tagdat -&gt; tag typ pos</font>
<font color=#8b2a0e>            switch -exact <font color=#1b1baa>$</font>tag <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>              tagCOM <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;b&gt;&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrCOM</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;&lt;/b&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagCOMTK <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;b&gt;&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrCOMTK</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;&lt;/b&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagPROC <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;b&gt;&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrPROC</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;&lt;/b&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagSTR <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrSTR</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagVAR <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrVAR</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagCMN <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;i&gt;&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrCMN</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;&lt;/i&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagCMN2 <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;i&gt;&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrCMN2</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;&lt;/i&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>              tagOPT <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>                set t1 &quot;</font>&lt;<b><font color=#134070>font</font></b> color=<font color=#1b1baa>$clrOPT</font>&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>                set t2 &quot;</font>&lt;/font&gt;<font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>              <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>            <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>            if <font color=#1b1baa>{$</font>typ==1<font color=#1b1baa>}</font> <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>              insertTag pos t1 lcode</font>
<font color=#8b2a0e>            <font color=#1b1baa>}</font> else <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>              insertTag pos t2 lcode</font>
<font color=#8b2a0e>            <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>          <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>          set code &quot;&quot;</font>
<font color=#8b2a0e>          foreach lc <font color=#1b1baa>$</font>lcode <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>            if <font color=#1b1baa>{$</font>code ne &quot;&quot;<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>append code \n<font color=#1b1baa>}</font></font>
<font color=#8b2a0e>            append code <font color=#1b1baa>$</font>lc</font>
<font color=#8b2a0e>          <font color=#1b1baa>}</font></font>
<font color=#8b2a0e>          set code <font color=#1b1baa>[</font>string map <font color=#1b1baa>[</font>list \&quot; &quot;&quot;&quot;</font>] <font color=#1b1baa>$code</font>]
          <b><font color=#3a6797>set</font></b> text1 [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$text</font> 0 <font color=#1b1baa>$ic</font>-1]
          <b><font color=#3a6797>set</font></b> text2 [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$text</font> <font color=#1b1baa>$ic2</font> end]
          <b><font color=#3a6797>set</font></b> text <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>text1<font color=#1b1baa>$</font>code&quot;</font>
          <b><font color=#3a6797>set</font></b> ic [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$text</font>]
          <b><font color=#3a6797>set</font></b> text <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>text<font color=#1b1baa>$</font>text2&quot;</font>
        }
      }
    }
  }
  <b><font color=#3a6797>set</font></b> chan [<b><font color=#3a6797>open</font></b> <font color=#1b1baa>$htmlfile</font> w]
  <b><font color=#3a6797>chan</font></b> configure <font color=#1b1baa>$chan</font> <font color=#653760>-encoding</font> utf-8
  <b><font color=#3a6797>puts</font></b> <font color=#653760>-nonewline</font> <font color=#1b1baa>$chan</font> <font color=#1b1baa>$text</font>
  <b><font color=#3a6797>close</font></b> <font color=#1b1baa>$chan</font>
  <b><font color=#134070>destroy</font></b> <font color=#1b1baa>$txt</font>
}
<a id=EOF></a>
<i><font color=#4b5d50># _________________________________ EOF _________________________________ #</font></i>
<i><font color=#4b5d50>#% file copy -force .bak/index-SRC.html .bak/index.html</font></i>
<i><font color=#4b5d50>#% exec tclsh ./tcl_html.tcl .bak/index.html</font></i>
<i><font color=#4b5d50>#% exec opera .bak/index.html</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#bdd7e7><div style=text-align:center>  <a href="../../index.html"><font color=#1a1a1a size=6>  <b>hl_tcl_html.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>