<!DOCTYPE html><html><head><meta charset="utf-8"/>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
</head>
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<script>
function homeLINK() {
  homelink = document.baseURI;
  ilen = 19
  ibase = homelink.indexOf('aplsimple.github');
  if (ibase<0) { ibase = homelink.indexOf('aplsimple_github'); ilen += 10 };
  if (ibase>=0) { homelink = homelink.substring(0,ibase+ilen) };
  return homelink;
};
document.write(' \
<link rel="stylesheet" href="'+homeLINK()+'/en/tcl/printer/zoo/style.css">');
document.write(' \
<link rel="icon" type="image/jpg" href="'+homeLINK()+'/zoo/favicon.jpg">');
document.write('<'+'script src="'+homeLINK()+'/zoo/funcs.js">'+'<'+'/script>');
document.write('<'+'script src="'+homeLINK()+'/en/tcl/printer/zoo/this.js">'+'<'+'/script>');
</script>
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<section id=sec2>
<div id='hd' class='banner'>
<link rel="stylesheet" href="../css/style.css">

<title>apavebase.tcl</title>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../index.html"><font color=#1a1a1a size=6>  <b>README.md</b></font></div></td></table>

<div id="bodyContent" class="dokuwiki">
<div id="dw__toc" class="dw__toc">
<h3 class="toggle open" style="cursor: pointer;">apavebase.tcl</h3>
<div aria-expanded="true" style="">

<ul class="toc">
<li><b><a href="#apavebase.tcl">apavebase.tcl</a></b></li>
<li><b><a href="#TCLLIBPATH">TCLLIBPATH</a></b></li>
<li><b><a href="#Remove_installed_subpackages_of_apave">Remove installed subpackages of apave</a></b></li>
<li><b><a href="#apave_NS">apave NS</a></b></li>
<li><b><a href="#apave_variables">&nbsp;&nbsp;apave variables</a></b></li>
<li><b><a href="#default_options_&_attributes_of_widgets">&nbsp;&nbsp;default options & attributes of widgets</a></b></li>
<li><b><a href="#Helpers">&nbsp;&nbsp;Helpers</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#WindowStatus">WindowStatus</a><span class=tooltiptext> WindowStatus : Sets/gets a status of window. The status is a value assigned to a name.
w - window's path
name - name of status
val - if blank, to get a value of status; otherwise a value to set
defval - default value (actual if the status not set beforehand)
Returns a value of status.
See also: IntStatus</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#mainWindowOfApp">mainWindowOfApp</a><span class=tooltiptext> mainWindowOfApp : Sets/gets a main window of application.
win - window's path
This should be run at application start, before opening any window.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#IntStatus">IntStatus</a><span class=tooltiptext> IntStatus : Sets/gets a status of window. The status is an integer assigned to a name.
w - window's path
name - name of status
val - if blank, to get a value of status; otherwise a value to set
Default value of status is 0.
Returns an old value of status.
See also: WindowStatus</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#iconImage">iconImage</a><span class=tooltiptext> iconImage : Gets a defined icon's image or list of icons.
If *icon* equals to "-init", initializes apave's icon set.
icon - icon's name
iconset - one of small/middle/large
doit - force the initialization
Returns the icon's image or, if *icon* is blank, a list of icons
available in *apave*.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#iconData">iconData</a><span class=tooltiptext> iconData : Gets an icon's data.
icon - icon's name
iconset - one of small/middle/large
Returns data of the icon.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#setAppIcon">setAppIcon</a><span class=tooltiptext> setAppIcon : Sets application's icon.
win - path to a window of application
winicon - data of icon
The *winicon* may be a contents of variable (as supposed by default) or
a file's name containing th image data.
If it fails to find an image in either, no icon is set.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#getAppIcon">getAppIcon</a><span class=tooltiptext> getAppIcon : Gets application's icon.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#precedeWidgetName">precedeWidgetName</a><span class=tooltiptext> precedeWidgetName : Adds a preceding name to a tail name of widget.
widname - widget's full name
prename - preceding name
Useful at getting a entry/button name of chooser.
Example:
set wentry [::apave::precedeWidgetName [$pobj DirToChoose] ent]
See also: APaveBase::Replace_chooser</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#defaultAttrs">defaultAttrs</a><span class=tooltiptext> defaultAttrs : Sets, gets or registers default options and attributes for widget type.
type - widget type
opts - new default grid/pack options
atrs - new default attributes
widget - Tcl/Tk command for the new registered widget type
See also: APaveBase::defaultATTRS</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#focusApp">focusApp</a><span class=tooltiptext> focusApp : Saves (if *win* is set) or restores app's focus.
win - focused window's path
In some DE, if app loses focus, restoring it
focuses main window, ignores modal toplevel, locks keyboard.
focusApp tries to focus on last modal window.</span></div></li></ul>
<li><b><a href="#Text_little_procs">&nbsp;&nbsp;Text little procs</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#eventOnText">eventOnText</a><span class=tooltiptext> eventOnText : Generates an event on a text, saving its current index in hl_tcl.
w - text widget's path
ev - event
The hl_tcl needs to call MemPos before any action changing the text.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#getTextHotkeys">getTextHotkeys</a><span class=tooltiptext> getTextHotkeys : Gets upper & lower keys for a hot key.
key - the hot key</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#setTextHotkeys">setTextHotkeys</a><span class=tooltiptext> setTextHotkeys : Sets new key combinations for some operations on text widgets.
key - ctrlD for "double selection", ctrlY for "delete line" operation
value - list of new key combinations</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#setTextIndent">setTextIndent</a><span class=tooltiptext> setTextIndent : Sets an indenting for text widgets.
len - length of indenting
padchar - indenting character</span></div></li></ul>
<li><b><a href="#EONS_::apave">&nbsp;&nbsp;EONS ::apave</a></b></li>
<li><b><a href="#source_*.tcl">source *.tcl</a></b></li>
<li><b><a href="#APaveBase_oo::class">APaveBase oo::class</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#constructor">constructor</a><span class=tooltiptext> constructor : Creates APaveBase object.
cs - color scheme (CS)
args - additional arguments
If cs>-2, the appropriate CS is set for the created APaveBase object.
Makes few procedures in the object's namespace to access from
event handlers:
- ListboxHandle
- ListboxSelect
- WinResize
This trick with *proc* inside an object is discussed at
[proc-in-tcl-ooclass](https://stackoverflow.com/questions/54804964/proc-in-tcl-ooclass)
keep the 'important' data of Pave object in array</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#destructor">destructor</a><span class=tooltiptext> destructor : Clears variables used in the object.</span></div></li></ul>
<li><b><a href="#Methods_to_be_redefined">&nbsp;&nbsp;Methods to be redefined</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#themePopup">themePopup</a><span class=tooltiptext> themePopup : Applies a color scheme to a popup menu.
mnu - name of popup menu
The method is to be redefined in descendants/mixins.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#NonTtkTheme">NonTtkTheme</a><span class=tooltiptext> NonTtkTheme : Applies a current color scheme for non-ttk widgets.
win - path to a window to be colored.
Method to be redefined in descendants/mixins.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#NonTtkStyle">NonTtkStyle</a><span class=tooltiptext> NonTtkStyle : Gets a style for non-ttk widgets.
typ - the type of widget (in apave terms, i.e. but, buT etc.)
dsbl - a mode to get style of disabled (1) or readonly (2) widgets
See also: widgetType
Method to be redefined in descendants/mixins.</span></div></li></ul>
<li><b><a href="#Helpers_for_APaveBase">&nbsp;&nbsp;Helpers for APaveBase</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#paveoptionValue">paveoptionValue</a><span class=tooltiptext> paveoptionValue : Gets an option's value.
opt - option's name
Returns a value for options like "Moveall".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#checkXY">checkXY</a><span class=tooltiptext> checkXY : Checks the coordinates of window (against the screen).
w - width of window
h - height of window
x - window's X coordinate
y - window's Y coordinate
Returns new coordinates in +X+Y form.
check for left/right edge of screen (accounting decors)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#CenteredXY">CenteredXY</a><span class=tooltiptext> CenteredXY : Gets the coordinates of centered window (against its parent).
rw - parent's width
rh - parent's height
rx - parent's X coordinate
ry - parent's Y coordinate
w - width of window to be centered
h - height of window to be centered
Returns centered coordinates in +X+Y form.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#ownWName">ownWName</a><span class=tooltiptext> ownWName : Gets a tail (last part) of widget's name
name - name (path) of the widget</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#parentWName">parentWName</a><span class=tooltiptext> parentWName : Gets parent name of widget.
name - name (path) of the widget</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#iconA">iconA</a><span class=tooltiptext> iconA : Gets icon attributes for buttons, menus etc.
icon - name of icon
iconset - one of small/middle/large
cmpd - value of -compound option
The *iconset* is "small" for menus (recommended and default).</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#configure">configure</a><span class=tooltiptext> configure : Configures the apave object (all of options may be changed).
args - list of pairs name/value of options
Example:
pobj configure edge "@@"</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#ExpandOptions">ExpandOptions</a><span class=tooltiptext> ExpandOptions : Expands shortened options.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#AddButtonIcon">AddButtonIcon</a><span class=tooltiptext> AddButtonIcon : Gets the button's icon based on its text and name (e.g. butOK) and
appends it to the attributes of button.
w - button's name
attrsName - name of variable containing attributes of the button</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#ListboxesAttrs">ListboxesAttrs</a><span class=tooltiptext> ListboxesAttrs : Appends selection attributes to listboxes.
Details:
1. https://wiki.tcl-lang.org/page/listbox+selection
2. https://stackoverflow.com, the question:
the-tablelist-curselection-goes-at-calling-the-directory-dialog</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#getWidChildren">getWidChildren</a><span class=tooltiptext> getWidChildren : Gets children of a widget.
wid - widget's path
treeName - name of variable to hold the result.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#findWidPath">findWidPath</a><span class=tooltiptext> findWidPath : Searches a widget's path among the active widgets.
w - widget name, set partially e.g. "wid" instead of ".win.wid"
mode - if "exact", searches *.wid; if "globe", searches *wid*
Returns the widget's full path or "" if the widget isn't active.</span></div></li></ul>
<li><b><a href="#File_content_widget">&nbsp;&nbsp;File content widget</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#FCfieldAttrs">FCfieldAttrs</a><span class=tooltiptext> FCfieldAttrs : Fills the non-standard attributes of file content widget.
wnamefull - a widget name
attrs - a list of all attributes
varopt - a variable option
The *varopt* refers to a variable part such as tvar, lvar:
* -inpval option means an initial value of the field
* -retpos option has p1:p2 format (e.g. 0:10) to cut a substring \</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#FCfieldValues">FCfieldValues</a><span class=tooltiptext> FCfieldValues : Fills the file content widget's values.
wnamefull - name (path) of fco widget
attrs - attributes of the widget</span></div></li></ul>
<li><b><a href="#Timeout_button">&nbsp;&nbsp;Timeout button</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#timeoutButton">timeoutButton</a><span class=tooltiptext> timeoutButton : Invokes a button's action after a timeout.
w - button's path
tmo - timeout in sec.
lbl - label widget, where seconds to wait are displayed
lbltext - original text of label</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#checkTimeoutButton">checkTimeoutButton</a><span class=tooltiptext> checkTimeoutButton : Checks if the timeout button is alive & focused; if not, cancels the timeout.
w - button's path
tmo - timeout in sec.
lbl - label widget, where seconds to wait are displayed
lbltext - original text of label</span></div></li></ul>
<li><b><a href="#Making_widgets">&nbsp;&nbsp;Making widgets</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#widgetType">widgetType</a><span class=tooltiptext> widgetType : Gets the widget type based on 3 initial letters of its name. Also
fills the grid/pack options and attributes of the widget.
wnamefull - path to the widget
options - grid/pack options of the widget
attrs - attribute of the widget
Returns a list of items:
widget - Tk/Ttk widget name
options - grid/pack options of the widget
attrs - attribute of the widget
nam3 - 3 initial letters of widget's name
disabled - flag of *disabled* state</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#defaultATTRS">defaultATTRS</a><span class=tooltiptext> defaultATTRS : Sets, gets or registers default options and attributes for widget type.
type - widget type
opts - new default grid/pack options
atrs - new default attributes
widget - Tcl/Tk command for the new registered widget type
The *type* should be a three letter unique string.
If the *type* is absent in the registered types and *opts* and/or *atrs*
is not set to "", defaultATTRS registers the new *type* with its grid/pack
options and attributes. At that *widget* is a command for the new widget
type. For example, to register "toolbutton" widget:
my defaultATTRS tbt {} {-style Toolbutton -compound top} ttk::button
Options and attributes may contain data (variables and commands)
to be processed by [subst].
Returns:
- if not set *type*: a full list of options and attributes of all types
- if set *type* only: a list of options, attributes and *widget*
- else: a list of updated options, attributes and *widget*</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#MC">MC</a><span class=tooltiptext> MC : Gets localized message
msg - the message
to use a preset namespace name, we need a fully qualified variable</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#GetMC">GetMC</a><span class=tooltiptext> GetMC : Gets localized -text attribute.
attrs - list of attributes</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#SpanConfig">SpanConfig</a><span class=tooltiptext> SpanConfig : The method is used by *GetIntOptions* method to configure
row/column for their *span* options.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#GetIntOptions">GetIntOptions</a><span class=tooltiptext> GetIntOptions : Gets specific integer options. Then expands other options.
w - widget's name
options - grid options
row, rowspan - row and its span of thw widget
col, colspan - column and its span of thw widget
The options are set in grid options as "-rw <int>", "-cw <int>" etc.
Returns the resulting grid options.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#GetAttrs">GetAttrs</a><span class=tooltiptext> GetAttrs : Expands attributes' values.
options - list of attributes and values
nam3 - first three letters (type) of widget's name
disabled - flag of "disabled" state
Returns expanded attributes.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#menuTips">menuTips</a><span class=tooltiptext> menuTips : Makes tip(s) for menu and its items.
win - menu's path
tip - tip's text
wpar - path to menu's parent (for opc widget)
The tips for menu items are set by "-indexedtips ?idx tip...?"
e.g., a tip can be "parent tip -indexedtips 0 1stItem 9 {10th Item}"</span></div></li></ul>
<li><b><a href="#Option_cascade">&nbsp;&nbsp;Option cascade</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#optionCascadeText">optionCascadeText</a><span class=tooltiptext> optionCascadeText : Rids a tk_optionCascade item of braces.
it - an item to be trimmed
Reason: tk_optionCascade items shimmer between 'list' and 'string'
so a multiline item is displayed with braces, if not got rid of them.
Returns the item trimmed.
See also: tk_optionCascade</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#tk_optionCascade">tk_optionCascade</a><span class=tooltiptext> tk_optionCascade : A bit modified tk_optionCascade widget made by Richard Suchenwirth.
w      - widget name
vname  - variable name for current selection
items  - list of items
mbopts - ttk::menubutton options (e.g. "-width -4")
precom - command to get entry's options (%a presents its label)
args   - additional options of entries
Returns a path to the widget.
See also:
optionCascadeText
[wiki.tcl-lang.org](https://wiki.tcl-lang.org/page/tk_optionCascade)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#optionCascade_add">optionCascade_add</a><span class=tooltiptext> optionCascade_add : Adds tk_optionCascade items recursively.
w      - tk_optionCascade widget's name
vname  - variable name for current selection
arg1   - list of items to be added
precom - command to get entry's options (%a presents its label)
args   - additional options of entries</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#ParentOpt">ParentOpt</a><span class=tooltiptext> ParentOpt : Gets *-parent* option for choosers.
w - parent window's name (path)</span></div></li></ul>
<li><b><a href="#Mega-widgets">&nbsp;&nbsp;Mega-widgets</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#fillGutter">fillGutter</a><span class=tooltiptext> fillGutter : Fills a gutter of text with the text's line numbers.
txt - path to the text widget
canvas - canvas of the gutter
width - width of the gutter, in chars
shift - addition to the width (to shift from the left side)
args - additional arguments for tracing
The code is borrowed from open source tedit project.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#gutterContents">gutterContents</a><span class=tooltiptext> gutterContents : Gets contents of a text's gutter
txt - text's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#AuxSetChooserGeometry">AuxSetChooserGeometry</a><span class=tooltiptext> AuxSetChooserGeometry : Auxiliary method to set some Tk choosers' geometry.
vargeo - variable for geometry value
vargeo2 - variable for geometry value with second type of dialogue
parent - list containing a parent's path
widname - name of the chooser
If there is no saved geometry with *vargeo*, tries to get it with *vargeo2*.
Returns a path to the chooser to be open.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#validateColorChoice">validateColorChoice</a><span class=tooltiptext> validateColorChoice : Displays a current color of color chooser's entry.
lab - color chooser's label (or apave name's clr1 / Clr1)
ent - color chooser's entry
Can be called as "validateColorChoice clr1 / Clr1".</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#scrolledFrame">scrolledFrame</a><span class=tooltiptext> scrolledFrame : Retrieves the path where the scrollable contents of frame go.
w - frame's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#chooserGeomVars">chooserGeomVars</a><span class=tooltiptext> chooserGeomVars : Sets/gets variables to save/restore geometry of Tcl/Tk dir/file choosers (in Linux).
dirvar - variable's name for geometry of directory chooser
filevar - variable's name for geometry of file chooser
See also: chooser</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#chooser">chooser</a><span class=tooltiptext> chooser : Chooser (for all available types).
nchooser - name of chooser
tvar - name of variable containing an input/output value
args - options of the chooser
The chooser names are:
tk_getOpenFile - choose a file to open
tk_getSaveFile - choose a file to save
tk_chooseDirectory - choose a directory
fontChooser - choose a font
dateChooser - choose a date
colorChooser - choose a color
ftx_OpenFile - (internal) choose a file for ftx widget
Returns a selected value.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#colorChooser">colorChooser</a><span class=tooltiptext> colorChooser : Color chooser.
tvar - name of variable containing a color
args - options of *tk_chooseColor*
The *tvar* sets the value of *-initialcolor* option. Also
it gets a color selected in the chooser.
Returns a selected color.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#sourceKlnd">sourceKlnd</a><span class=tooltiptext> sourceKlnd : Loads klnd package at need.
num - defines which name of package file to be used</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#dateChooser">dateChooser</a><span class=tooltiptext> dateChooser : Date chooser (calendar widget).
tvar - name of variable containing a date
args - options of *::klnd::calendar*
Returns a selected date.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Replace_Tcl">Replace_Tcl</a><span class=tooltiptext> Replace_Tcl : Replaces Tcl code with its resulting items in *lwidgets* list.
r1 - variable name for a current index in *lwidgets* list
r2 - variable name for a length of *lwidgets* list
r3 - variable name for *lwidgets* list
args - "tcl" and "tcl code" for "tcl" type of widget
The code should use the wildcard that goes first at a line:
%C - a command for inserting an item into lwidgets list.
The "tcl" widget type can be useful to automate the inserting
a list of similar widgets to the list of widgets.
See tests/test2_pave.tcl where the "tcl" fills "Color schemes" tab.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Replace_chooser">Replace_chooser</a><span class=tooltiptext> Replace_chooser : Replaces an item for a chooser with two items.
r0 - variable name for a widget's name
r1 - variable name for a current index in *lwidgets* list
r2 - variable name for a length of *lwidgets* list
r3 - variable name for *lwidgets* list
args - the widget item of *lwidgets* list
Choosers should contain 2 fields: entry + button.
Here every chooser is replaced with these two widgets.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Replace_bar">Replace_bar</a><span class=tooltiptext> Replace_bar : Replaces an item for a menu/tool/status bar with appropriate items.
r0 - variable name for a widget's name
r1 - variable name for a current index in *lwidgets* list
r2 - variable name for a length of *lwidgets* list
r3 - variable name for *lwidgets* list
args - the widget item of *lwidgets* list
Bar widgets should contain N fields of appropriate type</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#fontChooser">fontChooser</a><span class=tooltiptext> fontChooser : Font chooser.
tvar - name of variable containing a font
args - options of *tk fontchooser*
The *tvar* sets the value of *-font* option. Also
it gets a font selected in the chooser.
Returns a selected font.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#toolbarItem_Attrs">toolbarItem_Attrs</a><span class=tooltiptext> toolbarItem_Attrs : Gets attributes of toolbar button.
istext - true if textual button
img - image of button
fontB - bold font
fg - foreground
bg - background
fga - active foreground
bga - active background</span></div></li></ul>
<li><b><a href="#Widget_names_&_methods">&nbsp;&nbsp;Widget names & methods</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#chooserPath">chooserPath</a><span class=tooltiptext> chooserPath : Gets a path to chooser's entry or label.
W - widget/method name (e.g. Fil, Dir)
w - ent / lab for entry / label</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Transname">Transname</a><span class=tooltiptext> Transname : Transforms *name* by adding *typ* (its type).
typ - type of widget in *apave* terms (but, buT etc.)
name - name (path) of widget
Returns the transformed name.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#LowercaseWidgetName">LowercaseWidgetName</a><span class=tooltiptext> LowercaseWidgetName : Makes the widget name lowercased.
name - widget's name
The widgets of widget list can have uppercased names which
means that the appropriate methods will be created to access
their full pathes with a command `my Name`.
This method gets a "normal" name of widget accepted by Tk.
See also: MakeWidgetName</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#NormalizeName">NormalizeName</a><span class=tooltiptext> NormalizeName : Gets the real name of widget from *.name*.
refname - variable name for widget name
refi - variable name for index in widget list
reflwidgets - variable name for widget list
The *.name* means "child of some previous" and should be normalized.
Example:
If parent: fra.fra .....
child: .but
=> normalized: fra.fra.but</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#WidgetNameFull">WidgetNameFull</a><span class=tooltiptext> WidgetNameFull : Gets a full name of a widget.
w - name of root widget
name - name of widget
an - additional prefix for name
See also: apave::sframe::content</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#dlgPath">dlgPath</a><span class=tooltiptext> dlgPath : Gets a window name of apave open dialogue.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#DiaWidgetName">DiaWidgetName</a><span class=tooltiptext> DiaWidgetName : Gets a widget name of apave dialogue.
w - name of widget
The name of widget may be partial. In this case it's prepended
the current dialogue's frame path.
Useful in "input" dialogue when -method option is present
or widget names are uppercased.
See also: MakeWidgetName, input</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#MakeWidgetName">MakeWidgetName</a><span class=tooltiptext> MakeWidgetName : Makes an exported method named after root widget, if it's uppercased.
w - name of root widget
name - name of widget
an - additional prefix for name (if "-", $w is full/partial name)
The created method used for easy access to the widget's path.
Example:
fra1.fra2.fra3.Entry1
=> method Entry1 {} {...}
...
my Entry1  ;# instead of .win.fra1.fra2.fra3.Entry1</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#AddPopupAttr">AddPopupAttr</a><span class=tooltiptext> AddPopupAttr : Adds the attribute to call a popup menu for an editable widget.
w - widget's name
attrsName - variable name for attributes of widget
atRO - "readonly" attribute (internally used)
isRO - flag of readonly widget
args - widget states to be checked</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#clearEntry">clearEntry</a><span class=tooltiptext> clearEntry : Clears entry-like widget's value, after calling a command.
w - widget's path
clearcom - a command to call, can have %w for *w* (widget's path)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#makePopup">makePopup</a><span class=tooltiptext> makePopup : Makes a popup menu for an editable widget.
w - widget's name
isRO - flag for "is it readonly"
istext - flag for "is it a text"
tearoff - flag for "-tearoff" option
addpop - additional commands for popup menu
clearcom - command for "Clear" item</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Pre">Pre</a><span class=tooltiptext> Pre : "Pre" actions for the text widget and similar
which all require some actions before and after their creation e.g.:
the text widget's text cannot be filled if disabled
so, we must act this way:
1. call Pre - to get a text of widget
2. create the widget
3. call Post - to enable, then fill it with a text, then disable it
It's only possible with Pre and Post methods.
See also: Post</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Post">Post</a><span class=tooltiptext> Post : Performes "post" actions after creation a widget.
w - widget's path
attrs - widget's attributes
Processes the same *apave* options that are processed in Pre method.
See also: Pre</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#CleanUps">CleanUps</a><span class=tooltiptext> CleanUps : Performs various clean-ups before and after showing a window.
wr - window's path (to clean up at closing)
Cleans the unused widgets from _AP_VISITED list</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#UpdateColors">UpdateColors</a><span class=tooltiptext> UpdateColors : Updates colors of widgets at changing CS.</span></div></li></ul>
<li><b><a href="#Links_in_labels">&nbsp;&nbsp;Links in labels</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#initLinkFont">initLinkFont</a><span class=tooltiptext> initLinkFont : Gets/sets font attributes of links (labels & text tags with -link).
args - font attributes ("-underline 1" by default)
Returns the current value of these attributes.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#labelFlashing">labelFlashing</a><span class=tooltiptext> labelFlashing : Options of 'flashing' label:
-file (or -data) {list of image files (or data variables)}
-label {list of labels' texts}
-incr {increment for -alpha option}
-pause {pause in seconds for -alpha 1.0}
-after {interval for 'after'}
-squeeze {value for *-big.png}</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#VisitedLab">VisitedLab</a><span class=tooltiptext> VisitedLab : Marks a label as visited/not visited
w - label's path
cmd - command linked
on - flag "the label visited"
fg - foreground of label
bg - background of label</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#HoverLab">HoverLab</a><span class=tooltiptext> HoverLab : Actions on entering/leaving a linked label.
w - label's path
cmd - command linked
on - flag "now hovering on the label"
fg - foreground of label
bg - background of label</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#textLink">textLink</a><span class=tooltiptext> textLink : Gets a label's path of a link in a text widget.
w - text's path
idx - index of the link</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#makeLabelLinked">makeLabelLinked</a><span class=tooltiptext> makeLabelLinked : Makes the linked label from a label.
lab - label's path
v - data of the link: command, tip, visited
fg - foreground unhovered
bg - background unhovered
fg2 - foreground hovered
bg2 - background hovered
doadd - flag "register the label in the list of visited"
inv - flag "invert the meaning of colors"</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#leadingSpaces">leadingSpaces</a><span class=tooltiptext> leadingSpaces : Returns a number of leading spaces of a line
line - the line</span></div></li></ul>
<li><b><a href="#Text_methods">&nbsp;&nbsp;Text methods</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#SetContentVariable">SetContentVariable</a><span class=tooltiptext> SetContentVariable : Sets an internal text variable combining its main attributes.
tvar - external variable for text
txtnam - full name of widget
name - short (tail) name of widget
The tricky thing is for further access to all of the text.
See also: GetContentVariable</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#GetContentVariable">GetContentVariable</a><span class=tooltiptext> GetContentVariable : Gets an internal text variable.
See also: SetContentVariable</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#SplitContentVariable">SplitContentVariable</a><span class=tooltiptext> SplitContentVariable : Gets parts of an internal text variable.
See also: SetContentVariable</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#getTextContent">getTextContent</a><span class=tooltiptext> getTextContent : Gets text content.
tvar - text variable
Uses an internal text variable to extract the text contents.
Returns the content of text.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#onKeyTextM">onKeyTextM</a><span class=tooltiptext> onKeyTextM : Processes indents and braces at pressing keys.
w - text's path
K - key's name
s - key's state</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#setTextBinds">setTextBinds</a><span class=tooltiptext> setTextBinds : Returns bindings for a text widget.
wt - the text's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#TextCommandForChange">TextCommandForChange</a><span class=tooltiptext> TextCommandForChange : Replaces a command of text widget for making changes
w - text widget's name
com - command for changes
on - if "yes", replaces a text command; if "no", restores it
In particular, when `com` is empty, the text widget becomes readonly.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#readonlyWidget">readonlyWidget</a><span class=tooltiptext> readonlyWidget : Switches on/off a widget's readonly state for a text widget.
w - text widget's path
on - "on/off" boolean flag
popup - "make popup menu" boolean flag
See also:
[wiki.tcl-lang.org](https://wiki.tcl-lang.org/page/Read-only+text+widget)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#GetOutputValues">GetOutputValues</a><span class=tooltiptext> GetOutputValues : Makes output values for some widgets (lbx, fco).
Some i/o widgets need a special method to get their returned values.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#focusNext">focusNext</a><span class=tooltiptext> focusNext : Sets focus on a next widget (possibly, defined as `my Widget`).
w - parent window name
wnext - next widget's name
wnext0 - core next name (used internally, for recursive search)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#AdditionalCommands">AdditionalCommands</a><span class=tooltiptext> AdditionalCommands : Gets additional commands (for non-standard attributes).
w - window name
wdg - widget's full path
attrsName - variable name for widget's attributes</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#DefineWidgetKeys">DefineWidgetKeys</a><span class=tooltiptext> DefineWidgetKeys : Sets some hotkeys for some widgets (e.g. Enter to work as Tab)
wname - the widget's name
widget - the widget's type
This may be disabled by including "STD" in the widget's name.</span></div></li></ul>
<li><b><a href="#Paving_windows">&nbsp;&nbsp;Paving windows</a></b></li>
<ul class=toc><li><div class=tooltip><a href="#colorWindow">colorWindow</a><span class=tooltiptext> colorWindow : Initialize colors of a window.
win - window's path
args - arguments for csSet</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#ShowOption">ShowOption</a><span class=tooltiptext> ShowOption : Gets a default show option, used in showModal.
name - name of option
See also: getShowOption, setShowOption</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#getShowOption">getShowOption</a><span class=tooltiptext> getShowOption : Gets a default show option, used in showModal.
name - name of option
defval - default value
See also: showModal</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#setShowOption">setShowOption</a><span class=tooltiptext> setShowOption : Sets / gets a default show option, used in showModal.
name - name of option
args - value of option
See also: showModal</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#pavedPath">pavedPath</a><span class=tooltiptext> pavedPath : Gets the currently paved window's path.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#Window">Window</a><span class=tooltiptext> Window : Paves the window with widgets.
w - window's name (path)
inplists - list of widget items (lists of widget data)
Contents of a widget's item:
name - widget's name (first 3 characters define its type)
neighbor - top (T) or left (L) neighbor of the widget
posofnei - position of neighbor: T (top) or L (left)
rowspan - row span of the widget
colspan - column span of the widget
options - grid/pack options
attrs - attributes of widget
First 3 items are mandatory, others are set at need.
Called by *paveWindow* method to process a portion of widgets.
The "portion" refers to a separate block of widgets such as
notebook's tabs or frames.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#paveWindow">paveWindow</a><span class=tooltiptext> paveWindow : Processes "win / list_of_widgets" pairs.
args - list of pairs "win / lwidgets"
The *win* is a window's path. The *lwidgets* is a list of widget items.
Each widget item contains:
name - widget's name (first 3 characters define its type)
neighbor - top or left neighbor of the widget
posofnei - position of neighbor: T (top) or L (left)
rowspan - row span of the widget
colspan - column span of the widget
options - grid/pack options
attrs - attributes of widget
First 3 items are mandatory, others are set at need.
This method calls *paveWindow* in a cycle, to process a current "win/lwidgets" pair.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#window">window</a><span class=tooltiptext> window : Obsolete version of paveWindow (remains for compatibility).
See also: paveWindow</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#WinVarname">WinVarname</a><span class=tooltiptext> WinVarname : Gets a unique varname for a window.
win - window's path</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#waitWinVar">waitWinVar</a><span class=tooltiptext> waitWinVar : Tk waiting for variable's change.
win - the window's path
var - variable's name to receive a result (tkwait's variable)
modal - yes at showing the window as modal
first of all, wait till the window be visible</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#showWindow">showWindow</a><span class=tooltiptext> showWindow : Displays a windows and goes in tkwait cycle to interact with a user.
win - the window's path
modal - yes at showing the window as modal
ontop - yes at showing the window as topmost
var - variable's name to receive a result (tkwait's variable)
minsize - list {minwidth minheight} or {}
waitvar - if yes, force tkwait variable (mostly for non-modal windows)
waitme - if empty, deiconify immediately, otherwise after waiting a variable or "timeout and/or idle"</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#showModal">showModal</a><span class=tooltiptext> showModal : Shows a window as modal.
win - window's name
args - attributes of window ("-name value" pairs)</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#res">res</a><span class=tooltiptext> res : Gets/sets a variable for *vwait* command.
win - window's path
result - value of variable
This method is used when
- an event cycle should be stopped with changing a variable's value
- a result of event cycle (the variable's value) should be got
In the first case, *result* is set to an integer. In *apave* dialogs
the integer is corresponding a pressed button's index.
In the second case, *result* is omitted or equal to "get".
Returns a value of variable that controls an event cycle.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#makeWindow">makeWindow</a><span class=tooltiptext> makeWindow : Creates a toplevel window that has to be paved.
w - window's name
ttl - window's title
args - options for 'toplevel' command
If $w matches "*.fra" then ttk::frame is created with name $w.</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#displayText">displayText</a><span class=tooltiptext> displayText : Sets the text widget's contents.
w - text widget's name
conts - contents to be set in the widget</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#resetText">resetText</a><span class=tooltiptext> resetText : Resets a text widget to edit/view from scratch.
w - text widget's name
state - widget's final state (normal/disabled)
contsName - variable name for contents to be set in the widget</span></div></li></ul>
<ul class=toc><li><div class=tooltip><a href="#displayTaggedText">displayTaggedText</a><span class=tooltiptext> displayTaggedText : Sets the text widget's contents using tags (ornamental details).
w - text widget's name
contsName - variable name for contents to be set in the widget
tags - list of tags to be applied to the text
The lines in *text contents* are divided by \n and can include
*tags* like in a html layout, e.g. <red>RED ARMY</red>.
The *tags* is a list of "name/value" pairs. 1st is a tag's name, 2nd
is a tag's value.
The tag's name is "pure" one (without <>) so e.g.for <b>..</b> the tag
list contains "b".
The tag's value is a string of text attributes (-font etc.).
If the tag's name is FG, FG2, BG or BG2, then it is really a link color.</span></div></li></ul>
<li><b><a href="#EOC_::apave::APaveBase">EOC ::apave::APaveBase</a></b></li>
<li><b><a href="#EOF">EOF</a></b></li>

</ul>

</div>
</div>
</div>
<!-- TOC END -->

<h1><font color=#ca14ca> apave</font></h1>
</p><p>
A library for GUI development with Tcl/Tk.
</p><p>
Docs:
</p><p>
<a href="https://aplsimple.github.io/en/tcl/pave">Full description</a>
</p><p>

</p>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../index.html"><font color=#1a1a1a size=6>  <b>apavebase.tcl</b></font></div></td></table>

<pre class="code"><i><font color=#4b5d50>###########################################################<a id=apavebase.tcl></a></font></i>
<i><font color=#4b5d50># Name:    apavebase.tcl</font></i>
<i><font color=#4b5d50># Author:  Alex Plotnikov  (aplsimple@gmail.com)</font></i>
<i><font color=#4b5d50># Date:    12/09/2021</font></i>
<i><font color=#4b5d50># Brief:   Handles APaveBase class, sort of geometry manager.</font></i>
<i><font color=#4b5d50># License: MIT.</font></i>
<i><font color=#4b5d50>###########################################################</font></i>
<a id=TCLLIBPATH></a>
<i><font color=#4b5d50># ________________________ TCLLIBPATH _________________________ #</font></i>

<i><font color=#4b5d50># use TCLLIBPATH variable (some tclkits don't see it)</font></i>
<b><font color=#3a6797>catch</font></b> {
  <b><font color=#3a6797>foreach</font></b> _ [<b><font color=#3a6797>lreverse</font></b> <font color=#1b1baa>$::env(TCLLIBPATH)</font>] {
    <b><font color=#3a6797>set</font></b> _ [<b><font color=#3a6797>file</font></b> normalize <font color=#1b1baa>$_</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$::auto_path</font> <font color=#1b1baa>$_</font>]&lt;0 && [<b><font color=#3a6797>file</font></b> exists <font color=#1b1baa>$_</font>]} {
      <b><font color=#3a6797>set</font></b> ::auto_path [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$::auto_path</font> 0 <font color=#1b1baa>$_</font>]
    }
  }
}
<b><font color=#3a6797>unset</font></b> <font color=#653760>-nocomplain</font> _
<a id=Remove_installed_subpackages_of_apave></a>
<i><font color=#4b5d50># _____ Remove installed subpackages of apave _____ #</font></i>

<b><font color=#3a6797>foreach</font></b> _ {baltip bartabs hl_tcl} {
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>package</font></b> forget <font color=#1b1baa>$_</font>}
  <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>namespace</font></b> delete ::<font color=#1b1baa>$_</font>}
}
<b><font color=#3a6797>unset</font></b> <font color=#653760>-nocomplain</font> _
<a id=apave_NS></a>
<i><font color=#4b5d50># ________________________ apave NS _________________________ #</font></i>

<b><font color=#ca14ca>namespace</font></b> eval ::apave {

  <b><font color=#3a6797>variable</font></b> SRCDIR [<b><font color=#3a6797>file</font></b> normalize [<b><font color=#3a6797>file</font></b> dirname [<b><font color=#3a6797>info</font></b> script]]]
<a id=apave_variables></a>
  <i><font color=#4b5d50>## ________________________ apave variables _________________________ ##</font></i>

  <b><font color=#3a6797>variable</font></b> ISBALTIP yes
  <b><font color=#3a6797>variable</font></b> cursorwidth 1
  <b><font color=#3a6797>variable</font></b> apaveDir [<b><font color=#3a6797>file</font></b> dirname [<b><font color=#3a6797>info</font></b> script]]
  <b><font color=#3a6797>variable</font></b> _AP_ICO { none folder OpenFile SaveFile saveall print font color \
    date help home misc terminal run tools file find replace other view \
    categories actions config pin cut copy paste plus minus add delete \
    change diagram box trash double more undo redo up down previous next \
    previous2 next2 upload download tag tagoff tree lock light restricted \
    attach share mail www map umbrella gulls sound heart clock people info \
    err warn ques retry yes no ok cancel exit }
  <b><font color=#3a6797>variable</font></b> _AP_IMG;  <b><font color=#3a6797>array</font></b> set _AP_IMG [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>variable</font></b> _AP_VARS; <b><font color=#3a6797>array</font></b> set _AP_VARS [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> _AP_VARS(APPICON) {}
  <b><font color=#3a6797>set</font></b> _AP_VARS(.,MODALS) 0
  <b><font color=#3a6797>set</font></b> _AP_VARS(WPAVE) {}
  <b><font color=#3a6797>set</font></b> _AP_VARS(TIMW) [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> _AP_VARS(LINKFONT) [<b><font color=#3a6797>list</font></b> <font color=#653760>-underline</font> 1]
  <b><font color=#3a6797>set</font></b> _AP_VARS(INDENT) <font color=#8b2a0e>&quot;  &quot;</font>
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,F3) F3
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,CtrlA) [<b><font color=#3a6797>list</font></b> Control-A Control-a]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,CtrlD) [<b><font color=#3a6797>list</font></b> Control-D Control-d]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,CtrlY) [<b><font color=#3a6797>list</font></b> Control-Y Control-y]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,CtrlT) [<b><font color=#3a6797>list</font></b> Control-T Control-t]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,CtrlB) [<b><font color=#3a6797>list</font></b> Control-B Control-b]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,CtrlE) [<b><font color=#3a6797>list</font></b> Control-E Control-e]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,AltQ) [<b><font color=#3a6797>list</font></b> Alt-Q Alt-q]
  <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,AltW) [<b><font color=#3a6797>list</font></b> Alt-W Alt-w]
  <b><font color=#3a6797>variable</font></b> _AP_VISITED;  <b><font color=#3a6797>array</font></b> set _AP_VISITED [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> _AP_VISITED(ALL) [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>variable</font></b> UFF <font color=#8b2a0e>&quot;\uFFFF&quot;</font>
  <b><font color=#3a6797>variable</font></b> MC_NS {} FOCUSED {}
<a id=default_options_&_attributes_of_widgets></a>
  <i><font color=#4b5d50>## _ default options & attributes of widgets _ ##</font></i>

  <b><font color=#3a6797>variable</font></b> _Defaults [<b><font color=#3a6797>dict</font></b> create \
    bts {{} {}} \
    but {{} {}} \
    buT {{} {<font color=#653760>-width</font> -20 <font color=#653760>-pady</font> 1}} \
    btT {{} {<font color=#653760>-width</font> -20 <font color=#653760>-pady</font> 1 <font color=#653760>-relief</font> flat <font color=#653760>-overrelief</font> raised <font color=#653760>-highlightthickness</font> 0 <font color=#653760>-takefocus</font> 0}} \
    can {{} {}} \
    chb {{} {}} \
    swi {{} {}} \
    chB {{} {<font color=#653760>-relief</font> sunken <font color=#653760>-padx</font> 6 <font color=#653760>-pady</font> 2}} \
    cbx {{} {}} \
    fco {{} {}} \
    ent {{} {}} \
    enT {{} {<font color=#653760>-insertwidth</font> <font color=#1b1baa>$::apave::cursorwidth</font> <font color=#653760>-insertofftime</font> 250 <font color=#653760>-insertontime</font> 750}} \
    fil {{} {}} \
    fis {{} {}} \
    dir {{} {}} \
    fon {{} {}} \
    clr {{} {}} \
    dat {{} {}} \
    fiL {{} {}} \
    fiS {{} {}} \
    diR {{} {}} \
    foN {{} {}} \
    clR {{} {}} \
    daT {{} {}} \
    sta {{} {}} \
    too {{} {}} \
    fra {{} {}} \
    ftx {{} {}} \
    frA {{} {}} \
    gut {{} {<font color=#653760>-width</font> 0 <font color=#653760>-highlightthickness</font> 1}} \
    lab {{<font color=#653760>-sticky</font> w} {}} \
    laB {{<font color=#653760>-sticky</font> w} {}} \
    lfr {{} {}} \
    lfR {{} {<font color=#653760>-relief</font> groove}} \
    lbx {{} {<font color=#653760>-activestyle</font> none <font color=#653760>-exportselection</font> 0 <font color=#653760>-selectmode</font> browse}} \
    flb {{} {}} \
    meb {{} {}} \
    meB {{} {}} \
    nbk {{} {}} \
    opc {{} {}} \
    pan {{} {}} \
    pro {{} {}} \
    rad {{} {}} \
    raD {{} {<font color=#653760>-padx</font> 6 <font color=#653760>-pady</font> 2}} \
    sca {{} {<font color=#653760>-orient</font> horizontal <font color=#653760>-takefocus</font> 0}} \
    scA {{} {<font color=#653760>-orient</font> horizontal <font color=#653760>-takefocus</font> 0}} \
    sbh {{<font color=#653760>-sticky</font> ew} {<font color=#653760>-orient</font> horizontal <font color=#653760>-takefocus</font> 0}} \
    sbH {{<font color=#653760>-sticky</font> ew} {<font color=#653760>-orient</font> horizontal <font color=#653760>-takefocus</font> 0}} \
    sbv {{<font color=#653760>-sticky</font> ns} {<font color=#653760>-orient</font> vertical <font color=#653760>-takefocus</font> 0}} \
    sbV {{<font color=#653760>-sticky</font> ns} {<font color=#653760>-orient</font> vertical <font color=#653760>-takefocus</font> 0}} \
    scf {{} {}} \
    seh {{<font color=#653760>-sticky</font> ew} {<font color=#653760>-orient</font> horizontal <font color=#653760>-takefocus</font> 0}} \
    sev {{<font color=#653760>-sticky</font> ns} {<font color=#653760>-orient</font> vertical <font color=#653760>-takefocus</font> 0}} \
    siz {{} {}} \
    spx {{} {}} \
    spX {{} {}} \
    tbl {{} {<font color=#653760>-selectborderwidth</font> 1 <font color=#653760>-highlightthickness</font> 2 \
          <font color=#653760>-labelcommand</font> tablelist::sortByColumn <font color=#653760>-stretch</font> all \
          <font color=#653760>-showseparators</font> 1}} \
    tex {{} {<font color=#653760>-undo</font> 1 <font color=#653760>-maxundo</font> 0 <font color=#653760>-highlightthickness</font> 2 <font color=#653760>-insertofftime</font> 250 <font color=#653760>-insertontime</font> 750 <font color=#653760>-insertwidth</font> <font color=#1b1baa>$::apave::cursorwidth</font> <font color=#653760>-wrap</font> word <font color=#653760>-selborderwidth</font> 1 <font color=#653760>-exportselection</font> 0}} \
    tre {{} {<font color=#653760>-selectmode</font> browse}} \
    h_ {{<font color=#653760>-sticky</font> ew <font color=#653760>-csz</font> 3 <font color=#653760>-padx</font> 3} {}} \
    v_ {{<font color=#653760>-sticky</font> ns <font color=#653760>-rsz</font> 3 <font color=#653760>-pady</font> 3} {}}]
<a id=Helpers></a>
  <i><font color=#4b5d50>## _______________________ Helpers _____________________ ##</font></i>
<a id=WindowStatus></a>
  <b><font color=#ca14ca>proc</font></b> WindowStatus {w name {val <font color=#8b2a0e>&quot;&quot;</font>} {defval <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets/gets a status of window. The status is a value assigned to a name.</font></i>
    <i><font color=#4b5d50>#   w - window's path</font></i>
    <i><font color=#4b5d50>#   name - name of status</font></i>
    <i><font color=#4b5d50>#   val - if blank, to get a value of status; otherwise a value to set</font></i>
    <i><font color=#4b5d50>#   defval - default value (actual if the status not set beforehand)</font></i>
    <i><font color=#4b5d50># Returns a value of status.</font></i>
    <i><font color=#4b5d50># See also: IntStatus</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_VARS
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$val</font> eq {}} {  ;<i><font color=#4b5d50># getting</font></i>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exist _AP_VARS(<font color=#1b1baa>$w</font>,<font color=#1b1baa>$name</font>)]} {
        <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$_AP_VARS($w,$name)</font>
      }
      <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$defval</font>
    }
    <b><font color=#3a6797>set</font></b> _AP_VARS(<font color=#1b1baa>$w</font>,<font color=#1b1baa>$name</font>) <font color=#1b1baa>$val</font>  ;<i><font color=#4b5d50># setting</font></i>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=mainWindowOfApp></a>
  <b><font color=#ca14ca>proc</font></b> mainWindowOfApp {{win <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets/gets a main window of application.</font></i>
    <i><font color=#4b5d50>#   win - window's path</font></i>
    <i><font color=#4b5d50># This should be run at application start, before opening any window.</font></i>

    WindowStatus . MAIN_WINDOW_OF_APP <font color=#1b1baa>$win</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=IntStatus></a>
  <b><font color=#ca14ca>proc</font></b> IntStatus {w {name <font color=#8b2a0e>&quot;status&quot;</font>} {val <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets/gets a status of window. The status is an integer assigned to a name.</font></i>
    <i><font color=#4b5d50>#   w - window's path</font></i>
    <i><font color=#4b5d50>#   name - name of status</font></i>
    <i><font color=#4b5d50>#   val - if blank, to get a value of status; otherwise a value to set</font></i>
    <i><font color=#4b5d50># Default value of status is 0.</font></i>
    <i><font color=#4b5d50># Returns an old value of status.</font></i>
    <i><font color=#4b5d50># See also: WindowStatus</font></i>

    <b><font color=#3a6797>set</font></b> old [WindowStatus <font color=#1b1baa>$w</font> <font color=#1b1baa>$name</font> {} 0]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$val</font> ne {}} {WindowStatus <font color=#1b1baa>$w</font> <font color=#1b1baa>$name</font> <font color=#1b1baa>$val</font> 1}
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$old</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=iconImage></a>
  <b><font color=#ca14ca>proc</font></b> iconImage {{icon <font color=#8b2a0e>&quot;&quot;</font>} {iconset <font color=#8b2a0e>&quot;small&quot;</font>} {doit no}} {
    <i><font color=#4b5d50># Gets a defined icon's image or list of icons.</font></i>
    <i><font color=#4b5d50># If *icon* equals to &quot;-init&quot;, initializes apave's icon set.</font></i>
    <i><font color=#4b5d50>#   icon - icon's name</font></i>
    <i><font color=#4b5d50>#   iconset - one of small/middle/large</font></i>
    <i><font color=#4b5d50>#   doit - force the initialization</font></i>
    <i><font color=#4b5d50># Returns the icon's image or, if *icon* is blank, a list of icons</font></i>
    <i><font color=#4b5d50># available in *apave*.</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_IMG
    <b><font color=#3a6797>variable</font></b> _AP_ICO
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$icon</font> eq {}} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$_AP_ICO</font>}
  ; <b><font color=#ca14ca>proc</font></b> imagename {icon} {   # Get a defined icon's image name
      <b><font color=#ca14ca>return</font></b> _AP_IMG(img<font color=#1b1baa>$icon</font>)
    }
    <b><font color=#3a6797>variable</font></b> apaveDir
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>array</font></b> size _AP_IMG] || <font color=#1b1baa>$doit</font>} {
      <i><font color=#4b5d50># Make images of icons</font></i>
      <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$apaveDir</font> apaveimg.tcl]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iconset</font> ne <font color=#8b2a0e>&quot;small&quot;</font>} {
        <b><font color=#3a6797>foreach</font></b> ic <font color=#1b1baa>$_AP_ICO</font> {  ;<i><font color=#4b5d50># small icons best fit for menus</font></i>
          <b><font color=#3a6797>set</font></b> _AP_IMG(<font color=#1b1baa>$ic</font>-small) [<b><font color=#3a6797>set</font></b> _AP_IMG(<font color=#1b1baa>$ic</font>)]
        }
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iconset</font> eq <font color=#8b2a0e>&quot;middle&quot;</font>} {
          <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$apaveDir</font> apaveimg2.tcl]
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$apaveDir</font> apaveimg2.tcl] ;<i><font color=#ff0000># TODO</font></i>
        }
      }
      <b><font color=#3a6797>foreach</font></b> ic <font color=#1b1baa>$_AP_ICO</font> {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#134070>image</font></b> create photo [imagename <font color=#1b1baa>$ic</font>] <font color=#653760>-data</font> [<b><font color=#3a6797>set</font></b> _AP_IMG(<font color=#1b1baa>$ic</font>)]}]} {
          <i><font color=#4b5d50># some png issues on old Tk</font></i>
          <b><font color=#134070>image</font></b> create photo [imagename <font color=#1b1baa>$ic</font>] <font color=#653760>-data</font> [<b><font color=#3a6797>set</font></b> _AP_IMG(none)]
        } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$iconset</font> ne <font color=#8b2a0e>&quot;small&quot;</font>} {
          <b><font color=#134070>image</font></b> create photo [imagename <font color=#1b1baa>$ic</font>-small] <font color=#653760>-data</font> [<b><font color=#3a6797>set</font></b> _AP_IMG(<font color=#1b1baa>$ic</font>-small)]
        }
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$icon</font> eq <font color=#8b2a0e>&quot;-init&quot;</font>} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$_AP_ICO</font>} ;<i><font color=#4b5d50># just to get to icons</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$icon</font> ni <font color=#1b1baa>$_AP_ICO</font>} {<b><font color=#3a6797>set</font></b> icon [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$_AP_ICO</font> 0]}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iconset</font> eq <font color=#8b2a0e>&quot;small&quot;</font> && <font color=#8b2a0e>&quot;_AP_IMG(img<font color=#1b1baa>$</font>icon-small)&quot;</font> in [<b><font color=#134070>image</font></b> names]} {
      <b><font color=#3a6797>set</font></b> icon <font color=#1b1baa>$icon</font>-small
    }
    <b><font color=#ca14ca>return</font></b> [imagename <font color=#1b1baa>$icon</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=iconData></a>
  <b><font color=#ca14ca>proc</font></b> iconData {{icon <font color=#8b2a0e>&quot;info&quot;</font>} {iconset <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Gets an icon's data.</font></i>
    <i><font color=#4b5d50>#   icon - icon's name</font></i>
    <i><font color=#4b5d50>#   iconset - one of small/middle/large</font></i>
    <i><font color=#4b5d50># Returns data of the icon.</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_IMG
    iconImage <font color=#653760>-init</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iconset</font> ne {} && <font color=#8b2a0e>&quot;_AP_IMG(img<font color=#1b1baa>$</font>icon-<font color=#1b1baa>$</font>iconset)&quot;</font> in [<b><font color=#134070>image</font></b> names]} {
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>set</font></b> _AP_IMG(<font color=#1b1baa>$icon</font>-<font color=#1b1baa>$iconset</font>)]
    }
    <b><font color=#3a6797>set</font></b> _AP_IMG(<font color=#1b1baa>$icon</font>)
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=setAppIcon></a>
  <b><font color=#ca14ca>proc</font></b> setAppIcon {win {winicon <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets application's icon.</font></i>
    <i><font color=#4b5d50>#   win - path to a window of application</font></i>
    <i><font color=#4b5d50>#   winicon - data of icon</font></i>
    <i><font color=#4b5d50># The *winicon* may be a contents of variable (as supposed by default) or</font></i>
    <i><font color=#4b5d50># a file's name containing th image data.</font></i>
    <i><font color=#4b5d50># If it fails to find an image in either, no icon is set.</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_VARS
    <b><font color=#3a6797>set</font></b> _AP_VARS(APPICON) {}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$winicon</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> _AP_VARS(APPICON) [<b><font color=#134070>image</font></b> create photo <font color=#653760>-data</font> <font color=#1b1baa>$winicon</font>]}]} {
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> _AP_VARS(APPICON) [<b><font color=#134070>image</font></b> create photo <font color=#653760>-file</font> <font color=#1b1baa>$winicon</font>]}
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$_AP_VARS(APPICON)</font> ne {}} {<b><font color=#134070>wm</font></b> iconphoto <font color=#1b1baa>$win</font> <font color=#653760>-default</font> <font color=#1b1baa>$_AP_VARS(APPICON)</font>}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=getAppIcon></a>
  <b><font color=#ca14ca>proc</font></b> getAppIcon {} {
    <i><font color=#4b5d50># Gets application's icon.</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_VARS
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$_AP_VARS(APPICON)</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=precedeWidgetName></a>
  <b><font color=#ca14ca>proc</font></b> precedeWidgetName {widname prename} {
    <i><font color=#4b5d50># Adds a preceding name to a tail name of widget.</font></i>
    <i><font color=#4b5d50>#   widname - widget's full name</font></i>
    <i><font color=#4b5d50>#   prename - preceding name</font></i>
    <i><font color=#4b5d50># Useful at getting a entry/button name of chooser.</font></i>

    <i><font color=#4b5d50># Example:</font></i>
    <i><font color=#4b5d50>#   set wentry [::apave::precedeWidgetName [$pobj DirToChoose] ent]</font></i>
    <i><font color=#4b5d50># See also: APaveBase::Replace_chooser</font></i>

    <b><font color=#3a6797>set</font></b> p [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$widname</font>]
    <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$widname</font> 0 <font color=#1b1baa>$p</font>]
    <b><font color=#3a6797>append</font></b> res <font color=#1b1baa>$prename</font> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$widname</font> <font color=#1b1baa>$p</font>+1 end]
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=defaultAttrs></a>
  <b><font color=#ca14ca>proc</font></b> defaultAttrs {{type <font color=#8b2a0e>&quot;&quot;</font>} {opts <font color=#8b2a0e>&quot;&quot;</font>} {atrs <font color=#8b2a0e>&quot;&quot;</font>} {widget <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets, gets or registers default options and attributes for widget type.</font></i>
    <i><font color=#4b5d50>#   type - widget type</font></i>
    <i><font color=#4b5d50>#   opts - new default grid/pack options</font></i>
    <i><font color=#4b5d50>#   atrs - new default attributes</font></i>
    <i><font color=#4b5d50>#   widget - Tcl/Tk command for the new registered widget type</font></i>
    <i><font color=#4b5d50># See also: APaveBase::defaultATTRS</font></i>

    obj defaultATTRS <font color=#1b1baa>$type</font> <font color=#1b1baa>$opts</font> <font color=#1b1baa>$atrs</font> <font color=#1b1baa>$widget</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=focusApp></a>
  <b><font color=#ca14ca>proc</font></b> focusApp {{win <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Saves (if *win* is set) or restores app's focus.</font></i>
    <i><font color=#4b5d50>#   win - focused window's path</font></i>
    <i><font color=#4b5d50># In some DE, if app loses focus, restoring it</font></i>
    <i><font color=#4b5d50># focuses main window, ignores modal toplevel, locks keyboard.</font></i>
    <i><font color=#4b5d50># focusApp tries to focus on last modal window.</font></i>

    <b><font color=#3a6797>variable</font></b> FOCUSED
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$win</font> ne {}} {
      setProperty FOCW_<font color=#1b1baa>$win</font> [<b><font color=#134070>focus</font></b>]
      <b><font color=#ca14ca>return</font></b>
    }
    <b><font color=#3a6797>catch</font></b> {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> foc [<b><font color=#134070>focus</font></b>]] ne {}} {
        <b><font color=#3a6797>set</font></b> foc [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$foc</font>]
        <b><font color=#3a6797>set</font></b> modal 0
        <b><font color=#3a6797>foreach</font></b> fw <font color=#1b1baa>$FOCUSED</font> {
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fw</font> eq <font color=#1b1baa>$foc</font>} {<b><font color=#3a6797>set</font></b> modal 1; <b><font color=#ca14ca>break</font></b>}
        }
        <i><font color=#4b5d50># if non-modal is currently focused, let it be so</font></i>
        <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$modal</font>} {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>focus</font></b>] eq <font color=#1b1baa>$foc</font>} {<b><font color=#3a6797>catch</font></b> {<b><font color=#134070>focus</font></b> [getProperty FOCW_<font color=#1b1baa>$foc</font>]}}
          <b><font color=#ca14ca>return</font></b>
        }
      }
      <i><font color=#4b5d50># find and focus last open modal</font></i>
      <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$FOCUSED</font>]} {<font color=#1b1baa>$i</font>} {} {
        <b><font color=#3a6797>set</font></b> fw [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$FOCUSED</font> [<b><font color=#3a6797>incr</font></b> i -1]]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$fw</font>]} {
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fw</font> ne <font color=#1b1baa>$foc</font>} {
            <b><font color=#134070>focus</font></b> <font color=#653760>-force</font> <font color=#1b1baa>$fw</font>
            <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>focus</font></b> [getProperty FOCW_<font color=#1b1baa>$fw</font>]}
          }
          <b><font color=#ca14ca>break</font></b>
        }
        <b><font color=#3a6797>set</font></b> FOCUSED [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$FOCUSED</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
      }
    }
  }
<a id=Text_little_procs></a>
  <i><font color=#4b5d50>## _______________________ Text little procs _________________________ ##</font></i>
<a id=eventOnText></a>
  <b><font color=#ca14ca>proc</font></b> eventOnText {w ev} {
    <i><font color=#4b5d50># Generates an event on a text, saving its current index in hl_tcl.</font></i>
    <i><font color=#4b5d50>#   w - text widget's path</font></i>
    <i><font color=#4b5d50>#   ev - event</font></i>
    <i><font color=#4b5d50># The hl_tcl needs to call MemPos before any action changing the text.</font></i>

    <b><font color=#3a6797>catch</font></b> {::hl_tcl::my::MemPos <font color=#1b1baa>$w</font>}
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$w</font> tag ranges sel} sels]} {<b><font color=#3a6797>set</font></b> sels [<b><font color=#3a6797>list</font></b>]}
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$ev</font> {
      &lt;&lt;Cut&gt;&gt; - &lt;&lt;Copy&gt;&gt; {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> llen [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$sels</font>]-1}]] &lt; 2} <b><font color=#ca14ca>return</font></b>
        <i><font color=#4b5d50># multiple ranges of selection:</font></i>
        <i><font color=#4b5d50># first, copy all selections to clipboard</font></i>
        <b><font color=#134070>clipboard</font></b> clear <font color=#653760>-displayof</font> <font color=#1b1baa>$w</font>
        <b><font color=#3a6797>foreach</font></b> {pos1 pos2} <font color=#1b1baa>$sels</font> {
          <b><font color=#134070>clipboard</font></b> append <font color=#653760>-displayof</font> <font color=#1b1baa>$w</font> [<font color=#1b1baa>$w</font> get <font color=#1b1baa>$pos1</font> <font color=#1b1baa>$pos2</font>]
        }
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ev</font> eq {&lt;&lt;Cut&gt;&gt;}} {
          <i><font color=#4b5d50># for Cut event: delete all selections</font></i>
          <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i <font color=#1b1baa>$llen</font>} {<font color=#1b1baa>$i</font>&gt;0} {<b><font color=#3a6797>incr</font></b> i -2} {
            <b><font color=#3a6797>set</font></b> pos1 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$sels</font> <font color=#1b1baa>$i</font>-1]
            <b><font color=#3a6797>set</font></b> pos2 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$sels</font> <font color=#1b1baa>$i</font>]
            <font color=#1b1baa>$w</font> delete <font color=#1b1baa>$pos1</font> <font color=#1b1baa>$pos2</font>
          }
        }
        <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> break
      }
      <b><font color=#3a6797>default</font></b> {
        <b><font color=#134070>event</font></b> generate <font color=#1b1baa>$w</font> <font color=#1b1baa>$ev</font>
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=getTextHotkeys></a>
  <b><font color=#ca14ca>proc</font></b> getTextHotkeys {key} {
    <i><font color=#4b5d50># Gets upper & lower keys for a hot key.</font></i>
    <i><font color=#4b5d50>#   key - the hot key</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_VARS
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist _AP_VARS(KEY,<font color=#1b1baa>$key</font>)]} {<b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b>]}
    <b><font color=#3a6797>set</font></b> keys <font color=#1b1baa>$_AP_VARS(KEY,$key)</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$keys</font>]==1} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> last - <font color=#1b1baa>$keys</font>]]&gt;0} {
        <b><font color=#3a6797>set</font></b> lt [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$keys</font> <font color=#1b1baa>$i</font>+1 end]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$lt</font>]==1} {  ;<i><font color=#4b5d50># for lower case of letters</font></i>
          <b><font color=#3a6797>set</font></b> keys <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>string range <font color=#1b1baa>$</font>keys 0 <font color=#1b1baa>$</font>i<font color=#1b1baa>][</font>string toupper <font color=#1b1baa>$</font>lt<font color=#1b1baa>]</font>&quot;</font>
          <b><font color=#3a6797>lappend</font></b> keys <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>string range <font color=#1b1baa>$</font>keys 0 <font color=#1b1baa>$</font>i<font color=#1b1baa>][</font>string tolower <font color=#1b1baa>$</font>lt<font color=#1b1baa>]</font>&quot;</font>
        }
      }
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$keys</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=setTextHotkeys></a>
  <b><font color=#ca14ca>proc</font></b> setTextHotkeys {key value} {
    <i><font color=#4b5d50># Sets new key combinations for some operations on text widgets.</font></i>
    <i><font color=#4b5d50>#   key - ctrlD for &quot;double selection&quot;, ctrlY for &quot;delete line&quot; operation</font></i>
    <i><font color=#4b5d50>#   value - list of new key combinations</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_VARS
    <b><font color=#3a6797>set</font></b> _AP_VARS(KEY,<font color=#1b1baa>$key</font>) <font color=#1b1baa>$value</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=setTextIndent></a>
  <b><font color=#ca14ca>proc</font></b> setTextIndent {len {padchar { }}} {
    <i><font color=#4b5d50># Sets an indenting for text widgets.</font></i>
    <i><font color=#4b5d50>#   len - length of indenting</font></i>
    <i><font color=#4b5d50>#   padchar - indenting character</font></i>

    <b><font color=#3a6797>variable</font></b> _AP_VARS
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$padchar</font> ne <font color=#8b2a0e>&quot;\t&quot;</font>} {<b><font color=#3a6797>set</font></b> padchar { }}
    <b><font color=#3a6797>set</font></b> _AP_VARS(INDENT) [<b><font color=#3a6797>string</font></b> repeat <font color=#1b1baa>$padchar</font> <font color=#1b1baa>$len</font>]
  }
<a id=EONS_::apave></a>
  <i><font color=#4b5d50>## ________________________ EONS ::apave _________________________ ##</font></i>

}
<a id=source_*.tcl></a>
<i><font color=#4b5d50># ________________________ source *.tcl _________________________ #</font></i>

<i><font color=#4b5d50># Let the *.tcl be sourced here just to ensure</font></i>
<i><font color=#4b5d50># that apave's stuff available for them and vice versa.</font></i>

<b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::apaveDir</font> obbit.tcl]
<a id=APaveBase_oo::class></a>
<i><font color=#4b5d50># ________________________ APaveBase oo::class _________________________ #</font></i>

<b><font color=#ca14ca>oo::class</font></b> create ::apave::APaveBase {

  <b><font color=#3a6797>mixin</font></b> ::apave::ObjectTheming

  <b><font color=#3a6797>variable</font></b> PV Moveall Initialcolor Modalwin Fgbut Bgbut Fgtxt Bgtxt Prepost Widgetopts Edge
<a id=constructor></a>
  <b><font color=#ca14ca>constructor</font></b> {{cs -2} args} {
    <i><font color=#4b5d50># Creates APaveBase object.</font></i>
    <i><font color=#4b5d50>#   cs - color scheme (CS)</font></i>
    <i><font color=#4b5d50>#   args - additional arguments</font></i>
    <i><font color=#4b5d50># If cs&gt;-2, the appropriate CS is set for the created APaveBase object.</font></i>
    <i><font color=#4b5d50># Makes few procedures in the object's namespace to access from</font></i>
    <i><font color=#4b5d50># event handlers:</font></i>
    <i><font color=#4b5d50>#   - ListboxHandle</font></i>
    <i><font color=#4b5d50>#   - ListboxSelect</font></i>
    <i><font color=#4b5d50>#   - WinResize</font></i>
    <i><font color=#4b5d50># This trick with *proc* inside an object is discussed at</font></i>
    <i><font color=#4b5d50>#   [proc-in-tcl-ooclass](https://stackoverflow.com/questions/54804964/proc-in-tcl-ooclass)</font></i>

    <i><font color=#4b5d50># keep the 'important' data of Pave object in array</font></i>
    <b><font color=#3a6797>array</font></b> set PV [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> Moveall 1
    <b><font color=#3a6797>set</font></b> Initialcolor {}
    <b><font color=#3a6797>set</font></b> Modalwin .
    <b><font color=#3a6797>set</font></b> Fgbut [<b><font color=#134070>ttk::style</font></b> lookup TButton <font color=#653760>-foreground</font>]; <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$Fgbut</font> eq {}} {<b><font color=#3a6797>set</font></b> Fgbut #000000}
    <b><font color=#3a6797>set</font></b> Bgbut [<b><font color=#134070>ttk::style</font></b> lookup TButton <font color=#653760>-background</font>]; <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$Bgbut</font> eq {}} {<b><font color=#3a6797>set</font></b> Bgbut #d9d9d9}
    <b><font color=#3a6797>set</font></b> Fgtxt [<b><font color=#134070>ttk::style</font></b> lookup TEntry <font color=#653760>-foreground</font>] ; <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$Fgtxt</font> eq {}} {<b><font color=#3a6797>set</font></b> Fgtxt #000000}
    <b><font color=#3a6797>set</font></b> Prepost [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> Widgetopts [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> Edge @@
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$Fgtxt</font> in {black #000000}} {
      <b><font color=#3a6797>set</font></b> Bgtxt white
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> Bgtxt [<b><font color=#134070>ttk::style</font></b> lookup TEntry <font color=#653760>-background</font>]
    }
    <i><font color=#4b5d50># set/reset a color scheme if it is/was requested</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cs</font>&gt;=-1} {<b><font color=#ca14ca>my</font></b> csSet <font color=#1b1baa>$cs</font>} {<b><font color=#ca14ca>my</font></b> initTooltip}

    <i><font color=#4b5d50># object's procedures</font></i>

  ; <b><font color=#ca14ca>proc</font></b> ListboxHandle {W offset maxChars} {

      <b><font color=#3a6797>set</font></b> list {}
      <b><font color=#3a6797>foreach</font></b> index [<font color=#1b1baa>$W</font> curselection] { <b><font color=#3a6797>lappend</font></b> list [<font color=#1b1baa>$W</font> get <font color=#1b1baa>$index</font>] }
      <b><font color=#3a6797>set</font></b> text [<b><font color=#3a6797>join</font></b> <font color=#1b1baa>$list</font> \n]
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$text</font> <font color=#1b1baa>$offset</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$offset</font>+<font color=#1b1baa>$maxChars</font>-1}]]
    }

  ; <b><font color=#ca14ca>proc</font></b> ListboxSelect {W} {
      <i><font color=#4b5d50># This code had been taken from Tcl's wiki:</font></i>
      <i><font color=#4b5d50>#   https://wiki.tcl-lang.org/page/listbox+selection</font></i>

      <b><font color=#134070>selection</font></b> clear <font color=#653760>-displayof</font> <font color=#1b1baa>$W</font>
      <b><font color=#134070>selection</font></b> own <font color=#653760>-command</font> {} <font color=#1b1baa>$W</font>
      <b><font color=#134070>selection</font></b> handle <font color=#653760>-type</font> UTF8_STRING \
        <font color=#1b1baa>$W</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>namespace</font></b> current]::ListboxHandle <font color=#1b1baa>$W</font>]
      <b><font color=#134070>selection</font></b> handle \
        <font color=#1b1baa>$W</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>namespace</font></b> current]::ListboxHandle <font color=#1b1baa>$W</font>]
      <b><font color=#ca14ca>return</font></b>
    }

  ; <b><font color=#ca14ca>proc</font></b> WinResize {win} {
      <i><font color=#4b5d50># Restricts the window's sizes (thus fixing Tk's issue with a menubar)</font></i>
      <i><font color=#4b5d50>#   win - path to a window to be of restricted sizes</font></i>

      <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$win</font> cget <font color=#653760>-menu</font>] ne {}} {
        <b><font color=#3a6797>lassign</font></b> [::apave::splitGeometry [<b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font>]] w h
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#134070>wm</font></b> minsize <font color=#1b1baa>$win</font>] wmin hmin
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$w</font>&lt;<font color=#1b1baa>$wmin</font> && <font color=#1b1baa>$h</font>&lt;<font color=#1b1baa>$hmin</font>} {
          <b><font color=#3a6797>set</font></b> corrgeom <font color=#1b1baa>${wmin}</font>x<font color=#1b1baa>$hmin</font>
        } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$w</font>&lt;<font color=#1b1baa>$wmin</font>} {
          <b><font color=#3a6797>set</font></b> corrgeom <font color=#1b1baa>${wmin}</font>x<font color=#1b1baa>$h</font>
        } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$h</font>&lt;<font color=#1b1baa>$hmin</font>} {
          <b><font color=#3a6797>set</font></b> corrgeom <font color=#1b1baa>${w}</font>x<font color=#1b1baa>$hmin</font>
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#ca14ca>return</font></b>
        }
        <b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font> <font color=#1b1baa>$corrgeom</font>
      }
      <b><font color=#ca14ca>return</font></b>
    }

    <i><font color=#4b5d50># the end of APaveBase constructor</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> [<b><font color=#ca14ca>self</font></b> next]]} { <b><font color=#3a6797>next</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> }
    <b><font color=#ca14ca>return</font></b>
  }
<a id=destructor></a>
  <b><font color=#ca14ca>destructor</font></b> {
    <i><font color=#4b5d50># Clears variables used in the object.</font></i>

    <b><font color=#3a6797>array</font></b> unset PV *
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> [<b><font color=#ca14ca>self</font></b> next]]} <b><font color=#3a6797>next</font></b>
  }
<a id=Methods_to_be_redefined></a>
  <i><font color=#4b5d50>## _______________________ Methods to be redefined ____________________ ##</font></i>
<a id=themePopup></a>
  <b><font color=#ca14ca>method</font></b> themePopup {mnu} {
    <i><font color=#4b5d50># Applies a color scheme to a popup menu.</font></i>
    <i><font color=#4b5d50>#   mnu - name of popup menu</font></i>
    <i><font color=#4b5d50># The method is to be redefined in descendants/mixins.</font></i>

  }
<a id=NonTtkTheme></a>
  <b><font color=#ca14ca>method</font></b> NonTtkTheme {win} {
    <i><font color=#4b5d50># Applies a current color scheme for non-ttk widgets.</font></i>
    <i><font color=#4b5d50>#   win - path to a window to be colored.</font></i>
    <i><font color=#4b5d50># Method to be redefined in descendants/mixins.</font></i>

  }
<a id=NonTtkStyle></a>
  <b><font color=#ca14ca>method</font></b> NonTtkStyle {typ {dsbl 0}} {
    <i><font color=#4b5d50># Gets a style for non-ttk widgets.</font></i>
    <i><font color=#4b5d50>#   typ - the type of widget (in apave terms, i.e. but, buT etc.)</font></i>
    <i><font color=#4b5d50>#   dsbl - a mode to get style of disabled (1) or readonly (2) widgets</font></i>
    <i><font color=#4b5d50># See also: widgetType</font></i>
    <i><font color=#4b5d50># Method to be redefined in descendants/mixins.</font></i>

  }
<a id=Helpers_for_APaveBase></a>
  <i><font color=#4b5d50>## _______________________ Helpers for APaveBase ________________________ ##</font></i>
<a id=paveoptionValue></a>
  <b><font color=#ca14ca>method</font></b> paveoptionValue {opt} {
    <i><font color=#4b5d50># Gets an option's value.</font></i>
    <i><font color=#4b5d50>#   opt - option's name</font></i>
    <i><font color=#4b5d50># Returns a value for options like &quot;Moveall&quot;.</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt</font> in [<b><font color=#3a6797>info</font></b> object vars [<b><font color=#ca14ca>self</font></b>]]} {
      <b><font color=#3a6797>variable</font></b> <font color=#1b1baa>$opt</font>
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$opt</font>]
    }
    <b><font color=#ca14ca>return</font></b> {}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=checkXY></a>
  <b><font color=#ca14ca>method</font></b> checkXY {w h x y} {
    <i><font color=#4b5d50># Checks the coordinates of window (against the screen).</font></i>
    <i><font color=#4b5d50>#   w - width of window</font></i>
    <i><font color=#4b5d50>#   h - height of window</font></i>
    <i><font color=#4b5d50>#   x - window's X coordinate</font></i>
    <i><font color=#4b5d50>#   y - window's Y coordinate</font></i>
    <i><font color=#4b5d50># Returns new coordinates in +X+Y form.</font></i>

    <i><font color=#4b5d50># check for left/right edge of screen (accounting decors)</font></i>
    <b><font color=#3a6797>set</font></b> scrw [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> vrootwidth .] - 12}]
    <b><font color=#3a6797>set</font></b> scrh [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> vrootheight .] - 36}]
    <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$x</font> + <font color=#1b1baa>$w</font>) &gt; <font color=#1b1baa>$scrw</font> } {
      <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$scrw</font> - <font color=#1b1baa>$w</font>}]
    }
    <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$y</font> + <font color=#1b1baa>$h</font>) &gt; <font color=#1b1baa>$scrh</font> } {
      <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$scrh</font> - <font color=#1b1baa>$h</font>}]
    }
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match -* <font color=#1b1baa>$x</font>]} {<b><font color=#3a6797>set</font></b> x +[<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$x</font> +]}
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match -* <font color=#1b1baa>$y</font>]} {<b><font color=#3a6797>set</font></b> y +[<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$y</font> +]}
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$x$y</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=CenteredXY></a>
  <b><font color=#ca14ca>method</font></b> CenteredXY {rw rh rx ry w h} {
    <i><font color=#4b5d50># Gets the coordinates of centered window (against its parent).</font></i>
    <i><font color=#4b5d50>#   rw - parent's width</font></i>
    <i><font color=#4b5d50>#   rh - parent's height</font></i>
    <i><font color=#4b5d50>#   rx - parent's X coordinate</font></i>
    <i><font color=#4b5d50>#   ry - parent's Y coordinate</font></i>
    <i><font color=#4b5d50>#   w - width of window to be centered</font></i>
    <i><font color=#4b5d50>#   h - height of window to be centered</font></i>
    <i><font color=#4b5d50># Returns centered coordinates in +X+Y form.</font></i>

    <b><font color=#3a6797>set</font></b> x [<b><font color=#3a6797>expr</font></b> {max(0, <font color=#1b1baa>$rx</font> + (<font color=#1b1baa>$rw</font> - <font color=#1b1baa>$w</font>) / 2)}]
    <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {max(0,<font color=#1b1baa>$ry</font> + (<font color=#1b1baa>$rh</font> - <font color=#1b1baa>$h</font>) / 2)}]
    <b><font color=#ca14ca>my</font></b> checkXY <font color=#1b1baa>$w</font> <font color=#1b1baa>$h</font> <font color=#1b1baa>$x</font> <font color=#1b1baa>$y</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=ownWName></a>
  <b><font color=#ca14ca>method</font></b> ownWName {name} {
    <i><font color=#4b5d50># Gets a tail (last part) of widget's name</font></i>
    <i><font color=#4b5d50>#   name - name (path) of the widget</font></i>

    <b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$name</font> .] end
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=parentWName></a>
  <b><font color=#ca14ca>method</font></b> parentWName {name} {
    <i><font color=#4b5d50># Gets parent name of widget.</font></i>
    <i><font color=#4b5d50>#   name - name (path) of the widget</font></i>

    <b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> 0 [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$name</font>]-1
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=iconA></a>
  <b><font color=#ca14ca>method</font></b> iconA {icon {iconset small} {cmpd left}} {
    <i><font color=#4b5d50># Gets icon attributes for buttons, menus etc.</font></i>
    <i><font color=#4b5d50>#   icon - name of icon</font></i>
    <i><font color=#4b5d50>#   iconset - one of small/middle/large</font></i>
    <i><font color=#4b5d50>#   cmpd - value of -compound option</font></i>
    <i><font color=#4b5d50># The *iconset* is &quot;small&quot; for menus (recommended and default).</font></i>

    <b><font color=#ca14ca>return</font></b> <font color=#8b2a0e>&quot;-image <font color=#1b1baa>[</font>::apave::iconImage <font color=#1b1baa>$</font>icon <font color=#1b1baa>$</font>iconset<font color=#1b1baa>]</font> -compound <font color=#1b1baa>$</font>cmpd&quot;</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=configure></a>
  <b><font color=#ca14ca>method</font></b> configure {args} {
    <i><font color=#4b5d50># Configures the apave object (all of options may be changed).</font></i>
    <i><font color=#4b5d50>#   args - list of pairs name/value of options</font></i>
    <i><font color=#4b5d50># Example:</font></i>
    <i><font color=#4b5d50>#     pobj configure edge &quot;@@&quot;</font></i>

    <b><font color=#3a6797>foreach</font></b> {optnam optval} <font color=#1b1baa>$args</font> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$optnam</font> <font color=#1b1baa>$optval</font>}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=ExpandOptions></a>
  <b><font color=#ca14ca>method</font></b> ExpandOptions {<b><font color=#134070>options</font></b>} {
    <i><font color=#4b5d50># Expands shortened options.</font></i>

    <b><font color=#3a6797>set</font></b> options [<b><font color=#3a6797>string</font></b> map {
      { <font color=#653760>-st</font> } { <font color=#653760>-sticky</font> }
      { <font color=#653760>-com</font> } { <font color=#653760>-command</font> }
      { <font color=#653760>-t</font> } { <font color=#653760>-text</font> }
      { <font color=#653760>-w</font> } { <font color=#653760>-width</font> }
      { <font color=#653760>-h</font> } { <font color=#653760>-height</font> }
      { <font color=#653760>-var</font> } { <font color=#653760>-variable</font> }
      { <font color=#653760>-tvar</font> } { <font color=#653760>-textvariable</font> }
      { <font color=#653760>-lvar</font> } { <font color=#653760>-listvariable</font> }
      { <font color=#653760>-ro</font> } { <font color=#653760>-readonly</font> }
    } <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>options&quot;</font>]
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$options</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=AddButtonIcon></a>
  <b><font color=#ca14ca>method</font></b> AddButtonIcon {w attrsName} {
    <i><font color=#4b5d50># Gets the button's icon based on its text and name (e.g. butOK) and</font></i>
    <i><font color=#4b5d50># appends it to the attributes of button.</font></i>
    <i><font color=#4b5d50>#   w - button's name</font></i>
    <i><font color=#4b5d50>#   attrsName - name of variable containing attributes of the button</font></i>

    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$attrsName</font> attrs
    <b><font color=#3a6797>set</font></b> com [::apave::getOption <font color=#653760>-com</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is integer <font color=#653760>-strict</font> <font color=#1b1baa>$com</font>]} {  ;<i><font color=#4b5d50># returned integer result</font></i>
      ::apave::extractOptions attrs <font color=#653760>-com</font> {}
      <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; -com <font color=#1b1baa>{[</font>self<font color=#1b1baa>]</font> res <font color=#1b1baa>{[</font>my pavedPath<font color=#1b1baa>]}</font> <font color=#1b1baa>$</font>com<font color=#1b1baa>}</font>&quot;</font>
    }
    <b><font color=#3a6797>if</font></b> {[::apave::getOption <font color=#653760>-image</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] ne {}} <b><font color=#ca14ca>return</font></b>
    <b><font color=#3a6797>set</font></b> txt [::apave::getOption <font color=#653760>-t</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$txt</font> eq {}} { <b><font color=#3a6797>set</font></b> txt [::apave::getOption <font color=#653760>-text</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] }
    <b><font color=#3a6797>set</font></b> im {}
    <b><font color=#3a6797>set</font></b> icolist [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>exit</font></b> abort} {<b><font color=#3a6797>exit</font></b> close} \
      {SaveFile save} {OpenFile open}]
    <i><font color=#4b5d50># ok, yes, cancel, apply buttons should be at the end of list</font></i>
    <i><font color=#4b5d50># as their texts can be renamed (e.g. &quot;Help&quot; in e_menu's &quot;About&quot;)</font></i>
    <b><font color=#3a6797>lappend</font></b> icolist {<b><font color=#3a6797>*</font></b>}[::apave::iconImage] {yes apply}
    <b><font color=#3a6797>foreach</font></b> icon <font color=#1b1baa>$icolist</font> {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$icon</font> ic1 ic2
      <i><font color=#4b5d50># text of button is of highest priority at defining its icon</font></i>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> <font color=#1b1baa>$ic1</font> <font color=#1b1baa>$txt</font>] || \
      [<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> b*t<font color=#1b1baa>$ic1</font> <font color=#1b1baa>$w</font>] || (<font color=#1b1baa>$ic2</font> ne {} && ( \
      [<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> b*t<font color=#1b1baa>$ic2</font> <font color=#1b1baa>$w</font>] || [<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> <font color=#1b1baa>$ic2</font> <font color=#1b1baa>$txt</font>]))} {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> btT* <font color=#1b1baa>$w</font>]} {
          <b><font color=#3a6797>set</font></b> cmpd none
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> cmpd left
        }
        <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; <font color=#1b1baa>[</font>my iconA <font color=#1b1baa>$</font>ic1 small <font color=#1b1baa>$</font>cmpd<font color=#1b1baa>]</font>&quot;</font>
        <b><font color=#ca14ca>break</font></b>
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=ListboxesAttrs></a>
  <b><font color=#ca14ca>method</font></b> ListboxesAttrs {w attrs} {
    <i><font color=#4b5d50># Appends selection attributes to listboxes.</font></i>
    <i><font color=#4b5d50># Details:</font></i>
    <i><font color=#4b5d50>#   1. https://wiki.tcl-lang.org/page/listbox+selection</font></i>
    <i><font color=#4b5d50>#   2. https://stackoverflow.com, the question:</font></i>
    <i><font color=#4b5d50>#        the-tablelist-curselection-goes-at-calling-the-directory-dialog</font></i>

    <b><font color=#3a6797>if</font></b> {{<font color=#653760>-exportselection</font>} ni <font color=#1b1baa>$attrs</font>} {
      <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; -ListboxSel <font color=#1b1baa>$</font>w -selectmode extended -exportselection 0&quot;</font>
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$attrs</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=getWidChildren></a>
  <b><font color=#ca14ca>method</font></b> getWidChildren {wid treeName {init yes}} {
    <i><font color=#4b5d50># Gets children of a widget.</font></i>
    <i><font color=#4b5d50>#   wid - widget's path</font></i>
    <i><font color=#4b5d50>#   treeName - name of variable to hold the result.</font></i>

    <b><font color=#3a6797>upvar</font></b> <font color=#1b1baa>$treeName</font> tree
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$init</font>} {<b><font color=#3a6797>set</font></b> tree [<b><font color=#3a6797>list</font></b>]}
    <b><font color=#3a6797>foreach</font></b> ch [<b><font color=#134070>winfo</font></b> children <font color=#1b1baa>$wid</font>] {
      <b><font color=#3a6797>lappend</font></b> tree <font color=#1b1baa>$ch</font>
      <b><font color=#ca14ca>my</font></b> getWidChildren <font color=#1b1baa>$ch</font> <font color=#1b1baa>$treeName</font> no
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=findWidPath></a>
  <b><font color=#ca14ca>method</font></b> findWidPath {wid {mode exact} {visible yes}} {
    <i><font color=#4b5d50># Searches a widget's path among the active widgets.</font></i>
    <i><font color=#4b5d50>#   w - widget name, set partially e.g. &quot;wid&quot; instead of &quot;.win.wid&quot;</font></i>
    <i><font color=#4b5d50>#   mode - if &quot;exact&quot;, searches *.wid; if &quot;globe&quot;, searches *wid*</font></i>
    <i><font color=#4b5d50># Returns the widget's full path or &quot;&quot; if the widget isn't active.</font></i>

    <b><font color=#ca14ca>my</font></b> getWidChildren . tree
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$mode</font> eq {exact}} {
      <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-glob</font> <font color=#1b1baa>$tree</font> <font color=#8b2a0e>&quot;*.<font color=#1b1baa>$</font>wid&quot;</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-glob</font> <font color=#1b1baa>$tree</font> <font color=#8b2a0e>&quot;*<font color=#1b1baa>$</font>wid*&quot;</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>&gt;-1} {<b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$tree</font> <font color=#1b1baa>$i</font>]}
    <b><font color=#ca14ca>return</font></b> {}
  }
<a id=File_content_widget></a>
  <i><font color=#4b5d50>## _______________________ File content widget _______________________ ##</font></i>
<a id=FCfieldAttrs></a>
  <b><font color=#ca14ca>method</font></b> FCfieldAttrs {wnamefull attrs varopt} {
    <i><font color=#4b5d50># Fills the non-standard attributes of file content widget.</font></i>
    <i><font color=#4b5d50>#   wnamefull - a widget name</font></i>
    <i><font color=#4b5d50>#   attrs - a list of all attributes</font></i>
    <i><font color=#4b5d50>#   varopt - a variable option</font></i>
    <i><font color=#4b5d50># The *varopt* refers to a variable part such as tvar, lvar:</font></i>
    <i><font color=#4b5d50>#  * -inpval option means an initial value of the field</font></i>
    <i><font color=#4b5d50>#  * -retpos option has p1:p2 format (e.g. 0:10) to cut a substring \</font></i>
<i><font color=#4b5d50>    from a returned value</font></i>
    <i><font color=#4b5d50># Returns *attrs* without -inpval and -retpos options.</font></i>

    <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$attrs</font> <font color=#1b1baa>$varopt</font> {} <font color=#653760>-retpos</font> {} <font color=#653760>-inpval</font> {}] \
      vn rp iv
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first {<font color=#653760>-state</font> disabled} <font color=#1b1baa>$attrs</font>]&lt;0 && <font color=#1b1baa>$vn</font> ne {}} {
      <b><font color=#3a6797>set</font></b> all {}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$varopt</font> eq {<font color=#653760>-lvar</font>}} {
        <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attrs <font color=#653760>-values</font> {} <font color=#653760>-ALL</font> 0] iv a
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is boolean <font color=#653760>-strict</font> <font color=#1b1baa>$a</font>] && <font color=#1b1baa>$a</font>} {<b><font color=#3a6797>set</font></b> all ALL}
        <b><font color=#3a6797>lappend</font></b> Widgetopts <font color=#8b2a0e>&quot;-lbxname<font color=#1b1baa>$</font>all <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>$</font>vn&quot;</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rp</font> ne {}} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$all</font> ne {}} {<b><font color=#3a6797>set</font></b> rp 0:end}
        <b><font color=#3a6797>lappend</font></b> Widgetopts <font color=#8b2a0e>&quot;-retpos <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>$</font>vn <font color=#1b1baa>$</font>rp&quot;</font>
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$iv</font> ne {}} { <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vn</font> <font color=#1b1baa>$iv</font> }
    <b><font color=#ca14ca>return</font></b> [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-retpos</font> <font color=#653760>-inpval</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=FCfieldValues></a>
  <b><font color=#ca14ca>method</font></b> FCfieldValues {wnamefull attrs} {
    <i><font color=#4b5d50># Fills the file content widget's values.</font></i>
    <i><font color=#4b5d50>#   wnamefull - name (path) of fco widget</font></i>
    <i><font color=#4b5d50>#   attrs - attributes of the widget</font></i>

  ; <b><font color=#ca14ca>proc</font></b> readFCO {fname} {
      <i><font color=#4b5d50># Reads a file's content.</font></i>
      <i><font color=#4b5d50># Returns a list of (non-empty) lines of the file.</font></i>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fname</font> eq {}} {
        <b><font color=#3a6797>set</font></b> retval {{}}
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> retval {}
        <b><font color=#3a6797>foreach</font></b> ln [<b><font color=#3a6797>split</font></b> [::apave::readTextFile <font color=#1b1baa>$fname</font> {} 1] \n] {
          <i><font color=#4b5d50># probably, it's bad idea to have braces in the file of contents</font></i>
          <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \\ \\\\ \{ \\\{ \} \\\}] <font color=#1b1baa>$ln</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ln</font> ne {}} {<b><font color=#3a6797>lappend</font></b> retval <font color=#1b1baa>$ln</font>}
        }
      }
      <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$retval</font>
    }

  ; <b><font color=#ca14ca>proc</font></b> contFCO {fline opts edge args} {
      <i><font color=#4b5d50># Given a file's line and options,</font></i>
      <i><font color=#4b5d50># cuts a substring from the line.</font></i>
      <b><font color=#3a6797>lassign</font></b> [::apave::parseOptionsFile 1 <font color=#1b1baa>$opts</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>] opts
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$opts</font> - - - div1 - div2 - pos - len - RE - ret
      <b><font color=#3a6797>set</font></b> ldv1 [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$div1</font>]
      <b><font color=#3a6797>set</font></b> ldv2 [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$div2</font>]
      <b><font color=#3a6797>set</font></b> i1 [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$div1</font> <font color=#1b1baa>$fline</font>]+<font color=#1b1baa>$ldv1</font>}]
      <b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$div2</font> <font color=#1b1baa>$fline</font>]-1}]
      <b><font color=#3a6797>set</font></b> filterfile yes
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ldv1</font> && <font color=#1b1baa>$ldv2</font>} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i1</font>&lt;0 || <font color=#1b1baa>$i2</font>&lt;0} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$edge</font>}
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$fline</font> <font color=#1b1baa>$i1</font> <font color=#1b1baa>$i2</font>]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$ldv1</font>} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i1</font>&lt;0} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$edge</font>}
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$fline</font> <font color=#1b1baa>$i1</font> end]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$ldv2</font>} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i2</font>&lt;0} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$edge</font>}
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$fline</font> 0 <font color=#1b1baa>$i2</font>]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$pos</font> ne {} && <font color=#1b1baa>$len</font> ne {}} {
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$fline</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$pos</font>+[<b><font color=#3a6797>incr</font></b> len -1]]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$pos</font> ne {}} {
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$fline</font> <font color=#1b1baa>$pos</font> end]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$len</font> ne {}} {
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$fline</font> 0 <font color=#1b1baa>$len</font>-1]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$RE</font> ne {}} {
        <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>regexp</font></b> <font color=#653760>-inline</font> <font color=#1b1baa>$RE</font> <font color=#1b1baa>$fline</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$retval</font>]&gt;1} {
          <b><font color=#3a6797>foreach</font></b> r [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$retval</font> 1 end] {<b><font color=#3a6797>append</font></b> retval_tmp <font color=#1b1baa>$r</font>}
          <b><font color=#3a6797>set</font></b> retval <font color=#1b1baa>$retval_tmp</font>
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$retval</font> 0]
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> retval <font color=#1b1baa>$fline</font>
        <b><font color=#3a6797>set</font></b> filterfile no
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$retval</font> eq {} && <font color=#1b1baa>$filterfile</font>} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$edge</font>}
      <b><font color=#3a6797>set</font></b> retval [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> <font color=#8b2a0e>&quot;\}&quot;</font> <font color=#8b2a0e>&quot;\\\}&quot;</font>  <font color=#8b2a0e>&quot;\{&quot;</font> <font color=#8b2a0e>&quot;\\\{&quot;</font>] <font color=#1b1baa>$retval</font>]
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$retval</font> <font color=#1b1baa>$ret</font>]
    }

    <b><font color=#3a6797>set</font></b> edge <font color=#1b1baa>$Edge</font>
    <b><font color=#3a6797>set</font></b> ldv1 [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$edge</font>]
    <b><font color=#3a6797>set</font></b> filecontents {}
    <b><font color=#3a6797>set</font></b> optionlists {}
    <b><font color=#3a6797>set</font></b> tplvalues {}
    <b><font color=#3a6797>set</font></b> retpos {}
    <b><font color=#3a6797>set</font></b> values [::apave::getOption <font color=#653760>-values</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$edge</font> <font color=#1b1baa>$values</font>]&lt;0} { ;<i><font color=#4b5d50># if 1 file, edge</font></i>
      <b><font color=#3a6797>set</font></b> values <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>edge<font color=#1b1baa>$</font>values<font color=#1b1baa>$</font>edge&quot;</font>      ;<i><font color=#4b5d50># may be omitted</font></i>
    }
    <i><font color=#4b5d50># get: files' contents, files' options, template line</font></i>
    <b><font color=#3a6797>set</font></b> lopts {<font color=#653760>-list</font> {} <font color=#653760>-div1</font> {} <font color=#653760>-div2</font> {} <font color=#653760>-pos</font> {} <font color=#653760>-len</font> {} <font color=#653760>-RE</font> {} <font color=#653760>-ret</font> 0}
    <b><font color=#3a6797>while</font></b> {1} {
      <b><font color=#3a6797>set</font></b> i1 [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$edge</font> <font color=#1b1baa>$values</font>]
      <b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$edge</font> <font color=#1b1baa>$values</font> <font color=#1b1baa>$i1</font>+1]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i1</font>&gt;=0 && <font color=#1b1baa>$i2</font>&gt;=0} {
        <b><font color=#3a6797>incr</font></b> i1 <font color=#1b1baa>$ldv1</font>
        <b><font color=#3a6797>append</font></b> tplvalues [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$values</font> 0 <font color=#1b1baa>$i1</font>-1]
        <b><font color=#3a6797>set</font></b> fdata [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$values</font> <font color=#1b1baa>$i1</font> <font color=#1b1baa>$i2</font>-1]
        <b><font color=#3a6797>lassign</font></b> [::apave::parseOptionsFile 1 <font color=#1b1baa>$fdata</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lopts</font>] fopts fname
        <b><font color=#3a6797>lappend</font></b> filecontents [readFCO <font color=#1b1baa>$fname</font>]
        <b><font color=#3a6797>lappend</font></b> optionlists <font color=#1b1baa>$fopts</font>
        <b><font color=#3a6797>set</font></b> values [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$values</font> <font color=#1b1baa>$i2</font>+<font color=#1b1baa>$ldv1</font> end]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>append</font></b> tplvalues <font color=#1b1baa>$values</font>
        <b><font color=#ca14ca>break</font></b>
      }
    }
    <i><font color=#4b5d50># fill the combobox lines, using files' contents and options</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> leno [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$optionlists</font>]]} {
      <b><font color=#3a6797>set</font></b> newvalues {}
      <b><font color=#3a6797>set</font></b> ilin 0
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$filecontents</font> firstFCO
      <b><font color=#3a6797>foreach</font></b> fline <font color=#1b1baa>$firstFCO</font> { ;<i><font color=#4b5d50># lines of first file for a base</font></i>
        <b><font color=#3a6797>set</font></b> line {}
        <b><font color=#3a6797>set</font></b> tplline <font color=#1b1baa>$tplvalues</font>
        <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> io 0} {<font color=#1b1baa>$io</font>&lt;<font color=#1b1baa>$leno</font>} {<b><font color=#3a6797>incr</font></b> io} {
          <b><font color=#3a6797>set</font></b> opts [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$optionlists</font> <font color=#1b1baa>$io</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ilin</font>==0} {  ;<i><font color=#4b5d50># 1st cycle: add items from -list option</font></i>
            <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$opts</font> - list1  ;<i><font color=#4b5d50># -list option goes first</font></i>
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$list1</font>]} {
              <b><font color=#3a6797>foreach</font></b> l1 <font color=#1b1baa>$list1</font> {<b><font color=#3a6797>append</font></b> newvalues <font color=#8b2a0e>&quot;\{<font color=#1b1baa>$</font>l1\} &quot;</font>}
              <b><font color=#3a6797>lappend</font></b> Widgetopts <font color=#8b2a0e>&quot;-list <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>[</font>list <font color=#1b1baa>$</font>list1<font color=#1b1baa>]</font>&quot;</font>
            }
          }
          <b><font color=#3a6797>set</font></b> i1 [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$edge</font> <font color=#1b1baa>$tplline</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i1</font>&gt;=0} {
            <b><font color=#3a6797>lassign</font></b> [contFCO <font color=#1b1baa>$fline</font> <font color=#1b1baa>$opts</font> <font color=#1b1baa>$edge</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lopts</font>] retline ret
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ret</font> ne <font color=#8b2a0e>&quot;0&quot;</font> && <font color=#1b1baa>$retline</font> ne <font color=#1b1baa>$edge</font> && \
            [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$edge</font> <font color=#1b1baa>$line</font>]&lt;0} {
              <b><font color=#3a6797>set</font></b> p1 [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]+<font color=#1b1baa>$i1</font>}]
              <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$io</font>&lt;(<font color=#1b1baa>$leno</font>-1)} {
                <b><font color=#3a6797>set</font></b> p2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$p1</font>+[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$retline</font>]-1}]
              } <b><font color=#3a6797>else</font></b> {
                <b><font color=#3a6797>set</font></b> p2 end
              }
              <b><font color=#3a6797>set</font></b> retpos <font color=#8b2a0e>&quot;-retpos <font color=#1b1baa>$</font>p1:<font color=#1b1baa>$</font>p2&quot;</font>
            }
            <b><font color=#3a6797>append</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tplline</font> 0 <font color=#1b1baa>$i1</font>-1] <font color=#1b1baa>$retline</font>
            <b><font color=#3a6797>set</font></b> tplline [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tplline</font> <font color=#1b1baa>$i1</font>+<font color=#1b1baa>$ldv1</font> end]
          } <b><font color=#3a6797>else</font></b> {
            <b><font color=#ca14ca>break</font></b>
          }
          <b><font color=#3a6797>set</font></b> fline [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$filecontents</font> <font color=#1b1baa>$io</font>+1] <font color=#1b1baa>$ilin</font>]
        }
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$edge</font> <font color=#1b1baa>$line</font>]&lt;0} {
          <i><font color=#4b5d50># put only valid lines into the list of values</font></i>
          <b><font color=#3a6797>append</font></b> newvalues <font color=#8b2a0e>&quot;\{<font color=#1b1baa>$</font>line<font color=#1b1baa>$</font>tplline\} &quot;</font>
        }
        <b><font color=#3a6797>incr</font></b> ilin
      }
      <i><font color=#4b5d50># replace old 'values' attribute with the new 'values'</font></i>
      <b><font color=#3a6797>lassign</font></b> [::apave::parseOptionsFile 2 <font color=#1b1baa>$attrs</font> <font color=#653760>-values</font> \
        [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$newvalues</font>]] attrs
    }
    <b><font color=#ca14ca>return</font></b> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs <font color=#1b1baa>$</font>retpos&quot;</font>
  }
<a id=Timeout_button></a>
  <i><font color=#4b5d50>## _______________________ Timeout button _______________________ ##</font></i>
<a id=timeoutButton></a>
  <b><font color=#ca14ca>method</font></b> timeoutButton {w tmo lbl {lbltext <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Invokes a button's action after a timeout.</font></i>
    <i><font color=#4b5d50>#   w - button's path</font></i>
    <i><font color=#4b5d50>#   tmo - timeout in sec.</font></i>
    <i><font color=#4b5d50>#   lbl - label widget, where seconds to wait are displayed</font></i>
    <i><font color=#4b5d50>#   lbltext - original text of label</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tmo</font>&gt;0} {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> lbl [<b><font color=#ca14ca>my</font></b> <font color=#1b1baa>$lbl</font>]}
      <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exist <font color=#1b1baa>$lbl</font>]} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$lbltext</font> eq {}} {
          <b><font color=#3a6797>set</font></b> lbltext [<font color=#1b1baa>$lbl</font> cget <font color=#653760>-text</font>]
          <b><font color=#3a6797>lappend</font></b> ::apave::_AP_VARS(TIMW) <font color=#1b1baa>$w</font>
        }
        <font color=#1b1baa>$lbl</font> configure <font color=#653760>-text</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>lbltext <font color=#1b1baa>$</font>tmo sec. &quot;</font>
      }
      <b><font color=#3a6797>incr</font></b> tmo -1
      <b><font color=#3a6797>after</font></b> 1000 [<b><font color=#3a6797>list</font></b> if <font color=#8b2a0e>&quot;\[info commands <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font>\] ne <font color=#1b1baa>{}</font>&quot;</font> \
        <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> checkTimeoutButton <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>tmo <font color=#1b1baa>$</font>lbl <font color=#1b1baa>{$</font>lbltext<font color=#1b1baa>}</font>&quot;</font>]
      <b><font color=#ca14ca>return</font></b>
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exist <font color=#1b1baa>$w</font>]} {<font color=#1b1baa>$w</font> invoke}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=checkTimeoutButton></a>
  <b><font color=#ca14ca>method</font></b> checkTimeoutButton {w tmo lbl {lbltext <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Checks if the timeout button is alive & focused; if not, cancels the timeout.</font></i>
    <i><font color=#4b5d50>#   w - button's path</font></i>
    <i><font color=#4b5d50>#   tmo - timeout in sec.</font></i>
    <i><font color=#4b5d50>#   lbl - label widget, where seconds to wait are displayed</font></i>
    <i><font color=#4b5d50>#   lbltext - original text of label</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$lbl</font>]} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>focus</font></b>] in [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$w</font> {}]} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$w</font> in <font color=#1b1baa>$::apave::_AP_VARS(TIMW)</font>} {
          <b><font color=#ca14ca>my</font></b> timeoutButton <font color=#1b1baa>$w</font> <font color=#1b1baa>$tmo</font> <font color=#1b1baa>$lbl</font> <font color=#1b1baa>$lbltext</font>
        }
      } <b><font color=#3a6797>else</font></b> {
        <font color=#1b1baa>$lbl</font> configure <font color=#653760>-text</font> <font color=#1b1baa>$lbltext</font>
      }
    }
  }
<a id=Making_widgets></a>
  <i><font color=#4b5d50>## ________________________ Making widgets _________________________ ##</font></i>
<a id=widgetType></a>
  <b><font color=#ca14ca>method</font></b> widgetType {wnamefull options attrs} {
    <i><font color=#4b5d50># Gets the widget type based on 3 initial letters of its name. Also</font></i>
    <i><font color=#4b5d50># fills the grid/pack options and attributes of the widget.</font></i>
    <i><font color=#4b5d50>#   wnamefull - path to the widget</font></i>
    <i><font color=#4b5d50>#   options - grid/pack options of the widget</font></i>
    <i><font color=#4b5d50>#   attrs - attribute of the widget</font></i>
    <i><font color=#4b5d50># Returns a list of items:</font></i>
    <i><font color=#4b5d50>#   widget - Tk/Ttk widget name</font></i>
    <i><font color=#4b5d50>#   options - grid/pack options of the widget</font></i>
    <i><font color=#4b5d50>#   attrs - attribute of the widget</font></i>
    <i><font color=#4b5d50>#   nam3 - 3 initial letters of widget's name</font></i>
    <i><font color=#4b5d50>#   disabled - flag of *disabled* state</font></i>

    <b><font color=#3a6797>set</font></b> disabled [<b><font color=#3a6797>expr</font></b> {[::apave::getOption <font color=#653760>-state</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] eq {disabled}}]
    <b><font color=#3a6797>set</font></b> pack <font color=#1b1baa>$options</font>
    <b><font color=#3a6797>set</font></b> name [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$wnamefull</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::apave::_AP_VARS(ProSplash,type)] && \
    <font color=#1b1baa>$::apave::_AP_VARS(ProSplash,type)</font> eq {}} {
      <b><font color=#3a6797>set</font></b> val [<b><font color=#ca14ca>my</font></b> progress_Go [<b><font color=#3a6797>incr</font></b> ::apave::_AP_VARS(ProSplash,curvalue)] {} <font color=#1b1baa>$name</font>]
    }
    <b><font color=#3a6797>set</font></b> nam3 [<b><font color=#3a6797>string</font></b> tolower [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$name</font> 0]][<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> 1 2]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$nam3</font> 1] eq <font color=#8b2a0e>&quot;_&quot;</font>} {<b><font color=#3a6797>set</font></b> k [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$nam3</font> 0 1]} {<b><font color=#3a6797>set</font></b> k <font color=#1b1baa>$nam3</font>}
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> defaultATTRS <font color=#1b1baa>$k</font>] defopts defattrs newtype
    <b><font color=#3a6797>set</font></b> options <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>defopts <font color=#1b1baa>$</font>options&quot;</font>
    <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>defattrs <font color=#1b1baa>$</font>attrs&quot;</font>
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-glob</font> -- <font color=#1b1baa>$nam3</font> {
      bts {
        <b><font color=#3a6797>set</font></b> widget ttk::frame
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>namespace</font></b> exists ::bartabs]} {
          <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::SRCDIR</font> bartabs bartabs.tcl]
        }
        <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-bartabs <font color=#1b1baa>{$</font>attrs<font color=#1b1baa>}</font>&quot;</font>
      }
      but {
        <b><font color=#3a6797>set</font></b> widget ttk::button
        <b><font color=#ca14ca>my</font></b> AddButtonIcon <font color=#1b1baa>$name</font> attrs
      }
      buT - btT {
        <b><font color=#3a6797>set</font></b> widget button
        <b><font color=#ca14ca>my</font></b> AddButtonIcon <font color=#1b1baa>$name</font> attrs
      }
      can {<b><font color=#3a6797>set</font></b> widget canvas}
      chb {<b><font color=#3a6797>set</font></b> widget ttk::checkbutton}
      swi {
        <b><font color=#3a6797>set</font></b> widget ttk::checkbutton
        <b><font color=#3a6797>if</font></b> {![<b><font color=#ca14ca>my</font></b> apaveTheme]} {
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs -style Switch.TCheckbutton&quot;</font>
        }
      }
      chB {<b><font color=#3a6797>set</font></b> widget checkbutton}
      cbx - fco {
        <b><font color=#3a6797>set</font></b> widget ttk::combobox
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nam3</font> eq {fco}} {  ;<i><font color=#4b5d50># file content combobox</font></i>
          <b><font color=#3a6797>set</font></b> attrs [<b><font color=#ca14ca>my</font></b> FCfieldValues <font color=#1b1baa>$wnamefull</font> <font color=#1b1baa>$attrs</font>]
        }
        <b><font color=#3a6797>set</font></b> attrs [<b><font color=#ca14ca>my</font></b> FCfieldAttrs <font color=#1b1baa>$wnamefull</font> <font color=#1b1baa>$attrs</font> <font color=#653760>-tvar</font>]
      }
      ent {<b><font color=#3a6797>set</font></b> widget ttk::entry}
      enT {<b><font color=#3a6797>set</font></b> widget entry}
      fil - fiL -
      fis - fiS -
      dir - diR -
      fon - foN -
      clr - clR -
      dat - daT -
      sta -
      too -
      fra {
        <i><font color=#4b5d50># + frame for choosers and bars</font></i>
        <b><font color=#3a6797>set</font></b> widget ttk::frame
      }
      frA {
        <b><font color=#3a6797>set</font></b> widget frame
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$disabled</font>} {<b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-state</font>]}
      }
      ftx {<b><font color=#3a6797>set</font></b> widget ttk::labelframe}
      gut {<b><font color=#3a6797>set</font></b> widget canvas}
      lab {
        <b><font color=#3a6797>set</font></b> widget ttk::label
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$disabled</font>} {
          <b><font color=#3a6797>set</font></b> grey [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> csGet] 8]
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-foreground <font color=#1b1baa>$</font>grey <font color=#1b1baa>$</font>attrs&quot;</font>
        }
        <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-link</font> {} <font color=#653760>-style</font> {} <font color=#653760>-font</font> {}] \
          cmd style font
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cmd</font> ne {}} {
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-linkcom <font color=#1b1baa>{$</font>cmd<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>attrs&quot;</font>
          <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-link</font>]
        }
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$style</font> eq {} && <font color=#1b1baa>$font</font> eq {}} {
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-font <font color=#1b1baa>{$</font>::apave::FONTMAIN<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>attrs&quot;</font>
        } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$style</font> ne {}} {
          <i><font color=#4b5d50># some themes stumble at ttk styles, so bring their attrs directly</font></i>
          <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-style</font>]
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>ttk::style configure <font color=#1b1baa>$</font>style<font color=#1b1baa>]</font> <font color=#1b1baa>$</font>attrs&quot;</font>
        }
      }
      laB {<b><font color=#3a6797>set</font></b> widget label}
      lfr {<b><font color=#3a6797>set</font></b> widget ttk::labelframe}
      lfR {
        <b><font color=#3a6797>set</font></b> widget labelframe
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$disabled</font>} {<b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-state</font>]}
      }
      lbx - flb {
        <b><font color=#3a6797>set</font></b> widget listbox
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nam3</font> eq {flb}} {  ;<i><font color=#4b5d50># file content listbox</font></i>
          <b><font color=#3a6797>set</font></b> attrs [<b><font color=#ca14ca>my</font></b> FCfieldValues <font color=#1b1baa>$wnamefull</font> <font color=#1b1baa>$attrs</font>]
        }
        <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>my FCfieldAttrs <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>$</font>attrs -lvar<font color=#1b1baa>]</font>&quot;</font>
        <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>my ListboxesAttrs <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>$</font>attrs<font color=#1b1baa>]</font>&quot;</font>
        <b><font color=#ca14ca>my</font></b> AddPopupAttr <font color=#1b1baa>$wnamefull</font> attrs <font color=#653760>-entrypop</font> 1
        <b><font color=#3a6797>foreach</font></b> {ev com} {Home {::apave::LbxSelect %w 0} End {::apave::LbxSelect %w end}} {
          <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; -bindEC <font color=#1b1baa>{</font>&lt;<font color=#1b1baa>$</font>ev&gt; <font color=#1b1baa>{$</font>com<font color=#1b1baa>}}</font> &quot;</font>
        }
      }
      meb {<b><font color=#3a6797>set</font></b> widget ttk::menubutton}
      meB {<b><font color=#3a6797>set</font></b> widget menubutton}
      nbk {
        <b><font color=#3a6797>set</font></b> widget ttk::notebook
        <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-notebazook <font color=#1b1baa>{$</font>attrs<font color=#1b1baa>}</font>&quot;</font>
      }
      opc {
        ;<i><font color=#4b5d50># tk_optionCascade - example of &quot;my method&quot; widget</font></i>
        ;<i><font color=#4b5d50># arguments: vname items mbopts precom args</font></i>
        <b><font color=#3a6797>set</font></b> widget {<b><font color=#ca14ca>my</font></b> tk_optionCascade}
        <b><font color=#3a6797>set</font></b> imax [<b><font color=#3a6797>expr</font></b> {min(4,[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$attrs</font>])}]
        <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$imax</font>} {<b><font color=#3a6797>incr</font></b> i} {
          <b><font color=#3a6797>set</font></b> atr [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$attrs</font> <font color=#1b1baa>$i</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font>!=1} {
            <b><font color=#3a6797>lset</font></b> attrs <font color=#1b1baa>$i</font> \{<font color=#1b1baa>$atr</font>\}
          } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$atr</font>]==1 && [<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$atr</font>]} {
            <b><font color=#3a6797>lset</font></b> attrs <font color=#1b1baa>$i</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$atr</font>]  ;<i><font color=#4b5d50># items stored in a variable</font></i>
          }
        }
      }
      pan {<b><font color=#3a6797>set</font></b> widget ttk::panedwindow
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#653760>-w</font> <font color=#1b1baa>$attrs</font>]&gt;-1 && [<b><font color=#3a6797>string</font></b> first <font color=#653760>-h</font> <font color=#1b1baa>$attrs</font>]&gt;-1} {
          <i><font color=#4b5d50># important for panes with fixed (customized) dimensions</font></i>
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-propagate <font color=#1b1baa>{$</font>options<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>attrs&quot;</font>
        }
      }
      pro {<b><font color=#3a6797>set</font></b> widget ttk::progressbar}
      rad {<b><font color=#3a6797>set</font></b> widget ttk::radiobutton}
      raD {<b><font color=#3a6797>set</font></b> widget radiobutton}
      sca {<b><font color=#3a6797>set</font></b> widget ttk::scale}
      scA {<b><font color=#3a6797>set</font></b> widget scale}
      sbh {<b><font color=#3a6797>set</font></b> widget ttk::scrollbar}
      sbH {<b><font color=#3a6797>set</font></b> widget scrollbar}
      sbv {<b><font color=#3a6797>set</font></b> widget ttk::scrollbar}
      sbV {<b><font color=#3a6797>set</font></b> widget scrollbar}
      scf {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>namespace</font></b> exists ::apave::sframe]} {
          <b><font color=#ca14ca>namespace</font></b> eval ::apave {
            <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::apaveDir</font> sframe.tcl]
          }
        }
        <i><font color=#4b5d50># scrolledFrame - example of &quot;my method&quot; widget</font></i>
        <b><font color=#3a6797>set</font></b> widget {<b><font color=#ca14ca>my</font></b> scrolledFrame}
      }
      seh {<b><font color=#3a6797>set</font></b> widget ttk::separator}
      sev {<b><font color=#3a6797>set</font></b> widget ttk::separator}
      siz {<b><font color=#3a6797>set</font></b> widget ttk::sizegrip}
      spx - spX {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nam3</font> eq {spx}} {<b><font color=#3a6797>set</font></b> widget ttk::spinbox} {<b><font color=#3a6797>set</font></b> widget spinbox}
        <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$attrs</font> \
          <font color=#653760>-command</font> {} <font color=#653760>-com</font> {} <font color=#653760>-from</font> {} <font color=#653760>-to</font> {}] cmd cmd2 from to
        <b><font color=#3a6797>append</font></b> cmd <font color=#1b1baa>$cmd2</font>
        <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attrs <font color=#653760>-tip</font> {} <font color=#653760>-tooltip</font> {}] t1 t2
        <b><font color=#3a6797>set</font></b> t2 <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>t1<font color=#1b1baa>$</font>t2&quot;</font>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$from</font> ne {} || <font color=#1b1baa>$to</font> ne {}} {
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$t2</font> ne {}} {<b><font color=#3a6797>set</font></b> t2 <font color=#8b2a0e>&quot;\n <font color=#1b1baa>$</font>t2&quot;</font>}
          <b><font color=#3a6797>set</font></b> t2 <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>from .. <font color=#1b1baa>$</font>to <font color=#1b1baa>$</font>t2&quot;</font>
        }
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$t2</font> ne {}} {<b><font color=#3a6797>set</font></b> t2 <font color=#8b2a0e>&quot;-tip <font color=#1b1baa>{$</font>t2<font color=#1b1baa>}</font>&quot;</font>}
        <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; -onReturn <font color=#1b1baa>{$</font>::apave::UFF<font color=#1b1baa>{$</font>cmd<font color=#1b1baa>}</font> <font color=#1b1baa>{$</font>from<font color=#1b1baa>}</font> <font color=#1b1baa>{$</font>to<font color=#1b1baa>}$</font>::apave::UFF<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>t2&quot;</font>
      }
      tbl { ;<i><font color=#4b5d50># tablelist</font></i>
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>namespace</font></b> exists ::tablelist::]} {
          <b><font color=#ca14ca>namespace</font></b> eval :: {<b><font color=#3a6797>package</font></b> require tablelist}
        }
        <b><font color=#3a6797>set</font></b> widget ::tablelist::tablelist
        <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>my FCfieldAttrs <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>$</font>attrs -lvar<font color=#1b1baa>]</font>&quot;</font>
        <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>my ListboxesAttrs <font color=#1b1baa>$</font>wnamefull <font color=#1b1baa>$</font>attrs<font color=#1b1baa>]</font>&quot;</font>
      }
      tex {<b><font color=#3a6797>set</font></b> widget text
        <b><font color=#3a6797>if</font></b> {[::apave::getOption <font color=#653760>-textpop</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] eq {}} {
          <b><font color=#ca14ca>my</font></b> AddPopupAttr <font color=#1b1baa>$wnamefull</font> attrs <font color=#653760>-textpop</font> \
            [<b><font color=#3a6797>expr</font></b> {[::apave::getOption <font color=#653760>-rotext</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] ne {}}] -- disabled
        }
        <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-ro</font> {} <font color=#653760>-readonly</font> {} <font color=#653760>-rotext</font> {} \
          <font color=#653760>-gutter</font> {} <font color=#653760>-gutterwidth</font> 5 <font color=#653760>-guttershift</font> 6] r1 r2 r3 g1 g2 g3
        <b><font color=#3a6797>set</font></b> b1 [<b><font color=#3a6797>expr</font></b> [<b><font color=#3a6797>string</font></b> is boolean <font color=#653760>-strict</font> <font color=#1b1baa>$r1</font>]]
        <b><font color=#3a6797>set</font></b> b2 [<b><font color=#3a6797>expr</font></b> [<b><font color=#3a6797>string</font></b> is boolean <font color=#653760>-strict</font> <font color=#1b1baa>$r2</font>]]
        <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$b1</font> && <font color=#1b1baa>$r1</font>) || (<font color=#1b1baa>$b2</font> && <font color=#1b1baa>$r2</font>) || \
        (<font color=#1b1baa>$r3</font> ne {} && !(<font color=#1b1baa>$b1</font> && !<font color=#1b1baa>$r1</font>) && !(<font color=#1b1baa>$b2</font> && !<font color=#1b1baa>$r2</font>))} {
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;-takefocus 0 <font color=#1b1baa>$</font>attrs&quot;</font>
        }
        <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-gutter</font> <font color=#653760>-gutterwidth</font> <font color=#653760>-guttershift</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$g1</font> ne {}} {
          <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs -gutter <font color=#1b1baa>{</font>-canvas <font color=#1b1baa>$</font>g1 -width <font color=#1b1baa>$</font>g2 -shift <font color=#1b1baa>$</font>g3<font color=#1b1baa>}</font>&quot;</font>
        }
      }
      tre {
        <b><font color=#3a6797>set</font></b> widget ttk::treeview
        <b><font color=#3a6797>foreach</font></b> {ev com} {Home {::apave::TreSelect %w 0} End {::apave::TreSelect %w end}} {
          <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; -bindEC <font color=#1b1baa>{</font>&lt;<font color=#1b1baa>$</font>ev&gt; <font color=#1b1baa>{$</font>com<font color=#1b1baa>}}</font> &quot;</font>
        }
      }
      h_* {<b><font color=#3a6797>set</font></b> widget ttk::frame}
      v_* {<b><font color=#3a6797>set</font></b> widget ttk::frame}
      <b><font color=#3a6797>default</font></b> {<b><font color=#3a6797>set</font></b> widget <font color=#1b1baa>$newtype</font>}
    }
    <b><font color=#3a6797>set</font></b> attrs [<b><font color=#ca14ca>my</font></b> GetMC <font color=#1b1baa>$attrs</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nam3</font> in {cbx ent enT fco spx spX}} {
      <i><font color=#4b5d50># entry-like widgets need their popup menu</font></i>
      <b><font color=#3a6797>set</font></b> clearcom [<b><font color=#3a6797>lindex</font></b> [::apave::parseOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-clearcom</font> -] 0]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clearcom</font> eq {-}} {
        <b><font color=#ca14ca>my</font></b> AddPopupAttr <font color=#1b1baa>$wnamefull</font> attrs <font color=#653760>-entrypop</font> 0 readonly disabled
      }
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first pack [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$pack</font>]]==0} {
      <b><font color=#3a6797>catch</font></b> {
        <i><font color=#4b5d50># try to expand -after option (if set as WidgetName instead widgetName)</font></i>
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$pack</font> {<font color=#653760>-after</font>}]]&gt;=0} {
          <b><font color=#3a6797>set</font></b> aft [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$pack</font> [<b><font color=#3a6797>incr</font></b> i]]
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>regexp</font></b> {^[A-Z]} <font color=#1b1baa>$aft</font>]} {
            <b><font color=#3a6797>set</font></b> aft [<b><font color=#ca14ca>my</font></b> <font color=#1b1baa>$aft</font>]
            <b><font color=#3a6797>set</font></b> pack [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$pack</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$aft</font>]
          }
        }
      }
      <b><font color=#3a6797>set</font></b> options <font color=#1b1baa>$pack</font>
    }
    <b><font color=#3a6797>set</font></b> options [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$options</font>]
    <b><font color=#3a6797>set</font></b> attrs   [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]
    <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$widget</font> <font color=#1b1baa>$options</font> <font color=#1b1baa>$attrs</font> <font color=#1b1baa>$nam3</font> <font color=#1b1baa>$disabled</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=defaultATTRS></a>
  <b><font color=#ca14ca>method</font></b> defaultATTRS {{type <font color=#8b2a0e>&quot;&quot;</font>} {opts <font color=#8b2a0e>&quot;&quot;</font>} {atrs <font color=#8b2a0e>&quot;&quot;</font>} {widget <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets, gets or registers default options and attributes for widget type.</font></i>
    <i><font color=#4b5d50>#   type - widget type</font></i>
    <i><font color=#4b5d50>#   opts - new default grid/pack options</font></i>
    <i><font color=#4b5d50>#   atrs - new default attributes</font></i>
    <i><font color=#4b5d50>#   widget - Tcl/Tk command for the new registered widget type</font></i>
    <i><font color=#4b5d50># The *type* should be a three letter unique string.</font></i>
    <i><font color=#4b5d50># If the *type* is absent in the registered types and *opts* and/or *atrs*</font></i>
    <i><font color=#4b5d50># is not set to &quot;&quot;, defaultATTRS registers the new *type* with its grid/pack</font></i>
    <i><font color=#4b5d50># options and attributes. At that *widget* is a command for the new widget</font></i>
    <i><font color=#4b5d50># type. For example, to register &quot;toolbutton&quot; widget:</font></i>
    <i><font color=#4b5d50>#   my defaultATTRS tbt {} {-style Toolbutton -compound top} ttk::button</font></i>
    <i><font color=#4b5d50># Options and attributes may contain data (variables and commands)</font></i>
    <i><font color=#4b5d50># to be processed by [subst].</font></i>
    <i><font color=#4b5d50># Returns:</font></i>
    <i><font color=#4b5d50>#   - if not set *type*: a full list of options and attributes of all types</font></i>
    <i><font color=#4b5d50>#   - if set *type* only: a list of options, attributes and *widget*</font></i>
    <i><font color=#4b5d50>#   - else: a list of updated options, attributes and *widget*</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$type</font> eq {}} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$::apave::_Defaults</font>}
    <b><font color=#3a6797>set</font></b> optatr <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>opts<font color=#1b1baa>$</font>atrs&quot;</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> def1 [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$::apave::_Defaults</font> <font color=#1b1baa>$type</font>]}]} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$optatr</font> eq {}} {
        <b><font color=#3a6797>set</font></b> err <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self method<font color=#1b1baa>]</font>: \&quot;<font color=#1b1baa>$</font>type\&quot; widget type not registered.&quot;</font>
        <b><font color=#3a6797>puts</font></b> <font color=#653760>-nonewline</font> stderr <font color=#1b1baa>$err</font>
        <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> error <font color=#1b1baa>$err</font>
      }
      <b><font color=#3a6797>set</font></b> def1 [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$opts</font> <font color=#1b1baa>$atrs</font> <font color=#1b1baa>$widget</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$optatr</font> eq {}} {<b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$def1</font>]}
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$def1</font> defopts defatrs widget
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> defopts [<b><font color=#3a6797>dict</font></b> replace <font color=#1b1baa>$defopts</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opts</font>]}]} {
      <b><font color=#3a6797>set</font></b> defopts [<b><font color=#3a6797>string</font></b> trim <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>defopts <font color=#1b1baa>$</font>opts&quot;</font>]
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> defatrs [<b><font color=#3a6797>dict</font></b> replace <font color=#1b1baa>$defatrs</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$atrs</font>]}]} {
      <b><font color=#3a6797>set</font></b> defatrs [<b><font color=#3a6797>string</font></b> trim <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>defatrs <font color=#1b1baa>$</font>atrs&quot;</font>]
    }
    <b><font color=#3a6797>set</font></b> newval [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$defopts</font> <font color=#1b1baa>$defatrs</font> <font color=#1b1baa>$widget</font>]
    <b><font color=#3a6797>dict</font></b> set ::apave::_Defaults <font color=#1b1baa>$type</font> <font color=#1b1baa>$newval</font>
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$newval</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=MC></a>
  <b><font color=#ca14ca>method</font></b> MC {msg} {
    <i><font color=#4b5d50># Gets localized message</font></i>
    <i><font color=#4b5d50>#   msg - the message</font></i>

    <i><font color=#4b5d50># to use a preset namespace name, we need a fully qualified variable</font></i>
    <b><font color=#3a6797>set</font></b> ::apave::_MC_TEXT_ [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$msg</font> \{\}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::apave::MC_NS</font> ne {}} {
      <b><font color=#ca14ca>namespace</font></b> eval <font color=#1b1baa>$::apave::MC_NS</font> {
        <b><font color=#3a6797>set</font></b> ::apave::_MC_TEXT_ [msgcat::mc <font color=#1b1baa>$::apave::_MC_TEXT_</font>]
      }
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> ::apave::_MC_TEXT_ [msgcat::mc <font color=#1b1baa>$::apave::_MC_TEXT_</font>]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$::apave::_MC_TEXT_</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=GetMC></a>
  <b><font color=#ca14ca>method</font></b> GetMC {attrs} {
    <i><font color=#4b5d50># Gets localized -text attribute.</font></i>
    <i><font color=#4b5d50>#   attrs - list of attributes</font></i>

    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attrs <font color=#653760>-t</font> {} <font color=#653760>-text</font> {}] t text
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$t</font> ne {} || <font color=#1b1baa>$text</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$text</font> eq {}} {<b><font color=#3a6797>set</font></b> text <font color=#1b1baa>$t</font>}
      <b><font color=#3a6797>set</font></b> attrs [<b><font color=#3a6797>dict</font></b> set attrs <font color=#653760>-t</font> [<b><font color=#ca14ca>my</font></b> MC <font color=#1b1baa>$text</font>]]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$attrs</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=SpanConfig></a>
  <b><font color=#ca14ca>method</font></b> SpanConfig {w rcnam rc rcspan opt val} {
    <i><font color=#4b5d50># The method is used by *GetIntOptions* method to configure</font></i>
    <i><font color=#4b5d50># row/column for their *span* options.</font></i>

    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i <font color=#1b1baa>$rc</font>} {<font color=#1b1baa>$i</font> &lt; (<font color=#1b1baa>$rc</font> + <font color=#1b1baa>$rcspan</font>)} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>eval</font></b> [<b><font color=#134070>grid</font></b> <font color=#1b1baa>${rcnam}</font>configure <font color=#1b1baa>$w</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$opt</font> <font color=#1b1baa>$val</font>]
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=GetIntOptions></a>
  <b><font color=#ca14ca>method</font></b> GetIntOptions {w options row rowspan col colspan} {
    <i><font color=#4b5d50># Gets specific integer options. Then expands other options.</font></i>
    <i><font color=#4b5d50>#   w - widget's name</font></i>
    <i><font color=#4b5d50>#   options - grid options</font></i>
    <i><font color=#4b5d50>#   row, rowspan - row and its span of thw widget</font></i>
    <i><font color=#4b5d50>#   col, colspan - column and its span of thw widget</font></i>
    <i><font color=#4b5d50># The options are set in grid options as &quot;-rw &lt;int&gt;&quot;, &quot;-cw &lt;int&gt;&quot; etc.</font></i>
    <i><font color=#4b5d50># Returns the resulting grid options.</font></i>

    <b><font color=#3a6797>set</font></b> opts {}
    <b><font color=#3a6797>foreach</font></b> {opt val} [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$options</font>] {
      <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$opt</font> {
        <font color=#653760>-rw</font>  {<b><font color=#ca14ca>my</font></b> SpanConfig <font color=#1b1baa>$w</font> row <font color=#1b1baa>$row</font> <font color=#1b1baa>$rowspan</font> <font color=#653760>-weight</font> <font color=#1b1baa>$val</font>}
        <font color=#653760>-cw</font>  {<b><font color=#ca14ca>my</font></b> SpanConfig <font color=#1b1baa>$w</font> column <font color=#1b1baa>$col</font> <font color=#1b1baa>$colspan</font> <font color=#653760>-weight</font> <font color=#1b1baa>$val</font>}
        <font color=#653760>-rsz</font> {<b><font color=#ca14ca>my</font></b> SpanConfig <font color=#1b1baa>$w</font> row <font color=#1b1baa>$row</font> <font color=#1b1baa>$rowspan</font> <font color=#653760>-minsize</font> <font color=#1b1baa>$val</font>}
        <font color=#653760>-csz</font> {<b><font color=#ca14ca>my</font></b> SpanConfig <font color=#1b1baa>$w</font> column <font color=#1b1baa>$col</font> <font color=#1b1baa>$colspan</font> <font color=#653760>-minsize</font> <font color=#1b1baa>$val</font>}
        <font color=#653760>-ro</font>  {<b><font color=#ca14ca>my</font></b> SpanConfig <font color=#1b1baa>$w</font> column <font color=#1b1baa>$col</font> <font color=#1b1baa>$colspan</font> <font color=#653760>-readonly</font> <font color=#1b1baa>$val</font>}
        <b><font color=#3a6797>default</font></b> {<b><font color=#3a6797>append</font></b> opts <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>opt <font color=#1b1baa>$</font>val&quot;</font>}
      }
    }
    <i><font color=#4b5d50># Get other grid options</font></i>
    <b><font color=#ca14ca>return</font></b> [<b><font color=#ca14ca>my</font></b> ExpandOptions <font color=#1b1baa>$opts</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=GetAttrs></a>
  <b><font color=#ca14ca>method</font></b> GetAttrs {<b><font color=#134070>options</font></b> {nam3 <font color=#8b2a0e>&quot;&quot;</font>} {disabled 0} } {
    <i><font color=#4b5d50># Expands attributes' values.</font></i>
    <i><font color=#4b5d50>#   options - list of attributes and values</font></i>
    <i><font color=#4b5d50>#   nam3 - first three letters (type) of widget's name</font></i>
    <i><font color=#4b5d50>#   disabled - flag of &quot;disabled&quot; state</font></i>
    <i><font color=#4b5d50># Returns expanded attributes.</font></i>

    <b><font color=#3a6797>set</font></b> opts [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>foreach</font></b> {opt val} [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$options</font>] {
      <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$opt</font> {
        <font color=#653760>-t</font> - <font color=#653760>-text</font> {
          ;<i><font color=#4b5d50># these options need translating \\n to \n</font></i>
          <i><font color=#4b5d50># catch {set val [subst -nocommands -novariables $val]}</font></i>
          <b><font color=#3a6797>set</font></b> val [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \\n \n \\t \t] <font color=#1b1baa>$val</font>]
          <b><font color=#3a6797>set</font></b> opt <font color=#653760>-text</font>
        }
        <font color=#653760>-st</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-sticky</font>}
        <font color=#653760>-com</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-command</font>}
        <font color=#653760>-w</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-width</font>}
        <font color=#653760>-h</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-height</font>}
        <font color=#653760>-var</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-variable</font>}
        <font color=#653760>-tvar</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-textvariable</font>}
        <font color=#653760>-lvar</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-listvariable</font>}
        <font color=#653760>-ro</font> {<b><font color=#3a6797>set</font></b> opt <font color=#653760>-readonly</font>}
      }
      <b><font color=#3a6797>lappend</font></b> opts <font color=#1b1baa>$opt</font> \{<font color=#1b1baa>$val</font>\}
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$disabled</font>} {
      <b><font color=#3a6797>append</font></b> opts [<b><font color=#ca14ca>my</font></b> NonTtkStyle <font color=#1b1baa>$nam3</font> 1]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$opts</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=menuTips></a>
  <b><font color=#ca14ca>method</font></b> menuTips {win tip {wpar {}}} {
    <i><font color=#4b5d50># Makes tip(s) for menu and its items.</font></i>
    <i><font color=#4b5d50>#   win - menu's path</font></i>
    <i><font color=#4b5d50>#   tip - tip's text</font></i>
    <i><font color=#4b5d50>#   wpar - path to menu's parent (for opc widget)</font></i>
    <i><font color=#4b5d50># The tips for menu items are set by &quot;-indexedtips ?idx tip...?&quot;</font></i>
    <i><font color=#4b5d50># e.g., a tip can be &quot;parent tip -indexedtips 0 1stItem 9 {10th Item}&quot;</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tip</font> ne {}} {
      <b><font color=#3a6797>set</font></b> tip [<b><font color=#ca14ca>my</font></b> MC <font color=#1b1baa>$tip</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> first {<font color=#653760>-indexedtips</font> } <font color=#1b1baa>$tip</font>]]&gt;-1} {
        <b><font color=#3a6797>set</font></b> indexedtips [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tip</font> [<b><font color=#3a6797>string</font></b> first { } <font color=#1b1baa>$tip</font> <font color=#1b1baa>$i</font>]+1 end]
        <b><font color=#3a6797>set</font></b> tip [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tip</font> 0 <font color=#1b1baa>$i</font>-1]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> indexedtips {}
      }
      <i><font color=#4b5d50># \indexedtips to present -indexedtips in parent tip</font></i>
      <b><font color=#3a6797>set</font></b> tip [<b><font color=#3a6797>string</font></b> map <font color=#8b2a0e>&quot;\\indexedtips -indexedtips&quot;</font> <font color=#1b1baa>$tip</font>]
      <b><font color=#3a6797>catch</font></b> {
        <i><font color=#4b5d50># tips for indexed items of menu</font></i>
        <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$indexedtips</font> ne {}} {
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$indexedtips</font> idx itip
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$idx</font> eq {}} <b><font color=#ca14ca>break</font></b>
          <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> ::baltip tip <font color=#1b1baa>$win</font> <font color=#1b1baa>$itip</font> <font color=#653760>-index</font> <font color=#1b1baa>$idx</font> <font color=#653760>-ontop</font> 1]
          <b><font color=#3a6797>set</font></b> indexedtips [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$indexedtips</font> 2 end]
        }
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tip</font> ne {} && <font color=#1b1baa>$wpar</font> ne {}} {
        <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> ::baltip tip <font color=#1b1baa>$wpar</font> <font color=#1b1baa>$tip</font>]  ;<i><font color=#4b5d50># tip for the parent widget</font></i>
      }
    }
  }
<a id=Option_cascade></a>
  <i><font color=#4b5d50>## ________________________ Option cascade _________________________ ##</font></i>
<a id=optionCascadeText></a>
  <b><font color=#ca14ca>method</font></b> optionCascadeText {it} {
    <i><font color=#4b5d50># Rids a tk_optionCascade item of braces.</font></i>
    <i><font color=#4b5d50>#   it - an item to be trimmed</font></i>
    <i><font color=#4b5d50># Reason: tk_optionCascade items shimmer between 'list' and 'string'</font></i>
    <i><font color=#4b5d50># so a multiline item is displayed with braces, if not got rid of them.</font></i>
    <i><font color=#4b5d50># Returns the item trimmed.</font></i>
    <i><font color=#4b5d50># See also: tk_optionCascade</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#8b2a0e>&quot;\{*\}&quot;</font> <font color=#1b1baa>$it</font>]} {
      <b><font color=#3a6797>set</font></b> it [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$it</font> 1 end-1]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$it</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=tk_optionCascade></a>
  <b><font color=#ca14ca>method</font></b> tk_optionCascade {w vname items {mbopts <font color=#8b2a0e>&quot;&quot;</font>} {precom <font color=#8b2a0e>&quot;&quot;</font>} args} {
    <i><font color=#4b5d50># A bit modified tk_optionCascade widget made by Richard Suchenwirth.</font></i>
    <i><font color=#4b5d50>#   w      - widget name</font></i>
    <i><font color=#4b5d50>#   vname  - variable name for current selection</font></i>
    <i><font color=#4b5d50>#   items  - list of items</font></i>
    <i><font color=#4b5d50>#   mbopts - ttk::menubutton options (e.g. &quot;-width -4&quot;)</font></i>
    <i><font color=#4b5d50>#   precom - command to get entry's options (%a presents its label)</font></i>
    <i><font color=#4b5d50>#   args   - additional options of entries</font></i>
    <i><font color=#4b5d50># Returns a path to the widget.</font></i>
    <i><font color=#4b5d50># See also:</font></i>
    <i><font color=#4b5d50>#   optionCascadeText</font></i>
    <i><font color=#4b5d50>#   [wiki.tcl-lang.org](https://wiki.tcl-lang.org/page/tk_optionCascade)</font></i>

    <b><font color=#3a6797>set</font></b> win <font color=#1b1baa>$w</font>.m
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists <font color=#1b1baa>$vname</font>]} {
      <b><font color=#3a6797>set</font></b> it [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$items</font> 0]
      <b><font color=#3a6797>while</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$it</font>]&gt;1} {<b><font color=#3a6797>set</font></b> it [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$it</font> 0]}
      <b><font color=#3a6797>set</font></b> it [<b><font color=#ca14ca>my</font></b> optionCascadeText <font color=#1b1baa>$it</font>]
      <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vname</font> <font color=#1b1baa>$it</font>
    }
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions mbopts <font color=#653760>-tip</font> {} <font color=#653760>-tooltip</font> {} <font color=#653760>-com</font> {} <font color=#653760>-command</font> {}] \
      tip tip2 com com2
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tip</font> eq {}} {<b><font color=#3a6797>set</font></b> tip <font color=#1b1baa>$tip2</font>}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com</font> eq {}} {<b><font color=#3a6797>set</font></b> com <font color=#1b1baa>$com2</font>}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com</font> ne {}} {<b><font color=#3a6797>lappend</font></b> args <font color=#653760>-command</font> <font color=#1b1baa>$com</font>}
    <b><font color=#134070>ttk::menubutton</font></b> <font color=#1b1baa>$w</font> <font color=#653760>-menu</font> <font color=#1b1baa>$win</font> <font color=#653760>-text</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vname</font>] <font color=#653760>-style</font> TMenuButtonWest {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$mbopts</font>
    <b><font color=#134070>menu</font></b> <font color=#1b1baa>$win</font> <font color=#653760>-tearoff</font> 0
    <b><font color=#ca14ca>my</font></b> menuTips <font color=#1b1baa>$win</font> <font color=#1b1baa>$tip</font> <font color=#1b1baa>$w</font>
    <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> after 0 [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] optionCascade_add <font color=#1b1baa>$win</font> <font color=#1b1baa>$vname</font> <font color=#1b1baa>$items</font> <font color=#1b1baa>$precom</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]]
    <b><font color=#3a6797>trace</font></b> add variable <font color=#1b1baa>$vname</font> write \
      <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>w config -text \&quot;\[<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> optionCascadeText \$<font color=#1b1baa>{$</font>vname<font color=#1b1baa>}</font>\]\&quot; ;\#&quot;</font>
    <b><font color=#3a6797>lappend</font></b> ::apave::_AP_VARS(_TRACED_<font color=#1b1baa>$w</font>) <font color=#1b1baa>$vname</font>
    ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;ButtonPress&gt; <b><font color=#134070>focus</font></b> <font color=#1b1baa>$w</font>
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$win</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=optionCascade_add></a>
  <b><font color=#ca14ca>method</font></b> optionCascade_add {w vname argl precom args} {
    <i><font color=#4b5d50># Adds tk_optionCascade items recursively.</font></i>
    <i><font color=#4b5d50>#   w      - tk_optionCascade widget's name</font></i>
    <i><font color=#4b5d50>#   vname  - variable name for current selection</font></i>
    <i><font color=#4b5d50>#   arg1   - list of items to be added</font></i>
    <i><font color=#4b5d50>#   precom - command to get entry's options (%a presents its label)</font></i>
    <i><font color=#4b5d50>#   args   - additional options of entries</font></i>

    <b><font color=#3a6797>set</font></b> n [<b><font color=#3a6797>set</font></b> colbreak 0]
    <b><font color=#3a6797>foreach</font></b> arg <font color=#1b1baa>$argl</font> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$arg</font> eq {--}} {
        <font color=#1b1baa>$w</font> add separator
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$arg</font> eq {|}} {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>tk</font></b> windowingsystem] ne {aqua}} { <b><font color=#3a6797>set</font></b> colbreak 1 }
        <b><font color=#ca14ca>continue</font></b>
      } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$arg</font>] == 1} {
        <b><font color=#3a6797>set</font></b> label [<b><font color=#ca14ca>my</font></b> optionCascadeText [<b><font color=#3a6797>join</font></b> <font color=#1b1baa>$arg</font>]]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$precom</font> eq {}} {
          <b><font color=#3a6797>set</font></b> adds {}
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> adds [<b><font color=#3a6797>eval</font></b> {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> \$ \\\$ \[ \\\[] \
            [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %a <font color=#1b1baa>$label</font>] <font color=#1b1baa>$precom</font>]]]
        }
        <font color=#1b1baa>$w</font> add radiobutton <font color=#653760>-label</font> <font color=#1b1baa>$label</font> <font color=#653760>-variable</font> <font color=#1b1baa>$vname</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$adds</font>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> child [<b><font color=#134070>menu</font></b> <font color=#1b1baa>$w</font>.[<b><font color=#3a6797>incr</font></b> n] <font color=#653760>-tearoff</font> 0]
        <font color=#1b1baa>$w</font> add cascade <font color=#653760>-label</font> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$arg</font> 0] <font color=#653760>-menu</font> <font color=#1b1baa>$child</font>
        <b><font color=#ca14ca>my</font></b> optionCascade_add <font color=#1b1baa>$child</font> <font color=#1b1baa>$vname</font> [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$arg</font> 1 end] <font color=#1b1baa>$precom</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
      }
      <b><font color=#3a6797>if</font></b> <font color=#1b1baa>$colbreak</font> {
        <font color=#1b1baa>$w</font> entryconfigure end <font color=#653760>-columnbreak</font> 1
        <b><font color=#3a6797>set</font></b> colbreak 0
      }
    }
    <b><font color=#ca14ca>return</font></b>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=ParentOpt></a>
  <b><font color=#ca14ca>method</font></b> ParentOpt {{w <font color=#8b2a0e>&quot;.&quot;</font>}} {
    <i><font color=#4b5d50># Gets *-parent* option for choosers.</font></i>
    <i><font color=#4b5d50>#   w - parent window's name (path)</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$Modalwin</font> ne {.}} {<b><font color=#3a6797>set</font></b> w <font color=#1b1baa>$Modalwin</font>}
    <b><font color=#ca14ca>return</font></b> <font color=#8b2a0e>&quot;-parent <font color=#1b1baa>$</font>w&quot;</font>
  }
<a id=Mega-widgets></a>
  <i><font color=#4b5d50>## ________________________ Mega-widgets _________________________ ##</font></i>
<a id=fillGutter></a>
  <b><font color=#ca14ca>method</font></b> fillGutter {txt {<b><font color=#134070>canvas</font></b> <font color=#8b2a0e>&quot;&quot;</font>} {width <font color=#8b2a0e>&quot;&quot;</font>} {shift <font color=#8b2a0e>&quot;&quot;</font>} args} {
    <i><font color=#4b5d50># Fills a gutter of text with the text's line numbers.</font></i>
    <i><font color=#4b5d50>#  txt - path to the text widget</font></i>
    <i><font color=#4b5d50>#  canvas - canvas of the gutter</font></i>
    <i><font color=#4b5d50>#  width - width of the gutter, in chars</font></i>
    <i><font color=#4b5d50>#  shift - addition to the width (to shift from the left side)</font></i>
    <i><font color=#4b5d50>#  args - additional arguments for tracing</font></i>
    <i><font color=#4b5d50># The code is borrowed from open source tedit project.</font></i>

    <b><font color=#3a6797>set</font></b> savedcont [<b><font color=#3a6797>namespace</font></b> current]::gc<font color=#1b1baa>$txt</font>
    <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$txt</font>] || ![<b><font color=#134070>winfo</font></b> ismapped <font color=#1b1baa>$txt</font>]} {
      <b><font color=#3a6797>unset</font></b> <font color=#653760>-nocomplain</font> <font color=#1b1baa>$savedcont</font>
      <b><font color=#ca14ca>return</font></b>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$canvas</font> eq {}} {
      <b><font color=#134070>event</font></b> generate <font color=#1b1baa>$txt</font> &lt;Configure&gt; ;<i><font color=#4b5d50># repaints the gutter</font></i>
      <b><font color=#ca14ca>return</font></b>
    }
    <b><font color=#3a6797>set</font></b> oper [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0 1]
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$args</font>] || [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0 4] eq {<font color=#653760>-elide</font>} || \
    <font color=#1b1baa>$oper</font> in {configure delete insert see yview}} {
      <b><font color=#3a6797>set</font></b> i [<font color=#1b1baa>$txt</font> index @0,0]
      <b><font color=#3a6797>set</font></b> gcont [<b><font color=#3a6797>list</font></b>]
      <b><font color=#3a6797>while</font></b> true {
        <b><font color=#3a6797>set</font></b> dline [<font color=#1b1baa>$txt</font> dlineinfo <font color=#1b1baa>$i</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$dline</font>] == 0} <b><font color=#ca14ca>break</font></b>
        <b><font color=#3a6797>set</font></b> height [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$dline</font> 3]
        <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$dline</font> 1]}]
        <b><font color=#3a6797>set</font></b> linenum [<b><font color=#3a6797>format</font></b> <font color=#8b2a0e>&quot;%<font color=#1b1baa>${</font>width<font color=#1b1baa>}</font>d&quot;</font> [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$i</font> .] 0]]
        <b><font color=#3a6797>set</font></b> i [<font color=#1b1baa>$txt</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>i +1 lines linestart&quot;</font>]
        <b><font color=#3a6797>lappend</font></b> gcont [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$y</font> <font color=#1b1baa>$linenum</font>]
      }
      <i><font color=#4b5d50># update the gutter at changing its contents/config</font></i>
      <b><font color=#3a6797>if</font></b> {[::apave::cs_Active]} {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] - - - bg - - - - fg
        ::apave::setProperty _GUTTER_FGBG [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font>]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>lassign</font></b> [::apave::getProperty _GUTTER_FGBG] fg bg
      }
      <b><font color=#3a6797>set</font></b> cwidth [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$shift</font> + \
        [<b><font color=#134070>font</font></b> measure apaveFontMono <font color=#653760>-displayof</font> <font color=#1b1baa>$txt</font> [<b><font color=#3a6797>string</font></b> repeat 0 <font color=#1b1baa>$width</font>]]}]
      <b><font color=#3a6797>set</font></b> newbg [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$bg</font> ne [<font color=#1b1baa>$canvas</font> cget <font color=#653760>-background</font>]}]
      <b><font color=#3a6797>set</font></b> newwidth [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$cwidth</font> ne [<font color=#1b1baa>$canvas</font> cget <font color=#653760>-width</font>]}]
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$args</font>] || <font color=#1b1baa>$newbg</font> || <font color=#1b1baa>$newwidth</font> || ![<b><font color=#3a6797>info</font></b> exists <font color=#1b1baa>$savedcont</font>] || \
      <font color=#1b1baa>$gcont</font> ne [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$savedcont</font>]} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$newbg</font>} {<font color=#1b1baa>$canvas</font> config <font color=#653760>-background</font> <font color=#1b1baa>$bg</font>}
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$newwidth</font>} {<font color=#1b1baa>$canvas</font> config <font color=#653760>-width</font> <font color=#1b1baa>$cwidth</font>}
        <font color=#1b1baa>$canvas</font> delete all
        <b><font color=#3a6797>foreach</font></b> g <font color=#1b1baa>$gcont</font> {
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$g</font> y linenum
          <font color=#1b1baa>$canvas</font> create text 2 <font color=#1b1baa>$y</font> <font color=#653760>-anchor</font> nw <font color=#653760>-text</font> <font color=#1b1baa>$linenum</font> <font color=#653760>-font</font> apaveFontMono <font color=#653760>-fill</font> <font color=#1b1baa>$fg</font>
        }
        <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$savedcont</font> <font color=#1b1baa>$gcont</font>
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=gutterContents></a>
  <b><font color=#ca14ca>method</font></b> gutterContents {txt} {
    <i><font color=#4b5d50># Gets contents of a text's gutter</font></i>
    <i><font color=#4b5d50>#   txt - text's path</font></i>

    <b><font color=#3a6797>set</font></b> savedcont [<b><font color=#3a6797>namespace</font></b> current]::gc<font color=#1b1baa>$txt</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists <font color=#1b1baa>$savedcont</font>]} {
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$savedcont</font>]
    }
    <b><font color=#ca14ca>return</font></b> {}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=AuxSetChooserGeometry></a>
  <b><font color=#ca14ca>method</font></b> AuxSetChooserGeometry {vargeo vargeo2 parent widname} {
    <i><font color=#4b5d50># Auxiliary method to set some Tk choosers' geometry.</font></i>
    <i><font color=#4b5d50>#   vargeo - variable for geometry value</font></i>
    <i><font color=#4b5d50>#   vargeo2 - variable for geometry value with second type of dialogue</font></i>
    <i><font color=#4b5d50>#   parent - list containing a parent's path</font></i>
    <i><font color=#4b5d50>#   widname - name of the chooser</font></i>
    <i><font color=#4b5d50># If there is no saved geometry with *vargeo*, tries to get it with *vargeo2*.</font></i>
    <i><font color=#4b5d50># Returns a path to the chooser to be open.</font></i>

    <b><font color=#3a6797>set</font></b> wp [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$parent</font> 1]
    <b><font color=#3a6797>set</font></b> wchooser <font color=#1b1baa>$wp</font>.<font color=#1b1baa>$widname</font>
    <b><font color=#3a6797>set</font></b> geom {}
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vargeo</font>] -&gt; geom}] || <font color=#1b1baa>$geom</font> eq {}} {
      <i><font color=#4b5d50># no saved geometry with *vargeo*, so get it with *vargeo2*</font></i>
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vargeo2</font>] -&gt; geom}
    }
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match *x*+*+* <font color=#1b1baa>$geom</font>]} {
      <i><font color=#4b5d50># chooser's default geometry centered in parent</font></i>
      <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wp</font>]} {<b><font color=#3a6797>set</font></b> wp .}
      <b><font color=#3a6797>set</font></b> geom [<b><font color=#3a6797>set</font></b> W 640]x[<b><font color=#3a6797>set</font></b> H 470]
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>append</font></b> geom [<b><font color=#ca14ca>my</font></b> CenteredXY {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>split</font></b> [<b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$wp</font>] x+] <font color=#1b1baa>$W</font> <font color=#1b1baa>$H</font>]}
    }
    <b><font color=#3a6797>if</font></b> {[::isunix]} {
      <i><font color=#4b5d50># the below equilibristics provides the smooth display</font></i>
      <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;catch <font color=#1b1baa>{</font>wm withdraw <font color=#1b1baa>$</font>wchooser; wm geometry <font color=#1b1baa>$</font>wchooser 1x1<font color=#1b1baa>}</font>&quot;</font>
      <b><font color=#3a6797>after</font></b> 0 [<b><font color=#3a6797>list</font></b> after idle \
        <font color=#8b2a0e>&quot;catch <font color=#1b1baa>{</font>wm withdraw <font color=#1b1baa>$</font>wchooser; wm geometry <font color=#1b1baa>$</font>wchooser <font color=#1b1baa>$</font>geom; wm deiconify <font color=#1b1baa>$</font>wchooser; wm geometry <font color=#1b1baa>$</font>wchooser <font color=#1b1baa>$</font>geom<font color=#1b1baa>}</font>&quot;</font>]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$wchooser</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=validateColorChoice></a>
  <b><font color=#ca14ca>method</font></b> validateColorChoice {lab {ent <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Displays a current color of color chooser's entry.</font></i>
    <i><font color=#4b5d50>#   lab - color chooser's label (or apave name's clr1 / Clr1)</font></i>
    <i><font color=#4b5d50>#   ent - color chooser's entry</font></i>
    <i><font color=#4b5d50># Can be called as &quot;validateColorChoice clr1 / Clr1&quot;.</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-nocase</font> clr* <font color=#1b1baa>$lab</font>]} {
      <b><font color=#3a6797>set</font></b> lab [<b><font color=#3a6797>string</font></b> tolower [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$lab</font> 0]][<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$lab</font> 1 end]
      <b><font color=#3a6797>set</font></b> ent Ent<font color=#1b1baa>$lab</font>
      <b><font color=#3a6797>set</font></b> lab Lab<font color=#1b1baa>$lab</font>
    }
    <b><font color=#3a6797>set</font></b> ent [<b><font color=#ca14ca>my</font></b> [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$ent</font>]]
    <b><font color=#3a6797>set</font></b> lab [<b><font color=#ca14ca>my</font></b> [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$lab</font>]]
    <b><font color=#3a6797>set</font></b> val [<font color=#1b1baa>$ent</font> get]
    <b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$lab</font> configure <font color=#653760>-background</font> <font color=#1b1baa>$val</font>}
    <b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$ent</font> selection clear}
    <b><font color=#ca14ca>return</font></b> yes
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=scrolledFrame></a>
  <b><font color=#ca14ca>method</font></b> scrolledFrame {w args} {
    <i><font color=#4b5d50># Retrieves the path where the scrollable contents of frame go.</font></i>
    <i><font color=#4b5d50>#   w - frame's path</font></i>

    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-toplevel</font> no <font color=#653760>-anchor</font> center <font color=#653760>-mode</font> both] tl anc mode
    ::apave::sframe new <font color=#1b1baa>$w</font> <font color=#653760>-toplevel</font> <font color=#1b1baa>$tl</font> <font color=#653760>-anchor</font> <font color=#1b1baa>$anc</font> <font color=#653760>-mode</font> <font color=#1b1baa>$mode</font>
    <b><font color=#3a6797>set</font></b> path [::apave::sframe content <font color=#1b1baa>$w</font>]
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$path</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=chooserGeomVars></a>
  <b><font color=#ca14ca>method</font></b> chooserGeomVars {{dirvar <font color=#8b2a0e>&quot;&quot;</font>} {filevar <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets/gets variables to save/restore geometry of Tcl/Tk dir/file choosers (in Linux).</font></i>
    <i><font color=#4b5d50>#   dirvar - variable's name for geometry of directory chooser</font></i>
    <i><font color=#4b5d50>#   filevar - variable's name for geometry of file chooser</font></i>
    <i><font color=#4b5d50># See also: chooser</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dirvar</font> eq {}} {
      <b><font color=#ca14ca>return</font></b> [::apave::getProperty DirFilGeoVars]
    }
    ::apave::setProperty DirFilGeoVars [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$dirvar</font> <font color=#1b1baa>$filevar</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=chooser></a>
  <b><font color=#ca14ca>method</font></b> chooser {nchooser tvar args} {
    <i><font color=#4b5d50># Chooser (for all available types).</font></i>
    <i><font color=#4b5d50>#   nchooser - name of chooser</font></i>
    <i><font color=#4b5d50>#   tvar - name of variable containing an input/output value</font></i>
    <i><font color=#4b5d50>#   args - options of the chooser</font></i>
    <i><font color=#4b5d50># The chooser names are:</font></i>
    <i><font color=#4b5d50>#   tk_getOpenFile - choose a file to open</font></i>
    <i><font color=#4b5d50>#   tk_getSaveFile - choose a file to save</font></i>
    <i><font color=#4b5d50>#   tk_chooseDirectory - choose a directory</font></i>
    <i><font color=#4b5d50>#   fontChooser - choose a font</font></i>
    <i><font color=#4b5d50>#   dateChooser - choose a date</font></i>
    <i><font color=#4b5d50>#   colorChooser - choose a color</font></i>
    <i><font color=#4b5d50>#   ftx_OpenFile - (internal) choose a file for ftx widget</font></i>
    <i><font color=#4b5d50># Returns a selected value.</font></i>

    <b><font color=#3a6797>set</font></b> isfilename [<b><font color=#3a6797>set</font></b> rootname 0]
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args \
      <font color=#653760>-ftxvar</font> {} <font color=#653760>-tname</font> {} <font color=#653760>-bname</font> {} <font color=#653760>-parent</font> {}] ftxvar tname bname parent
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$parent</font> ne {}} {
      <b><font color=#3a6797>set</font></b> parent <font color=#8b2a0e>&quot;-parent <font color=#1b1baa>$</font>parent&quot;</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> parent [<b><font color=#ca14ca>my</font></b> ParentOpt]
    }
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> chooserGeomVars] dirvar filvar
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dirvar</font> eq {}} {
      <b><font color=#3a6797>set</font></b> [<b><font color=#3a6797>set</font></b> dirvar ::apave::APaveDirVar] {}
      <b><font color=#3a6797>set</font></b> [<b><font color=#3a6797>set</font></b> filvar ::apave::APaveFilVar] {}
      <b><font color=#ca14ca>my</font></b> chooserGeomVars <font color=#1b1baa>$dirvar</font> <font color=#1b1baa>$filvar</font>
    }
    <b><font color=#3a6797>set</font></b> vargeo {}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nchooser</font> eq {ftx_OpenFile}} {
      <b><font color=#3a6797>set</font></b> nchooser tk_getOpenFile
    }
    <b><font color=#3a6797>set</font></b> widname {}
    <b><font color=#3a6797>set</font></b> choosname <font color=#1b1baa>$nchooser</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$choosname</font> in {fontChooser colorChooser dateChooser}} {
      <b><font color=#3a6797>set</font></b> nchooser <font color=#8b2a0e>&quot;my <font color=#1b1baa>$</font>choosname <font color=#1b1baa>$</font>tvar <font color=#1b1baa>$</font>parent <font color=#1b1baa>$</font>args&quot;</font>
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$choosname</font> in {<b><font color=#134070>tk_getOpenFile</font></b> tk_getSaveFile}} {
      <b><font color=#3a6797>set</font></b> vargeo <font color=#1b1baa>$filvar</font>
      <b><font color=#3a6797>set</font></b> widname [<b><font color=#ca14ca>my</font></b> AuxSetChooserGeometry <font color=#1b1baa>$vargeo</font> <font color=#1b1baa>$dirvar</font> <font color=#1b1baa>$parent</font> __tk_filedialog]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> fn [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>]] eq {}} {
        <b><font color=#3a6797>set</font></b> dn [<b><font color=#3a6797>pwd</font></b>]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> dn [<b><font color=#3a6797>file</font></b> dirname <font color=#1b1baa>$fn</font>]
        <b><font color=#3a6797>set</font></b> fn [<b><font color=#3a6797>file</font></b> tail <font color=#1b1baa>$fn</font>]
      }
      <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-initialdir</font> <font color=#1b1baa>$dn</font>] dn
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match -* <font color=#1b1baa>$dn</font>]} {
        <b><font color=#3a6797>set</font></b> rootname 1
        <b><font color=#3a6797>set</font></b> dn [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$dn</font> 1 end]
      }
      <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>list</font></b> <font color=#653760>-initialfile</font> <font color=#1b1baa>$fn</font> <font color=#653760>-initialdir</font> <font color=#1b1baa>$dn</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$parent</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
      <b><font color=#3a6797>incr</font></b> isfilename
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$nchooser</font> eq {<b><font color=#134070>tk_chooseDirectory</font></b>}} {
      <b><font color=#3a6797>set</font></b> vargeo <font color=#1b1baa>$dirvar</font>
      <b><font color=#3a6797>set</font></b> widname [<b><font color=#ca14ca>my</font></b> AuxSetChooserGeometry <font color=#1b1baa>$vargeo</font> <font color=#1b1baa>$filvar</font> <font color=#1b1baa>$parent</font> __tk_choosedir]
      <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>list</font></b> <font color=#653760>-initialdir</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>] {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$parent</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
      <b><font color=#3a6797>incr</font></b> isfilename
    }
    <b><font color=#3a6797>if</font></b> {[::isunix] && <font color=#1b1baa>$choosname</font> ne {dateChooser}} {
      <b><font color=#ca14ca>my</font></b> themeExternal *.foc.* *f1.demo  ;<i><font color=#4b5d50># don't touch tkcc's boxes</font></i>
    }
    <b><font color=#3a6797>set</font></b> res [{<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$nchooser</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>res&quot;</font> ne {} && <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>tvar&quot;</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rootname</font>} {<b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>file</font></b> rootname [<b><font color=#3a6797>file</font></b> tail <font color=#1b1baa>$res</font>]]}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$isfilename</font>} {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> SplitContentVariable <font color=#1b1baa>$ftxvar</font>] -&gt; txtnam wid
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$ftxvar</font>] && \
        [<b><font color=#3a6797>file</font></b> exist [<b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>file</font></b> nativename <font color=#1b1baa>$res</font>]]]} {
          <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$ftxvar</font> [::apave::readTextFile <font color=#1b1baa>$res</font>]
          <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exist <font color=#1b1baa>$txtnam</font>]} {
            <b><font color=#ca14ca>my</font></b> readonlyWidget <font color=#1b1baa>$txtnam</font> no
            <b><font color=#ca14ca>my</font></b> displayTaggedText <font color=#1b1baa>$txtnam</font> <font color=#1b1baa>$ftxvar</font>
            <b><font color=#ca14ca>my</font></b> readonlyWidget <font color=#1b1baa>$txtnam</font> yes
            <b><font color=#3a6797>set</font></b> wid [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$txtnam</font> 0 [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$txtnam</font>]]<font color=#1b1baa>$wid</font>
            <font color=#1b1baa>$wid</font> configure <font color=#653760>-text</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>res&quot;</font>
            ::tk::TextSetCursor <font color=#1b1baa>$txtnam</font> 1.0
            <b><font color=#3a6797>update</font></b>
          }
        }
      }
      <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font> <font color=#1b1baa>$res</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vargeo</font> ne {} && <font color=#1b1baa>$widname</font> ne {} && [::isunix]} {
      <b><font color=#3a6797>catch</font></b> {
        <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$vargeo</font> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$widname</font> [<b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$widname</font>]]  ;<i><font color=#4b5d50># 1st item for possible usage only</font></i>
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tname</font> ne {}} {
      <b><font color=#3a6797>set</font></b> tname [<b><font color=#ca14ca>my</font></b> [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$tname</font>]]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$bname</font> ne {}} {
        <i><font color=#4b5d50># re-focus to fire invalidation of the entry (esp. for Windows)</font></i>
        <b><font color=#3a6797>set</font></b> ent [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$tname</font>]
        <b><font color=#3a6797>set</font></b> but [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$bname</font>]
        <b><font color=#3a6797>set</font></b> bname [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> .<font color=#1b1baa>$ent</font> .<font color=#1b1baa>$but</font>] <font color=#1b1baa>$tname</font>]
        <b><font color=#134070>focus</font></b> <font color=#1b1baa>$bname</font>
      }
      <b><font color=#134070>focus</font></b> <font color=#1b1baa>$tname</font>
      <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;catch <font color=#1b1baa>{$</font>tname selection range 0 end ; <font color=#1b1baa>$</font>tname icursor end<font color=#1b1baa>}</font>&quot;</font>
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=colorChooser></a>
  <b><font color=#ca14ca>method</font></b> colorChooser {tvar args} {
    <i><font color=#4b5d50># Color chooser.</font></i>
    <i><font color=#4b5d50>#   tvar - name of variable containing a color</font></i>
    <i><font color=#4b5d50>#   args - options of *tk_chooseColor*</font></i>
    <i><font color=#4b5d50># The *tvar* sets the value of *-initialcolor* option. Also</font></i>
    <i><font color=#4b5d50># it gets a color selected in the chooser.</font></i>
    <i><font color=#4b5d50># Returns a selected color.</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$Initialcolor</font> eq {} && [::isunix]} {
      <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::apaveDir</font> pickers color clrpick.tcl]
    }
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-entry</font> {} <font color=#653760>-inifile</font> {}] ent ini
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ent</font> ne {}} {
      <b><font color=#3a6797>set</font></b> ent [<b><font color=#ca14ca>my</font></b> [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$ent</font>]]
      <b><font color=#3a6797>set</font></b> x [<b><font color=#134070>winfo</font></b> rootx <font color=#1b1baa>$ent</font>]
      <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>expr</font></b> {[<b><font color=#134070>winfo</font></b> rooty <font color=#1b1baa>$ent</font>]+32}]
      <b><font color=#3a6797>dict</font></b> set args <font color=#653760>-geometry</font> +<font color=#1b1baa>$x</font>+<font color=#1b1baa>$y</font>  ;<i><font color=#4b5d50># the same as with date picker</font></i>
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> _ [<b><font color=#3a6797>string</font></b> trim [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>]]] ne {}} {
      <b><font color=#3a6797>set</font></b> ic <font color=#1b1baa>$_</font>
      <b><font color=#3a6797>set</font></b> _ [. cget <font color=#653760>-background</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {. configure <font color=#653760>-background</font> <font color=#1b1baa>$ic</font>}]} {
        <b><font color=#3a6797>set</font></b> ic <font color=#8b2a0e>&quot;#<font color=#1b1baa>$</font>ic&quot;</font>
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {. configure <font color=#653760>-background</font> <font color=#1b1baa>$ic</font>}]} {<b><font color=#3a6797>set</font></b> ic black}
      }
      <b><font color=#3a6797>set</font></b> Initialcolor <font color=#1b1baa>$ic</font>
      . configure <font color=#653760>-background</font> <font color=#1b1baa>$_</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> Initialcolor black
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>lassign</font></b> [<b><font color=#134070>tk_chooseColor</font></b> <font color=#653760>-moveall</font> <font color=#1b1baa>$Moveall</font> \
    <font color=#653760>-initialcolor</font> <font color=#1b1baa>$Initialcolor</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> <font color=#653760>-inifile</font> <font color=#1b1baa>$ini</font>] res Moveall}]} {
      <b><font color=#3a6797>set</font></b> args [::apave::removeOptions <font color=#1b1baa>$args</font> <font color=#653760>-moveall</font> <font color=#653760>-tonemoves</font> <font color=#653760>-geometry</font>]
      <b><font color=#3a6797>set</font></b> res [<b><font color=#134070>tk_chooseColor</font></b> <font color=#653760>-initialcolor</font> <font color=#1b1baa>$Initialcolor</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$res</font> ne {}} {
      <b><font color=#3a6797>set</font></b> Initialcolor [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font> <font color=#1b1baa>$res</font>]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=sourceKlnd></a>
  <b><font color=#ca14ca>method</font></b> sourceKlnd {{num <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Loads klnd package at need.</font></i>
    <i><font color=#4b5d50>#   num - defines which name of package file to be used</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> commands ::klnd::calendar<font color=#1b1baa>$num</font>] eq {}} {
      <i><font color=#4b5d50># imo, it's more effective to source on request than to require on possibility</font></i>
      <b><font color=#3a6797>source</font></b> [<b><font color=#3a6797>file</font></b> join <font color=#1b1baa>$::apave::apaveDir</font> pickers klnd klnd<font color=#1b1baa>$num</font>.tcl]
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=dateChooser></a>
  <b><font color=#ca14ca>method</font></b> dateChooser {tvar args} {
    <i><font color=#4b5d50># Date chooser (calendar widget).</font></i>
    <i><font color=#4b5d50>#   tvar - name of variable containing a date</font></i>
    <i><font color=#4b5d50>#   args - options of *::klnd::calendar*</font></i>
    <i><font color=#4b5d50># Returns a selected date.</font></i>

    <b><font color=#ca14ca>my</font></b> sourceKlnd {}
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> ent [<b><font color=#ca14ca>my</font></b> [<b><font color=#ca14ca>my</font></b> ownWName [::apave::getOption <font color=#653760>-entry</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]]]}]} {
      <b><font color=#3a6797>dict</font></b> set args <font color=#653760>-entry</font> <font color=#1b1baa>$ent</font>
      <b><font color=#3a6797>set</font></b> res [::klnd::calendar {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> <font color=#653760>-tvar</font> <font color=#1b1baa>$tvar</font> <font color=#653760>-parent</font> [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$ent</font>]]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> res [::klnd::calendar {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> <font color=#653760>-tvar</font> <font color=#1b1baa>$tvar</font>]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Replace_Tcl></a>
  <b><font color=#ca14ca>method</font></b> Replace_Tcl {r1 r2 r3 args} {
    <i><font color=#4b5d50># Replaces Tcl code with its resulting items in *lwidgets* list.</font></i>
    <i><font color=#4b5d50>#   r1 - variable name for a current index in *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   r2 - variable name for a length of *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   r3 - variable name for *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   args - &quot;tcl&quot; and &quot;tcl code&quot; for &quot;tcl&quot; type of widget</font></i>
    <i><font color=#4b5d50># The code should use the wildcard that goes first at a line:</font></i>
    <i><font color=#4b5d50>#   %C - a command for inserting an item into lwidgets list.</font></i>
    <i><font color=#4b5d50># The &quot;tcl&quot; widget type can be useful to automate the inserting</font></i>
    <i><font color=#4b5d50># a list of similar widgets to the list of widgets.</font></i>
    <i><font color=#4b5d50># See tests/test2_pave.tcl where the &quot;tcl&quot; fills &quot;Color schemes&quot; tab.</font></i>

    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> _name _code
    <b><font color=#3a6797>if</font></b> {[<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$_name</font>] ne {tcl}} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>}
    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$r1</font> _ii <font color=#1b1baa>$r2</font> _lwlen <font color=#1b1baa>$r3</font> _lwidgets
  ; <b><font color=#ca14ca>proc</font></b> lwins {lwName i w} {
      <b><font color=#3a6797>upvar</font></b> 2 <font color=#1b1baa>$lwName</font> lw
      <b><font color=#3a6797>set</font></b> lw [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lw</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$w</font>]
    }
    <b><font color=#3a6797>set</font></b> _lwidgets [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$_lwidgets</font> <font color=#1b1baa>$_ii</font> <font color=#1b1baa>$_ii</font>]  ;<i><font color=#4b5d50># removes tcl item</font></i>
    <b><font color=#3a6797>set</font></b> _inext [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$_ii</font>-1}]
    <b><font color=#3a6797>eval</font></b> [<b><font color=#3a6797>string</font></b> map {%C {lwins <font color=#1b1baa>$r3</font> [<b><font color=#3a6797>incr</font></b> _inext] }} <font color=#1b1baa>$_code</font>]
    <b><font color=#ca14ca>return</font></b> {}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Replace_chooser></a>
  <b><font color=#ca14ca>method</font></b> Replace_chooser {r0 r1 r2 r3 args} {
    <i><font color=#4b5d50># Replaces an item for a chooser with two items.</font></i>
    <i><font color=#4b5d50>#   r0 - variable name for a widget's name</font></i>
    <i><font color=#4b5d50>#   r1 - variable name for a current index in *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   r2 - variable name for a length of *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   r3 - variable name for *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   args - the widget item of *lwidgets* list</font></i>
    <i><font color=#4b5d50># Choosers should contain 2 fields: entry + button.</font></i>
    <i><font color=#4b5d50># Here every chooser is replaced with these two widgets.</font></i>

    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$r0</font> w <font color=#1b1baa>$r1</font> i <font color=#1b1baa>$r2</font> lwlen <font color=#1b1baa>$r3</font> lwidgets
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> name neighbor posofnei rowspan colspan options1 attrs1
    <b><font color=#3a6797>lassign</font></b> {} wpar view addattrs addattrs2
    <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$attrs1</font> <font color=#653760>-tvar</font> {-} <font color=#653760>-validatecommand</font> {}] tvar validatecommand
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attrs1 <font color=#653760>-takefocus</font> 0 <font color=#653760>-showcolor</font> {} <font color=#653760>-filetypes</font> {} \
      <font color=#653760>-initialdir</font> {} <font color=#653760>-initialfile</font> {} <font color=#653760>-defaultextension</font> {} <font color=#653760>-multiple</font> {}] \
      takefocus showcolor filetypes initialdir initialfile defaultextension multiple
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions options1 <font color=#653760>-padx</font> 0 <font color=#653760>-pady</font> 0] padx pady
    <b><font color=#3a6797>set</font></b> takefocus <font color=#8b2a0e>&quot;-takefocus <font color=#1b1baa>$</font>takefocus&quot;</font>
    <b><font color=#3a6797>foreach</font></b> atr {filetypes initialdir initialfile defaultextension multiple} {
      <b><font color=#3a6797>set</font></b> val [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$atr</font>]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$val</font> ne {}} {
        <b><font color=#3a6797>lset</font></b> args 6 <font color=#1b1baa>$attrs1</font>
        <b><font color=#3a6797>append</font></b> addattrs2 <font color=#8b2a0e>&quot; -<font color=#1b1baa>$</font>atr <font color=#1b1baa>{$</font>val<font color=#1b1baa>}</font>&quot;</font>
      }
    }
    <b><font color=#3a6797>set</font></b> an [<b><font color=#3a6797>set</font></b> entname {}]
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$name</font>] n
    <b><font color=#3a6797>set</font></b> ownname [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$n</font>]
    <b><font color=#3a6797>set</font></b> wtyp [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$ownname</font> 0 2]
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$wtyp</font> {
      daT { ;<i><font color=#4b5d50># embed calendar widgets into $ownname frame</font></i>
        <b><font color=#ca14ca>my</font></b> sourceKlnd
        <b><font color=#ca14ca>my</font></b> sourceKlnd 2
        <b><font color=#3a6797>set</font></b> attrs1 [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$attrs1</font>]
        <b><font color=#3a6797>set</font></b> lwidgets2 [::klnd::calendar2 [<b><font color=#ca14ca>self</font></b>] <font color=#1b1baa>$w</font> <font color=#1b1baa>$n</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs1</font>]
        <b><font color=#3a6797>set</font></b> lwlen2 [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lwidgets2</font>]
        <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i2 0} {<font color=#1b1baa>$i2</font> &lt; <font color=#1b1baa>$lwlen2</font>} {} {
          <b><font color=#3a6797>set</font></b> lst2 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets2</font> <font color=#1b1baa>$i2</font>]
          <b><font color=#3a6797>if</font></b> {[<b><font color=#ca14ca>my</font></b> Replace_Tcl i2 lwlen2 lwidgets2 {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lst2</font>] ne {}} {<b><font color=#3a6797>incr</font></b> i2}
        }
        <b><font color=#3a6797>incr</font></b> lwlen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lwidgets2</font>]
        <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+1}] {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lwidgets2</font>]
        <b><font color=#3a6797>lset</font></b> args 6 [::klnd::clearArgs {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs1</font>]
        <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>
      }
      fil - fiL {<b><font color=#3a6797>set</font></b> chooser tk_getOpenFile}
      fis - fiS {<b><font color=#3a6797>set</font></b> chooser tk_getSaveFile}
      dir - diR {<b><font color=#3a6797>set</font></b> chooser tk_chooseDirectory}
      fon - foN {<b><font color=#3a6797>set</font></b> chooser fontChooser}
      clr - clR {
        <b><font color=#3a6797>set</font></b> chooser colorChooser
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$showcolor</font> eq {}} {<b><font color=#3a6797>set</font></b> showcolor 1} ;<i><font color=#4b5d50># default is &quot;show color label&quot;</font></i>
        <b><font color=#3a6797>set</font></b> showcolor [<b><font color=#3a6797>string</font></b> is true <font color=#653760>-strict</font> <font color=#1b1baa>$showcolor</font>]
        <b><font color=#3a6797>set</font></b> wpar <font color=#8b2a0e>&quot;-parent <font color=#1b1baa>$</font>w&quot;</font> ;<i><font color=#4b5d50># specific for color chooser (parent of $w)</font></i>
        <b><font color=#3a6797>set</font></b> entname {<font color=#653760>-entry</font> }
      }
      dat {<b><font color=#3a6797>set</font></b> chooser dateChooser; <b><font color=#3a6797>set</font></b> entname {<font color=#653760>-entry</font> }}
      ftx {
        <b><font color=#3a6797>set</font></b> chooser [<b><font color=#3a6797>set</font></b> view ftx_OpenFile]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tvar</font> ne {} && [<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$tvar</font>]} {
          <b><font color=#3a6797>append</font></b> addattrs <font color=#8b2a0e>&quot; -t <font color=#1b1baa>{[</font>set <font color=#1b1baa>$</font>tvar<font color=#1b1baa>]}</font>&quot;</font>
        }
        <b><font color=#3a6797>set</font></b> an tex
        <b><font color=#3a6797>set</font></b> txtnam [<b><font color=#ca14ca>my</font></b> Transname <font color=#1b1baa>$an</font> <font color=#1b1baa>$name</font>]
      }
      <b><font color=#3a6797>default</font></b> {
        <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>
      }
    }
    <b><font color=#3a6797>set</font></b> inname [<b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$w</font> <font color=#1b1baa>$name</font> <font color=#1b1baa>$an</font>]
    <b><font color=#3a6797>set</font></b> name <font color=#1b1baa>$n</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$view</font> ne {}} {
      <b><font color=#3a6797>set</font></b> tvname <font color=#1b1baa>$inname</font>
      <b><font color=#3a6797>set</font></b> inname [<b><font color=#ca14ca>my</font></b> WidgetNameFull <font color=#1b1baa>$w</font> <font color=#1b1baa>$name</font>]
    }
    <b><font color=#3a6797>set</font></b> tvar [<b><font color=#3a6797>set</font></b> vv [<b><font color=#3a6797>set</font></b> addopt {}]]
    <b><font color=#3a6797>set</font></b> attmp [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>foreach</font></b> {nam val} <font color=#1b1baa>$attrs1</font> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nam</font> in {<font color=#653760>-title</font> <font color=#653760>-parent</font> <font color=#653760>-dateformat</font> <font color=#653760>-weekday</font> <font color=#653760>-modal</font> <font color=#653760>-centerme</font>}} {
        <b><font color=#3a6797>append</font></b> addopt <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>nam \{<font color=#1b1baa>$</font>val\}&quot;</font>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>lappend</font></b> attmp <font color=#1b1baa>$nam</font> <font color=#1b1baa>$val</font>
      }
    }
    <b><font color=#3a6797>set</font></b> attrs1 <font color=#1b1baa>$attmp</font>
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>array</font></b> set a <font color=#1b1baa>$attrs1</font>; <b><font color=#3a6797>set</font></b> tvar <font color=#8b2a0e>&quot;-tvar <font color=#1b1baa>[</font>set vv <font color=#1b1baa>$</font>a(-tvar)<font color=#1b1baa>]</font>&quot;</font>}
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>array</font></b> set a <font color=#1b1baa>$attrs1</font>; <b><font color=#3a6797>set</font></b> tvar <font color=#8b2a0e>&quot;-tvar <font color=#1b1baa>[</font>set vv <font color=#1b1baa>$</font>a(-textvariable)<font color=#1b1baa>]</font>&quot;</font>}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$vv</font> eq {}} {
      <b><font color=#3a6797>set</font></b> vv [<b><font color=#3a6797>namespace</font></b> current]::<font color=#1b1baa>$name</font>
      <b><font color=#3a6797>set</font></b> tvar <font color=#8b2a0e>&quot;-tvar <font color=#1b1baa>$</font>vv&quot;</font>
    }
    <i><font color=#4b5d50># make a frame in the widget list</font></i>
    <b><font color=#3a6797>set</font></b> ispack 0
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> gm [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>] 5]}]} {
      <b><font color=#3a6797>set</font></b> ispack [<b><font color=#3a6797>expr</font></b> [<b><font color=#3a6797>string</font></b> first pack <font color=#1b1baa>$gm</font>]==0]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ispack</font>} {
      <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$options1</font> <font color=#653760>-expand</font> 0 <font color=#653760>-fill</font> x] exp fil
      <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font> - - - - \
        <font color=#8b2a0e>&quot;pack -expand <font color=#1b1baa>$</font>exp -fill <font color=#1b1baa>$</font>fil <font color=#1b1baa>[</font>string range <font color=#1b1baa>$</font>gm 5 end<font color=#1b1baa>]</font>&quot;</font> <font color=#1b1baa>$addattrs</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$options1</font> <font color=#653760>-st</font> ew <font color=#653760>-sticky</font> {} <font color=#653760>-rw</font> {} <font color=#653760>-cw</font> {}] st st2 rw cw
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$st2</font> ne {}} {<b><font color=#3a6797>set</font></b> st <font color=#1b1baa>$st2</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rw</font> ne {}} {<b><font color=#3a6797>set</font></b> rw <font color=#8b2a0e>&quot;-rw <font color=#1b1baa>$</font>rw&quot;</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$cw</font> ne {}} {<b><font color=#3a6797>set</font></b> cw <font color=#8b2a0e>&quot;-cw <font color=#1b1baa>$</font>cw&quot;</font>}
      <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font> <font color=#1b1baa>$neighbor</font> <font color=#1b1baa>$posofnei</font> <font color=#1b1baa>$rowspan</font> <font color=#1b1baa>$colspan</font> \
        <font color=#8b2a0e>&quot;-st <font color=#1b1baa>$</font>st <font color=#1b1baa>$</font>rw <font color=#1b1baa>$</font>cw&quot;</font> <font color=#1b1baa>$addattrs</font>]
    }
    <b><font color=#3a6797>lset</font></b> lwidgets <font color=#1b1baa>$i</font> <font color=#1b1baa>$args</font>
    <b><font color=#3a6797>set</font></b> btTname [<b><font color=#ca14ca>my</font></b> Transname btT <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$view</font> ne {}} {
      <b><font color=#3a6797>append</font></b> attrs1 <font color=#8b2a0e>&quot; -callF2 <font color=#1b1baa>{</font>.texF .btTf .texf .btTf<font color=#1b1baa>}</font>&quot;</font>
      <b><font color=#3a6797>set</font></b> tvar [::apave::getOption <font color=#653760>-tvar</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs1</font>]
      <b><font color=#3a6797>set</font></b> attrs1 [::apave::removeOptions <font color=#1b1baa>$attrs1</font> <font color=#653760>-tvar</font>]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tvar</font> ne {} && [<b><font color=#3a6797>file</font></b> exist [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>]]} {
        <b><font color=#3a6797>set</font></b> tcont [<b><font color=#ca14ca>my</font></b> SetContentVariable <font color=#1b1baa>$tvar</font> <font color=#1b1baa>$tvname</font> [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$name</font>]]
        <b><font color=#3a6797>set</font></b> wpar <font color=#8b2a0e>&quot;-ftxvar <font color=#1b1baa>$</font>tcont&quot;</font>
        <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tcont</font> [::apave::readTextFile [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>]]
        <b><font color=#3a6797>set</font></b> attrs1 [::apave::putOption <font color=#653760>-rotext</font> <font color=#1b1baa>$tcont</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs1</font>]
      }
      <b><font color=#3a6797>set</font></b> entf [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$txtnam</font> - - - - <font color=#8b2a0e>&quot;pack -side top -expand 1 -fill both -in <font color=#1b1baa>$</font>inname&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs1&quot;</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wtyp</font> in {fiL fiS diR foN clR}} {
        <b><font color=#3a6797>set</font></b> field cbx
        <b><font color=#3a6797>set</font></b> tname [<b><font color=#ca14ca>my</font></b> Transname Cbx <font color=#1b1baa>$name</font>]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> tname [<b><font color=#ca14ca>my</font></b> Transname Ent <font color=#1b1baa>$name</font>]
        <b><font color=#3a6797>set</font></b> field ent
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$entname</font> ne {}} {<b><font color=#3a6797>append</font></b> entname <font color=#1b1baa>$tname</font>}
      <b><font color=#3a6797>append</font></b> attrs1 <font color=#8b2a0e>&quot; -callF2 <font color=#1b1baa>{</font>.<font color=#1b1baa>$</font>field .btT<font color=#1b1baa>}</font>&quot;</font>
      <b><font color=#3a6797>append</font></b> wpar <font color=#8b2a0e>&quot; -tname <font color=#1b1baa>$</font>tname -bname <font color=#1b1baa>$</font>btTname&quot;</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$chooser</font> eq {fontChooser}} {
        <b><font color=#3a6797>append</font></b> wpar <font color=#8b2a0e>&quot; -parent \[<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> <font color=#1b1baa>[</font>my ownWName <font color=#1b1baa>$</font>tname<font color=#1b1baa>]</font>\]&quot;</font>
      }
      <b><font color=#3a6797>set</font></b> entf [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$tname</font> - - - - <font color=#8b2a0e>&quot;pack -padx <font color=#1b1baa>$</font>padx -pady <font color=#1b1baa>$</font>pady -side left -expand 1 -fill x -in <font color=#1b1baa>$</font>inname&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs1 <font color=#1b1baa>$</font>tvar&quot;</font>]
    }
    <b><font color=#3a6797>set</font></b> icon folder
    <b><font color=#3a6797>foreach</font></b> ic {OpenFile SaveFile font color date} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$ic</font> <font color=#1b1baa>$chooser</font>] &gt;= 0} {<b><font color=#3a6797>set</font></b> icon <font color=#1b1baa>$ic</font>; <b><font color=#ca14ca>break</font></b>}
    }
    <b><font color=#3a6797>set</font></b> com <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> chooser <font color=#1b1baa>$</font>chooser \{<font color=#1b1baa>$</font>vv\} <font color=#1b1baa>$</font>addopt <font color=#1b1baa>$</font>wpar <font color=#1b1baa>$</font>addattrs2 <font color=#1b1baa>$</font>entname&quot;</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$view</font> ne {}} {<b><font color=#3a6797>set</font></b> anc n} {<b><font color=#3a6797>set</font></b> anc center}
    <b><font color=#3a6797>set</font></b> butf [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$btTname</font> - - - - <font color=#8b2a0e>&quot;pack -side right -anchor <font color=#1b1baa>$</font>anc -in <font color=#1b1baa>$</font>inname -padx 2&quot;</font> <font color=#8b2a0e>&quot;-com \{<font color=#1b1baa>$</font>com\} -compound none -image <font color=#1b1baa>[</font>::apave::iconImage <font color=#1b1baa>$</font>icon small<font color=#1b1baa>]</font> -font \{-weight bold -size 5\} -fg <font color=#1b1baa>$</font>Fgbut -bg <font color=#1b1baa>$</font>Bgbut <font color=#1b1baa>$</font>takefocus&quot;</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$view</font> ne {}} {
      <b><font color=#3a6797>set</font></b> scrolv [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>my</font></b> Transname sbv <font color=#1b1baa>$name</font>] <font color=#1b1baa>$txtnam</font> L - - <font color=#8b2a0e>&quot;pack -in <font color=#1b1baa>$</font>inname -side bottom -after <font color=#1b1baa>[</font>my WidgetNameFull <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>btTname<font color=#1b1baa>]</font>&quot;</font> {}]
      <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+1}] <font color=#1b1baa>$butf</font>]
      <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+2}] <font color=#1b1baa>$entf</font>]
      <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+3}] <font color=#1b1baa>$scrolv</font>]
      <b><font color=#3a6797>incr</font></b> lwlen 3
      <b><font color=#3a6797>set</font></b> wrap [::apave::getOption <font color=#653760>-wrap</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs1</font>]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wrap</font> eq {none}} {
        <b><font color=#3a6797>set</font></b> scrolh [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>my</font></b> Transname sbh <font color=#1b1baa>$name</font>] <font color=#1b1baa>$txtnam</font> T - - <font color=#8b2a0e>&quot;pack -in <font color=#1b1baa>$</font>inname -side bottom -after <font color=#1b1baa>[</font>my WidgetNameFull <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>txtnam<font color=#1b1baa>]</font>&quot;</font> {}]
        <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+3}] <font color=#1b1baa>$scrolh</font>]
        <b><font color=#3a6797>incr</font></b> lwlen
      }
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$chooser</font> eq {colorChooser} && <font color=#1b1baa>$showcolor</font>} {
        <b><font color=#3a6797>set</font></b> f0 [<b><font color=#ca14ca>my</font></b> Transname Lab <font color=#1b1baa>$name</font>]
        <b><font color=#3a6797>set</font></b> labf [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$f0</font> - - - - <font color=#8b2a0e>&quot;pack -side right -in <font color=#1b1baa>$</font>inname -padx 2&quot;</font> \
          <font color=#8b2a0e>&quot;-t \{    \} -relief raised&quot;</font>]
        <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$entf</font> f1 - - - - f2 f3
        <b><font color=#3a6797>set</font></b> com <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> validateColorChoice <font color=#1b1baa>$</font>f0 <font color=#1b1baa>$</font>f1&quot;</font>
        <b><font color=#3a6797>append</font></b> f3 <font color=#8b2a0e>&quot; -afteridle \&quot;<font color=#1b1baa>$</font>com; bind \[string map \{.entclr .labclr\} %w\] &lt;ButtonPress&gt; \{eval \[string map \{.entclr .btTclr\} %w\] invoke\}\&quot;&quot;</font>
        <b><font color=#3a6797>append</font></b> f3 <font color=#8b2a0e>&quot; -validate all -validatecommand \{<font color=#1b1baa>$</font>com ; <font color=#1b1baa>$</font>validatecommand\}&quot;</font>
        <b><font color=#3a6797>set</font></b> entf [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$f1</font> - - - - <font color=#1b1baa>$f2</font> <font color=#1b1baa>$f3</font>]
        <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+1}] <font color=#1b1baa>$entf</font> <font color=#1b1baa>$butf</font> <font color=#1b1baa>$labf</font>]
        <b><font color=#3a6797>incr</font></b> lwlen 3
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+1}] <font color=#1b1baa>$entf</font> <font color=#1b1baa>$butf</font>]
        <b><font color=#3a6797>incr</font></b> lwlen 2
      }
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Replace_bar></a>
  <b><font color=#ca14ca>method</font></b> Replace_bar {r0 r1 r2 r3 args} {
    <i><font color=#4b5d50># Replaces an item for a menu/tool/status bar with appropriate items.</font></i>
    <i><font color=#4b5d50>#   r0 - variable name for a widget's name</font></i>
    <i><font color=#4b5d50>#   r1 - variable name for a current index in *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   r2 - variable name for a length of *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   r3 - variable name for *lwidgets* list</font></i>
    <i><font color=#4b5d50>#   args - the widget item of *lwidgets* list</font></i>
    <i><font color=#4b5d50># Bar widgets should contain N fields of appropriate type</font></i>

    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$r0</font> w <font color=#1b1baa>$r1</font> i <font color=#1b1baa>$r2</font> lwlen <font color=#1b1baa>$r3</font> lwidgets
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> winname [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$w</font>]}]} {
      <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>
    }
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> name neighbor posofnei rowspan colspan options1 attrs1
    <b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$w</font> <font color=#1b1baa>$name</font>
    <b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$name</font>] 0]
    <b><font color=#3a6797>set</font></b> wpar {}
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-glob</font> -- [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$name</font>] {
      men* {<b><font color=#3a6797>set</font></b> typ menuBar}
      too* {<b><font color=#3a6797>set</font></b> typ toolBar}
      sta* {<b><font color=#3a6797>set</font></b> typ statusBar}
      <b><font color=#3a6797>default</font></b> {
        <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>
      }
    }
    <b><font color=#3a6797>set</font></b> attcur [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> namvar [<b><font color=#3a6797>list</font></b>]
    <i><font color=#4b5d50># get array of pairs (e.g. image-command for toolbar)</font></i>
    <b><font color=#3a6797>foreach</font></b> {nam val} <font color=#1b1baa>$attrs1</font> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nam</font> eq {<font color=#653760>-array</font>}} {
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> val [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$val</font>]}
        <b><font color=#3a6797>set</font></b> ind -1
        <b><font color=#3a6797>foreach</font></b> {v1 v2} <font color=#1b1baa>$val</font> {
          <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> v1 [<b><font color=#3a6797>subst</font></b> <font color=#653760>-nocommand</font> <font color=#653760>-nobackslash</font> <font color=#1b1baa>$v1</font>]}
          <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> v2 [<b><font color=#3a6797>subst</font></b> <font color=#653760>-nocommand</font> <font color=#653760>-nobackslash</font> <font color=#1b1baa>$v2</font>]}
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$name</font> eq {<b><font color=#134070>menu</font></b>}} {<b><font color=#3a6797>set</font></b> v2 [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>my</font></b> MC <font color=#1b1baa>$v2</font>]]}
          <b><font color=#3a6797>lappend</font></b> namvar [<b><font color=#3a6797>namespace</font></b> current]::<font color=#1b1baa>$typ</font>[<b><font color=#3a6797>incr</font></b> ind] <font color=#1b1baa>$v1</font> <font color=#1b1baa>$v2</font>
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>lappend</font></b> attcur <font color=#1b1baa>$nam</font> <font color=#1b1baa>$val</font>
      }
    }
    <i><font color=#4b5d50># make a frame in the widget list</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$typ</font> eq {menuBar}} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> fillmenu [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 7]] ne {}} {
        <b><font color=#3a6797>after</font></b> idle <font color=#1b1baa>$fillmenu</font>
      }
      <b><font color=#3a6797>set</font></b> args {}
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> ispack 0
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> gm [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>] 5]}]} {
        <b><font color=#3a6797>set</font></b> ispack [<b><font color=#3a6797>expr</font></b> [<b><font color=#3a6797>string</font></b> first pack <font color=#1b1baa>$gm</font>]==0]
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ispack</font>} {
        <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font> - - - - <font color=#8b2a0e>&quot;pack -expand 0 -fill x -side bottom <font color=#1b1baa>[</font>string range <font color=#1b1baa>$</font>gm 5 end<font color=#1b1baa>]</font>&quot;</font> <font color=#1b1baa>$attcur</font>]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font> <font color=#1b1baa>$neighbor</font> <font color=#1b1baa>$posofnei</font> <font color=#1b1baa>$rowspan</font> <font color=#1b1baa>$colspan</font> <font color=#8b2a0e>&quot;-st ew&quot;</font> <font color=#1b1baa>$attcur</font>]
      }
      <b><font color=#3a6797>lset</font></b> lwidgets <font color=#1b1baa>$i</font> <font color=#1b1baa>$args</font>
    }
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] fga fg bga bg
    <b><font color=#3a6797>set</font></b> fontB [<b><font color=#ca14ca>my</font></b> boldTextFont 16]
    <b><font color=#3a6797>set</font></b> fontS [<b><font color=#ca14ca>my</font></b> basicSmallFont]
    <b><font color=#3a6797>set</font></b> itmp <font color=#1b1baa>$i</font>
    <b><font color=#3a6797>set</font></b> k [<b><font color=#3a6797>set</font></b> j [<b><font color=#3a6797>set</font></b> j2 [<b><font color=#3a6797>set</font></b> wasmenu 0]]]
    <b><font color=#3a6797>foreach</font></b> {nam v1 v2} <font color=#1b1baa>$namvar</font> {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first # <font color=#1b1baa>$v1</font>]==0} <b><font color=#ca14ca>continue</font></b>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$v1</font> eq {h_}} {  ;<i><font color=#4b5d50># horisontal space</font></i>
        <b><font color=#3a6797>set</font></b> ntmp [<b><font color=#ca14ca>my</font></b> Transname fra <font color=#1b1baa>${name}</font>[<b><font color=#3a6797>incr</font></b> j2]]
        <b><font color=#3a6797>set</font></b> wid1 [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ntmp</font> - - - - <font color=#8b2a0e>&quot;pack -side left -in <font color=#1b1baa>$</font>w.<font color=#1b1baa>$</font>name -fill y&quot;</font>]
        <b><font color=#3a6797>set</font></b> wid2 [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ntmp</font>.[<b><font color=#ca14ca>my</font></b> ownWName [<b><font color=#ca14ca>my</font></b> Transname h_ <font color=#1b1baa>$name$j</font>]] - - - - <font color=#8b2a0e>&quot;pack -fill y -expand 1 -padx <font color=#1b1baa>$</font>v2&quot;</font>]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$v1</font> eq {sev}} {   ;<i><font color=#4b5d50># vertical separator</font></i>
        <b><font color=#3a6797>set</font></b> ntmp [<b><font color=#ca14ca>my</font></b> Transname fra <font color=#1b1baa>${name}</font>[<b><font color=#3a6797>incr</font></b> j2]]
        <b><font color=#3a6797>set</font></b> wid1 [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ntmp</font> - - - - <font color=#8b2a0e>&quot;pack -side left -in <font color=#1b1baa>$</font>w.<font color=#1b1baa>$</font>name -fill y&quot;</font>]
        <b><font color=#3a6797>set</font></b> wid2 [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ntmp</font>.[<b><font color=#ca14ca>my</font></b> ownWName [<b><font color=#ca14ca>my</font></b> Transname sev <font color=#1b1baa>$name$j</font>]] - - - - <font color=#8b2a0e>&quot;pack -fill y -expand 1 -padx <font color=#1b1baa>$</font>v2&quot;</font>]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$typ</font> eq {statusBar}} {  ;<i><font color=#4b5d50># statusbar</font></i>
        <b><font color=#ca14ca>my</font></b> NormalizeName name i lwidgets
        <b><font color=#3a6797>set</font></b> dattr [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$v1</font> 1 end]
        <b><font color=#3a6797>if</font></b> {[::apave::extractOptions dattr <font color=#653760>-expand</font> 0]} {
          <b><font color=#3a6797>set</font></b> expand {<font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> x}
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> expand {}
        }
        <b><font color=#3a6797>set</font></b> font <font color=#8b2a0e>&quot; -font <font color=#1b1baa>{$</font>fontS<font color=#1b1baa>}</font>&quot;</font>
        <i><font color=#4b5d50># status prompt</font></i>
        <b><font color=#3a6797>set</font></b> wid1 [<b><font color=#3a6797>list</font></b> .[<b><font color=#ca14ca>my</font></b> ownWName [<b><font color=#ca14ca>my</font></b> Transname Lab <font color=#1b1baa>${name}</font>_[<b><font color=#3a6797>incr</font></b> j]]] - - - - <font color=#8b2a0e>&quot;pack -side left -in <font color=#1b1baa>$</font>w.<font color=#1b1baa>$</font>name&quot;</font> <font color=#8b2a0e>&quot;-t <font color=#1b1baa>{[</font>lindex <font color=#1b1baa>$</font>v1 0<font color=#1b1baa>]}</font> <font color=#1b1baa>$</font>font <font color=#1b1baa>$</font>dattr&quot;</font>]
        <i><font color=#4b5d50># status value</font></i>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::apave::_CS_(LABELBORDER)</font>} {<b><font color=#3a6797>set</font></b> relief sunken} {<b><font color=#3a6797>set</font></b> relief flat}
        <b><font color=#3a6797>set</font></b> wid2 [<b><font color=#3a6797>list</font></b> .[<b><font color=#ca14ca>my</font></b> ownWName [<b><font color=#ca14ca>my</font></b> Transname Lab <font color=#1b1baa>$name$j</font>]] - - - - <font color=#8b2a0e>&quot;pack -side left <font color=#1b1baa>$</font>expand -in <font color=#1b1baa>$</font>w.<font color=#1b1baa>$</font>name&quot;</font> <font color=#8b2a0e>&quot;-style TLabelSTD -relief <font color=#1b1baa>$</font>relief -w <font color=#1b1baa>$</font>v2 -t <font color=#1b1baa>{</font> <font color=#1b1baa>}</font> <font color=#1b1baa>$</font>font <font color=#1b1baa>$</font>dattr&quot;</font>]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$typ</font> eq {toolBar}} {  ;<i><font color=#4b5d50># toolbar</font></i>
        <b><font color=#3a6797>set</font></b> packreq {}
        <b><font color=#3a6797>switch</font></b> <font color=#653760>-nocase</font> <font color=#653760>-glob</font> -- <font color=#1b1baa>$v1</font> {
          lab* - laB* { ;<i><font color=#4b5d50># label</font></i>
            <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$v2</font> txt packreq att
            <b><font color=#3a6797>set</font></b> v2 <font color=#8b2a0e>&quot;-text <font color=#1b1baa>{$</font>txt<font color=#1b1baa>}</font> <font color=#1b1baa>$</font>att&quot;</font>
          }
          opc* { ;<i><font color=#4b5d50># tk_optionCascade</font></i>
            <b><font color=#3a6797>lset</font></b> v2 2 <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>lindex <font color=#1b1baa>$</font>v2 2<font color=#1b1baa>]</font> -takefocus 0&quot;</font>
          }
          spx* - chb* { ;<i><font color=#4b5d50># spinbox etc.</font></i>
            <b><font color=#3a6797>set</font></b> v2 <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>v2 -takefocus 0&quot;</font>
          }
          <b><font color=#3a6797>default</font></b> {
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is lower [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$v1</font> 0]]} { ;<i><font color=#4b5d50># button with -image</font></i>
              <b><font color=#3a6797>set</font></b> but buT
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> but BuT
            }
            <b><font color=#3a6797>set</font></b> v2 <font color=#8b2a0e>&quot;-command <font color=#1b1baa>$</font>v2 &quot;</font>
            <b><font color=#3a6797>append</font></b> v2 [<b><font color=#ca14ca>my</font></b> toolbarItem_Attrs [<b><font color=#3a6797>string</font></b> match _* <font color=#1b1baa>$v1</font>] <font color=#1b1baa>$v1</font> <font color=#1b1baa>$fontB</font> \
              <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fga</font> <font color=#1b1baa>$bga</font>]
            <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions v2 <font color=#653760>-method</font> {}] ismeth
            <b><font color=#3a6797>set</font></b> v1 [<b><font color=#ca14ca>my</font></b> Transname <font color=#1b1baa>$but</font> _<font color=#1b1baa>$v1</font>]
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is true <font color=#653760>-strict</font> <font color=#1b1baa>$ismeth</font>]} {
              <i><font color=#4b5d50># -method option forces making &quot;WidgetName&quot; method from &quot;widgetName&quot;</font></i>
              <b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$w</font>.<font color=#1b1baa>$name</font> [<b><font color=#3a6797>string</font></b> totitle <font color=#1b1baa>$v1</font> 0 0]
            }
          }
        }
        <b><font color=#3a6797>set</font></b> wid1 [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font>.<font color=#1b1baa>$v1</font> - - - - <font color=#8b2a0e>&quot;pack -side left <font color=#1b1baa>$</font>packreq&quot;</font> <font color=#1b1baa>$v2</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> wasseh]==1} {
          ;<i><font color=#4b5d50># horiz.separator for multiline toolbar</font></i>
          <b><font color=#3a6797>set</font></b> wid2 [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>my</font></b> Transname seh <font color=#1b1baa>$name$j</font>] - - - - <font color=#8b2a0e>&quot;pack -side top -fill x&quot;</font>]
        } <b><font color=#3a6797>else</font></b> {
          ;<i><font color=#4b5d50># 1st line of toolbar</font></i>
          <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>incr</font></b> itmp] <font color=#1b1baa>$wid1</font>]
          <b><font color=#ca14ca>continue</font></b>
        }
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$typ</font> eq {menuBar}} {
        ;<i><font color=#4b5d50># menubar: making it here; filling it outside of 'pave window'</font></i>
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> wasmenu]==1} {
          <b><font color=#3a6797>set</font></b> menupath [<b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$winname</font> <font color=#1b1baa>$name</font>]
          <b><font color=#134070>menu</font></b> <font color=#1b1baa>$menupath</font> <font color=#653760>-tearoff</font> 0
        }
        <b><font color=#3a6797>set</font></b> menuitem [<b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$menupath</font> <font color=#1b1baa>$v1</font>]
        <b><font color=#134070>menu</font></b> <font color=#1b1baa>$menuitem</font> <font color=#653760>-tearoff</font> 0
        <b><font color=#3a6797>set</font></b> ampos [<b><font color=#3a6797>string</font></b> first & [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$v2</font>  \{]]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ampos</font>&gt;=0} {<b><font color=#3a6797>append</font></b> v2 <font color=#8b2a0e>&quot; -underline <font color=#1b1baa>$</font>ampos&quot;</font>}
        <b><font color=#3a6797>set</font></b> v2 [<b><font color=#3a6797>string</font></b> map {& {}} <font color=#1b1baa>$v2</font>]
        <font color=#1b1baa>$menupath</font> add cascade <font color=#653760>-label</font> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$v2</font> 0] {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$v2</font> 1 end] <font color=#653760>-menu</font> <font color=#1b1baa>$menuitem</font>
        <b><font color=#ca14ca>continue</font></b>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>error</font></b> <font color=#8b2a0e>&quot;\npaveme.tcl: erroneous \&quot;<font color=#1b1baa>$</font>v1\&quot; for \&quot;<font color=#1b1baa>$</font>nam\&quot;\n&quot;</font>
      }
      <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$lwidgets</font> [<b><font color=#3a6797>incr</font></b> itmp] <font color=#1b1baa>$wid1</font> <font color=#1b1baa>$wid2</font>]
      <b><font color=#3a6797>incr</font></b> itmp
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wasmenu</font>} {
      <font color=#1b1baa>$winname</font> configure <font color=#653760>-menu</font> <font color=#1b1baa>$menupath</font>
    }
    <b><font color=#3a6797>incr</font></b> lwlen [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$itmp</font> - <font color=#1b1baa>$i</font>}]
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$args</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=fontChooser></a>
  <b><font color=#ca14ca>method</font></b> fontChooser {tvar args} {
    <i><font color=#4b5d50># Font chooser.</font></i>
    <i><font color=#4b5d50>#   tvar - name of variable containing a font</font></i>
    <i><font color=#4b5d50>#   args - options of *tk fontchooser*</font></i>
    <i><font color=#4b5d50># The *tvar* sets the value of *-font* option. Also</font></i>
    <i><font color=#4b5d50># it gets a font selected in the chooser.</font></i>
    <i><font color=#4b5d50># Returns a selected font.</font></i>

    <b><font color=#3a6797>set</font></b> parw [::apave::parseOptions <font color=#1b1baa>$args</font> <font color=#653760>-parent</font> [::apave::rootModalWindow .]]
  ; <b><font color=#ca14ca>proc</font></b> [<b><font color=#3a6797>namespace</font></b> current]::applyFont {<b><font color=#134070>font</font></b>} <font color=#8b2a0e>&quot; \</font>
<font color=#8b2a0e>      set <font color=#1b1baa>$</font>tvar \[font actual \$font\]; \</font>
<font color=#8b2a0e>      focus -force <font color=#1b1baa>$</font>parw&quot;</font>
    <b><font color=#3a6797>set</font></b> font [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$font</font> eq {}} {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>font</font></b> create fontchoose {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$::apave::FONTMAIN</font>}
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>font</font></b> delete fontchoose}
      <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>font</font></b> create fontchoose {<b><font color=#3a6797>*</font></b>}[<b><font color=#134070>font</font></b> actual <font color=#1b1baa>$font</font>]}
    }
    <b><font color=#134070>tk</font></b> fontchooser configure <font color=#653760>-font</font> fontchoose {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> ParentOpt] \
      {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font> <font color=#653760>-command</font> [<b><font color=#3a6797>namespace</font></b> current]::applyFont
    <b><font color=#3a6797>set</font></b> res [<b><font color=#134070>tk</font></b> fontchooser show]
    <i><font color=#4b5d50># core Tk font chooser is bad with focusing in and out, it isn't modal</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> foc [<b><font color=#3a6797>info</font></b> commands *__tk__fontchooser.ok]] ne {}} {
      <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> after 0 [<b><font color=#3a6797>list</font></b> catch <font color=#8b2a0e>&quot;focus -force <font color=#1b1baa>$</font>foc&quot;</font>]]
    }
    <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$tvar</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=toolbarItem_Attrs></a>
  <b><font color=#ca14ca>method</font></b> toolbarItem_Attrs {istext img fontB fg bg fga bga} {
    <i><font color=#4b5d50># Gets attributes of toolbar button.</font></i>
    <i><font color=#4b5d50>#   istext - true if textual button</font></i>
    <i><font color=#4b5d50>#   img - image of button</font></i>
    <i><font color=#4b5d50>#   fontB - bold font</font></i>
    <i><font color=#4b5d50>#   fg - foreground</font></i>
    <i><font color=#4b5d50>#   bg - background</font></i>
    <i><font color=#4b5d50>#   fga - active foreground</font></i>
    <i><font color=#4b5d50>#   bga - active background</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$istext</font>} {
      <b><font color=#3a6797>set</font></b> img <font color=#8b2a0e>&quot;-font <font color=#1b1baa>{$</font>fontB<font color=#1b1baa>}</font> -foreground <font color=#1b1baa>$</font>fg -background <font color=#1b1baa>$</font>bg -width 2 -pady 0 -padx 2&quot;</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> img <font color=#8b2a0e>&quot;-image <font color=#1b1baa>$</font>img -background <font color=#1b1baa>$</font>bg&quot;</font>
    }
    <b><font color=#3a6797>append</font></b> img <font color=#8b2a0e>&quot; -relief flat -overrelief raised -activeforeground <font color=#1b1baa>$</font>fga \</font>
<font color=#8b2a0e>      -activebackground <font color=#1b1baa>$</font>bga -highlightthickness 0 -takefocus 0&quot;</font>
  }
<a id=Widget_names_&_methods></a>
  <i><font color=#4b5d50>## ________________________ Widget names & methods _________________________ ##</font></i>
<a id=chooserPath></a>
  <b><font color=#ca14ca>method</font></b> chooserPath {W {w ent}} {
    <i><font color=#4b5d50># Gets a path to chooser's entry or label.</font></i>
    <i><font color=#4b5d50>#   W - widget/method name (e.g. Fil, Dir)</font></i>
    <i><font color=#4b5d50>#   w - ent / lab for entry / label</font></i>

    ::apave::precedeWidgetName [<b><font color=#ca14ca>my</font></b> <font color=#1b1baa>$W</font>] <font color=#1b1baa>$w</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Transname></a>
  <b><font color=#ca14ca>method</font></b> Transname {typ name} {
    <i><font color=#4b5d50># Transforms *name* by adding *typ* (its type).</font></i>
    <i><font color=#4b5d50>#   typ - type of widget in *apave* terms (but, buT etc.)</font></i>
    <i><font color=#4b5d50>#   name - name (path) of widget</font></i>
    <i><font color=#4b5d50># Returns the transformed name.</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> pp [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$name</font>]]&gt;-1} {
      <b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> 0 <font color=#1b1baa>$pp</font>]<font color=#1b1baa>$typ</font>[<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> <font color=#1b1baa>$pp</font>+1 end]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> name <font color=#1b1baa>$typ$name</font>
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$name</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=LowercaseWidgetName></a>
  <b><font color=#ca14ca>method</font></b> LowercaseWidgetName {name} {
    <i><font color=#4b5d50># Makes the widget name lowercased.</font></i>
    <i><font color=#4b5d50>#   name - widget's name</font></i>
    <i><font color=#4b5d50># The widgets of widget list can have uppercased names which</font></i>
    <i><font color=#4b5d50># means that the appropriate methods will be created to access</font></i>
    <i><font color=#4b5d50># their full pathes with a command `my Name`.</font></i>
    <i><font color=#4b5d50># This method gets a &quot;normal&quot; name of widget accepted by Tk.</font></i>
    <i><font color=#4b5d50># See also: MakeWidgetName</font></i>

    <b><font color=#3a6797>set</font></b> root [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$name</font> 0 [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$name</font>]][<b><font color=#3a6797>string</font></b> tolower <font color=#1b1baa>$root</font> 0 0] <font color=#1b1baa>$root</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=NormalizeName></a>
  <b><font color=#ca14ca>method</font></b> NormalizeName {refname refi reflwidgets} {
    <i><font color=#4b5d50># Gets the real name of widget from *.name*.</font></i>
    <i><font color=#4b5d50>#   refname - variable name for widget name</font></i>
    <i><font color=#4b5d50>#   refi - variable name for index in widget list</font></i>
    <i><font color=#4b5d50>#   reflwidgets - variable name for widget list</font></i>
    <i><font color=#4b5d50># The *.name* means &quot;child of some previous&quot; and should be normalized.</font></i>
    <i><font color=#4b5d50># Example:</font></i>
    <i><font color=#4b5d50>#   If parent: fra.fra .....</font></i>
    <i><font color=#4b5d50>#      child: .but</font></i>
    <i><font color=#4b5d50>#   =&gt; normalized: fra.fra.but</font></i>

    <b><font color=#3a6797>upvar</font></b> <font color=#1b1baa>$refname</font> name <font color=#1b1baa>$refi</font> i <font color=#1b1baa>$reflwidgets</font> lwidgets
    <b><font color=#3a6797>set</font></b> wname <font color=#1b1baa>$name</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$name</font> 0] eq {.}} {
      <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>-1}]} {<font color=#1b1baa>$i2</font> &gt;=0} {<b><font color=#3a6797>incr</font></b> i2 -1} {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i2</font>] name2
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$name2</font> 0] ne {.}} {
          <b><font color=#3a6797>set</font></b> name2 [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$name2</font>] 0]
          <b><font color=#3a6797>set</font></b> wname <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>name2<font color=#1b1baa>$</font>name&quot;</font>
          <b><font color=#3a6797>set</font></b> name [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$name</font>] 0]
          <b><font color=#3a6797>set</font></b> name <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>name2<font color=#1b1baa>$</font>name&quot;</font>
          <b><font color=#ca14ca>break</font></b>
        }
      }
    }
    <b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font> <font color=#1b1baa>$wname</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=WidgetNameFull></a>
  <b><font color=#ca14ca>method</font></b> WidgetNameFull {w name {an {}}} {
    <i><font color=#4b5d50># Gets a full name of a widget.</font></i>
    <i><font color=#4b5d50>#   w - name of root widget</font></i>
    <i><font color=#4b5d50>#   name - name of widget</font></i>
    <i><font color=#4b5d50>#   an - additional prefix for name</font></i>
    <i><font color=#4b5d50># See also: apave::sframe::content</font></i>

    <b><font color=#3a6797>set</font></b> wn [<b><font color=#3a6797>string</font></b> trim [<b><font color=#ca14ca>my</font></b> parentWName <font color=#1b1baa>$name</font>].<font color=#1b1baa>$an</font>[<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$name</font>] .]
    <b><font color=#3a6797>set</font></b> wnamefull <font color=#1b1baa>$w</font>.<font color=#1b1baa>$wn</font>
    <b><font color=#3a6797>set</font></b> wcc canvas.container.content ;<i><font color=#4b5d50># sframe.tcl may be not sourced</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i1 [<b><font color=#3a6797>string</font></b> first .scf <font color=#1b1baa>$wnamefull</font>]]&gt;0 && \
    [<b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>string</font></b> first . <font color=#1b1baa>$wnamefull</font> <font color=#1b1baa>$i1</font>+1]]&gt;0 && \
    [<b><font color=#3a6797>string</font></b> first .<font color=#1b1baa>$wcc</font>. <font color=#1b1baa>$wnamefull</font>]&lt;0} {
      <i><font color=#4b5d50># insert a container's name into a scrolled frame's child</font></i>
      <b><font color=#3a6797>set</font></b> wend [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$wnamefull</font> <font color=#1b1baa>$i2</font> end]
      <b><font color=#3a6797>set</font></b> wnamefull [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$wnamefull</font> 0 <font color=#1b1baa>$i2</font>]
      <b><font color=#3a6797>append</font></b> wnamefull <font color=#1b1baa>$wcc</font> <font color=#1b1baa>$wend</font>
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$wnamefull</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=dlgPath></a>
  <b><font color=#ca14ca>method</font></b> dlgPath {} {
    <i><font color=#4b5d50># Gets a window name of apave open dialogue.</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> res <font color=#1b1baa>$Dlgpath</font>}] || <font color=#1b1baa>$Dlgpath</font> eq {}} {
      <b><font color=#3a6797>set</font></b> res <font color=#1b1baa>$::apave::MODALWINDOW</font>
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=DiaWidgetName></a>
  <b><font color=#ca14ca>method</font></b> DiaWidgetName {w} {
    <i><font color=#4b5d50># Gets a widget name of apave dialogue.</font></i>
    <i><font color=#4b5d50>#   w - name of widget</font></i>
    <i><font color=#4b5d50># The name of widget may be partial. In this case it's prepended</font></i>
    <i><font color=#4b5d50># the current dialogue's frame path.</font></i>
    <i><font color=#4b5d50># Useful in &quot;input&quot; dialogue when -method option is present</font></i>
    <i><font color=#4b5d50># or widget names are uppercased.</font></i>
    <i><font color=#4b5d50># See also: MakeWidgetName, input</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$w</font> 0] eq {.}} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$w</font>}
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$Dlgpath</font>.fra.<font color=#1b1baa>$w</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=MakeWidgetName></a>
  <b><font color=#ca14ca>method</font></b> MakeWidgetName {w name {an {}}} {
    <i><font color=#4b5d50># Makes an exported method named after root widget, if it's uppercased.</font></i>
    <i><font color=#4b5d50>#   w - name of root widget</font></i>
    <i><font color=#4b5d50>#   name - name of widget</font></i>
    <i><font color=#4b5d50>#   an - additional prefix for name (if &quot;-&quot;, $w is full/partial name)</font></i>
    <i><font color=#4b5d50># The created method used for easy access to the widget's path.</font></i>
    <i><font color=#4b5d50># Example:</font></i>
    <i><font color=#4b5d50>#   fra1.fra2.fra3.Entry1</font></i>
    <i><font color=#4b5d50>#   =&gt; method Entry1 {} {...}</font></i>
    <i><font color=#4b5d50>#   ...</font></i>
    <i><font color=#4b5d50>#   my Entry1  ;# instead of .win.fra1.fra2.fra3.Entry1</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$an</font> eq {-}} {
      <b><font color=#3a6797>set</font></b> wnamefull <font color=#8b2a0e>&quot;\[my DiaWidgetName <font color=#1b1baa>$</font>w\]&quot;</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> wnamefull [<b><font color=#ca14ca>my</font></b> WidgetNameFull <font color=#1b1baa>$w</font> <font color=#1b1baa>$name</font> <font color=#1b1baa>$an</font>]
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$wnamefull</font>] wnamefull
    }
    <b><font color=#3a6797>set</font></b> method [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$name</font>]
    <b><font color=#3a6797>set</font></b> root1 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$method</font> 0]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is upper <font color=#1b1baa>$root1</font>]} {
      <b><font color=#ca14ca>oo::objdefine</font></b> [<b><font color=#ca14ca>self</font></b>] <font color=#8b2a0e>&quot;method <font color=#1b1baa>$</font>method <font color=#1b1baa>{}</font> <font color=#1b1baa>{</font>return <font color=#1b1baa>$</font>wnamefull<font color=#1b1baa>}</font> ; \</font>
<font color=#8b2a0e>        export <font color=#1b1baa>$</font>method&quot;</font>
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$wnamefull</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=AddPopupAttr></a>
  <b><font color=#ca14ca>method</font></b> AddPopupAttr {w attrsName atRO isRO args} {
    <i><font color=#4b5d50># Adds the attribute to call a popup menu for an editable widget.</font></i>
    <i><font color=#4b5d50>#   w - widget's name</font></i>
    <i><font color=#4b5d50>#   attrsName - variable name for attributes of widget</font></i>
    <i><font color=#4b5d50>#   atRO - &quot;readonly&quot; attribute (internally used)</font></i>
    <i><font color=#4b5d50>#   isRO - flag of readonly widget</font></i>
    <i><font color=#4b5d50>#   args - widget states to be checked</font></i>

    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$attrsName</font> attrs
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> state state2
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$state2</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {[::apave::getOption <font color=#653760>-state</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] eq <font color=#1b1baa>$state2</font>} <b><font color=#ca14ca>return</font></b>
      <b><font color=#3a6797>set</font></b> isRO [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$isRO</font> || [::apave::getOption <font color=#653760>-state</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] eq <font color=#1b1baa>$state</font>}]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$isRO</font>} {<b><font color=#3a6797>append</font></b> atRO RO}
    <b><font color=#3a6797>append</font></b> attrs <font color=#8b2a0e>&quot; <font color=#1b1baa>$</font>atRO <font color=#1b1baa>$</font>w&quot;</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=clearEntry></a>
  <b><font color=#ca14ca>method</font></b> clearEntry {w clearcom} {
    <i><font color=#4b5d50># Clears entry-like widget's value, after calling a command.</font></i>
    <i><font color=#4b5d50>#   w - widget's path</font></i>
    <i><font color=#4b5d50>#   clearcom - a command to call, can have %w for *w* (widget's path)</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clearcom</font> ne {}} {
      {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$w</font> %p [<b><font color=#ca14ca>self</font></b>]] <font color=#1b1baa>$clearcom</font>]
    }
    <i><font color=#ff0000>#! perhaps, needs refactoring:</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$w</font> delete 0 end}]} { ;<i><font color=#4b5d50># entry</font></i>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$w</font> set {}}]} {     ;<i><font color=#4b5d50># combobox</font></i>
        <i><font color=#4b5d50># others</font></i>
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=makePopup></a>
  <b><font color=#ca14ca>method</font></b> makePopup {w {isRO no} {istext no} {tearoff no} {addpop <font color=#8b2a0e>&quot;&quot;</font>} {clearcom <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Makes a popup menu for an editable widget.</font></i>
    <i><font color=#4b5d50>#   w - widget's name</font></i>
    <i><font color=#4b5d50>#   isRO - flag for &quot;is it readonly&quot;</font></i>
    <i><font color=#4b5d50>#   istext - flag for &quot;is it a text&quot;</font></i>
    <i><font color=#4b5d50>#   tearoff - flag for &quot;-tearoff&quot; option</font></i>
    <i><font color=#4b5d50>#   addpop - additional commands for popup menu</font></i>
    <i><font color=#4b5d50>#   clearcom - command for &quot;Clear&quot; item</font></i>

    <b><font color=#3a6797>set</font></b> pop <font color=#1b1baa>$w</font>.popupMenu
    <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>menu</font></b> <font color=#1b1baa>$pop</font> <font color=#653760>-tearoff</font> <font color=#1b1baa>$tearoff</font>}
    <font color=#1b1baa>$pop</font> delete 0 end
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$isRO</font> || [<font color=#1b1baa>$w</font> cget <font color=#653760>-state</font>] eq {disabled}} {
      <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA copy] <font color=#653760>-accelerator</font> Ctrl+C <font color=#653760>-label</font> Copy \
        <font color=#653760>-command</font> <font color=#8b2a0e>&quot;event generate <font color=#1b1baa>$</font>w &lt;&lt;Copy&gt;&gt;&quot;</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$istext</font>} {
        <b><font color=#3a6797>eval</font></b> [<b><font color=#ca14ca>my</font></b> popupHighlightCommands <font color=#1b1baa>$pop</font> <font color=#1b1baa>$w</font>]
        <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] set_highlight_matches <font color=#1b1baa>$w</font>]
      }
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$istext</font>} {
        ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;&lt;Copy&gt;&gt; ::apave::eventOnText <font color=#1b1baa>$w</font> &lt;&lt;Copy&gt;&gt;
        ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;&lt;Cut&gt;&gt; ::apave::eventOnText <font color=#1b1baa>$w</font> &lt;&lt;Cut&gt;&gt;
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA cut] <font color=#653760>-accelerator</font> Ctrl+X <font color=#653760>-label</font> Cut \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;event generate <font color=#1b1baa>$</font>w &lt;&lt;Cut&gt;&gt;&quot;</font>
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA copy] <font color=#653760>-accelerator</font> Ctrl+C <font color=#653760>-label</font> Copy \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;event generate <font color=#1b1baa>$</font>w &lt;&lt;Copy&gt;&gt;&quot;</font>
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA paste] <font color=#653760>-accelerator</font> Ctrl+V <font color=#653760>-label</font> Paste \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;::apave::eventOnText <font color=#1b1baa>$</font>w &lt;&lt;Paste&gt;&gt;&quot;</font>
        <font color=#1b1baa>$pop</font> add separator
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA undo] <font color=#653760>-accelerator</font> Ctrl+Z <font color=#653760>-label</font> Undo \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;::apave::eventOnText <font color=#1b1baa>$</font>w &lt;&lt;Undo&gt;&gt;&quot;</font>
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA redo] <font color=#653760>-accelerator</font> Ctrl+Shift+Z <font color=#653760>-label</font> Redo \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;::apave::eventOnText <font color=#1b1baa>$</font>w &lt;&lt;Redo&gt;&gt;&quot;</font>
        <b><font color=#3a6797>catch</font></b> {
          <b><font color=#3a6797>eval</font></b> [<b><font color=#ca14ca>my</font></b> popupBlockCommands <font color=#1b1baa>$pop</font> <font color=#1b1baa>$w</font>]
          <b><font color=#3a6797>eval</font></b> [<b><font color=#ca14ca>my</font></b> popupHighlightCommands <font color=#1b1baa>$pop</font> <font color=#1b1baa>$w</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$addpop</font> ne {}} {
            <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$addpop</font> com par1 par2
            <b><font color=#3a6797>eval</font></b> [<b><font color=#ca14ca>my</font></b> <font color=#1b1baa>$com</font> <font color=#1b1baa>$pop</font> <font color=#1b1baa>$w</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$par1</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$par2</font>]
          }
          <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] set_highlight_matches <font color=#1b1baa>$w</font>]
          <b><font color=#3a6797>after</font></b> idle [<b><font color=#ca14ca>my</font></b> setTextBinds <font color=#1b1baa>$w</font>]
        }
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clearcom</font> ne {}} {
          <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA no] <font color=#653760>-label</font> Clear \
            <font color=#653760>-command</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] clearEntry <font color=#1b1baa>$w</font> <font color=#1b1baa>$clearcom</font>]
          <font color=#1b1baa>$pop</font> add separator
        }
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA cut] <font color=#653760>-accelerator</font> Ctrl+X <font color=#653760>-label</font> Cut \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;event generate <font color=#1b1baa>$</font>w &lt;&lt;Cut&gt;&gt;&quot;</font>
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA copy] <font color=#653760>-accelerator</font> Ctrl+C <font color=#653760>-label</font> Copy \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;event generate <font color=#1b1baa>$</font>w &lt;&lt;Copy&gt;&gt;&quot;</font>
        <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA paste] <font color=#653760>-accelerator</font> Ctrl+V <font color=#653760>-label</font> Paste \
          <font color=#653760>-command</font> <font color=#8b2a0e>&quot;event generate <font color=#1b1baa>$</font>w &lt;&lt;Paste&gt;&gt;&quot;</font>
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$istext</font>} {
      <font color=#1b1baa>$pop</font> add separator
      <font color=#1b1baa>$pop</font> add command {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> iconA none] <font color=#653760>-accelerator</font> Ctrl+A <font color=#653760>-label</font> {Select All} \
        <font color=#653760>-command</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>w tag add sel 1.0 end&quot;</font>
      <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> &lt;Control-a&gt; <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>w tag add sel 1.0 end; break&quot;</font>
    }
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> &lt;Button-3&gt; <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> themePopup <font color=#1b1baa>$</font>w.popupMenu; tk_popup <font color=#1b1baa>$</font>w.popupMenu %X %Y&quot;</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Pre></a>
  <b><font color=#ca14ca>method</font></b> Pre {refattrs} {
    <i><font color=#4b5d50># &quot;Pre&quot; actions for the text widget and similar</font></i>
    <i><font color=#4b5d50># which all require some actions before and after their creation e.g.:</font></i>
    <i><font color=#4b5d50>#   the text widget's text cannot be filled if disabled</font></i>
    <i><font color=#4b5d50>#   so, we must act this way:</font></i>
    <i><font color=#4b5d50>#     1. call Pre - to get a text of widget</font></i>
    <i><font color=#4b5d50>#     2. create the widget</font></i>
    <i><font color=#4b5d50>#     3. call Post - to enable, then fill it with a text, then disable it</font></i>
    <i><font color=#4b5d50># It's only possible with Pre and Post methods.</font></i>
    <i><font color=#4b5d50># See also: Post</font></i>

    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$refattrs</font> attrs
    <b><font color=#3a6797>set</font></b> attrs_ret [<b><font color=#3a6797>set</font></b> Prepost [<b><font color=#3a6797>list</font></b>]]
    <b><font color=#3a6797>foreach</font></b> {a v} <font color=#1b1baa>$attrs</font> {
      <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$a</font> {
        <font color=#653760>-disabledtext</font> - <font color=#653760>-rotext</font> - <font color=#653760>-lbxsel</font> - <font color=#653760>-cbxsel</font> - <font color=#653760>-notebazook</font> - \
        <font color=#653760>-entrypop</font> - <font color=#653760>-entrypopRO</font> - <font color=#653760>-textpop</font> - <font color=#653760>-textpopRO</font> - <font color=#653760>-ListboxSel</font> - \
        <font color=#653760>-callF2</font> - <font color=#653760>-timeout</font> - <font color=#653760>-bartabs</font> - <font color=#653760>-onReturn</font> - <font color=#653760>-linkcom</font> - <font color=#653760>-selcombobox</font> - \
        <font color=#653760>-afteridle</font> - <font color=#653760>-gutter</font> - <font color=#653760>-propagate</font> - <font color=#653760>-columnoptions</font> - <font color=#653760>-selborderwidth</font> -
        <font color=#653760>-selected</font> - <font color=#653760>-popup</font> - <font color=#653760>-bindEC</font> - <font color=#653760>-tags</font> - <font color=#653760>-debug</font> - <font color=#653760>-clearcom</font> {
          <i><font color=#4b5d50># attributes specific to apave, processed below in &quot;Post&quot;</font></i>
          <b><font color=#3a6797>set</font></b> v2 [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$v</font> \{]
          <b><font color=#3a6797>set</font></b> v2 [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$v2</font> 0 end-[<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$v</font>]-[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$v2</font>]}]]
          <b><font color=#3a6797>lappend</font></b> Prepost [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$a</font> <font color=#1b1baa>$v2</font>]
        }
        <font color=#653760>-myown</font> {
          <b><font color=#3a6797>lappend</font></b> Prepost [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$a</font> [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$v</font>]]
        }
        <font color=#653760>-labelwidget</font> { ;<i><font color=#4b5d50># widget path as a method</font></i>
          <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$v</font> \{\}]
          <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> v [<b><font color=#ca14ca>my</font></b> <font color=#1b1baa>$v</font>]}
          <b><font color=#3a6797>lappend</font></b> attrs_ret <font color=#1b1baa>$a</font> <font color=#1b1baa>$v</font>
        }
        <b><font color=#3a6797>default</font></b> {
          <b><font color=#3a6797>lappend</font></b> attrs_ret <font color=#1b1baa>$a</font> <font color=#1b1baa>$v</font>
        }
      }
    }
    <b><font color=#3a6797>set</font></b> attrs <font color=#1b1baa>$attrs_ret</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Post></a>
  <b><font color=#ca14ca>method</font></b> Post {w attrs} {
    <i><font color=#4b5d50># Performes &quot;post&quot; actions after creation a widget.</font></i>
    <i><font color=#4b5d50>#   w - widget's path</font></i>
    <i><font color=#4b5d50>#   attrs - widget's attributes</font></i>
    <i><font color=#4b5d50># Processes the same *apave* options that are processed in Pre method.</font></i>
    <i><font color=#4b5d50># See also: Pre</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#653760>-index</font> 0 <font color=#1b1baa>$Prepost</font> <font color=#653760>-tags</font>]]&gt;-1} {
      <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$Prepost</font> <font color=#1b1baa>$i</font> 1]
      <b><font color=#3a6797>set</font></b> tags [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$v</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> tags {}
    }
    <b><font color=#3a6797>foreach</font></b> pp <font color=#1b1baa>$Prepost</font> {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$pp</font> a v
      <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$v</font> <font color=#1b1baa>$::apave::UFF</font>]
      <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- <font color=#1b1baa>$a</font> {
        <font color=#653760>-disabledtext</font> {
          <font color=#1b1baa>$w</font> configure <font color=#653760>-state</font> normal
          <b><font color=#ca14ca>my</font></b> displayTaggedText <font color=#1b1baa>$w</font> v <font color=#1b1baa>$tags</font>
          <font color=#1b1baa>$w</font> configure <font color=#653760>-state</font> disabled
          <b><font color=#ca14ca>my</font></b> readonlyWidget <font color=#1b1baa>$w</font> no
        }
        <font color=#653760>-rotext</font> {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exist v]} {
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exist <font color=#1b1baa>$v</font>]} {
              <b><font color=#ca14ca>my</font></b> displayTaggedText <font color=#1b1baa>$w</font> <font color=#1b1baa>$v</font> <font color=#1b1baa>$tags</font>
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#ca14ca>my</font></b> displayTaggedText <font color=#1b1baa>$w</font> v <font color=#1b1baa>$tags</font>
            }
          }
          <b><font color=#ca14ca>my</font></b> readonlyWidget <font color=#1b1baa>$w</font> yes
        }
        <font color=#653760>-lbxsel</font> {
          <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-glob</font> [<font color=#1b1baa>$w</font> get 0 end] <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>v*&quot;</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$v</font>&gt;=0} {
            <font color=#1b1baa>$w</font> selection set <font color=#1b1baa>$v</font>
            <font color=#1b1baa>$w</font> yview <font color=#1b1baa>$v</font>
            <font color=#1b1baa>$w</font> activate <font color=#1b1baa>$v</font>
          }
          <b><font color=#ca14ca>my</font></b> UpdateSelectAttrs <font color=#1b1baa>$w</font>
        }
        <font color=#653760>-cbxsel</font> {
          <b><font color=#3a6797>set</font></b> cbl [<font color=#1b1baa>$w</font> cget <font color=#653760>-values</font>]
          <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-glob</font> <font color=#1b1baa>$cbl</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>v*&quot;</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$v</font>&gt;=0} { <font color=#1b1baa>$w</font> set [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$cbl</font> <font color=#1b1baa>$v</font>] }
        }
        <font color=#653760>-ListboxSel</font> {
          <b><font color=#134070>bind</font></b> <font color=#1b1baa>$v</font> &lt;&lt;ListboxSelect&gt;&gt; [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>namespace</font></b> current]::ListboxSelect %W]
        }
        <font color=#653760>-entrypop</font> - <font color=#653760>-entrypopRO</font> {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$v</font>]} {
            <b><font color=#ca14ca>my</font></b> makePopup <font color=#1b1baa>$v</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$a</font> eq {<font color=#653760>-entrypopRO</font>}}]
          }
        }
        <font color=#653760>-clearcom</font> {
          <b><font color=#ca14ca>my</font></b> makePopup <font color=#1b1baa>$w</font> no no no {} <font color=#1b1baa>$v</font>   ;<i><font color=#4b5d50># popup menu with &quot;Clear&quot; command</font></i>
        }
        <font color=#653760>-textpop</font> - <font color=#653760>-textpopRO</font> {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$v</font>]} {
            <b><font color=#3a6797>set</font></b> ro [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$a</font> eq {<font color=#653760>-textpopRO</font>}}]
            <b><font color=#ca14ca>my</font></b> makePopup <font color=#1b1baa>$v</font> <font color=#1b1baa>$ro</font> yes
            <b><font color=#3a6797>set</font></b> w <font color=#1b1baa>$v</font>
          } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$v</font>]&gt;5} {
            <b><font color=#ca14ca>my</font></b> makePopup <font color=#1b1baa>$w</font> no yes no <font color=#1b1baa>$v</font>
          }
          <font color=#1b1baa>$w</font> tag configure sel <font color=#653760>-borderwidth</font> 1
        }
        <font color=#653760>-notebazook</font> {
          <b><font color=#3a6797>foreach</font></b> {fr attr} <font color=#1b1baa>$v</font> {
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-tr</font>* <font color=#1b1baa>$fr</font>]} {
              <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is boolean <font color=#653760>-strict</font> <font color=#1b1baa>$attr</font>] && <font color=#1b1baa>$attr</font>} {
                ttk::notebook::enableTraversal <font color=#1b1baa>$w</font>
              }
            } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#653760>-sel</font>* <font color=#1b1baa>$fr</font>]} {
              <font color=#1b1baa>$w</font> select <font color=#1b1baa>$w</font>.<font color=#1b1baa>$attr</font>
            } <b><font color=#3a6797>elseif</font></b> {![<b><font color=#3a6797>string</font></b> match #* <font color=#1b1baa>$fr</font>]} {
              <b><font color=#3a6797>set</font></b> attr [<b><font color=#ca14ca>my</font></b> GetMC <font color=#1b1baa>$attr</font>]
              <b><font color=#3a6797>set</font></b> attr [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$attr</font>]
              <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attr <font color=#653760>-tip</font> {} <font color=#653760>-tooltip</font> {}] tip t2
              <b><font color=#3a6797>set</font></b> wt <font color=#1b1baa>$w</font>.<font color=#1b1baa>$fr</font>
              <font color=#1b1baa>$w</font> add [<b><font color=#134070>ttk::frame</font></b> <font color=#1b1baa>$wt</font>] {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attr</font>
              <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>append</font></b> tip <font color=#1b1baa>$t2</font>] ne {}} {
                <b><font color=#3a6797>set</font></b> tip [<b><font color=#ca14ca>my</font></b> MC <font color=#1b1baa>$tip</font>]
                ::baltip::tip <font color=#1b1baa>$w</font> <font color=#1b1baa>$tip</font> <font color=#653760>-nbktab</font> <font color=#1b1baa>$wt</font>
              }
            }
          }
        }
        <font color=#653760>-gutter</font> {
          <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$v</font> <font color=#653760>-canvas</font> Gut <font color=#653760>-width</font> 5 <font color=#653760>-shift</font> 6] canvas width shift
          <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$canvas</font>]} {<b><font color=#3a6797>set</font></b> canvas [<b><font color=#ca14ca>my</font></b> <font color=#1b1baa>$canvas</font>]}
          <b><font color=#3a6797>set</font></b> bind [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] fillGutter <font color=#1b1baa>$w</font> <font color=#1b1baa>$canvas</font> <font color=#1b1baa>$width</font> <font color=#1b1baa>$shift</font>]
          <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> &lt;Configure&gt; <font color=#1b1baa>$bind</font>
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>trace</font></b> info execution <font color=#1b1baa>$w</font>] eq {}} {
            <b><font color=#3a6797>trace</font></b> add execution <font color=#1b1baa>$w</font> leave <font color=#1b1baa>$bind</font>
          }
        }
        <font color=#653760>-onReturn</font> {   ;<i><font color=#4b5d50># makes a command run at Enter key pressing</font></i>
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$v</font> cmd from to
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> tvar [<font color=#1b1baa>$w</font> cget <font color=#653760>-textvariable</font>]] ne {}} {
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$from</font> ne {}} {
              <b><font color=#3a6797>set</font></b> cmd <font color=#8b2a0e>&quot;if <font color=#1b1baa>{</font>\$<font color=#1b1baa>$</font>tvar &lt; <font color=#1b1baa>$</font>from<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>set <font color=#1b1baa>$</font>tvar <font color=#1b1baa>$</font>from<font color=#1b1baa>}</font>; <font color=#1b1baa>$</font>cmd&quot;</font>
            }
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$to</font> ne {}} {
              <b><font color=#3a6797>set</font></b> cmd <font color=#8b2a0e>&quot;if <font color=#1b1baa>{</font>\$<font color=#1b1baa>$</font>tvar &gt;<font color=#1b1baa>$</font>to<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>set <font color=#1b1baa>$</font>tvar <font color=#1b1baa>$</font>to<font color=#1b1baa>}</font>; <font color=#1b1baa>$</font>cmd&quot;</font>
            }
          }
          <b><font color=#3a6797>foreach</font></b> k {&lt;Return&gt; &lt;KP_Enter&gt;} {
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$v</font> ne {}} {<b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> <font color=#1b1baa>$k</font> <font color=#1b1baa>$cmd</font>}
          }
        }
        <font color=#653760>-linkcom</font> {
          <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] fg fg2 bg bg2
          <b><font color=#ca14ca>my</font></b> makeLabelLinked <font color=#1b1baa>$w</font> <font color=#1b1baa>$v</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fg2</font> <font color=#1b1baa>$bg2</font> yes yes
        }
        <font color=#653760>-callF2</font> {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$v</font>]==1} {<b><font color=#3a6797>set</font></b> w2 <font color=#1b1baa>$v</font>} {<b><font color=#3a6797>set</font></b> w2 [<b><font color=#3a6797>string</font></b> map <font color=#1b1baa>$v</font> <font color=#1b1baa>$w</font>]}
          ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;F2&gt; <font color=#1b1baa>$w2</font> invoke
        }
        <font color=#653760>-bindEC</font> {
          <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$w</font>] <font color=#1b1baa>$v</font>]
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$v</font> ev com
          ::apave::bindToEvent <font color=#1b1baa>$w</font> <font color=#1b1baa>$ev</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$com</font>
          <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> -- [<b><font color=#134070>winfo</font></b> class <font color=#1b1baa>$w</font>] {
            Treeview {
              ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;ButtonPress&gt; <b><font color=#134070>selection</font></b> clear
              ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;KeyPress&gt; <b><font color=#134070>selection</font></b> clear
            }
            Listbox {
              ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;ButtonPress&gt; <b><font color=#134070>selection</font></b> clear
              ::apave::bindToEvent <font color=#1b1baa>$w</font> &lt;KeyPress&gt; <b><font color=#134070>selection</font></b> clear
            }
          }
        }
        <font color=#653760>-timeout</font> {
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$v</font> timo lbl
          <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] timeoutButton <font color=#1b1baa>$w</font> <font color=#1b1baa>$timo</font> <font color=#1b1baa>$lbl</font>]
        }
        <font color=#653760>-myown</font> {
          <b><font color=#3a6797>eval</font></b> {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$w</font>] <font color=#1b1baa>$v</font>]
        }
        <font color=#653760>-bartabs</font> {
          <b><font color=#3a6797>after</font></b> 10 [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$w</font>] <font color=#1b1baa>$v</font>]
        }
        <font color=#653760>-afteridle</font> {
          <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$w</font>] <font color=#1b1baa>$v</font>]
        }
        <font color=#653760>-propagate</font> {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$v</font> 0] in {add pack}} {
            <b><font color=#134070>pack</font></b> propagate <font color=#1b1baa>$w</font> 0
          } <b><font color=#3a6797>else</font></b> {
            <b><font color=#134070>grid</font></b> propagate <font color=#1b1baa>$w</font> 0
          }
        }
        <font color=#653760>-columnoptions</font> {
          <b><font color=#3a6797>foreach</font></b> {col opts} <font color=#1b1baa>$v</font> {
            <font color=#1b1baa>$w</font> column <font color=#1b1baa>$col</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opts</font>
          }
        }
        <font color=#653760>-selborderwidth</font> {
          <font color=#1b1baa>$w</font> tag configure sel <font color=#653760>-borderwidth</font> <font color=#1b1baa>$v</font>
        }
        <font color=#653760>-selcombobox</font> {
          <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> &lt;&lt;ComboboxSelected&gt;&gt; <font color=#1b1baa>$v</font>
        }
        <font color=#653760>-selected</font> {
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is true <font color=#1b1baa>$v</font>]} {
            <b><font color=#3a6797>after</font></b> idle <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>w selection range 0 end&quot;</font>
          }
        }
        <font color=#653760>-popup</font> {
          <b><font color=#3a6797>after</font></b> 50 <font color=#8b2a0e>&quot;bind <font color=#1b1baa>$</font>w &lt;Button-3&gt; <font color=#1b1baa>{$</font>v<font color=#1b1baa>}</font>&quot;</font> ;<i><font color=#4b5d50># redefines other possible popups</font></i>
        }
        <font color=#653760>-debug</font> {
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$v</font>} {
            <i><font color=#4b5d50># puts out the widget's name and (if exists) its method</font></i>
            <b><font color=#3a6797>set</font></b> method [<b><font color=#3a6797>string</font></b> toupper [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$w</font>] 0]
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$method</font> in [<b><font color=#3a6797>info</font></b> object methods [<b><font color=#ca14ca>self</font></b>]]} {
              <b><font color=#3a6797>set</font></b> method <font color=#8b2a0e>&quot;  METHOD: <font color=#1b1baa>$</font>method&quot;</font>
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> method {}
            }
            <b><font color=#3a6797>puts</font></b> <font color=#8b2a0e>&quot;WIDGET: <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>method&quot;</font>
          }
        }
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=CleanUps></a>
  <b><font color=#ca14ca>method</font></b> CleanUps {{wr <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Performs various clean-ups before and after showing a window.</font></i>
    <i><font color=#4b5d50>#   wr - window's path (to clean up at closing)</font></i>

    <i><font color=#4b5d50># Cleans the unused widgets from _AP_VISITED list</font></i>
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$::apave::_AP_VISITED(ALL)</font>]} {[<b><font color=#3a6797>incr</font></b> i -1]&gt;=0} {} {
      <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$::apave::_AP_VISITED(ALL)</font> <font color=#1b1baa>$i</font> 0]]} {
        <b><font color=#3a6797>set</font></b> ::apave::_AP_VISITED(ALL) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$::apave::_AP_VISITED(ALL)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wr</font> ne {}} {
      <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$::apave::_AP_VARS(TIMW)</font>]} {[<b><font color=#3a6797>incr</font></b> i -1]&gt;=0} {} {
        <b><font color=#3a6797>set</font></b> w [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$::apave::_AP_VARS(TIMW)</font> <font color=#1b1baa>$i</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$wr</font> <font color=#1b1baa>$w</font>]==0 && ![<b><font color=#3a6797>catch</font></b> {::baltip::hide <font color=#1b1baa>$w</font>}]} {
          <b><font color=#3a6797>set</font></b> ::apave::_AP_VARS(TIMW) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$::apave::_AP_VARS(TIMW)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
        }
      }
      <b><font color=#3a6797>foreach</font></b> {lst vars} [<b><font color=#3a6797>array</font></b> get ::apave::_AP_VARS <font color=#8b2a0e>&quot;_TRACED_<font color=#1b1baa>${</font>wr<font color=#1b1baa>}</font>*&quot;</font>] {
        <b><font color=#3a6797>foreach</font></b> v <font color=#1b1baa>$vars</font> {
          ::apave::traceRemove <font color=#1b1baa>$v</font>
        }
        <b><font color=#3a6797>set</font></b> ::apave::_AP_VARS(<font color=#1b1baa>$lst</font>) [<b><font color=#3a6797>list</font></b>]
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=UpdateColors></a>
  <b><font color=#ca14ca>method</font></b> UpdateColors {} {
    <i><font color=#4b5d50># Updates colors of widgets at changing CS.</font></i>

    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] fg fg2 bg bg2 - - - - - fg3
    <i><font color=#4b5d50># Visited labels:</font></i>
    <b><font color=#ca14ca>my</font></b> CleanUps
    <b><font color=#3a6797>foreach</font></b> lw <font color=#1b1baa>$::apave::_AP_VISITED(ALL)</font> {  ;<i><font color=#4b5d50># mark the same links</font></i>
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$lw</font> w v inv
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> makeLabelLinked <font color=#1b1baa>$w</font> <font color=#1b1baa>$v</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fg2</font> <font color=#1b1baa>$bg2</font> no <font color=#1b1baa>$inv</font>] fg0 bg0
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::apave::_AP_VISITED(FG,<font color=#1b1baa>$w</font>)]} {
        <b><font color=#3a6797>set</font></b> fg0 <font color=#1b1baa>$fg3</font>
        <b><font color=#3a6797>set</font></b> ::apave::_AP_VISITED(FG,<font color=#1b1baa>$w</font>) <font color=#1b1baa>$fg3</font>
      }
      <font color=#1b1baa>$w</font> configure <font color=#653760>-foreground</font> <font color=#1b1baa>$fg0</font> <font color=#653760>-background</font> <font color=#1b1baa>$bg0</font>
    }
  }
<a id=Links_in_labels></a>
  <i><font color=#4b5d50>## ________________________ Links in labels _________________________ ##</font></i>
<a id=initLinkFont></a>
  <b><font color=#ca14ca>method</font></b> initLinkFont {args} {
    <i><font color=#4b5d50># Gets/sets font attributes of links (labels & text tags with -link).</font></i>
    <i><font color=#4b5d50>#  args - font attributes (&quot;-underline 1&quot; by default)</font></i>
    <i><font color=#4b5d50># Returns the current value of these attributes.</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> ll [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$args</font>]]} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ll</font>%2} {   ;<i><font color=#4b5d50># clear the attributes, if called with &quot;&quot;</font></i>
        <b><font color=#3a6797>set</font></b> ::apave::_AP_VARS(LINKFONT) [<b><font color=#3a6797>list</font></b>]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-foreground</font> {} <font color=#653760>-background</font> {}] \
          ::apave::_AP_VARS(LINKFG) ::apave::_AP_VARS(LINKBG)
        <b><font color=#3a6797>set</font></b> ::apave::_AP_VARS(LINKFONT) <font color=#1b1baa>$args</font>
      }
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$::apave::_AP_VARS(LINKFONT)</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=labelFlashing></a>
  <b><font color=#ca14ca>method</font></b> labelFlashing {w1 w2 first args} {
    <i><font color=#4b5d50># Options of 'flashing' label:</font></i>
    <i><font color=#4b5d50>#   -file (or -data) {list of image files (or data variables)}</font></i>
    <i><font color=#4b5d50>#   -label {list of labels' texts}</font></i>
    <i><font color=#4b5d50>#   -incr {increment for -alpha option}</font></i>
    <i><font color=#4b5d50>#   -pause {pause in seconds for -alpha 1.0}</font></i>
    <i><font color=#4b5d50>#   -after {interval for 'after'}</font></i>
    <i><font color=#4b5d50>#   -squeeze {value for *-big.png}</font></i>

    <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$w1</font>]} <b><font color=#ca14ca>return</font></b>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$first</font>} {
      <b><font color=#3a6797>lassign</font></b> [::apave::parseOptions <font color=#1b1baa>$args</font> \
        <font color=#653760>-file</font> {} <font color=#653760>-data</font> {} <font color=#653760>-label</font> {} <font color=#653760>-incr</font> 0.01 <font color=#653760>-pause</font> 3.0 <font color=#653760>-after</font> 10 <font color=#653760>-squeeze</font> {} <font color=#653760>-static</font> 0] \
        ofile odata olabel oincr opause oafter osqueeze ostatic
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$osqueeze</font> ne {}} {<b><font color=#3a6797>set</font></b> osqueeze <font color=#8b2a0e>&quot;-subsample <font color=#1b1baa>$</font>osqueeze&quot;</font>}
      <b><font color=#3a6797>lassign</font></b> {0 -2 0 1} idx incev waitev direv
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$args</font> ofile odata olabel oincr opause oafter osqueeze ostatic \
        idx incev waitev direv
    }
    <b><font color=#3a6797>set</font></b> llf [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$ofile</font>]
    <b><font color=#3a6797>set</font></b> lld [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$odata</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> llen [<b><font color=#3a6797>expr</font></b> {max(<font color=#1b1baa>$llf</font>,<font color=#1b1baa>$lld</font>)}]]==0} <b><font color=#ca14ca>return</font></b>
    <b><font color=#3a6797>incr</font></b> incev <font color=#1b1baa>$direv</font>
    <b><font color=#3a6797>set</font></b> alphaev [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$oincr</font>*<font color=#1b1baa>$incev</font>}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$alphaev</font>&gt;=1} {
      <b><font color=#3a6797>set</font></b> alpha 1.0
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> waitev -1]&lt;0} {
        <b><font color=#3a6797>set</font></b> direv -1
      }
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$alphaev</font>&lt;0} {
      <b><font color=#3a6797>set</font></b> alpha 0.0
      <b><font color=#3a6797>set</font></b> idx [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$idx</font>%<font color=#1b1baa>$llen</font>+1}]
      <b><font color=#3a6797>set</font></b> direv 1
      <b><font color=#3a6797>set</font></b> incev 0
      <b><font color=#3a6797>set</font></b> waitev [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$opause</font>/<font color=#1b1baa>$oincr</font>)}]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> alpha <font color=#1b1baa>$alphaev</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$llf</font>} {
      <b><font color=#3a6797>set</font></b> png [<b><font color=#3a6797>list</font></b> <font color=#653760>-file</font> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$ofile</font> <font color=#1b1baa>$idx</font>-1]]
    } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>info</font></b> exists [<b><font color=#3a6797>set</font></b> datavar [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$odata</font> <font color=#1b1baa>$idx</font>-1]]]} {
      <b><font color=#3a6797>set</font></b> png [<b><font color=#3a6797>list</font></b> <font color=#653760>-data</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$datavar</font>]]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> png [<b><font color=#3a6797>list</font></b> <font color=#653760>-data</font> <font color=#1b1baa>$odata</font>]
    }
    <b><font color=#3a6797>set</font></b> NS [<b><font color=#3a6797>namespace</font></b> current]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ostatic</font>} {
      <b><font color=#134070>image</font></b> create photo <font color=#1b1baa>${NS}</font>::ImgT<font color=#1b1baa>$w1</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$png</font>
      <font color=#1b1baa>$w1</font> configure <font color=#653760>-image</font> <font color=#1b1baa>${NS}</font>::ImgT<font color=#1b1baa>$w1</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#134070>image</font></b> create photo <font color=#1b1baa>${NS}</font>::ImgT<font color=#1b1baa>$w1</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$png</font> <font color=#653760>-format</font> <font color=#8b2a0e>&quot;png -alpha <font color=#1b1baa>$</font>alpha&quot;</font>
      <b><font color=#134070>image</font></b> create photo <font color=#1b1baa>${NS}</font>::Img<font color=#1b1baa>$w1</font>
      <font color=#1b1baa>${NS}</font>::Img<font color=#1b1baa>$w1</font> copy <font color=#1b1baa>${NS}</font>::ImgT<font color=#1b1baa>$w1</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$osqueeze</font>
      <font color=#1b1baa>$w1</font> configure <font color=#653760>-image</font> <font color=#1b1baa>${NS}</font>::Img<font color=#1b1baa>$w1</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$w2</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$alphaev</font>&lt;0.33 && !<font color=#1b1baa>$ostatic</font>} {
        <b><font color=#3a6797>set</font></b> fg [<font color=#1b1baa>$w1</font> cget <font color=#653760>-background</font>]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::apave::_AP_VISITED(FG,<font color=#1b1baa>$w2</font>)]} {
          <b><font color=#3a6797>set</font></b> fg <font color=#1b1baa>$::apave::_AP_VISITED(FG,$w2)</font>
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> fg [<font color=#1b1baa>$w1</font> cget <font color=#653760>-foreground</font>]
        }
      }
      <font color=#1b1baa>$w2</font> configure <font color=#653760>-text</font> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$olabel</font> <font color=#1b1baa>$idx</font>-1] <font color=#653760>-foreground</font> <font color=#1b1baa>$fg</font>
    }
    <b><font color=#3a6797>after</font></b> <font color=#1b1baa>$oafter</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] labelFlashing <font color=#1b1baa>$w1</font> <font color=#1b1baa>$w2</font> 0 \
      <font color=#1b1baa>$ofile</font> <font color=#1b1baa>$odata</font> <font color=#1b1baa>$olabel</font> <font color=#1b1baa>$oincr</font> <font color=#1b1baa>$opause</font> <font color=#1b1baa>$oafter</font> <font color=#1b1baa>$osqueeze</font> <font color=#1b1baa>$ostatic</font> \
      <font color=#1b1baa>$idx</font> <font color=#1b1baa>$incev</font> <font color=#1b1baa>$waitev</font> <font color=#1b1baa>$direv</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=VisitedLab></a>
  <b><font color=#ca14ca>method</font></b> VisitedLab {w cmd {on <font color=#8b2a0e>&quot;&quot;</font>} {fg <font color=#8b2a0e>&quot;&quot;</font>} {bg <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Marks a label as visited/not visited</font></i>
    <i><font color=#4b5d50>#   w - label's path</font></i>
    <i><font color=#4b5d50>#   cmd - command linked</font></i>
    <i><font color=#4b5d50>#   on - flag &quot;the label visited&quot;</font></i>
    <i><font color=#4b5d50>#   fg - foreground of label</font></i>
    <i><font color=#4b5d50>#   bg - background of label</font></i>

    <b><font color=#3a6797>set</font></b> styl [<b><font color=#134070>ttk::style</font></b> configure TLabel]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fg</font> eq {}} {<b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] - fg - bg}
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::apave::_AP_VARS(LINKFG)]} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::apave::_AP_VARS(LINKFG)</font> ne {}} {<b><font color=#3a6797>set</font></b> fg <font color=#1b1baa>$::apave::_AP_VARS(LINKFG)</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::apave::_AP_VARS(LINKBG)</font> ne {}} {<b><font color=#3a6797>set</font></b> bg <font color=#1b1baa>$::apave::_AP_VARS(LINKBG)</font>}
    }
    <b><font color=#3a6797>set</font></b> vst [<b><font color=#3a6797>string</font></b> map {{ } _} <font color=#1b1baa>$cmd</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$on</font> eq {}} {
      <b><font color=#3a6797>set</font></b> on [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>info</font></b> exists ::apave::_AP_VISITED(<font color=#1b1baa>$vst</font>)]}]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$on</font>} {
      <b><font color=#3a6797>set</font></b> fg [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> csGet] 9]
      <b><font color=#3a6797>set</font></b> ::apave::_AP_VISITED(<font color=#1b1baa>$vst</font>) 1
      <b><font color=#3a6797>set</font></b> ::apave::_AP_VISITED(FG,<font color=#1b1baa>$w</font>) <font color=#1b1baa>$fg</font>
      <b><font color=#3a6797>foreach</font></b> lw <font color=#1b1baa>$::apave::_AP_VISITED(ALL)</font> {  ;<i><font color=#4b5d50># mark the same links</font></i>
        <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$lw</font> w2 cmd2
        <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$w2</font>] && <font color=#1b1baa>$cmd</font> eq <font color=#1b1baa>$cmd2</font>} {
          <font color=#1b1baa>$w2</font> configure <font color=#653760>-foreground</font> <font color=#1b1baa>$fg</font> <font color=#653760>-background</font> <font color=#1b1baa>$bg</font>
          <b><font color=#3a6797>set</font></b> ::apave::_AP_VISITED(FG,<font color=#1b1baa>$w2</font>) <font color=#1b1baa>$fg</font>
        }
      }
    }
    <font color=#1b1baa>$w</font> configure <font color=#653760>-foreground</font> <font color=#1b1baa>$fg</font> <font color=#653760>-background</font> <font color=#1b1baa>$bg</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> font [<font color=#1b1baa>$w</font> cget <font color=#653760>-font</font>]] eq {}} {
      <b><font color=#3a6797>set</font></b> font <font color=#1b1baa>$::apave::FONTMAIN</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> font [<b><font color=#134070>font</font></b> actual <font color=#1b1baa>$font</font>]}
    }
    <b><font color=#3a6797>foreach</font></b> {o v} [<b><font color=#ca14ca>my</font></b> initLinkFont] {<b><font color=#3a6797>dict</font></b> set font <font color=#1b1baa>$o</font> <font color=#1b1baa>$v</font>}
    <font color=#1b1baa>$w</font> configure <font color=#653760>-font</font> <font color=#1b1baa>$font</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=HoverLab></a>
  <b><font color=#ca14ca>method</font></b> HoverLab {w cmd on {fg <font color=#8b2a0e>&quot;&quot;</font>} {bg <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Actions on entering/leaving a linked label.</font></i>
    <i><font color=#4b5d50>#   w - label's path</font></i>
    <i><font color=#4b5d50>#   cmd - command linked</font></i>
    <i><font color=#4b5d50>#   on - flag &quot;now hovering on the label&quot;</font></i>
    <i><font color=#4b5d50>#   fg - foreground of label</font></i>
    <i><font color=#4b5d50>#   bg - background of label</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$on</font>} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fg</font> eq {}} {<b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] fg - bg}
      <font color=#1b1baa>$w</font> configure <font color=#653760>-background</font> <font color=#1b1baa>$bg</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#ca14ca>my</font></b> VisitedLab <font color=#1b1baa>$w</font> <font color=#1b1baa>$cmd</font> {} <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font>
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=textLink></a>
  <b><font color=#ca14ca>method</font></b> textLink {w idx} {
    <i><font color=#4b5d50># Gets a label's path of a link in a text widget.</font></i>
    <i><font color=#4b5d50>#   w - text's path</font></i>
    <i><font color=#4b5d50>#   idx - index of the link</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::apave::__TEXTLINKS__(<font color=#1b1baa>$w</font>)]} {
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$::apave::__TEXTLINKS__($w)</font> <font color=#1b1baa>$idx</font>]
    }
    <b><font color=#ca14ca>return</font></b> {}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=makeLabelLinked></a>
  <b><font color=#ca14ca>method</font></b> makeLabelLinked {lab v fg bg fg2 bg2 {doadd yes} {inv no} } {
    <i><font color=#4b5d50># Makes the linked label from a label.</font></i>
    <i><font color=#4b5d50>#   lab - label's path</font></i>
    <i><font color=#4b5d50>#   v - data of the link: command, tip, visited</font></i>
    <i><font color=#4b5d50>#   fg - foreground unhovered</font></i>
    <i><font color=#4b5d50>#   bg - background unhovered</font></i>
    <i><font color=#4b5d50>#   fg2 - foreground hovered</font></i>
    <i><font color=#4b5d50>#   bg2 - background hovered</font></i>
    <i><font color=#4b5d50>#   doadd - flag &quot;register the label in the list of visited&quot;</font></i>
    <i><font color=#4b5d50>#   inv - flag &quot;invert the meaning of colors&quot;</font></i>

    <b><font color=#3a6797>set</font></b> txt [<font color=#1b1baa>$lab</font> cget <font color=#653760>-text</font>]
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$Edge</font> <font color=#1b1baa>$::apave::UFF</font>] <font color=#1b1baa>$v</font>] <font color=#1b1baa>$::apave::UFF</font>] v tt vz
    <b><font color=#3a6797>set</font></b> tt [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %l <font color=#1b1baa>$txt</font>] <font color=#1b1baa>$tt</font>]
    <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %l <font color=#1b1baa>$txt</font> %t <font color=#1b1baa>$tt</font>] <font color=#1b1baa>$v</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tt</font> ne {}} {
      <b><font color=#3a6797>set</font></b> tt [<b><font color=#ca14ca>my</font></b> MC <font color=#1b1baa>$tt</font>]
      ::baltip tip <font color=#1b1baa>$lab</font> <font color=#1b1baa>$tt</font>
      <b><font color=#3a6797>lappend</font></b> ::apave::_AP_VARS(TIMW) <font color=#1b1baa>$lab</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$inv</font>} {
      <b><font color=#3a6797>set</font></b> ft <font color=#1b1baa>$fg</font>
      <b><font color=#3a6797>set</font></b> bt <font color=#1b1baa>$bg</font>
      <b><font color=#3a6797>set</font></b> fg <font color=#1b1baa>$fg2</font>
      <b><font color=#3a6797>set</font></b> bg <font color=#1b1baa>$bg2</font>
      <b><font color=#3a6797>set</font></b> fg2 <font color=#1b1baa>$ft</font>
      <b><font color=#3a6797>set</font></b> bg2 <font color=#1b1baa>$bt</font>
    }
    <b><font color=#ca14ca>my</font></b> VisitedLab <font color=#1b1baa>$lab</font> <font color=#1b1baa>$v</font> <font color=#1b1baa>$vz</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lab</font> &lt;Enter&gt; <font color=#8b2a0e>&quot;::apave::obj EXPORT HoverLab <font color=#1b1baa>$</font>lab <font color=#1b1baa>{$</font>v<font color=#1b1baa>}</font> yes <font color=#1b1baa>$</font>fg2 <font color=#1b1baa>$</font>bg2&quot;</font>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lab</font> &lt;Leave&gt; <font color=#8b2a0e>&quot;::apave::obj EXPORT HoverLab <font color=#1b1baa>$</font>lab <font color=#1b1baa>{$</font>v<font color=#1b1baa>}</font> no <font color=#1b1baa>$</font>fg <font color=#1b1baa>$</font>bg&quot;</font>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$lab</font> &lt;Button-1&gt; <font color=#8b2a0e>&quot;::apave::obj EXPORT VisitedLab <font color=#1b1baa>$</font>lab <font color=#1b1baa>{$</font>v<font color=#1b1baa>}</font> yes <font color=#1b1baa>$</font>fg2 <font color=#1b1baa>$</font>bg2;<font color=#1b1baa>$</font>v&quot;</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doadd</font>} {<b><font color=#3a6797>lappend</font></b> ::apave::_AP_VISITED(ALL) [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$lab</font> <font color=#1b1baa>$v</font> <font color=#1b1baa>$inv</font>]}
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fg2</font> <font color=#1b1baa>$bg2</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=leadingSpaces></a>
  <b><font color=#ca14ca>method</font></b> leadingSpaces {line} {
    <i><font color=#4b5d50># Returns a number of leading spaces of a line</font></i>
    <i><font color=#4b5d50>#   line - the line</font></i>

    <b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]-[<b><font color=#3a6797>string</font></b> length [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$line</font>]]}
  }
<a id=Text_methods></a>
  <i><font color=#4b5d50>## ________________________ Text methods _________________________ ##</font></i>
<a id=SetContentVariable></a>
  <b><font color=#ca14ca>method</font></b> SetContentVariable {tvar txtnam name} {
    <i><font color=#4b5d50># Sets an internal text variable combining its main attributes.</font></i>
    <i><font color=#4b5d50>#   tvar - external variable for text</font></i>
    <i><font color=#4b5d50>#   txtnam - full name of widget</font></i>
    <i><font color=#4b5d50>#   name - short (tail) name of widget</font></i>
    <i><font color=#4b5d50># The tricky thing is for further access to all of the text.</font></i>
    <i><font color=#4b5d50># See also: GetContentVariable</font></i>

    <b><font color=#3a6797>set</font></b> PV(textcont,<font color=#1b1baa>$tvar</font>) <font color=#1b1baa>$tvar</font>*<font color=#1b1baa>$txtnam</font>*<font color=#1b1baa>$name</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=GetContentVariable></a>
  <b><font color=#ca14ca>method</font></b> GetContentVariable {tvar} {
    <i><font color=#4b5d50># Gets an internal text variable.</font></i>
    <i><font color=#4b5d50># See also: SetContentVariable</font></i>

    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$PV(textcont,$tvar)</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=SplitContentVariable></a>
  <b><font color=#ca14ca>method</font></b> SplitContentVariable {ftxvar} {
    <i><font color=#4b5d50># Gets parts of an internal text variable.</font></i>
    <i><font color=#4b5d50># See also: SetContentVariable</font></i>

    <b><font color=#3a6797>split</font></b> <font color=#1b1baa>$ftxvar</font> *
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=getTextContent></a>
  <b><font color=#ca14ca>method</font></b> getTextContent {tvar} {
    <i><font color=#4b5d50># Gets text content.</font></i>
    <i><font color=#4b5d50>#   tvar - text variable</font></i>
    <i><font color=#4b5d50># Uses an internal text variable to extract the text contents.</font></i>
    <i><font color=#4b5d50># Returns the content of text.</font></i>

    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> SplitContentVariable [<b><font color=#ca14ca>my</font></b> GetContentVariable <font color=#1b1baa>$tvar</font>]] \
      -&gt; txtnam wid
    <b><font color=#3a6797>string</font></b> trimright [<font color=#1b1baa>$txtnam</font> get 1.0 end]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=onKeyTextM></a>
  <b><font color=#ca14ca>method</font></b> onKeyTextM {w K {s {}}} {
    <i><font color=#4b5d50># Processes indents and braces at pressing keys.</font></i>
    <i><font color=#4b5d50>#   w - text's path</font></i>
    <i><font color=#4b5d50>#   K - key's name</font></i>
    <i><font color=#4b5d50>#   s - key's state</font></i>

    <b><font color=#3a6797>set</font></b> lindt [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$::apave::_AP_VARS(INDENT)</font>]
    <b><font color=#3a6797>switch</font></b> <font color=#653760>-exact</font> <font color=#1b1baa>$K</font> {
      Return - KP_Enter {
        <i><font color=#4b5d50># at pressing Enter key, indent (and possibly add the right brace)</font></i>
        <i><font color=#4b5d50># but shift/ctrl+Enter acts by default - without indenting</font></i>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$s</font> & 1 || <font color=#1b1baa>$s</font> & 4} <b><font color=#ca14ca>return</font></b>
        <b><font color=#3a6797>set</font></b> idx1 [<font color=#1b1baa>$w</font> index {insert linestart}]
        <b><font color=#3a6797>set</font></b> idx2 [<font color=#1b1baa>$w</font> index {insert lineend}]
        <b><font color=#3a6797>set</font></b> line [<font color=#1b1baa>$w</font> get <font color=#1b1baa>$idx1</font> <font color=#1b1baa>$idx2</font>]
        <b><font color=#3a6797>set</font></b> nchars [<b><font color=#ca14ca>my</font></b> leadingSpaces <font color=#1b1baa>$line</font>]
        <b><font color=#3a6797>set</font></b> indent [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 0 <font color=#1b1baa>$nchars</font>-1]
        <b><font color=#3a6797>set</font></b> ch1 [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$nchars</font> <font color=#1b1baa>$nchars</font>+1]
        <b><font color=#3a6797>set</font></b> islist [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$ch1</font> in {{<b><font color=#3a6797>*</font></b> } {- } {# }}}]
        <b><font color=#3a6797>set</font></b> ch2 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> end]
        <b><font color=#3a6797>set</font></b> idx1 [<font color=#1b1baa>$w</font> index insert]
        <b><font color=#3a6797>set</font></b> idx2 [<font color=#1b1baa>$w</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 +1 line&quot;</font>]
        <b><font color=#3a6797>set</font></b> st2 [<font color=#1b1baa>$w</font> get <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx2 linestart&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx2 lineend&quot;</font>]
        <b><font color=#3a6797>set</font></b> ch3 [<b><font color=#3a6797>string</font></b> index [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$st2</font>] 0]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$indent</font> ne {} || <font color=#1b1baa>$ch2</font> eq <font color=#8b2a0e>&quot;\{&quot;</font> || <font color=#1b1baa>$K</font> eq {KP_Enter} || <font color=#1b1baa>$st2</font> ne {} || <font color=#1b1baa>$islist</font>} {
          <b><font color=#3a6797>set</font></b> st1 [<font color=#1b1baa>$w</font> get <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 lineend&quot;</font>]
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st1</font> 0] in [<b><font color=#3a6797>list</font></b> \t { }]} {
            <i><font color=#4b5d50># if space(s) are at the right, remove them at cutting</font></i>
            <b><font color=#3a6797>set</font></b> n1 [<b><font color=#ca14ca>my</font></b> leadingSpaces <font color=#1b1baa>$st1</font>]
            <font color=#1b1baa>$w</font> delete <font color=#1b1baa>$idx1</font> [<font color=#1b1baa>$w</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 +<font color=#1b1baa>$</font>n1 char&quot;</font>]
          } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$ch2</font> eq <font color=#8b2a0e>&quot;\{&quot;</font> && <font color=#1b1baa>$st1</font> eq {}} {
            <i><font color=#4b5d50># indent + closing brace</font></i>
            <b><font color=#3a6797>set</font></b> nchars2 [<b><font color=#ca14ca>my</font></b> leadingSpaces <font color=#1b1baa>$st2</font>]
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$st2</font> eq {} || <font color=#1b1baa>$nchars</font>&gt;<font color=#1b1baa>$nchars2</font> || (<font color=#1b1baa>$nchars</font>==<font color=#1b1baa>$nchars2</font> && <font color=#1b1baa>$ch3</font> ne <font color=#8b2a0e>&quot;\}&quot;</font>)} {
              <b><font color=#3a6797>append</font></b> indent <font color=#1b1baa>$::apave::_AP_VARS(INDENT)</font> \n <font color=#1b1baa>$indent</font> <font color=#8b2a0e>&quot;\}&quot;</font>
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>append</font></b> indent <font color=#1b1baa>$::apave::_AP_VARS(INDENT)</font>
            }
            <b><font color=#3a6797>incr</font></b> nchars <font color=#1b1baa>$lindt</font>
          } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$indent</font> eq {} && <font color=#1b1baa>$st2</font> ne {}} {
            <i><font color=#4b5d50># no indent of previous line, try to get it from the next</font></i>
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$st2</font>] eq <font color=#8b2a0e>&quot;\}&quot;</font>} {
              <i><font color=#4b5d50># add indentation for the next brace</font></i>
              <b><font color=#3a6797>set</font></b> st2 <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>::apave::_AP_VARS(INDENT)<font color=#1b1baa>$</font>st2&quot;</font>
            }
            <b><font color=#3a6797>set</font></b> nchars [<b><font color=#ca14ca>my</font></b> leadingSpaces <font color=#1b1baa>$st2</font>]
            <b><font color=#3a6797>set</font></b> indent [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$st2</font> 0 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$nchars</font>-1}]]
          }
          <i><font color=#4b5d50># a new line supplied with &quot;list-like pattern&quot;</font></i>
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$islist</font> && ![<b><font color=#3a6797>string</font></b> match *.0 <font color=#1b1baa>$idx1</font>] && \
          [<b><font color=#3a6797>string</font></b> trim [<font color=#1b1baa>$w</font> get <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 linestart&quot;</font> <font color=#1b1baa>$idx1</font>]] ne {}} {
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ch1</font> eq {# } && int(<font color=#1b1baa>$idx1</font>)&gt;1} {
              <i><font color=#4b5d50># for comments: if only more than 1 of them, then add another</font></i>
              <b><font color=#3a6797>set</font></b> idx0 [<font color=#1b1baa>$w</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 -1 line&quot;</font>]
              <b><font color=#3a6797>set</font></b> st0 [<b><font color=#3a6797>string</font></b> trimleft [<font color=#1b1baa>$w</font> get <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx0 linestart&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx0 lineend&quot;</font>]]
              <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st0</font> 0] ne {#} && <font color=#1b1baa>$ch3</font> ne {#}} {
                <b><font color=#3a6797>set</font></b> ch1 {}
              }
            }
            <b><font color=#3a6797>set</font></b> indent <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>indent<font color=#1b1baa>$</font>ch1&quot;</font>
            <b><font color=#3a6797>incr</font></b> nchars [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$ch1</font>]
          }
          <font color=#1b1baa>$w</font> insert <font color=#1b1baa>$idx1</font> \n<font color=#1b1baa>$indent</font>
          ::tk::TextSetCursor <font color=#1b1baa>$w</font> [<font color=#1b1baa>$w</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx2 linestart +<font color=#1b1baa>$</font>nchars char&quot;</font>]
          <b><font color=#ca14ca>return</font></b> <font color=#653760>-code</font> break
        }
      }
    braceright {
        <i><font color=#4b5d50># right brace pressed: shift the brace to left</font></i>
        <b><font color=#3a6797>set</font></b> idx1 [<font color=#1b1baa>$w</font> index insert]
        <b><font color=#3a6797>set</font></b> st [<font color=#1b1baa>$w</font> get <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 linestart&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 lineend&quot;</font>]
        <b><font color=#3a6797>set</font></b> idx2 [<font color=#1b1baa>$w</font> index <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 -1 line&quot;</font>]
        <b><font color=#3a6797>set</font></b> st2 [<font color=#1b1baa>$w</font> get <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx2 linestart&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx2 lineend&quot;</font>]
        <b><font color=#3a6797>set</font></b> nchars [<b><font color=#ca14ca>my</font></b> leadingSpaces <font color=#1b1baa>$st</font>]
        <b><font color=#3a6797>set</font></b> nchars2 [<b><font color=#ca14ca>my</font></b> leadingSpaces <font color=#1b1baa>$st2</font>]
        <b><font color=#3a6797>set</font></b> st2 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st2</font> end]
        <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$st2</font> ne <font color=#8b2a0e>&quot;\{&quot;</font> && <font color=#1b1baa>$nchars2</font>&lt;=<font color=#1b1baa>$nchars</font> || <font color=#1b1baa>$st2</font> eq <font color=#8b2a0e>&quot;\{&quot;</font> && <font color=#1b1baa>$nchars2</font>&lt;<font color=#1b1baa>$nchars</font>) \
        && [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$st</font>] eq {} && [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$st</font>]&gt;=<font color=#1b1baa>$lindt</font>} {
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$nchars</font>&gt;<font color=#1b1baa>$nchars2</font>} {<b><font color=#3a6797>set</font></b> lindt [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$nchars</font>-<font color=#1b1baa>$nchars2</font>}]}
          <font color=#1b1baa>$w</font> delete <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 lineend -<font color=#1b1baa>$</font>lindt char&quot;</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>idx1 lineend&quot;</font>
        }
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=setTextBinds></a>
  <b><font color=#ca14ca>method</font></b> setTextBinds {wt} {
    <i><font color=#4b5d50># Returns bindings for a text widget.</font></i>
    <i><font color=#4b5d50>#   wt - the text's path</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>bind</font></b> <font color=#1b1baa>$wt</font> &lt;&lt;Paste&gt;&gt;] eq {}} {
      <b><font color=#3a6797>set</font></b> res <font color=#8b2a0e>&quot; \</font>
<font color=#8b2a0e>      ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;&lt;Paste&gt;&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> pasteText <font color=#1b1baa>$</font>wt ;\</font>
<font color=#8b2a0e>      ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;KP_Enter&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> onKeyTextM <font color=#1b1baa>$</font>wt %K %s ;\</font>
<font color=#8b2a0e>      ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;Return&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> onKeyTextM <font color=#1b1baa>$</font>wt %K %s ;\</font>
<font color=#8b2a0e>      catch <font color=#1b1baa>{</font>::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;braceright&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> onKeyTextM <font color=#1b1baa>$</font>wt %K<font color=#1b1baa>}</font>&quot;</font>
    }
    <b><font color=#3a6797>foreach</font></b> k [::apave::getTextHotkeys CtrlD] {
      <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ; ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;<font color=#1b1baa>$</font>k&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> doubleText <font color=#1b1baa>$</font>wt&quot;</font>
    }
    <b><font color=#3a6797>foreach</font></b> k [::apave::getTextHotkeys CtrlY] {
      <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ; ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;<font color=#1b1baa>$</font>k&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> deleteLine <font color=#1b1baa>$</font>wt&quot;</font>
    }
    <b><font color=#3a6797>foreach</font></b> k [::apave::getTextHotkeys CtrlA] {
      <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ; ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;<font color=#1b1baa>$</font>k&gt; <font color=#1b1baa>$</font>wt tag add sel 1.0 end <font color=#1b1baa>{</font>;<font color=#1b1baa>}</font> break&quot;</font>
    }
    <b><font color=#3a6797>foreach</font></b> k [::apave::getTextHotkeys CtrlT] {
      <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ; ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;<font color=#1b1baa>$</font>k&gt; ::apave::InsertChar <font color=#1b1baa>$</font>wt <font color=#1b1baa>{</font>\t<font color=#1b1baa>}</font> <font color=#1b1baa>{</font>;<font color=#1b1baa>}</font> break&quot;</font>
    }
    <b><font color=#3a6797>set</font></b> lstart linestart
    <b><font color=#3a6797>if</font></b> {[::isunix]} {<b><font color=#3a6797>append</font></b> lstart { +1c}} ;<i><font color=#4b5d50># don't use &quot;break&quot;</font></i>
    <b><font color=#3a6797>foreach</font></b> k [::apave::getTextHotkeys CtrlB] {
      <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ; ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;<font color=#1b1baa>$</font>k&gt; ::apave::CursorToBEOL <font color=#1b1baa>$</font>wt <font color=#1b1baa>{$</font>lstart<font color=#1b1baa>}</font>&quot;</font>
    }
    <b><font color=#3a6797>foreach</font></b> k [::apave::getTextHotkeys CtrlE] {
      <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ; ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;<font color=#1b1baa>$</font>k&gt; ::apave::CursorToBEOL <font color=#1b1baa>$</font>wt lineend&quot;</font>
    }
    <b><font color=#3a6797>append</font></b> res <font color=#8b2a0e>&quot; ;\</font>
<font color=#8b2a0e>      ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;Alt-Up&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> linesMove <font color=#1b1baa>$</font>wt -1 ;\</font>
<font color=#8b2a0e>      ::apave::bindToEvent <font color=#1b1baa>$</font>wt &lt;Alt-Down&gt; <font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> linesMove <font color=#1b1baa>$</font>wt +1&quot;</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=TextCommandForChange></a>
  <b><font color=#ca14ca>method</font></b> TextCommandForChange {w com on {com2 <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Replaces a command of text widget for making changes</font></i>
    <i><font color=#4b5d50>#   w - text widget's name</font></i>
    <i><font color=#4b5d50>#   com - command for changes</font></i>
    <i><font color=#4b5d50>#   on - if &quot;yes&quot;, replaces a text command; if &quot;no&quot;, restores it</font></i>
    <i><font color=#4b5d50># In particular, when `com` is empty, the text widget becomes readonly.</font></i>

    <b><font color=#3a6797>set</font></b> newcom <font color=#1b1baa>$w</font>.internal
    <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$on</font>} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> commands ::<font color=#1b1baa>$newcom</font>] ne {}} {
        <b><font color=#3a6797>rename</font></b> ::<font color=#1b1baa>$w</font> {}
        <b><font color=#3a6797>rename</font></b> ::<font color=#1b1baa>$newcom</font> ::<font color=#1b1baa>$w</font>
      }
    } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>info</font></b> commands ::<font color=#1b1baa>$newcom</font>] eq {}} {
      <b><font color=#3a6797>rename</font></b> <font color=#1b1baa>$w</font> ::<font color=#1b1baa>$newcom</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com</font> eq {}} {
        <i><font color=#4b5d50># text to be readonly</font></i>
      ; <b><font color=#ca14ca>proc</font></b> ::<font color=#1b1baa>$w</font> {args} <font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>          switch -exact -- \[lindex \$args 0\] \{</font>
<font color=#8b2a0e>              insert \{\}</font>
<font color=#8b2a0e>              delete \{\}</font>
<font color=#8b2a0e>              replace \{\}</font>
<font color=#8b2a0e>              default \{</font>
<font color=#8b2a0e>                  return \[eval ::<font color=#1b1baa>$</font>newcom \$args\]</font>
<font color=#8b2a0e>              \}</font>
<font color=#8b2a0e>          \}&quot;</font>
      } <b><font color=#3a6797>else</font></b> {
        <i><font color=#4b5d50># text to be sensible to changes</font></i>
      ; <b><font color=#ca14ca>proc</font></b> ::<font color=#1b1baa>$w</font> {args} <font color=#8b2a0e>&quot;</font>
<font color=#8b2a0e>          set _res_of_TextCommandForChange \[eval ::<font color=#1b1baa>$</font>newcom \$args\]</font>
<font color=#8b2a0e>          switch -exact -- \[lindex \$args 0\] \{</font>
<font color=#8b2a0e>              insert \{<font color=#1b1baa>$</font>com\}</font>
<font color=#8b2a0e>              delete \{<font color=#1b1baa>$</font>com\}</font>
<font color=#8b2a0e>              replace \{<font color=#1b1baa>$</font>com\}</font>
<font color=#8b2a0e>          \}</font>
<font color=#8b2a0e>          return \$_res_of_TextCommandForChange&quot;</font>
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com2</font> ne {}} {
      {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$com2</font>
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=readonlyWidget></a>
  <b><font color=#ca14ca>method</font></b> readonlyWidget {w {on yes} {popup yes}} {
    <i><font color=#4b5d50># Switches on/off a widget's readonly state for a text widget.</font></i>
    <i><font color=#4b5d50>#   w - text widget's path</font></i>
    <i><font color=#4b5d50>#   on - &quot;on/off&quot; boolean flag</font></i>
    <i><font color=#4b5d50>#   popup - &quot;make popup menu&quot; boolean flag</font></i>
    <i><font color=#4b5d50># See also:</font></i>
    <i><font color=#4b5d50>#   [wiki.tcl-lang.org](https://wiki.tcl-lang.org/page/Read-only+text+widget)</font></i>

    <b><font color=#ca14ca>my</font></b> TextCommandForChange <font color=#1b1baa>$w</font> {} <font color=#1b1baa>$on</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$popup</font>} {<b><font color=#ca14ca>my</font></b> makePopup <font color=#1b1baa>$w</font> <font color=#1b1baa>$on</font> yes}
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=GetOutputValues></a>
  <b><font color=#ca14ca>method</font></b> GetOutputValues {} {
    <i><font color=#4b5d50># Makes output values for some widgets (lbx, fco).</font></i>
    <i><font color=#4b5d50># Some i/o widgets need a special method to get their returned values.</font></i>

    <b><font color=#3a6797>foreach</font></b> aop <font color=#1b1baa>$Widgetopts</font> {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$aop</font> optnam vn v1 v2
      <b><font color=#3a6797>switch</font></b> <font color=#653760>-glob</font> -- <font color=#1b1baa>$optnam</font> {
        <font color=#653760>-lbxname</font>* {
          <i><font color=#4b5d50># To get a listbox's value, its methods are used.</font></i>
          <i><font color=#4b5d50># The widget may not exist when an apave object is used for</font></i>
          <i><font color=#4b5d50># several dialogs which is a bad style (very very bad).</font></i>
          <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$vn</font>]} {
            <b><font color=#3a6797>lassign</font></b> [<font color=#1b1baa>$vn</font> curselection] s1
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$s1</font> eq {}} {<b><font color=#3a6797>set</font></b> s1 0}
            <b><font color=#3a6797>set</font></b> w [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$vn</font> [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$vn</font>]+1 end]
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> v0 [<font color=#1b1baa>$vn</font> get <font color=#1b1baa>$s1</font>]}]} {<b><font color=#3a6797>set</font></b> v0 {}}
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$optnam</font> eq {<font color=#653760>-lbxnameALL</font>}} {
              <i><font color=#4b5d50># when -ALL option is set to 1, listbox returns</font></i>
              <i><font color=#4b5d50># a list of 3 items - sel index, sel contents and all contents</font></i>
              <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$v1</font> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$s1</font> <font color=#1b1baa>$v0</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$v1</font>]]
            } <b><font color=#3a6797>else</font></b> {
              <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$v1</font> <font color=#1b1baa>$v0</font>
            }
          }
        }
        <font color=#653760>-retpos</font> { ;<i><font color=#4b5d50># a range to cut from -tvar/-lvar variable</font></i>
          <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$v2</font> :] p1 p2
          <b><font color=#3a6797>set</font></b> val1 [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$v1</font>]
          <i><font color=#4b5d50># there may be -list option for this widget</font></i>
          <i><font color=#4b5d50># then if the value is from the list, it's fully returned</font></i>
          <b><font color=#3a6797>foreach</font></b> aop2 <font color=#1b1baa>$Widgetopts</font> {
            <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$aop2</font> optnam2 vn2 lst2
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$optnam2</font> eq {<font color=#653760>-list</font>} && <font color=#1b1baa>$vn</font> eq <font color=#1b1baa>$vn2</font>} {
              <b><font color=#3a6797>foreach</font></b> val2 <font color=#1b1baa>$lst2</font> {
                <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$val1</font> eq <font color=#1b1baa>$val2</font>} {
                  <b><font color=#3a6797>set</font></b> p1 0
                  <b><font color=#3a6797>set</font></b> p2 end
                  <b><font color=#ca14ca>break</font></b>
                }
              }
              <b><font color=#ca14ca>break</font></b>
            }
          }
          <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$v1</font> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$val1</font> <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font>]
        }
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=focusNext></a>
  <b><font color=#ca14ca>method</font></b> focusNext {w wnext {wnext0 <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets focus on a next widget (possibly, defined as `my Widget`).</font></i>
    <i><font color=#4b5d50>#   w - parent window name</font></i>
    <i><font color=#4b5d50>#   wnext - next widget's name</font></i>
    <i><font color=#4b5d50>#   wnext0 - core next name (used internally, for recursive search)</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wnext</font> eq {}} <b><font color=#ca14ca>return</font></b>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exist <font color=#1b1baa>$wnext</font>]} {
      <b><font color=#134070>focus</font></b> <font color=#1b1baa>$wnext</font>  ;<i><font color=#4b5d50># direct path to the next widget</font></i>
      <b><font color=#ca14ca>return</font></b>
    }
    <i><font color=#4b5d50># try to find the next widget in hierarchy of widgets</font></i>
    <b><font color=#3a6797>set</font></b> ws <font color=#1b1baa>$wnext</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wnext0</font> eq {}} {
      <i><font color=#4b5d50># get the real next widget (wnext can be uppercased or calculated)</font></i>
      <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> wnext [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$wnext</font>]}
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> match {<b><font color=#ca14ca>my</font></b> *} <font color=#1b1baa>$wnext</font>]} {
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> wnext [<b><font color=#ca14ca>my</font></b> [<b><font color=#ca14ca>my</font></b> ownWName <font color=#1b1baa>$wnext</font>]]}
      }
      <b><font color=#ca14ca>my</font></b> focusNext <font color=#1b1baa>$w</font> <font color=#1b1baa>$wnext</font> <font color=#1b1baa>$wnext</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> wnext <font color=#1b1baa>$wnext0</font>
    }
    <b><font color=#3a6797>foreach</font></b> wn [<b><font color=#134070>winfo</font></b> children <font color=#1b1baa>$w</font>] {
      <b><font color=#ca14ca>my</font></b> focusNext <font color=#1b1baa>$wn</font> <font color=#1b1baa>$wnext</font> <font color=#1b1baa>$wnext0</font>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match <font color=#8b2a0e>&quot;*.<font color=#1b1baa>$</font>wnext&quot;</font> <font color=#1b1baa>$wn</font>] || [<b><font color=#3a6797>string</font></b> match <font color=#8b2a0e>&quot;*.<font color=#1b1baa>$</font>ws&quot;</font> <font color=#1b1baa>$wn</font>]} {
        <b><font color=#134070>focus</font></b> <font color=#1b1baa>$wn</font>
        <b><font color=#ca14ca>return</font></b>
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=AdditionalCommands></a>
  <b><font color=#ca14ca>method</font></b> AdditionalCommands {w wdg attrsName} {
    <i><font color=#4b5d50># Gets additional commands (for non-standard attributes).</font></i>
    <i><font color=#4b5d50>#   w - window name</font></i>
    <i><font color=#4b5d50>#   wdg - widget's full path</font></i>
    <i><font color=#4b5d50>#   attrsName - variable name for widget's attributes</font></i>

    <b><font color=#3a6797>upvar</font></b> <font color=#1b1baa>$attrsName</font> attrs
    <b><font color=#3a6797>set</font></b> addcomms {}
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> tooltip [::apave::getOption <font color=#653760>-tooltip</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]] ne {} ||
    [<b><font color=#3a6797>set</font></b> tooltip [::apave::getOption <font color=#653760>-tip</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]] ne {}} {
      ::apave::initBaltip
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$Edge</font> <font color=#1b1baa>$tooltip</font>]]&gt;=0} {
        <b><font color=#3a6797>set</font></b> tooltip [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tooltip</font> 1 end-1]
        <b><font color=#3a6797>set</font></b> tattrs [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$tooltip</font> [<b><font color=#3a6797>incr</font></b> i -1]+[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$Edge</font>] end]
        <b><font color=#3a6797>set</font></b> tooltip <font color=#8b2a0e>&quot;<font color=#1b1baa>{[</font>string range <font color=#1b1baa>$</font>tooltip 0 <font color=#1b1baa>$</font>i-1<font color=#1b1baa>]}</font>&quot;</font>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> tattrs {}
      }
      <b><font color=#3a6797>set</font></b> tooltip [<b><font color=#ca14ca>my</font></b> MC <font color=#1b1baa>$tooltip</font>]
      <b><font color=#3a6797>lappend</font></b> addcomms [<b><font color=#3a6797>list</font></b> ::baltip::tip <font color=#1b1baa>$wdg</font> <font color=#1b1baa>$tooltip</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$tattrs</font>]
      <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-tooltip</font> <font color=#653760>-tip</font>]
    }
    <b><font color=#3a6797>if</font></b> {[::apave::getOption <font color=#653760>-ro</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] ne {} || \
    [::apave::getOption <font color=#653760>-readonly</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>] ne {}} {
      <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions attrs <font color=#653760>-ro</font> 0 <font color=#653760>-readonly</font> 0] ro readonly
      <b><font color=#3a6797>lappend</font></b> addcomms [<b><font color=#3a6797>list</font></b> my readonlyWidget <font color=#1b1baa>$wdg</font> [<b><font color=#3a6797>expr</font></b> <font color=#1b1baa>$ro</font>||<font color=#1b1baa>$readonly</font>]]
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> wnext [::apave::getOption <font color=#653760>-tabnext</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>]] ne {}} {
      <i><font color=#4b5d50># two widgets for Tab & Shift/Tab (proc can be used to get them)</font></i>
      <b><font color=#3a6797>set</font></b> wnext [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$wnext</font> <font color=#8b2a0e>&quot;\{\}&quot;</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first \[ <font color=#1b1baa>$wnext</font>]==0} { ;<i><font color=#4b5d50># if [comm1] [comm2] for next/prev</font></i>
        <b><font color=#3a6797>set</font></b> wprev {}
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>subst</font></b> <font color=#1b1baa>$wnext</font>] wnext wprev}
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>lassign</font></b> [{<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$wnext</font>] wnext wprev}]} {
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$wnext</font> wnext wprev
        }
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wnext</font> eq {0}} {<b><font color=#3a6797>set</font></b> wnext <font color=#1b1baa>$wdg</font>} ;<i><font color=#4b5d50># disables Tab on this widget</font></i>
      <b><font color=#3a6797>if</font></b> {[::iswindows]} {
        <b><font color=#3a6797>set</font></b> i1 {{%s}==0}  ;<i><font color=#4b5d50># in Windows: Shift+Tab doesn't work in text</font></i>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> i1 1
      }
      <b><font color=#3a6797>set</font></b> c1 <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> focusNext <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>wnext ; break&quot;</font>
      <b><font color=#3a6797>set</font></b> c2 <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>self<font color=#1b1baa>]</font> focusNext <font color=#1b1baa>$</font>w <font color=#1b1baa>$</font>wprev ; break&quot;</font>
      <b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$wprev</font> ne {}}]
      <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> if <font color=#8b2a0e>&quot;\[winfo exists <font color=#1b1baa>$</font>wdg\]&quot;</font> [<b><font color=#3a6797>list</font></b> bind <font color=#1b1baa>$wdg</font> &lt;Key&gt; \
        [<b><font color=#3a6797>list</font></b> + if {{%K} eq {Tab}} [<b><font color=#3a6797>list</font></b> if <font color=#1b1baa>$i1</font> <font color=#1b1baa>$c1</font> elseif <font color=#1b1baa>$i2</font> <font color=#1b1baa>$c2</font>]]]]
      <b><font color=#3a6797>set</font></b> attrs [::apave::removeOptions <font color=#1b1baa>$attrs</font> <font color=#653760>-tabnext</font>]
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$addcomms</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=DefineWidgetKeys></a>
  <b><font color=#ca14ca>method</font></b> DefineWidgetKeys {wname widget} {
    <i><font color=#4b5d50># Sets some hotkeys for some widgets (e.g. Enter to work as Tab)</font></i>
    <i><font color=#4b5d50>#   wname - the widget's name</font></i>
    <i><font color=#4b5d50>#   widget - the widget's type</font></i>
    <i><font color=#4b5d50># This may be disabled by including &quot;STD&quot; in the widget's name.</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first STD <font color=#1b1baa>$wname</font>]&gt;0} <b><font color=#ca14ca>return</font></b>
    <b><font color=#3a6797>if</font></b> {(<font color=#1b1baa>$widget</font> in {<b><font color=#134070>ttk::entry</font></b> entry})} {
      <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wname</font> &lt;Up&gt;  \
        <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>wname selection clear ; \</font>
<font color=#8b2a0e>        if <font color=#1b1baa>{{$</font>::tcl_platform(platform)<font color=#1b1baa>}</font> eq <font color=#1b1baa>{</font>windows<font color=#1b1baa>}}</font> <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>          event generate <font color=#1b1baa>$</font>wname &lt;Shift-Tab&gt;</font>
<font color=#8b2a0e>        <font color=#1b1baa>}</font> else <font color=#1b1baa>{</font></font>
<font color=#8b2a0e>          event generate <font color=#1b1baa>$</font>wname &lt;Key&gt; -keysym ISO_Left_Tab</font>
<font color=#8b2a0e>        <font color=#1b1baa>}</font>&quot;</font>
      <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wname</font> &lt;Down&gt;  \
        <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>wname selection clear ; \</font>
<font color=#8b2a0e>        event generate <font color=#1b1baa>$</font>wname &lt;Key&gt; -keysym Tab&quot;</font>
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$widget</font> in {<b><font color=#134070>ttk::button</font></b> button ttk::checkbutton checkbutton \
    <b><font color=#134070>ttk::radiobutton</font></b> radiobutton <font color=#8b2a0e>&quot;my tk_optionCascade&quot;</font>}} {
      <b><font color=#3a6797>foreach</font></b> k {&lt;Up&gt; &lt;Left&gt;} {
        <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wname</font> <font color=#1b1baa>$k</font> [<b><font color=#3a6797>list</font></b> \
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$::tcl_platform(platform)</font> eq {windows}} [<b><font color=#3a6797>list</font></b> \
            <b><font color=#134070>event</font></b> generate <font color=#1b1baa>$wname</font> &lt;Shift-Tab&gt; \
          ] else [<b><font color=#3a6797>list</font></b> \
            <b><font color=#134070>event</font></b> generate <font color=#1b1baa>$wname</font> &lt;Key&gt; <font color=#653760>-keysym</font> ISO_Left_Tab] \
          ]
      }
      <b><font color=#3a6797>foreach</font></b> k {&lt;Down&gt; &lt;Right&gt;} {
        <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wname</font> <font color=#1b1baa>$k</font> \
          [<b><font color=#3a6797>list</font></b> event generate <font color=#1b1baa>$wname</font> &lt;Key&gt; <font color=#653760>-keysym</font> Tab]
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$widget</font> in {<b><font color=#134070>ttk::button</font></b> button \
    <b><font color=#134070>ttk::checkbutton</font></b> checkbutton ttk::radiobutton radiobutton}} {
      <b><font color=#3a6797>foreach</font></b> k {&lt;Return&gt; &lt;KP_Enter&gt;} {
        <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wname</font> <font color=#1b1baa>$k</font> \
        [<b><font color=#3a6797>list</font></b> event generate <font color=#1b1baa>$wname</font> &lt;Key&gt; <font color=#653760>-keysym</font> space]
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$widget</font> in {<b><font color=#134070>ttk::entry</font></b> entry spinbox ttk::spinbox ttk::combobox}} {
      <b><font color=#3a6797>foreach</font></b> k {&lt;Return&gt; &lt;KP_Enter&gt;} {
        <b><font color=#134070>bind</font></b> <font color=#1b1baa>$wname</font> <font color=#1b1baa>$k</font> \
          <font color=#8b2a0e>&quot;+ <font color=#1b1baa>$</font>wname selection clear ; event generate <font color=#1b1baa>$</font>wname &lt;Key&gt; -keysym Tab&quot;</font>
      }
    }
  }
<a id=Paving_windows></a>
  <i><font color=#4b5d50>## ________________________ Paving windows _________________________ ##</font></i>
<a id=colorWindow></a>
  <b><font color=#ca14ca>method</font></b> colorWindow {win args} {
    <i><font color=#4b5d50># Initialize colors of a window.</font></i>
    <i><font color=#4b5d50>#   win - window's path</font></i>
    <i><font color=#4b5d50>#   args - arguments for csSet</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#ca14ca>my</font></b> apaveTheme]} {
      <b><font color=#ca14ca>my</font></b> csSet [<b><font color=#ca14ca>my</font></b> csCurrent] <font color=#1b1baa>$win</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$args</font> ne {<font color=#653760>-doit</font>}} {<b><font color=#ca14ca>my</font></b> themeNonThemed <font color=#1b1baa>$win</font>}
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#ca14ca>my</font></b> themeNonThemed <font color=#1b1baa>$win</font>
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=ShowOption></a>
  <b><font color=#ca14ca>method</font></b> ShowOption {name} {
    <i><font color=#4b5d50># Gets a default show option, used in showModal.</font></i>
    <i><font color=#4b5d50>#   name - name of option</font></i>
    <i><font color=#4b5d50># See also: getShowOption, setShowOption</font></i>

    <b><font color=#ca14ca>return</font></b> <font color=#8b2a0e>&quot;_SHOWMODAL_<font color=#1b1baa>$</font>name&quot;</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=getShowOption></a>
  <b><font color=#ca14ca>method</font></b> getShowOption {name {defval <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Gets a default show option, used in showModal.</font></i>
    <i><font color=#4b5d50>#   name - name of option</font></i>
    <i><font color=#4b5d50>#   defval - default value</font></i>
    <i><font color=#4b5d50># See also: showModal</font></i>

    ::apave::getProperty [<b><font color=#ca14ca>my</font></b> ShowOption <font color=#1b1baa>$name</font>] <font color=#1b1baa>$defval</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=setShowOption></a>
  <b><font color=#ca14ca>method</font></b> setShowOption {name args} {
    <i><font color=#4b5d50># Sets / gets a default show option, used in showModal.</font></i>
    <i><font color=#4b5d50>#   name - name of option</font></i>
    <i><font color=#4b5d50>#   args - value of option</font></i>
    <i><font color=#4b5d50># See also: showModal</font></i>

    ::apave::setProperty [<b><font color=#ca14ca>my</font></b> ShowOption <font color=#1b1baa>$name</font>] {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=pavedPath></a>
  <b><font color=#ca14ca>method</font></b> pavedPath {} {
    <i><font color=#4b5d50># Gets the currently paved window's path.</font></i>

    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$Modalwin</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=Window></a>
  <b><font color=#ca14ca>method</font></b> Window {w inplists} {
    <i><font color=#4b5d50># Paves the window with widgets.</font></i>
    <i><font color=#4b5d50>#   w - window's name (path)</font></i>
    <i><font color=#4b5d50>#   inplists - list of widget items (lists of widget data)</font></i>
    <i><font color=#4b5d50># Contents of a widget's item:</font></i>
    <i><font color=#4b5d50>#   name - widget's name (first 3 characters define its type)</font></i>
    <i><font color=#4b5d50>#   neighbor - top (T) or left (L) neighbor of the widget</font></i>
    <i><font color=#4b5d50>#   posofnei - position of neighbor: T (top) or L (left)</font></i>
    <i><font color=#4b5d50>#   rowspan - row span of the widget</font></i>
    <i><font color=#4b5d50>#   colspan - column span of the widget</font></i>
    <i><font color=#4b5d50>#   options - grid/pack options</font></i>
    <i><font color=#4b5d50>#   attrs - attributes of widget</font></i>
    <i><font color=#4b5d50># First 3 items are mandatory, others are set at need.</font></i>
    <i><font color=#4b5d50># Called by *paveWindow* method to process a portion of widgets.</font></i>
    <i><font color=#4b5d50># The &quot;portion&quot; refers to a separate block of widgets such as</font></i>
    <i><font color=#4b5d50># notebook's tabs or frames.</font></i>

    <b><font color=#3a6797>set</font></b> ::apave::_AP_VARS(WPAVE) [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$w</font>]
    <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>list</font></b>]
    <i><font color=#4b5d50># comments be skipped</font></i>
    <b><font color=#3a6797>foreach</font></b> lst <font color=#1b1baa>$inplists</font> {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$lst</font> 0] ne {#}} {
        <b><font color=#3a6797>lappend</font></b> lwidgets <font color=#1b1baa>$lst</font>
      }
    }
    <b><font color=#3a6797>set</font></b> lused [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> lwlen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lwidgets</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$lwlen</font>&lt;2 && [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$lwidgets</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>{}</font> &quot;</font>] eq {}} {
      <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>list</font></b> {fra - - - - {<b><font color=#134070>pack</font></b> <font color=#653760>-padx</font> 99 <font color=#653760>-pady</font> 99}}]
      <b><font color=#3a6797>set</font></b> lwlen 1
    }
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font> &lt; <font color=#1b1baa>$lwlen</font>} {} {
      <b><font color=#3a6797>set</font></b> lst1 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#ca14ca>my</font></b> Replace_Tcl i lwlen lwidgets {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lst1</font>] ne {}} {<b><font color=#3a6797>incr</font></b> i}
    }
    <i><font color=#4b5d50># firstly, normalize all names that are &quot;subwidgets&quot; (.lab for fra.lab)</font></i>
    <i><font color=#4b5d50># also, &quot;+&quot; for previous neighbors</font></i>
    <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>set</font></b> lwlen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lwidgets</font>]]
    <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$i</font>&gt;1} {
      <b><font color=#3a6797>incr</font></b> i -1
      <b><font color=#3a6797>set</font></b> lst1 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$lst1</font> name neighbor
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$neighbor</font> eq {+}} {<b><font color=#3a6797>set</font></b> neighbor [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>-1 0]}
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> NormalizeName name i lwidgets] name wname
      <b><font color=#3a6797>set</font></b> neighbor [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> NormalizeName neighbor i lwidgets] 0]
      <b><font color=#3a6797>set</font></b> lst1 [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$lst1</font> 0 1 <font color=#1b1baa>$wname</font> <font color=#1b1baa>$neighbor</font>]
      <b><font color=#3a6797>set</font></b> lwidgets [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$lst1</font>]
    }
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font> &lt; <font color=#1b1baa>$lwlen</font>} {} {
      <i><font color=#4b5d50># List of widgets contains data per widget:</font></i>
      <i><font color=#4b5d50>#   widget's name,</font></i>
      <i><font color=#4b5d50>#   neighbor widget, position of neighbor (T, L),</font></i>
      <i><font color=#4b5d50>#   widget's rowspan and columnspan (both optional),</font></i>
      <i><font color=#4b5d50>#   grid options, widget's attributes (both optional)</font></i>
      <b><font color=#3a6797>set</font></b> lst1 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>set</font></b> lst1 [<b><font color=#ca14ca>my</font></b> Replace_chooser w i lwlen lwidgets {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lst1</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> lst1 [<b><font color=#ca14ca>my</font></b> Replace_bar w i lwlen lwidgets {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$lst1</font>]] eq {}} {
        <b><font color=#3a6797>incr</font></b> i
        <b><font color=#ca14ca>continue</font></b>
      }
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$lst1</font> name neighbor posofnei rowspan colspan options1 attrs1
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> NormalizeName name i lwidgets] name wname
      <b><font color=#3a6797>set</font></b> wname [<b><font color=#ca14ca>my</font></b> MakeWidgetName <font color=#1b1baa>$w</font> <font color=#1b1baa>$wname</font>]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$colspan</font> eq {} || <font color=#1b1baa>$colspan</font> eq {-}} {
        <b><font color=#3a6797>set</font></b> colspan 1
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rowspan</font> eq {} || <font color=#1b1baa>$rowspan</font> eq {-}} {
          <b><font color=#3a6797>set</font></b> rowspan 1
        }
      }
      <b><font color=#3a6797>foreach</font></b> ao {attrs options} {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$ao</font> [<b><font color=#3a6797>uplevel</font></b> 2 subst <font color=#653760>-nocommand</font> <font color=#653760>-nobackslashes</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>${ao}</font>1]]]}]} {
          <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$ao</font> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>${ao}</font>1]
        }
      }
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> widgetType <font color=#1b1baa>$wname</font> <font color=#1b1baa>$options</font> <font color=#1b1baa>$attrs</font>] widget options attrs nam3 dsbl
      <i><font color=#4b5d50># The type of widget (if defined) means its creation</font></i>
      <i><font color=#4b5d50># (if not defined, it was created after &quot;makewindow&quot; call</font></i>
      <i><font color=#4b5d50># and before &quot;window&quot; call)</font></i>
      <b><font color=#3a6797>if</font></b> { !(<font color=#1b1baa>$widget</font> eq {} || [<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$widget</font>])} {
        <b><font color=#3a6797>set</font></b> attrs [<b><font color=#ca14ca>my</font></b> GetAttrs <font color=#1b1baa>$attrs</font> <font color=#1b1baa>$nam3</font> <font color=#1b1baa>$dsbl</font>]
        <b><font color=#3a6797>set</font></b> attrs [<b><font color=#ca14ca>my</font></b> ExpandOptions <font color=#1b1baa>$attrs</font>]
        <i><font color=#4b5d50># for scrollbars - set up the scrolling commands</font></i>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$widget</font> in {<b><font color=#134070>ttk::scrollbar</font></b> scrollbar}} {
          <b><font color=#3a6797>set</font></b> neighbor [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$neighbor</font>] 0]
          <b><font color=#3a6797>set</font></b> wneigb [<b><font color=#ca14ca>my</font></b> WidgetNameFull <font color=#1b1baa>$w</font> <font color=#1b1baa>$neighbor</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$posofnei</font> eq {L}} {
            <font color=#1b1baa>$wneigb</font> config <font color=#653760>-yscrollcommand</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>wname set&quot;</font>
            <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs -com \\\{<font color=#1b1baa>$</font>wneigb yview\\\}&quot;</font>
            <b><font color=#3a6797>append</font></b> options { <font color=#653760>-side</font> right <font color=#653760>-fill</font> y} ;<i><font color=#4b5d50># -after $wneigb&quot;</font></i>
          } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$posofnei</font> eq {T}} {
            <font color=#1b1baa>$wneigb</font> config <font color=#653760>-xscrollcommand</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>wname set&quot;</font>
            <b><font color=#3a6797>set</font></b> attrs <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>attrs -com \\\{<font color=#1b1baa>$</font>wneigb xview\\\}&quot;</font>
            <b><font color=#3a6797>append</font></b> options { <font color=#653760>-side</font> bottom <font color=#653760>-fill</font> x} ;<i><font color=#4b5d50># -before $wneigb&quot;</font></i>
          }
          <b><font color=#3a6797>set</font></b> options [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$wneigb</font>] <font color=#1b1baa>$options</font>]
        }
        <i><font color=#4b5d50>#% doctest 1</font></i>
        <i><font color=#4b5d50>#%   set a &quot;123 \\\\\\\\ 45&quot;</font></i>
        <i><font color=#4b5d50>#%   eval append b {*}$a</font></i>
        <i><font color=#4b5d50>#%   set b</font></i>
        <i><font color=#4b5d50>#&gt;   123\45</font></i>
        <i><font color=#4b5d50>#&gt; doctest</font></i>
        <b><font color=#ca14ca>my</font></b> Pre attrs
        <b><font color=#3a6797>set</font></b> addcomms [<b><font color=#ca14ca>my</font></b> AdditionalCommands <font color=#1b1baa>$w</font> <font color=#1b1baa>$wname</font> attrs]
        <b><font color=#3a6797>eval</font></b> <font color=#1b1baa>$widget</font> <font color=#1b1baa>$wname</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$attrs</font>
        <b><font color=#ca14ca>my</font></b> Post <font color=#1b1baa>$wname</font> <font color=#1b1baa>$attrs</font>
        <b><font color=#3a6797>foreach</font></b> acm <font color=#1b1baa>$addcomms</font> {{<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$acm</font>}
        <i><font color=#4b5d50># for buttons and entries - set up the hotkeys (Up/Down etc.)</font></i>
        <b><font color=#ca14ca>my</font></b> DefineWidgetKeys <font color=#1b1baa>$wname</font> <font color=#1b1baa>$widget</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$neighbor</font> eq {-} || <font color=#1b1baa>$row</font> &lt; 0} {
        <b><font color=#3a6797>set</font></b> row [<b><font color=#3a6797>set</font></b> col 0]
      }
      <i><font color=#4b5d50># check for simple creation of widget (without pack/grid)</font></i>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$neighbor</font> ne {#}} {
        <b><font color=#3a6797>set</font></b> options [<b><font color=#ca14ca>my</font></b> GetIntOptions <font color=#1b1baa>$w</font> <font color=#1b1baa>$options</font> <font color=#1b1baa>$row</font> <font color=#1b1baa>$rowspan</font> <font color=#1b1baa>$col</font> <font color=#1b1baa>$colspan</font>]
        <b><font color=#3a6797>set</font></b> pack [<b><font color=#3a6797>string</font></b> trim <font color=#1b1baa>$options</font>]
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first add <font color=#1b1baa>$pack</font>]==0} {
          <b><font color=#3a6797>set</font></b> comm <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>winfo parent <font color=#1b1baa>$</font>wname<font color=#1b1baa>]</font> add <font color=#1b1baa>$</font>wname <font color=#1b1baa>[</font>string range <font color=#1b1baa>$</font>pack 4 end<font color=#1b1baa>]</font>&quot;</font>
          {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$comm</font>
        } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> first pack <font color=#1b1baa>$pack</font>]==0} {
          <b><font color=#3a6797>set</font></b> opts [<b><font color=#3a6797>string</font></b> trim [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$pack</font> 5 end]]
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first forget <font color=#1b1baa>$opts</font>]==0} {
            <b><font color=#134070>pack</font></b> forget {<b><font color=#3a6797>*</font></b>}[<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$opts</font> 6 end]
          } <b><font color=#3a6797>else</font></b> {
            <b><font color=#134070>pack</font></b> <font color=#1b1baa>$wname</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opts</font>
          }
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#134070>grid</font></b> <font color=#1b1baa>$wname</font> <font color=#653760>-row</font> <font color=#1b1baa>$row</font> <font color=#653760>-column</font> <font color=#1b1baa>$col</font> <font color=#653760>-rowspan</font> <font color=#1b1baa>$rowspan</font> \
             <font color=#653760>-columnspan</font> <font color=#1b1baa>$colspan</font> <font color=#653760>-padx</font> 1 <font color=#653760>-pady</font> 1 {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$options</font>
        }
      }
      <b><font color=#3a6797>lappend</font></b> lused [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$name</font> <font color=#1b1baa>$row</font> <font color=#1b1baa>$col</font> <font color=#1b1baa>$rowspan</font> <font color=#1b1baa>$colspan</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> i] &lt; <font color=#1b1baa>$lwlen</font>} {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> <font color=#1b1baa>$i</font>] name neighbor posofnei
        <b><font color=#3a6797>set</font></b> neighbor [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$neighbor</font>] 0]
        <b><font color=#3a6797>set</font></b> row -1
        <b><font color=#3a6797>foreach</font></b> cell <font color=#1b1baa>$lused</font> {
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$cell</font> uname urow ucol urowspan ucolspan
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> LowercaseWidgetName <font color=#1b1baa>$uname</font>] 0] eq <font color=#1b1baa>$neighbor</font>} {
            <b><font color=#3a6797>set</font></b> col <font color=#1b1baa>$ucol</font>
            <b><font color=#3a6797>set</font></b> row <font color=#1b1baa>$urow</font>
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$posofnei</font> eq {T} || <font color=#1b1baa>$posofnei</font> eq {}} {
              <b><font color=#3a6797>incr</font></b> row <font color=#1b1baa>$urowspan</font>
            } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$posofnei</font> eq {L}} {
              <b><font color=#3a6797>incr</font></b> col <font color=#1b1baa>$ucolspan</font>
            }
          }
        }
      }
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$lwidgets</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=paveWindow></a>
  <b><font color=#ca14ca>method</font></b> paveWindow {args} {
    <i><font color=#4b5d50># Processes &quot;win / list_of_widgets&quot; pairs.</font></i>
    <i><font color=#4b5d50>#   args - list of pairs &quot;win / lwidgets&quot;</font></i>
    <i><font color=#4b5d50># The *win* is a window's path. The *lwidgets* is a list of widget items.</font></i>
    <i><font color=#4b5d50># Each widget item contains:</font></i>
    <i><font color=#4b5d50>#   name - widget's name (first 3 characters define its type)</font></i>
    <i><font color=#4b5d50>#   neighbor - top or left neighbor of the widget</font></i>
    <i><font color=#4b5d50>#   posofnei - position of neighbor: T (top) or L (left)</font></i>
    <i><font color=#4b5d50>#   rowspan - row span of the widget</font></i>
    <i><font color=#4b5d50>#   colspan - column span of the widget</font></i>
    <i><font color=#4b5d50>#   options - grid/pack options</font></i>
    <i><font color=#4b5d50>#   attrs - attributes of widget</font></i>
    <i><font color=#4b5d50># First 3 items are mandatory, others are set at need.</font></i>
    <i><font color=#4b5d50># This method calls *paveWindow* in a cycle, to process a current &quot;win/lwidgets&quot; pair.</font></i>

    <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> wmain [<b><font color=#3a6797>set</font></b> wdia {}]
    <b><font color=#3a6797>foreach</font></b> {w lwidgets} <font color=#1b1baa>$args</font> {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> 0 0] eq {<b><font color=#3a6797>after</font></b>}} {
        <i><font color=#4b5d50># if 1st item is &quot;after idle&quot; or like &quot;after 1000&quot;, layout the window after...</font></i>
        <i><font color=#4b5d50># (fit for &quot;invisible independent&quot; windows/frames/tabs)</font></i>
        <b><font color=#3a6797>set</font></b> what [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lwidgets</font> 0 1]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$what</font> eq {idle} || [<b><font color=#3a6797>string</font></b> is integer <font color=#653760>-strict</font> <font color=#1b1baa>$what</font>]} {
          <b><font color=#3a6797>after</font></b> <font color=#1b1baa>$what</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] paveWindow <font color=#1b1baa>$w</font> [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$lwidgets</font> 1 end]]
          <b><font color=#3a6797>after</font></b> <font color=#1b1baa>$what</font> [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] colorWindow <font color=#1b1baa>$w</font> <font color=#653760>-doit</font>]
        }
        <b><font color=#ca14ca>continue</font></b>
      }
      <b><font color=#3a6797>lappend</font></b> res {<b><font color=#3a6797>*</font></b>}[<b><font color=#ca14ca>my</font></b> Window <font color=#1b1baa>$w</font> <font color=#1b1baa>$lwidgets</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> ifnd [<b><font color=#3a6797>regexp</font></b> <font color=#653760>-indices</font> <font color=#653760>-inline</font> {[.]dia\d+} <font color=#1b1baa>$w</font>]] ne {}} {
        <b><font color=#3a6797>set</font></b> wdia [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$w</font> 0 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$ifnd</font> 0 1]]
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> wmain .[<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$w</font> .] 1]
      }
    }
    <i><font color=#4b5d50># add a system Menu binding for the created window</font></i>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wdia</font>]} {::apave::initPOP <font color=#1b1baa>$wdia</font>} <b><font color=#3a6797>elseif</font></b> {
        [<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$wmain</font>]} {::apave::initPOP <font color=#1b1baa>$wmain</font>}
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=window></a>
  <b><font color=#ca14ca>method</font></b> window {args} {
    <i><font color=#4b5d50># Obsolete version of paveWindow (remains for compatibility).</font></i>
    <i><font color=#4b5d50># See also: paveWindow</font></i>

    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>uplevel</font></b> 1 [<b><font color=#3a6797>list</font></b> [<b><font color=#ca14ca>self</font></b>] paveWindow {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=WinVarname></a>
  <b><font color=#ca14ca>method</font></b> WinVarname {win} {
    <i><font color=#4b5d50># Gets a unique varname for a window.</font></i>
    <i><font color=#4b5d50>#   win - window's path</font></i>

    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>namespace</font></b> current]::PV(_WIN_,<font color=#1b1baa>$win</font>)
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=waitWinVar></a>
  <b><font color=#ca14ca>method</font></b> waitWinVar {win var modal} {
    <i><font color=#4b5d50># Tk waiting for variable's change.</font></i>
    <i><font color=#4b5d50>#   win - the window's path</font></i>
    <i><font color=#4b5d50>#   var - variable's name to receive a result (tkwait's variable)</font></i>
    <i><font color=#4b5d50>#   modal - yes at showing the window as modal</font></i>

    <i><font color=#4b5d50># first of all, wait till the window be visible</font></i>
    <b><font color=#3a6797>after</font></b> 1 ;<i><font color=#4b5d50># solves an issue with doubleclicking buttons</font></i>
    <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> viewable <font color=#1b1baa>$win</font>]} {
      <b><font color=#134070>tkwait</font></b> visibility <font color=#1b1baa>$win</font>
    }
    <b><font color=#3a6797>set</font></b> wmain [::apave::mainWindowOfApp]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$modal</font>} {      ;<i><font color=#4b5d50># for modal, grab the window</font></i>
      <b><font color=#3a6797>set</font></b> wgr [<b><font color=#134070>grab</font></b> current]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wmain</font> ne {} && <font color=#1b1baa>$wmain</font> ne <font color=#1b1baa>$win</font>} {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#134070>grab</font></b> set <font color=#1b1baa>$win</font>} e]} {
          <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>tkwait</font></b> visibility <font color=#1b1baa>$win</font>}  ;<i><font color=#4b5d50># 2nd attempt to get the window visible, by force</font></i>
          <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>grab</font></b> set <font color=#1b1baa>$win</font>}           ;<i><font color=#4b5d50># (not sure, where it can fire, still let it be)</font></i>
          <b><font color=#3a6797>puts</font></b> stderr <font color=#8b2a0e>&quot;\napave::waitWinVar - please send a note to apave developers on this catch. Error: <font color=#1b1baa>$</font>e&quot;</font>
          <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>puts</font></b> stderr <font color=#8b2a0e>&quot;apave::waitWinVar - <font color=#1b1baa>[</font>info level -1<font color=#1b1baa>]</font>\n&quot;</font>}
        }
      }
    }
    <i><font color=#4b5d50># at need, wait till the window associated variable be changed</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$var</font> ne {}} {
      <b><font color=#134070>tkwait</font></b> variable <font color=#1b1baa>$var</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$modal</font>} {      ;<i><font color=#4b5d50># for modal, release the grab and restore the old one</font></i>
      <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>grab</font></b> release <font color=#1b1baa>$win</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wgr</font> ne {}} {
        <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>grab</font></b> set <font color=#1b1baa>$wgr</font>}
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=showWindow></a>
  <b><font color=#ca14ca>method</font></b> showWindow {win modal ontop {var <font color=#8b2a0e>&quot;&quot;</font>} {minsize <font color=#8b2a0e>&quot;&quot;</font>} {waitvar 1} {waitme {}}} {
    <i><font color=#4b5d50># Displays a windows and goes in tkwait cycle to interact with a user.</font></i>
    <i><font color=#4b5d50>#   win - the window's path</font></i>
    <i><font color=#4b5d50>#   modal - yes at showing the window as modal</font></i>
    <i><font color=#4b5d50>#   ontop - yes at showing the window as topmost</font></i>
    <i><font color=#4b5d50>#   var - variable's name to receive a result (tkwait's variable)</font></i>
    <i><font color=#4b5d50>#   minsize - list {minwidth minheight} or {}</font></i>
    <i><font color=#4b5d50>#   waitvar - if yes, force tkwait variable (mostly for non-modal windows)</font></i>
    <i><font color=#4b5d50>#   waitme - if empty, deiconify immediately, otherwise after waiting a variable or &quot;timeout and/or idle&quot;</font></i>

    ::apave::InfoWindow [<b><font color=#3a6797>expr</font></b> {[::apave::InfoWindow] + 1}] <font color=#1b1baa>$win</font> <font color=#1b1baa>$modal</font> <font color=#1b1baa>$var</font> yes
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$waitme</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists <font color=#1b1baa>$waitme</font>]} {
        <b><font color=#3a6797>vwait</font></b> <font color=#1b1baa>$waitme</font>
        ::apave::deiconify <font color=#1b1baa>$win</font>
        <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>incr</font></b> <font color=#1b1baa>$waitme</font>} ;<i><font color=#4b5d50># used to trigger chained events</font></i>
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>after</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$waitme</font> ::apave::deiconify <font color=#1b1baa>$win</font>
      }
    } <b><font color=#3a6797>else</font></b> {
      ::apave::deiconify <font color=#1b1baa>$win</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$minsize</font> eq {}} {
      <b><font color=#3a6797>set</font></b> minsize [<b><font color=#3a6797>list</font></b> [<b><font color=#134070>winfo</font></b> width <font color=#1b1baa>$win</font>] [<b><font color=#134070>winfo</font></b> height <font color=#1b1baa>$win</font>]]
    }
    <b><font color=#134070>wm</font></b> minsize <font color=#1b1baa>$win</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$minsize</font>
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$win</font> &lt;Configure&gt; <font color=#8b2a0e>&quot;<font color=#1b1baa>[</font>namespace current<font color=#1b1baa>]</font>::WinResize <font color=#1b1baa>$</font>win&quot;</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ontop</font>} {<b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$win</font> <font color=#653760>-topmost</font> 1}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$modal</font>} {
      <i><font color=#4b5d50># modal window:</font></i>
      <b><font color=#ca14ca>my</font></b> waitWinVar <font color=#1b1baa>$win</font> <font color=#1b1baa>$var</font> <font color=#1b1baa>$modal</font>
      ::apave::InfoWindow [<b><font color=#3a6797>expr</font></b> {[::apave::InfoWindow] - 1}] <font color=#1b1baa>$win</font> <font color=#1b1baa>$modal</font> <font color=#1b1baa>$var</font>
    } <b><font color=#3a6797>else</font></b> {
      <i><font color=#4b5d50># non-modal window:</font></i>
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> wgr [<b><font color=#134070>grab</font></b> current]] ne {}} {
        <i><font color=#4b5d50># otherwise the non-modal window is irresponsive (in Windows even at WM level):</font></i>
        <b><font color=#134070>grab</font></b> release <font color=#1b1baa>$wgr</font>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$waitvar</font> && <font color=#1b1baa>$var</font> ne {}} {
        <b><font color=#ca14ca>my</font></b> waitWinVar <font color=#1b1baa>$win</font> <font color=#1b1baa>$var</font> <font color=#1b1baa>$modal</font> ;<i><font color=#4b5d50># show and wait for closing the window</font></i>
      }
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=showModal></a>
  <b><font color=#ca14ca>method</font></b> showModal {win args} {
    <i><font color=#4b5d50># Shows a window as modal.</font></i>
    <i><font color=#4b5d50>#   win - window's name</font></i>
    <i><font color=#4b5d50>#   args - attributes of window (&quot;-name value&quot; pairs)</font></i>

    <b><font color=#3a6797>set</font></b> ::apave::MODALWINDOW <font color=#1b1baa>$win</font>
    ::apave::setAppIcon <font color=#1b1baa>$win</font>
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-centerme</font> {} <font color=#653760>-ontop</font> 0 <font color=#653760>-modal</font> yes \
      <font color=#653760>-minsize</font> {} <font color=#653760>-themed</font> {} <font color=#653760>-input</font> 0 <font color=#653760>-variable</font> {} <font color=#653760>-waitvar</font> {} <font color=#653760>-transient</font> {-} \
      <font color=#653760>-root</font> {} <font color=#653760>-parent</font> {} <font color=#653760>-waitme</font> {}] \
      centerme ontop modal minsize themed input varname waitvar transient \
      root parent waitme
    <font color=#1b1baa>$win</font> configure <font color=#653760>-bg</font> [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> csGet] 3]  ;<i><font color=#4b5d50># removes blinking by default bg</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$themed</font> in {{} {0}} && [<b><font color=#ca14ca>my</font></b> csCurrent] != [apave::cs_Non]} {
      <b><font color=#ca14ca>my</font></b> colorWindow <font color=#1b1baa>$win</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$centerme</font> eq {}} {
      <i><font color=#4b5d50># obsolete options: -root, -parent</font></i>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$root</font> ne {}} {<b><font color=#3a6797>set</font></b> centerme <font color=#1b1baa>$root</font>} {<b><font color=#3a6797>set</font></b> centerme <font color=#1b1baa>$parent</font>}
    }
    <b><font color=#3a6797>set</font></b> root [<b><font color=#134070>winfo</font></b> parent <font color=#1b1baa>$win</font>]
    <b><font color=#3a6797>set</font></b> rooted 1
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$centerme</font> ne {}} {
      ;<i><font color=#4b5d50># forced centering relative to a caller's window</font></i>
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$centerme</font> x+-] rw rh rx ry
      <b><font color=#3a6797>set</font></b> rooted [<b><font color=#3a6797>expr</font></b> {![<b><font color=#3a6797>regexp</font></b> {[+|-]+\d+\++} <font color=#1b1baa>$centerme</font>]}]
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rooted</font> && [<b><font color=#134070>winfo</font></b> exist <font color=#1b1baa>$centerme</font>]} {
        <b><font color=#3a6797>set</font></b> root <font color=#1b1baa>$centerme</font>
      }
    }
    <b><font color=#3a6797>set</font></b> decor [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$root</font> in {{} .}}]
    <b><font color=#3a6797>foreach</font></b> {o v} [<b><font color=#3a6797>list</font></b> <font color=#653760>-decor</font> <font color=#1b1baa>$decor</font> <font color=#653760>-focus</font> {} <font color=#653760>-onclose</font> {} <font color=#653760>-geometry</font> {} \
    <font color=#653760>-resizable</font> {} <font color=#653760>-ontop</font> 0 <font color=#653760>-escape</font> 1 <font color=#653760>-checkgeometry</font> 1] {
      <b><font color=#3a6797>lappend</font></b> defargs <font color=#1b1baa>$o</font> [<b><font color=#ca14ca>my</font></b> getShowOption <font color=#1b1baa>$o</font> <font color=#1b1baa>$v</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$varname</font> ne {}} {
      <b><font color=#3a6797>set</font></b> waitvar 1
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> waitvar [<b><font color=#3a6797>string</font></b> is true <font color=#1b1baa>$waitvar</font>]  ;<i><font color=#4b5d50># default 1: wait for closing the window</font></i>
      <b><font color=#3a6797>set</font></b> varname [<b><font color=#ca14ca>my</font></b> WinVarname <font color=#1b1baa>$win</font>]
    }
    <b><font color=#3a6797>array</font></b> set opt [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$defargs</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ontop</font> eq {}} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-ontop)</font>} {
        <b><font color=#3a6797>set</font></b> ontop yes
      } <b><font color=#3a6797>else</font></b> {
        <b><font color=#3a6797>set</font></b> ontop no
        <b><font color=#3a6797>catch</font></b> {
          <b><font color=#3a6797>set</font></b> ontop [<b><font color=#134070>wm</font></b> attributes [<b><font color=#134070>winfo</font></b> parent <font color=#1b1baa>$win</font>] <font color=#653760>-topmost</font>]
        }
        <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$ontop</font>} {
          <i><font color=#4b5d50># find if a window child of &quot;.&quot; is topmost</font></i>
          <i><font color=#4b5d50># if so, let this one be topmost too</font></i>
          <b><font color=#3a6797>foreach</font></b> w [<b><font color=#134070>winfo</font></b> children .] {
            <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> ontop [<b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$w</font> <font color=#653760>-topmost</font>]}
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ontop</font>} <b><font color=#ca14ca>break</font></b>
          }
        }
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$rooted</font>} {
      <b><font color=#3a6797>lassign</font></b> [::apave::splitGeometry [<b><font color=#134070>wm</font></b> geometry [<b><font color=#134070>winfo</font></b> toplevel <font color=#1b1baa>$root</font>]]] rw rh rx ry
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$transient</font> ne {-}} {
      <b><font color=#134070>wm</font></b> transient <font color=#1b1baa>$win</font> <font color=#1b1baa>$transient</font>
    } <b><font color=#3a6797>elseif</font></b> {!<font color=#1b1baa>$opt(-decor)</font>} {
      <b><font color=#134070>wm</font></b> transient <font color=#1b1baa>$win</font> <font color=#1b1baa>$root</font>
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> destroy [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$opt(-onclose)</font> eq {<b><font color=#134070>destroy</font></b>}}]]} {
      <b><font color=#3a6797>set</font></b> opt(-onclose) {}
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-onclose)</font> eq {}} {
      <b><font color=#3a6797>set</font></b> opt(-onclose) <font color=#8b2a0e>&quot;set <font color=#1b1baa>$</font>varname 0&quot;</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> opt(-onclose) <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>opt(-onclose) <font color=#1b1baa>$</font>varname&quot;</font>  ;<i><font color=#4b5d50># $opt(-onclose) is a command</font></i>
      <b><font color=#3a6797>set</font></b> opt(-onclose) [<b><font color=#3a6797>string</font></b> map [<b><font color=#3a6797>list</font></b> %w <font color=#1b1baa>$win</font>] <font color=#1b1baa>$opt(-onclose)</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$destroy</font>} {<b><font color=#3a6797>append</font></b> opt(-onclose) <font color=#8b2a0e>&quot; ; catch <font color=#1b1baa>{</font>destroy <font color=#1b1baa>$</font>win<font color=#1b1baa>}</font>&quot;</font>}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-resizable)</font> ne {}} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is boolean <font color=#1b1baa>$opt(-resizable)</font>]} {
        <b><font color=#3a6797>set</font></b> opt(-resizable) <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>opt(-resizable) <font color=#1b1baa>$</font>opt(-resizable)&quot;</font>
      }
      <b><font color=#134070>wm</font></b> resizable <font color=#1b1baa>$win</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opt(-resizable)</font>
    }
    <b><font color=#3a6797>if</font></b> {!(<font color=#1b1baa>$modal</font> || <font color=#1b1baa>$waitvar</font>)} {
      <b><font color=#3a6797>append</font></b> opt(-onclose) <font color=#8b2a0e>&quot;; ::apave::obj EXPORT CleanUps <font color=#1b1baa>$</font>win&quot;</font>
    }
    <b><font color=#3a6797>foreach</font></b> ev {KeyRelease ButtonRelease} {
      <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> bind <font color=#1b1baa>$Modalwin</font> &lt;<font color=#1b1baa>$ev</font>&gt; <font color=#8b2a0e>&quot;::apave::focusApp <font color=#1b1baa>$</font>Modalwin&quot;</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$modal</font>} {<b><font color=#3a6797>lappend</font></b> ::apave::FOCUSED <font color=#1b1baa>$win</font>}
    <b><font color=#134070>wm</font></b> protocol <font color=#1b1baa>$win</font> WM_TAKE_FOCUS {<b><font color=#3a6797>after</font></b> idle ::apave::focusApp}
    <b><font color=#134070>wm</font></b> protocol <font color=#1b1baa>$win</font> WM_DELETE_WINDOW <font color=#1b1baa>$opt(-onclose)</font>
    <i><font color=#4b5d50># get the window's geometry from its requested sizes</font></i>
    <b><font color=#3a6797>set</font></b> inpgeom <font color=#1b1baa>$opt(-geometry)</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$inpgeom</font> eq {}} {
      <i><font color=#4b5d50># this is for less blinking:</font></i>
      <b><font color=#3a6797>set</font></b> opt(-geometry) [<b><font color=#ca14ca>my</font></b> CenteredXY <font color=#1b1baa>$rw</font> <font color=#1b1baa>$rh</font> <font color=#1b1baa>$rx</font> <font color=#1b1baa>$ry</font> \
        [<b><font color=#134070>winfo</font></b> reqwidth <font color=#1b1baa>$win</font>] [<b><font color=#134070>winfo</font></b> reqheight <font color=#1b1baa>$win</font>]]
    } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> first pointer <font color=#1b1baa>$inpgeom</font>]==0} {
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$inpgeom</font>+0+0 +] -&gt; x y
      <b><font color=#3a6797>set</font></b> inpgeom +[<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$x</font>+[<b><font color=#134070>winfo</font></b> pointerx .]}]+[<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$y</font>+[<b><font color=#134070>winfo</font></b> pointery .]}]
      <b><font color=#3a6797>set</font></b> opt(-geometry) <font color=#1b1baa>$inpgeom</font>
    } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> first root <font color=#1b1baa>$inpgeom</font>]==0} {
      <b><font color=#3a6797>set</font></b> root .[<b><font color=#3a6797>string</font></b> trimleft [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$inpgeom</font> 5 end] .]
      <b><font color=#3a6797>set</font></b> opt(-geometry) [<b><font color=#3a6797>set</font></b> inpgeom {}]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-geometry)</font> ne {}} {
      <b><font color=#3a6797>lassign</font></b> [::apave::splitGeometry <font color=#1b1baa>$opt(-geometry)</font> {} {}] - - x y
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$x</font> ne {}} {<b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font> <font color=#1b1baa>$x$y</font>}
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-focus)</font> eq {}} {
      <b><font color=#3a6797>set</font></b> opt(-focus) <font color=#1b1baa>$win</font>
    }
    <b><font color=#3a6797>set</font></b> <font color=#1b1baa>$varname</font> {-}
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-escape)</font>} {<b><font color=#134070>bind</font></b> <font color=#1b1baa>$win</font> &lt;Escape&gt; <font color=#1b1baa>$opt(-onclose)</font>}
    <b><font color=#3a6797>update</font></b>
    <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$win</font>]} {
      <b><font color=#ca14ca>return</font></b> 0 ;<i><font color=#4b5d50># looks idiotic, yet possible at sporadic calls</font></i>
    }
    <b><font color=#3a6797>set</font></b> w [<b><font color=#134070>winfo</font></b> reqwidth <font color=#1b1baa>$win</font>]
    <b><font color=#3a6797>set</font></b> h [<b><font color=#134070>winfo</font></b> reqheight <font color=#1b1baa>$win</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$inpgeom</font> eq {}} {  ;<i><font color=#4b5d50># final geometrizing with actual sizes</font></i>
      <b><font color=#3a6797>set</font></b> geo [<b><font color=#ca14ca>my</font></b> CenteredXY <font color=#1b1baa>$rw</font> <font color=#1b1baa>$rh</font> <font color=#1b1baa>$rx</font> <font color=#1b1baa>$ry</font> <font color=#1b1baa>$w</font> <font color=#1b1baa>$h</font>]
      <b><font color=#3a6797>set</font></b> y [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$geo</font> +] end]
      <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$rooted</font> || <font color=#1b1baa>$root</font> ne {.} && ((<font color=#1b1baa>$h</font>/2-<font color=#1b1baa>$ry</font>-<font color=#1b1baa>$rh</font>/2)&gt;30 || [::iswindows] && <font color=#1b1baa>$y</font>&gt;0)} {
        <i><font color=#4b5d50># ::tk::PlaceWindow needs correcting in rare cases, namely:</font></i>
        <i><font color=#4b5d50># when 'root' is of less sizes than 'win' and at screen top</font></i>
        <b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font> <font color=#1b1baa>$geo</font>
      } <b><font color=#3a6797>else</font></b> {
        ::tk::PlaceWindow <font color=#1b1baa>$win</font> widget <font color=#1b1baa>$root</font>
      }
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>lassign</font></b> [::apave::splitGeometry <font color=#1b1baa>$inpgeom</font> {} {}] - - x y
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$x</font> ne {} && <font color=#1b1baa>$y</font> ne {} && [<b><font color=#3a6797>string</font></b> first x <font color=#1b1baa>$inpgeom</font>]&lt;0 && <font color=#1b1baa>$opt(-checkgeometry)</font>} {
        <b><font color=#3a6797>set</font></b> inpgeom [<b><font color=#ca14ca>my</font></b> checkXY <font color=#1b1baa>$w</font> <font color=#1b1baa>$h</font> <font color=#1b1baa>$x</font> <font color=#1b1baa>$y</font>]
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$x</font> eq {} && <font color=#1b1baa>$y</font> eq {} && <font color=#1b1baa>$centerme</font> ne {} && <font color=#1b1baa>$opt(-geometry)</font> ne {}} {
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$opt(-geometry)</font> x+] w h
        <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> [<b><font color=#ca14ca>my</font></b> CenteredXY <font color=#1b1baa>$rw</font> <font color=#1b1baa>$rh</font> <font color=#1b1baa>$rx</font> <font color=#1b1baa>$ry</font> <font color=#1b1baa>$w</font> <font color=#1b1baa>$h</font>] +] -&gt; x y
        <b><font color=#3a6797>set</font></b> inpgeom <font color=#1b1baa>${w}</font>x<font color=#1b1baa>$h</font>+<font color=#1b1baa>$x</font>+<font color=#1b1baa>$y</font>
      }
      <b><font color=#3a6797>set</font></b> inpgeom [::apave::checkGeometry <font color=#1b1baa>$inpgeom</font>]
      <b><font color=#134070>wm</font></b> geometry <font color=#1b1baa>$win</font> <font color=#1b1baa>$inpgeom</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$opt(-focus)</font> eq {Tab}} {
      <b><font color=#3a6797>after</font></b> 100 <font color=#8b2a0e>&quot;catch <font color=#1b1baa>{</font>focus <font color=#1b1baa>$</font>win; event generate <font color=#1b1baa>$</font>win &lt;Tab&gt;<font color=#1b1baa>}</font>&quot;</font> ;<i><font color=#4b5d50># to focus on 1st</font></i>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>after</font></b> 100 <font color=#8b2a0e>&quot;catch <font color=#1b1baa>{</font>focus -force <font color=#1b1baa>$</font>opt(-focus); apave::setProperty FOCW_<font color=#1b1baa>$</font>win <font color=#1b1baa>$</font>opt(-focus)<font color=#1b1baa>}</font>&quot;</font>
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::transpops::my::cntwait]} {
      <i><font color=#4b5d50># this specific bind - for transpops package (to hide a demo message by keys)</font></i>
      <b><font color=#134070>bind</font></b> <font color=#1b1baa>$win</font> &lt;Control-Alt-0&gt; {<b><font color=#3a6797>set</font></b> ::transpops::my::cntwait 0}
    }
    <b><font color=#ca14ca>my</font></b> showWindow <font color=#1b1baa>$win</font> <font color=#1b1baa>$modal</font> <font color=#1b1baa>$ontop</font> <font color=#1b1baa>$varname</font> <font color=#1b1baa>$minsize</font> <font color=#1b1baa>$waitvar</font> <font color=#1b1baa>$waitme</font>
    <b><font color=#3a6797>set</font></b> res 0
    <b><font color=#3a6797>catch</font></b> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$modal</font> || <font color=#1b1baa>$waitvar</font>} {<b><font color=#ca14ca>my</font></b> CleanUps <font color=#1b1baa>$win</font>}
      <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$win</font>]} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$input</font>} {<b><font color=#ca14ca>my</font></b> GetOutputValues}
        <b><font color=#3a6797>set</font></b> res [<b><font color=#3a6797>set</font></b> [<b><font color=#3a6797>set</font></b> _ <font color=#1b1baa>$varname</font>]]
      }
    }
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$res</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=res></a>
  <b><font color=#ca14ca>method</font></b> res {{win {}} {result get}} {
    <i><font color=#4b5d50># Gets/sets a variable for *vwait* command.</font></i>
    <i><font color=#4b5d50>#   win - window's path</font></i>
    <i><font color=#4b5d50>#   result - value of variable</font></i>
    <i><font color=#4b5d50># This method is used when</font></i>
    <i><font color=#4b5d50>#  - an event cycle should be stopped with changing a variable's value</font></i>
    <i><font color=#4b5d50>#  - a result of event cycle (the variable's value) should be got</font></i>
    <i><font color=#4b5d50># In the first case, *result* is set to an integer. In *apave* dialogs</font></i>
    <i><font color=#4b5d50># the integer is corresponding a pressed button's index.</font></i>
    <i><font color=#4b5d50># In the second case, *result* is omitted or equal to &quot;get&quot;.</font></i>
    <i><font color=#4b5d50># Returns a value of variable that controls an event cycle.</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$win</font> eq {}} {<b><font color=#3a6797>set</font></b> win [<b><font color=#ca14ca>my</font></b> dlgPath]}
    <b><font color=#3a6797>set</font></b> varname [<b><font color=#ca14ca>my</font></b> WinVarname <font color=#1b1baa>$win</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$result</font> eq {get}} {
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$varname</font>]
    }
    <b><font color=#ca14ca>my</font></b> CleanUps <font color=#1b1baa>$win</font>
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>set</font></b> <font color=#1b1baa>$varname</font> <font color=#1b1baa>$result</font>]
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=makeWindow></a>
  <b><font color=#ca14ca>method</font></b> makeWindow {w ttl args} {
    <i><font color=#4b5d50># Creates a toplevel window that has to be paved.</font></i>
    <i><font color=#4b5d50>#   w - window's name</font></i>
    <i><font color=#4b5d50>#   ttl - window's title</font></i>
    <i><font color=#4b5d50>#   args - options for 'toplevel' command</font></i>
    <i><font color=#4b5d50># If $w matches &quot;*.fra&quot; then ttk::frame is created with name $w.</font></i>

    <b><font color=#ca14ca>my</font></b> CleanUps
    <b><font color=#3a6797>set</font></b> w [<b><font color=#3a6797>set</font></b> wtop [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$w</font> .]]
    <b><font color=#3a6797>set</font></b> withfr [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>set</font></b> pp [<b><font color=#3a6797>string</font></b> last . <font color=#1b1baa>$w</font>]]&gt;0 && \
      [<b><font color=#3a6797>string</font></b> match *.fra <font color=#1b1baa>$w</font>]}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$withfr</font>} {
      <b><font color=#3a6797>set</font></b> wtop [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$w</font> 0 <font color=#1b1baa>$pp</font>-1]
    }
    <b><font color=#3a6797>catch</font></b> {<b><font color=#134070>destroy</font></b> <font color=#1b1baa>$wtop</font>}
    <b><font color=#3a6797>lassign</font></b> [::apave::extractOptions args <font color=#653760>-type</font> {}] type
    <b><font color=#3a6797>set</font></b> Modalwin [<b><font color=#134070>toplevel</font></b> <font color=#1b1baa>$wtop</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
    ::apave::withdraw <font color=#1b1baa>$wtop</font> ;<i><font color=#4b5d50># nice to hide all gui manipulations</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$type</font> ne {} && [<b><font color=#134070>tk</font></b> windowingsystem] eq {x11}} {
      <b><font color=#134070>wm</font></b> attributes <font color=#1b1baa>$wtop</font> <font color=#653760>-type</font> <font color=#1b1baa>$type</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$withfr</font>} {
      <b><font color=#134070>pack</font></b> [<b><font color=#134070>frame</font></b> <font color=#1b1baa>$w</font> <font color=#653760>-background</font> [<b><font color=#3a6797>lindex</font></b> [<b><font color=#ca14ca>my</font></b> csGet] 3]] <font color=#653760>-expand</font> 1 <font color=#653760>-fill</font> both
    }
    <b><font color=#134070>wm</font></b> title <font color=#1b1baa>$wtop</font> <font color=#1b1baa>$ttl</font>
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$wtop</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=displayText></a>
  <b><font color=#ca14ca>method</font></b> displayText {w conts {pos 1.0}} {
    <i><font color=#4b5d50># Sets the text widget's contents.</font></i>
    <i><font color=#4b5d50>#   w - text widget's name</font></i>
    <i><font color=#4b5d50>#   conts - contents to be set in the widget</font></i>

    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> state [<font color=#1b1baa>$w</font> cget <font color=#653760>-state</font>]] ne {normal}} {
      <font color=#1b1baa>$w</font> configure <font color=#653760>-state</font> normal
    }
    <font color=#1b1baa>$w</font> replace 1.0 end <font color=#1b1baa>$conts</font>
    <font color=#1b1baa>$w</font> edit reset; <font color=#1b1baa>$w</font> edit modified no
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$state</font> eq {normal}} {
      ::tk::TextSetCursor <font color=#1b1baa>$w</font> <font color=#1b1baa>$pos</font>
    } <b><font color=#3a6797>else</font></b> {
      <font color=#1b1baa>$w</font> configure <font color=#653760>-state</font> <font color=#1b1baa>$state</font>
    }
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=resetText></a>
  <b><font color=#ca14ca>method</font></b> resetText {w state {contsName {}}} {
    <i><font color=#4b5d50># Resets a text widget to edit/view from scratch.</font></i>
    <i><font color=#4b5d50>#   w - text widget's name</font></i>
    <i><font color=#4b5d50>#   state - widget's final state (normal/disabled)</font></i>
    <i><font color=#4b5d50>#   contsName - variable name for contents to be set in the widget</font></i>

    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$contsName</font> ne {}} {
      <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$contsName</font> conts
      <font color=#1b1baa>$w</font> replace 1.0 end <font color=#1b1baa>$conts</font>
    }
    <font color=#1b1baa>$w</font> edit reset
    <font color=#1b1baa>$w</font> edit modified no
    <font color=#1b1baa>$w</font> configure <font color=#653760>-state</font> <font color=#1b1baa>$state</font>
  }
  <i><font color=#4b5d50>#_______________________</font></i>
<a id=displayTaggedText></a>
  <b><font color=#ca14ca>method</font></b> displayTaggedText {w contsName {tags <font color=#8b2a0e>&quot;&quot;</font>}} {
    <i><font color=#4b5d50># Sets the text widget's contents using tags (ornamental details).</font></i>
    <i><font color=#4b5d50>#   w - text widget's name</font></i>
    <i><font color=#4b5d50>#   contsName - variable name for contents to be set in the widget</font></i>
    <i><font color=#4b5d50>#   tags - list of tags to be applied to the text</font></i>
    <i><font color=#4b5d50># The lines in *text contents* are divided by \n and can include</font></i>
    <i><font color=#4b5d50># *tags* like in a html layout, e.g. &lt;red&gt;RED ARMY&lt;/red&gt;.</font></i>
    <i><font color=#4b5d50># The *tags* is a list of &quot;name/value&quot; pairs. 1st is a tag's name, 2nd</font></i>
    <i><font color=#4b5d50># is a tag's value.</font></i>
    <i><font color=#4b5d50># The tag's name is &quot;pure&quot; one (without &lt;&gt;) so e.g.for &lt;b&gt;..&lt;/b&gt; the tag</font></i>
    <i><font color=#4b5d50># list contains &quot;b&quot;.</font></i>
    <i><font color=#4b5d50># The tag's value is a string of text attributes (-font etc.).</font></i>
    <i><font color=#4b5d50># If the tag's name is FG, FG2, BG or BG2, then it is really a link color.</font></i>

    <b><font color=#3a6797>upvar</font></b> <font color=#1b1baa>$contsName</font> conts
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tags</font> eq {}} {
      <b><font color=#ca14ca>my</font></b> displayText <font color=#1b1baa>$w</font> <font color=#1b1baa>$conts</font>
      <b><font color=#ca14ca>return</font></b>
    }
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#ca14ca>my</font></b> csGet] fg fg2 bg bg2
    <b><font color=#3a6797>if</font></b> { [<b><font color=#3a6797>set</font></b> state [<font color=#1b1baa>$w</font> cget <font color=#653760>-state</font>]] ne {normal}} {
      <font color=#1b1baa>$w</font> configure <font color=#653760>-state</font> normal
    }
    <b><font color=#3a6797>set</font></b> taglist [<b><font color=#3a6797>set</font></b> tagpos [<b><font color=#3a6797>set</font></b> taglen [<b><font color=#3a6797>list</font></b>]]]
    <b><font color=#3a6797>foreach</font></b> tagi <font color=#1b1baa>$tags</font> {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$tagi</font> tag opts
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$tag</font> in {FG FG2 BG BG2} } {
        <b><font color=#3a6797>set</font></b> [<b><font color=#3a6797>string</font></b> tolower <font color=#1b1baa>$tag</font>] <font color=#1b1baa>$opts</font>
      } <b><font color=#3a6797>elseif</font></b> {![<b><font color=#3a6797>string</font></b> match link* <font color=#1b1baa>$tag</font>]} {
        <font color=#1b1baa>$w</font> tag config <font color=#1b1baa>$tag</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opts</font>
      }
      <b><font color=#3a6797>lappend</font></b> tagpos 0
      <b><font color=#3a6797>lappend</font></b> taglen [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$tag</font>]
    }
    <b><font color=#3a6797>set</font></b> tLen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$tags</font>]
    <b><font color=#3a6797>set</font></b> disptext {}
    <b><font color=#3a6797>set</font></b> irow 1
    <b><font color=#3a6797>foreach</font></b> line [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$conts</font> \n] {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$irow</font> &gt; 1} {
        <b><font color=#3a6797>append</font></b> disptext \n
      }
      <b><font color=#3a6797>set</font></b> newline {}
      <b><font color=#3a6797>while</font></b> 1 {
        <b><font color=#3a6797>set</font></b> p [<b><font color=#3a6797>string</font></b> first \&lt; <font color=#1b1baa>$line</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p</font> &lt; 0} {
          <b><font color=#ca14ca>break</font></b>
        }
        <b><font color=#3a6797>append</font></b> newline [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 0 <font color=#1b1baa>$p</font>-1]
        <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$p</font> end]
        <b><font color=#3a6797>set</font></b> i 0
        <b><font color=#3a6797>set</font></b> nrnc <font color=#1b1baa>$irow</font>.[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$newline</font>]
        <b><font color=#3a6797>foreach</font></b> tagi <font color=#1b1baa>$tags</font> pos <font color=#1b1baa>$tagpos</font> len <font color=#1b1baa>$taglen</font> {
          <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$tagi</font> tag
          <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first &lt;<font color=#1b1baa>$tag</font>&gt; <font color=#1b1baa>$line</font>]==0} {
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pos</font> ne {0}} {
              <b><font color=#3a6797>error</font></b> <font color=#8b2a0e>&quot;\napave: mismatched &lt;<font color=#1b1baa>$</font>tag&gt; in line <font color=#1b1baa>$</font>irow.\n&quot;</font>
            }
            <b><font color=#3a6797>lset</font></b> tagpos <font color=#1b1baa>$i</font> <font color=#1b1baa>$nrnc</font>
            <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$len</font>+2 end]
            <b><font color=#ca14ca>break</font></b>
          } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>string</font></b> first &lt;/<font color=#1b1baa>$tag</font>&gt; <font color=#1b1baa>$line</font>]==0} {
            <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pos</font> eq {0}} {
              <b><font color=#3a6797>error</font></b> <font color=#8b2a0e>&quot;\napave: mismatched &lt;/<font color=#1b1baa>$</font>tag&gt; in line <font color=#1b1baa>$</font>irow.\n&quot;</font>
            }
            <b><font color=#3a6797>lappend</font></b> taglist [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$i</font> <font color=#1b1baa>$pos</font> <font color=#1b1baa>$nrnc</font>]
            <b><font color=#3a6797>lset</font></b> tagpos <font color=#1b1baa>$i</font> 0
            <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$len</font>+3 end]
            <b><font color=#ca14ca>break</font></b>
          }
          <b><font color=#3a6797>incr</font></b> i
        }
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i</font> == <font color=#1b1baa>$tLen</font>} {
          <i><font color=#4b5d50># tag not found after &quot;&lt;&quot; - shift by 1 character</font></i>
          <b><font color=#3a6797>append</font></b> newline [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> 0]
          <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 1 end]
        }
      }
      <b><font color=#3a6797>append</font></b> disptext <font color=#1b1baa>$newline</font> <font color=#1b1baa>$line</font>
      <b><font color=#3a6797>incr</font></b> irow
    }
    <font color=#1b1baa>$w</font> replace 1.0 end <font color=#1b1baa>$disptext</font>
    <b><font color=#3a6797>set</font></b> lfont [<font color=#1b1baa>$w</font> cget <font color=#653760>-font</font>]
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> lfont [<b><font color=#134070>font</font></b> actual <font color=#1b1baa>$lfont</font>]}
    <b><font color=#3a6797>foreach</font></b> {o v} [<b><font color=#ca14ca>my</font></b> initLinkFont] {<b><font color=#3a6797>dict</font></b> set lfont <font color=#1b1baa>$o</font> <font color=#1b1baa>$v</font>}
    <b><font color=#3a6797>set</font></b> ::apave::__TEXTLINKS__(<font color=#1b1baa>$w</font>) [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> it [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$taglist</font>]} {[<b><font color=#3a6797>incr</font></b> it -1]&gt;=0} {} {
      <b><font color=#3a6797>set</font></b> tagli [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$taglist</font> <font color=#1b1baa>$it</font>]
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$tagli</font> i p1 p2
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$tags</font> <font color=#1b1baa>$i</font>] tag opts
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> match link* <font color=#1b1baa>$tag</font>] && \
      [<b><font color=#3a6797>set</font></b> ist [<b><font color=#3a6797>lsearch</font></b> <font color=#653760>-exact</font> <font color=#653760>-index</font> 0 <font color=#1b1baa>$tags</font> <font color=#1b1baa>$tag</font>]]&gt;=0} {
        <b><font color=#3a6797>set</font></b> txt [<font color=#1b1baa>$w</font> get <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font>]
        <b><font color=#3a6797>set</font></b> lab <font color=#1b1baa>${w}</font>l[<b><font color=#3a6797>incr</font></b> ::apave::__linklab__]
        <b><font color=#134070>ttk::label</font></b> <font color=#1b1baa>$lab</font> <font color=#653760>-text</font> <font color=#1b1baa>$txt</font> <font color=#653760>-font</font> <font color=#1b1baa>$lfont</font> <font color=#653760>-foreground</font> <font color=#1b1baa>$fg</font> <font color=#653760>-background</font> <font color=#1b1baa>$bg</font>
        <b><font color=#3a6797>set</font></b> ::apave::__TEXTLINKS__(<font color=#1b1baa>$w</font>) [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$::apave::__TEXTLINKS__($w)</font> 0 <font color=#1b1baa>$lab</font>]
        <font color=#1b1baa>$w</font> delete <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font>
        <font color=#1b1baa>$w</font> window create <font color=#1b1baa>$p1</font> <font color=#653760>-window</font> <font color=#1b1baa>$lab</font>
        <b><font color=#3a6797>set</font></b> v [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$tags</font> <font color=#1b1baa>$ist</font> 1]
        <b><font color=#ca14ca>my</font></b> makeLabelLinked <font color=#1b1baa>$lab</font> <font color=#1b1baa>$v</font> <font color=#1b1baa>$fg</font> <font color=#1b1baa>$bg</font> <font color=#1b1baa>$fg2</font> <font color=#1b1baa>$bg2</font>
      } <b><font color=#3a6797>else</font></b> {
        <font color=#1b1baa>$w</font> tag add <font color=#1b1baa>$tag</font> <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font>
      }
    }
    <b><font color=#ca14ca>my</font></b> resetText <font color=#1b1baa>$w</font> <font color=#1b1baa>$state</font>
  }
<a id=EOC_::apave::APaveBase></a>
<i><font color=#4b5d50># ________________________ EOC ::apave::APaveBase _________________________ #</font></i>

}
<a id=EOF></a>
<i><font color=#4b5d50># _____________________________ EOF _____________________________________ #</font></i>

</pre>

<table border=0 cellPadding=4 cellSpacing=0 width=100%>  <td border=0 bgColor=#87bcd3><div style=text-align:center>  <a href="../index.html"><font color=#1a1a1a size=6>  <b>apavebase.tcl</b></font></div></td></table>

</section>
<script>
  writeFooter('Generated by <a href="'+homeLINK()+'/en/tcl/alited/index.html">alited</a> &amp; <a href="'+homeLINK()+'/en/tcl/mulster/index.html">mulster</a></a>');
</script>
</div>
</body>
</html>