<!DOCTYPE html><html><head><meta charset="utf-8"/>
<link rel="stylesheet" href="../../../zoo/sh/styles/aplsimple.css">
<title>::playtkl reference</title>
<style>
/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
html{color:#000;background:#FFF;}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,button,textarea,p,blockquote,th,td{margin:0;padding:0;}table{border-collapse:collapse;border-spacing:0;}fieldset,img{border:0;}address,caption,cite,code,dfn,em,strong,th,var,optgroup{font-style:inherit;font-weight:inherit;}del,ins{text-decoration:none;}li{list-style:none;}caption,th{text-align:left;}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal;}q:before,q:after{content:'';}abbr,acronym{border:0;font-variant:normal;}sup{vertical-align:baseline;}sub{vertical-align:baseline;}legend{color:#000;}input,button,textarea,select,optgroup,option{font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;}input,button,textarea,select{*font-size:100%;}body{font:13px/1.231 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small;}select,input,button,textarea,button{font:99% arial,helvetica,clean,sans-serif;}table{font-size:inherit;font:100%;}pre,code,kbd,samp,tt{font-family:Consolas,"Courier New",monospace;font-size:100%;line-height:100%;}body{text-align:center;}#doc,#doc2,#doc3,#doc4,.yui-t1,.yui-t2,.yui-t3,.yui-t4,.yui-t5,.yui-t6,.yui-t7{margin:auto;text-align:left;width:57.69em;*width:56.25em;}#doc2{width:73.076em;*width:71.25em;}#doc3{margin:auto;width:auto;}#doc4{width:74.923em;*width:73.05em;}.yui-b{position:relative;}.yui-b{_position:static;}#yui-main .yui-b{position:static;}#yui-main,.yui-g .yui-u .yui-g{width:100%;}.yui-t1 #yui-main,.yui-t2 #yui-main,.yui-t3 #yui-main{float:right;margin-left:-25em;}.yui-t4 #yui-main,.yui-t5 #yui-main,.yui-t6 #yui-main{float:left;margin-right:-25em;}.yui-t1 .yui-b{float:left;width:12.30769em;*width:12.00em;}.yui-t1 #yui-main .yui-b{margin-left:13.30769em;*margin-left:13.05em;}.yui-t2 .yui-b{float:left;width:9.8461em;*width:13.50em;}.yui-t2 #yui-main .yui-b{margin-left:10.8461em;*margin-left:14.55em;}.yui-t3 .yui-b{float:left;width:23.0769em;*width:22.50em;}.yui-t3 #yui-main .yui-b{margin-left:24.0769em;*margin-left:23.62em;}.yui-t4 .yui-b{float:right;width:13.8456em;*width:13.50em;}.yui-t4 #yui-main .yui-b{margin-right:14.8456em;*margin-right:14.55em;}.yui-t5 .yui-b{float:right;width:18.4615em;*width:18.00em;}.yui-t5 #yui-main .yui-b{margin-right:19.4615em;*margin-right:19.125em;}.yui-t6 .yui-b{float:right;width:23.0769em;*width:22.50em;}.yui-t6 #yui-main .yui-b{margin-right:24.0769em;*margin-right:23.62em;}.yui-t7 #yui-main .yui-b{display:block;margin:0 0 1em 0;}#yui-main .yui-b{float:none;width:auto;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf,.yui-gc .yui-u,.yui-gd .yui-g,.yui-g .yui-gc .yui-u,.yui-ge .yui-u,.yui-ge .yui-g,.yui-gf .yui-g,.yui-gf .yui-u{float:right;}.yui-g div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first,.yui-ge div.first,.yui-gf div.first,.yui-g .yui-gc div.first,.yui-g .yui-ge div.first,.yui-gc div.first div.first{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf{width:49.1%;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{width:32%;margin-left:1.99%;}.yui-gb .yui-u{*margin-left:1.9%;*width:31.9%;}.yui-gc div.first,.yui-gd .yui-u{width:66%;}.yui-gd div.first{width:32%;}.yui-ge div.first,.yui-gf .yui-u{width:74.2%;}.yui-ge .yui-u,.yui-gf div.first{width:24%;}.yui-g .yui-gb div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first{margin-left:0;}.yui-g .yui-g .yui-u,.yui-gb .yui-g .yui-u,.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u,.yui-ge .yui-g .yui-u,.yui-gf .yui-g .yui-u{width:49%;*width:48.1%;*margin-left:0;}.yui-g .yui-g .yui-u{width:48.1%;}.yui-g .yui-gb div.first,.yui-gb .yui-gb div.first{*margin-right:0;*width:32%;_width:31.7%;}.yui-g .yui-gc div.first,.yui-gd .yui-g{width:66%;}.yui-gb .yui-g div.first{*margin-right:4%;_margin-right:1.3%;}.yui-gb .yui-gc div.first,.yui-gb .yui-gd div.first{*margin-right:0;}.yui-gb .yui-gb .yui-u,.yui-gb .yui-gc .yui-u{*margin-left:1.8%;_margin-left:4%;}.yui-g .yui-gb .yui-u{_margin-left:1.0%;}.yui-gb .yui-gd .yui-u{*width:66%;_width:61.2%;}.yui-gb .yui-gd div.first{*width:31%;_width:29.5%;}.yui-g .yui-gc .yui-u,.yui-gb .yui-gc .yui-u{width:32%;_float:right;margin-right:0;_margin-left:0;}.yui-gb .yui-gc div.first{width:66%;*float:left;*margin-left:0;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf .yui-u{margin:0;}.yui-gb .yui-gb .yui-u{_margin-left:.7%;}.yui-gb .yui-g div.first,.yui-gb .yui-gb div.first{*margin-left:0;}.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u{*width:48.1%;*margin-left:0;}.yui-gb .yui-gd div.first{width:32%;}.yui-g .yui-gd div.first{_width:29.9%;}.yui-ge .yui-g{width:24%;}.yui-gf .yui-g{width:74.2%;}.yui-gb .yui-ge div.yui-u,.yui-gb .yui-gf div.yui-u{float:right;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf div.first{float:left;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf div.first{*width:24%;_width:20%;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf .yui-u{*width:73.5%;_width:65.5%;}.yui-ge div.first .yui-gd .yui-u{width:65%;}.yui-ge div.first .yui-gd div.first{width:32%;}#hd:after,#bd:after,#ft:after,.yui-g:after,.yui-gb:after,.yui-gc:after,.yui-gd:after,.yui-ge:after,.yui-gf:after{content:".";display:block;height:0;clear:both;visibility:hidden;}#hd,#bd,#ft,.yui-g,.yui-gb,.yui-gc,.yui-gd,.yui-ge,.yui-gf{zoom:0;}

body{margin:10px;}h1{font-size:138.5%;}h2{font-size:123.1%;}h3{font-size:108%;}h1,h2,h3{margin:1em 0;}h1,h2,h3,h4,h5,h6,strong,dt{font-weight:bold;}optgroup{font-weight:normal;}abbr,acronym{border-bottom:1px dotted #000;cursor:help;}em{font-style:italic;}del{text-decoration:line-through;}blockquote,ul,ol,dl{margin:1em;}ol,ul,dl{margin-left:2em;}ol li{list-style:decimal outside;}ul li{list-style:disc outside;}dl dd{margin-left:1em;}th,td{border:1px solid #000;padding:.5em;}th{font-weight:bold;text-align:center;}caption{margin-bottom:.5em;text-align:center;}sup{vertical-align:super;}sub{vertical-align:sub;}p,fieldset,table,pre{margin-bottom:1em;}button,input[type="checkbox"],input[type="radio"],input[type="reset"],input[type="submit"]{padding:1px;}

/* Ruff default CSS */

body {
  /*max-width: 70em;*/
  margin: 0;
}

h1,h2 {
  color: #888888;
  margin-bottom: 0.5em;
  margin-top: 0em;
}

#ft { font-size: x-small; font-family: Arial, sans-serif;
  text-align: left;
  border-top: 1px solid #0B3467;
  color: #888888;
  margin-top: 10px;
}

.banner h2 {
  color: #0B3467;
}

#hd.banner {
 font-family: "Times New Roman", serif;
 font-size: 200%;
 line-height: 64px;
 border-bottom: thin solid #0B3467;
 color: #0B3467;
}

p.linkline {
  text-align: right;
  font-size: smaller;
  /*    margin-top: -1em; */
  margin-bottom: 0;
}

.tinylink {
  font-size: x-small;
  font-variant: normal;
  font-family: Arial, sans-serif;
  float: right;
  padding:2px;
}

h1 .tinylink a {
  color: white;
}

#bd {
font-family: Arial, sans-serif;
/*font-size: 108%;*/
}

div.navbox {
  /* margin-top: 1em; */
  background-color: #0B3467;
  color: white;
  padding: 3px 4px 2px 4px;
  font-family: Arial, sans-serif;
  overflow: hidden;
}

div.navbox:hover {
  overflow: visible;
}

/* Note .navbox header css should be based on $header_levels */
.navbox h1, .navbox h2, .navbox h3, .navbox h4, .navbox h5 {
  font-size: 85%;
  margin: 0px;
  font-weight: normal;
}
.navbox h1 {
  font-weight: bold; /* Override */
}
.navbox h2 {
  padding-left: 1em;
}
.navbox h3 {
  padding-left: 2em;
}
.navbox h4 {
  padding-left: 2.5em;
  font-weight: normal;
}
.navbox h5 {
  padding-left: 3em;
  font-weight: normal;
}
.navbox hr {
  color: white;
  margin-top:0.1em;
  margin-bottom:0.1em;
}

.navbox a:link, .navbox a:visited, .navbox a:hover {
  text-decoration: none;
  color: white;
  background-color: #0B3467;
}

.navbox a:hover {
   font-weight: bold;
}

/* Tooltip text - see https://www.w3schools.com/css/css_tooltip.asp */
.tooltip {
  position: relative;
  /* display: inline-block; */
}

.tooltip .tooltiptext {
  width: 100%;
  font-weight: bold;
  background-color: white;
  color: #0B3467;
  text-align: left;
  border: 1px solid #0B3467;
  /* border-radius: 4px; */
  position: absolute;
  z-index: 1;
  margin-left: 4px;
  padding: 2px 3px;
  visibility: hidden;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
}

span.ns_scope {
  color: #aaaaaa;
}

span.ns_scope a:link, span.ns_scope a:visited {
  text-decoration: none;
  color: #aaaaaa;

}

li {
  margin-top: 0.5em;
}

span.ns_scope a:hover {
  text-decoration: none;
  color: #666666;
}

table {
  margin: 1em;
  margin-top: 0.5em;
  border: thin solid;
  border-collapse: collapse;
  border-color: #808080;
  padding: 4px;
}

td {
  border: thin solid;
  border-color: #808080;
  vertical-align: top;
  font-size: 93%;
  padding: 0.3em;
  padding-top: 0.1em;
}
th {
  border: thin solid;
  border-color: #808080;
  padding: 0.3em;
  padding-top: 0.1em;
  background-color: #CCCCCC;
}

dt, dd {
   font-size: 93%;
}

h1.ruff {
  background-color: #0B3467;
  color: #ffffff;
  padding-left: 0.2em;
  font-family: "Times New Roman", serif;
}
h2.ruff {
  font-variant: small-caps;
  color: #0B3467;
  font-weight: bold;
  font-family: "Times New Roman", serif;
}

h3.ruff, h4.ruff, h5.ruff, h6.ruff {
  color: #0B3467;
}
h5.ruff {
  font-style: italic;
  font-weight: normal;
}
h6.ruff {
  font-weight: normal;
}
h3.ruffclass, h3.ruffproc, h3.ruffmethod,
h4.ruffclass, h4.ruffproc, h4.ruffmethod,
h5.ruffclass, h5.ruffproc, h5.ruffmethod {
  border-bottom: thin solid #0B3467;
  color: #0B3467;
  margin-bottom: 0.2em;
}

pre {
  background-color: #f9f9f9;
  margin-top: 1em;
  margin-left: 1em;
  padding: 5px;
  font-family: Consolas, "Courier New", monospace;
  /* width: max-content; --- to leave footsteps */ overflow: auto;
  line-height: 1.2em;
}

.ruff_dyn_src {
  display: none; /* Displayed via JS */
}

.ruff_synopsis {
  border: thin solid #cccccc;
  background: #f9f9f9;
  font-family: Consolas, "Courier New", monospace;
  padding: 5px;
  margin: 0em 2em 1em;
}
.ruff_const, .ruff_cmd, ruff_defitem {
  font-weight: bold;
  font-family: Consolas, "Courier New", monospace;
}
.ruff_arg {
  font-style: italic;
  font-family: Consolas, "Courier New", monospace;
}

.ruff_source_link {
  font-size: smaller;
}

.ruff_index {
  font-size: small;
  color: grey;
  line-height: 1;
}

.ruff_index ul li {
  list-style-type: none;
}

.ruff_index ul li a {
  text-decoration: none;
}
</style>
<script>function toggleSource( id )
{
  /* Copied from Rails */
  var elem
  var link

  if( document.getElementById )
  {
      elem = document.getElementById( id )
      link = document.getElementById( "l_" + id )
  }
  else if ( document.all )
  {
      elem = eval( "document.all." + id )
      link = eval( "document.all.l_" + id )
  }
  else
      return false;

  if( elem.style.display == "block" )
  {
      elem.style.display = "none"
      link.innerHTML = "Show source"
  }
  else
  {
      elem.style.display = "block"
      link.innerHTML = "Hide source"
  }
}
</script></head>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
<link rel="stylesheet" href="../../../en/zoo/style.css">
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<link rel="icon" type="image/jpg" href="../../../zoo/favicon.jpg">
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<script src="../../../zoo/funcs.js"></script>
<script src="../../../en/zoo/this.js"></script>
<section id=sec2>
<div id='hd' class='banner'>
<a name='playtkl.html'>::playtkl reference</a>
</div>
<div id='bd'><div id='yui-main'><div class='yui-b'><h1 class='ruff'><a name='::playtkl'></a>::playtkl<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<br><h2 class='ruff'><a name='::playtkl-What's that'></a>What's that<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The <em>playtkl</em> is Tcl/Tk package that is used:</p>
<ul class='ruff'>
<li>to make a testing scenario for a Tk application</li>
<li>to run a testing scenario for a Tk application</li>
<li>to record a macro containing mouse / keyboard actions</li>
<li>to play a macro</li>
</ul>
<p class='ruff'>So, there are two working modes of <em>playtkl</em>: recording and playing. At recording, mouse / keyboard actions occured in a Tk application are saved to a file. At playing, the saved actions are read from the file and played back as if the actions were performed by a human.</p>
<p class='ruff'>The <em>playtkl</em> is used only with Tk applications. Other GUI Tcl libraries aren't supported.</p>
<br><h2 class='ruff'><a name='::playtkl-Testing Tk'></a>Testing Tk<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>With GUI applications, <a href="https://wiki.tcl-lang.org/page/tcltest" >tcltest</a> and <a href="https://wiki.tcl-lang.org/page/doctest+for+Tcl" >doctest</a> couldn't help you a lot.</p>
<p class='ruff'>To test a GUI application &quot;properly&quot;, you might act this way:</p>
<p class='ruff'>1. You <em>record</em> the key / mouse pressings in the application, supposedly at its &quot;good&quot; behavior. Thus, you get a testing scenario of &quot;good&quot; behavior.</p>
<p class='ruff'>2. After a while, some changes are made to the application.</p>
<p class='ruff'>3. You <em>play back</em> the testing scenario in the application, viewing this spectacle and noticing all discrepancies against the &quot;good&quot; behavior. Or just comparing the final state of the played to the recorded.</p>
<p class='ruff'>4. You repeat steps 2 and 3 to keep the application consistent with the testing scenario. At need 1st step can be repeated too, if some cool features are introduced into the application. Old scenarios may be saved and rerun as well.</p>
<p class='ruff'>The <em>playtkl</em> package is rather good for this way of testing.</p>
<p class='ruff'>Of course, as usually with Tcl/Tk, there are alternative ways, see e.g.</p>
<ul class='ruff'>
<li><a href="https://wiki.tcl-lang.org/page/A+little+GUI+tester" >A little GUI tester</a></li>
<li><a href="https://wiki.tcl-lang.org/page/Law+of+Demos%2C+tests+and+transpops" >Law of Demos, tests and transpops</a></li>
</ul>
<br><h2 class='ruff'><a name='::playtkl-How's that'></a>How's that<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>To enable <em>playtkl</em>, a Tk application should <em>source playtkl.tcl</em> and then run the recording or the playing part of it, for example this way:</p>
<pre class='ruff'><br><code class="tcl"><b><font color=#3a6797>if</font></b> 0 {
  <b><font color=#3a6797>source</font></b> playtkl.tcl

  <b><font color=#3a6797>set</font></b> playtklfname ./playtkl.log
  playtkl::inform no

  <b><font color=#3a6797>if</font></b> 0 {

    <i><font color=#4b5d50># 1. recording</font></i>
    <b><font color=#3a6797>after</font></b> 4000 <font color=#8b2a0e>&quot;playtkl::record <font color=#1b1baa>$</font>playtklfname F11&quot;</font>  ;<i><font color=#4b5d50># or just: playtkl::record $playtklfname</font></i>

  } <b><font color=#3a6797>else</font></b> {

    <i><font color=#4b5d50># 2. playing</font></i>
    <b><font color=#3a6797>after</font></b> 4000 <font color=#8b2a0e>&quot;playtkl::play <font color=#1b1baa>$</font>playtklfname F12&quot;</font>  ;<i><font color=#4b5d50># or just: playtkl::play $playtklfname</font></i>

  }
}
...
<b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> commands playtkl::end] ne {}} playtkl::end
<b><font color=#3a6797>exit</font></b>
<br></code></pre>
<p class='ruff'>Above, after the sourcing, a Tk application does the following:</p>
<ul class='ruff'>
<li>sets a file name as &quot;./playtkl.log&quot;</li>
<li>disables info messages on begin / end (by default, they are shown in stdout)</li>
<li>depending on a current mode, runs:</li>
<li>1. recording with <em>playtkl::record</em></li>
<li>2. playing with <em>playtkl::play</em></li>
<li>before exit, <em>playtkl::end</em> is a must if no key was pressed to stop the recording</li>
</ul>
<p class='ruff'>In the above example, the recording and playing are run after 4 seconds of waiting for supposed initialization done. It depends on an application.</p>
<p class='ruff'>Also note that F11 is passed as 2nd (omittable) argument to <em>playtkl::record</em> which means a key to stop the recording. This key is mostly good for a macro recording.</p>
<p class='ruff'>The stop key is also useful for testing Tk applications. If a scenario was stopped with a key, then the final state of the application after its playback should be the same as it was after the recording. It's only the final states that can be interesting: they don't coincide, the test failed.</p>
<p class='ruff'>In the above example, F12 is passed as 2nd (omittable) argument to <em>playtkl::play</em> which means a key to pause / resume the playing.</p>
<p class='ruff'>The example shows a use of <em>playtkl</em> in a working mode of Tk application, when the <em>playtkl</em> stuff is disabled by &quot;if 0 ...&quot; command (or commented out).</p>
<br><h2 class='ruff'><a name='::playtkl-Records'></a>Records<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The file of records can contain emply lines and comments like this:</p>
<pre class='ruff'><br><code class="tcl"><i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># It's a playtkl test for apave package.</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># Run with the command:</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50>#  tclsh ~/PG/github/apave_tests/tests/test2_pave.tcl lightbrown 4 10 12 &quot;small icons&quot;</font></i>
<i><font color=#4b5d50>#</font></i>
<i><font color=#4b5d50># playtkl:   Recording: 11:20:26</font></i>
<i><font color=#4b5d50># playtkl:         End: 11:26:40</font></i>
<i><font color=#4b5d50>#</font></i>
Motion .win.#win#menu %t=13150304 %K=?? %b=?? %x=399 %y=1 %s=16 %d=??
Motion .win.#win#menu %t=13150312 %K=?? %b=?? %x=397 %y=6 %s=16 %d=??
...
<i><font color=#4b5d50>#ButtonPress .win.#win#menu.#win#menu#file %t=13455419 %K=?? %b=1 %x=46 %y=152 %s=16 %d=??</font></i>
<i><font color=#4b5d50>#ButtonRelease .win.#win#menu.#win#menu#file %t=13455611 %K=?? %b=1 %x=46 %y=152 %s=272 %d=??</font></i>
<br></code></pre>
<p class='ruff'>It begins with comments about the start / end of recording.</p>
<p class='ruff'>At need, any lines can commented out, e.g. last ones that close the application as shown above.</p>
<br><h2 class='ruff'><a name='::playtkl-Macros'></a>Macros<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The usage of <em>playtkl</em> to record / play macros is nearly the same as above described.</p>
<p class='ruff'>The recording and playing macros are performed inside and for a Tcl/Tk application, so that no need for &quot;if 0 ...&quot; to disable <em>playtkl</em>.</p>
<p class='ruff'>A stop key should be passed to <em>playtkl::record</em>. And vice versa, the key to pause / resume macros isn't of much importance.</p>
<p class='ruff'>To check if the recording is still active, <em>playtkl::isend</em> is used.</p>
<p class='ruff'>For example:</p>
<pre class='ruff'><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> NS::checkrecording {{first yes}} {
  <b><font color=#3a6797>if</font></b> {[playtkl::isend]} {
  <b><font color=#134070>bell</font></b> ;<i><font color=#4b5d50># or something like &quot;resumeWorkFlow&quot;, or nothing at all</font></i>
  } <b><font color=#3a6797>else</font></b> {
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$first</font>} pauseWorkFlow
  <b><font color=#3a6797>after</font></b> 300 {NS::checkrecording no}
  }
}
...
playtkl::inform no
playtkl::record <font color=#1b1baa>$playtklfname</font> F11
NS::checkrecording
...
playtkl::replay <font color=#1b1baa>$playtklfname</font>
...
playtkl::replay
...
playtkl::replay
<br></code></pre>
<p class='ruff'>To replay a macro, <em>playtkl::replay</em> is used. A recorded file's name can be passed to <em>playtkl::replay</em>. When <em>playtkl::replay</em> has no arguments, it doesn't read a file of records, it just replays what was read and played before.</p>
<br><h2 class='ruff'><a name='::playtkl-Issues'></a>Issues<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The initial state of a tested Tk application should be absolutely the same at recording and at playing a testing scenario. If the application uses configuration files, these files should be supplied to it in the same state at recording and at playing. It refers mostly to a geometry of Tk application as a whole and to its internal widgets which depend on a ttk theme. But an application's behavior can interfere with the playing too. Probably, OS environment should be identical, e.g. the less the loaded programs the better (esp. notifiers &amp; shedulers).</p>
<p class='ruff'>The following two facts should be counted (i.e. appropriate uses should be avoided):</p>
<ul class='ruff'>
<li><em>playtkl</em> cannot catch those events that occur outside of Tk, e.g. MS Windows' file and color choosers don't provide any Tk bindings and as such aren't seen by <em>playtkl</em></li>
<li><em>playtkl</em> doesn't catch events related to window managers like clicking a window's title buttons</li>
</ul>
<p class='ruff'>With moveable widgets like scrollbars, scales, rulers etc., there may be problems when the widgets are moved too fast at recording - then, at playing them, the mouse pointer can lag a bit, so that the replayed picture would be restorted. Though a bit annoying, this artifact isn't critical in most cases.</p>
<p class='ruff'>However, if played okay once, a recorded scenario would be played okay in all future runs as well. It isn't hard to reach.</p>
<p class='ruff'>All in all, <em>playtkl</em> allows testing the main functions of Tk apps and enhancing their facilities with macros.</p>
<br><h2 class='ruff'><a name='::playtkl-Links'></a>Links<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<ul class='ruff'>
<li><a href="https://aplsimple.github.io/en/tcl/playtkl/playtkl.html" >Reference</a></li>
<li><a href="https://chiselapp.com/user/aplsimple/repository/playtkl/download" >Source #1</a></li>
<li><a href="https://github.com/aplsimple/playtkl" >Source #2</a></li>
<li><a href="https://github.com/aplsimple/playtkl/releases/tag/demo-playtkl-1.0" >Demo of recording &amp; playing</a></li>
</ul>
<br><h2 class='ruff'><a name='::playtkl-Commands'></a>Commands<span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<br><br><br><h4 class='ruffproc'><a name='::playtkl::Data'>Data</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Extracts event's data of wildcard</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Data</span> <span class='ruff_arg'>w data</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>w</code></code></td><td class='ruff_defitem'>the wildcard</td></tr>
<tr><td class='ruff_defitem'><code><code>data</code></code></td><td class='ruff_defitem'>full list of %w=data</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_Data' href="javascript:toggleSource('playtkl_Data')">Show source</a></p>
<div id='playtkl_Data' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::Data {w data} {
  <i><font color=#4b5d50># Extracts event's data of wildcard</font></i>
  <i><font color=#4b5d50>#   w - the wildcard</font></i>
  <i><font color=#4b5d50>#   data - full list of %w=data</font></i>

  <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#6c3e67>-glob</font> <font color=#1b1baa>$data</font> <font color=#1b1baa>$w</font>*]
  <b><font color=#3a6797>set</font></b> d [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$data</font> <font color=#1b1baa>$i</font>]
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$d</font> [<b><font color=#3a6797>string</font></b> first = <font color=#1b1baa>$d</font>]+1 end]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::end'>end</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Closes the recording/playing.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>end</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_end' href="javascript:toggleSource('playtkl_end')">Show source</a></p>
<div id='playtkl_end' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::end {} {
  <i><font color=#4b5d50># Closes the recording/playing.</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>set</font></b> msgend [inform End]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dd(isrec)</font>} {
    <b><font color=#3a6797>set</font></b> dd(fcont) [<b><font color=#3a6797>lsort</font></b> <font color=#6c3e67>-index</font> 2 <font color=#6c3e67>-dictionary</font> <font color=#1b1baa>$dd(fcont)</font>] ;<i><font color=#4b5d50># sort by time</font></i>
    <b><font color=#3a6797>set</font></b> dd(fcont) [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$dd(fcont)</font> 0 <font color=#8b2a0e>&quot;# <font color=#1b1baa>$</font>dd(msgbeg)&quot;</font> <font color=#8b2a0e>&quot;# <font color=#1b1baa>$</font>msgend&quot;</font> #]
    <b><font color=#3a6797>set</font></b> ch [<b><font color=#3a6797>open</font></b> <font color=#1b1baa>$dd(fname)</font> w]
    <b><font color=#3a6797>foreach</font></b> line <font color=#1b1baa>$dd(fcont)</font> {<b><font color=#3a6797>puts</font></b> <font color=#1b1baa>$ch</font> <font color=#1b1baa>$line</font>}
    <b><font color=#3a6797>close</font></b> <font color=#1b1baa>$ch</font>
  }
  <b><font color=#3a6797>set</font></b> dd(isrec) 0
  <b><font color=#3a6797>set</font></b> dd(endkey) -
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::inform'>inform</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Puts out a short message and the current time.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>inform</span> <span class='ruff_arg'>msg</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>msg</code></code></td><td class='ruff_defitem'>the message or yes/no to switch the puts on/off</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_inform' href="javascript:toggleSource('playtkl_inform')">Show source</a></p>
<div id='playtkl_inform' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::inform {msg} {
  <i><font color=#4b5d50># Puts out a short message and the current time.</font></i>
  <i><font color=#4b5d50>#   msg - the message or yes/no to switch the puts on/off</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is boolean <font color=#1b1baa>$msg</font>]} {
    <b><font color=#3a6797>set</font></b> dd(timing) <font color=#1b1baa>$msg</font>
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$dd(timing)</font>} {
    <b><font color=#3a6797>set</font></b> msg [<b><font color=#3a6797>string</font></b> range <font color=#8b2a0e>&quot;          <font color=#1b1baa>$</font>msg&quot;</font> end-10 end]
    <b><font color=#3a6797>set</font></b> msg <font color=#8b2a0e>&quot;playtkl: <font color=#1b1baa>$</font>msg: <font color=#1b1baa>[</font>clock format <font color=#1b1baa>[</font>clock seconds<font color=#1b1baa>]</font> -format %T<font color=#1b1baa>]</font>&quot;</font>
    <b><font color=#3a6797>puts</font></b> <font color=#1b1baa>$msg</font>
    <b><font color=#134070>bell</font></b>
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$msg</font>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::isend'>isend</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if no recording/playing is performed.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>isend</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_isend' href="javascript:toggleSource('playtkl_isend')">Show source</a></p>
<div id='playtkl_isend' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::isend {} {
  <i><font color=#4b5d50># Checks if no recording/playing is performed.</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$dd(endkey)</font> in {- <font color=#8b2a0e>&quot;&quot;</font>}}]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::PausePlaying'>PausePlaying</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Pauses / resumes the playing.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>PausePlaying</span> <span class='ruff_arg'>pausekey key</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>pausekey</code></code></td><td class='ruff_defitem'>key to pause/resume</td></tr>
<tr><td class='ruff_defitem'><code><code>key</code></code></td><td class='ruff_defitem'>pressed key</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_PausePlaying' href="javascript:toggleSource('playtkl_PausePlaying')">Show source</a></p>
<div id='playtkl_PausePlaying' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::PausePlaying {pausekey key} {
  <i><font color=#4b5d50># Pauses / resumes the playing.</font></i>
  <i><font color=#4b5d50>#   pausekey - key to pause/resume</font></i>
  <i><font color=#4b5d50>#   key - pressed key</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pausekey</font> eq <font color=#1b1baa>$key</font>} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> dd(pause) [<b><font color=#3a6797>expr</font></b> {!<font color=#1b1baa>$dd(pause)</font>}]]} {inform Paused} {inform Resumed}
  }
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::play'>play</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Starts the playback.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>play</span> <span class='ruff_arg'>fname ?pausekey?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>fname</code></code></td><td class='ruff_defitem'>name of file to store the recording</td></tr>
<tr><td class='ruff_defitem'><code><code>pausekey</code></code></td><td class='ruff_defitem'>key to pause/resume the playing; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_play' href="javascript:toggleSource('playtkl_play')">Show source</a></p>
<div id='playtkl_play' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::play {fname {pausekey {}}} {
  <i><font color=#4b5d50># Starts the playback.</font></i>
  <i><font color=#4b5d50>#   fname - name of file to store the recording</font></i>
  <i><font color=#4b5d50>#   pausekey - key to pause/resume the playing</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pausekey</font> ne {} && <font color=#1b1baa>$pausekey</font> ne <font color=#1b1baa>$dd(pausekey)</font>} {
    <b><font color=#134070>bind</font></b> all &lt;KeyPress&gt; [<b><font color=#3a6797>list</font></b> + ::playtkl::PausePlaying <font color=#1b1baa>$pausekey</font> %K]
    <b><font color=#3a6797>set</font></b> dd(pausekey) <font color=#1b1baa>$pausekey</font>
  }
  replay <font color=#1b1baa>$fname</font> no
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::Playing'>Playing</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Plays a current record.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Playing</span> </div>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_Playing' href="javascript:toggleSource('playtkl_Playing')">Show source</a></p>
<div id='playtkl_Playing' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::Playing {} {
  <i><font color=#4b5d50># Plays a current record.</font></i>

  <b><font color=#3a6797>variable</font></b> fields
  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>set</font></b> llen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$dd(fcont)</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> dd(idx)]&gt;=<font color=#1b1baa>$llen</font>} {
    end
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dd(pause)</font>} {
    <b><font color=#3a6797>after</font></b> 300 ::playtkl::Playing
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$dd(fcont)</font> <font color=#1b1baa>$dd(idx)</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>regexp</font></b> {^\s*#+} <font color=#1b1baa>$line</font>#]} { ;<i><font color=#4b5d50># skip empty or commented</font></i>
    <b><font color=#3a6797>after</font></b> idle ::playtkl::Playing
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$line</font> ev win
  <b><font color=#3a6797>set</font></b> data [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$line</font> 2 end]
  <i><font color=#4b5d50># mouse buttons: pressed on one window, released on other not existing yet</font></i>
  <b><font color=#3a6797>if</font></b> {![<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$win</font>]} {
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i <font color=#1b1baa>$dd(idx)</font>} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$llen</font> && <font color=#1b1baa>$win</font> ne <font color=#1b1baa>$dd(win)</font>} {<b><font color=#3a6797>incr</font></b> i} {
      <b><font color=#3a6797>set</font></b> l1 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$dd(fcont)</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$l1</font> e1 w1
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$e1</font> in {ButtonPress ButtonRelease} && [<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$w1</font>]} {
        <b><font color=#3a6797>set</font></b> dd(fcont) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$dd(fcont)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font>]
        <b><font color=#3a6797>set</font></b> t [Data %t <font color=#1b1baa>$dd(data)</font>]
        <b><font color=#3a6797>set</font></b> dd(fcont) [<b><font color=#3a6797>linsert</font></b> <font color=#1b1baa>$dd(fcont)</font> <font color=#1b1baa>$dd(idx)</font> <font color=#8b2a0e>&quot;<font color=#1b1baa>$</font>l1 %t=<font color=#1b1baa>[</font>incr t<font color=#1b1baa>]</font>&quot;</font>]
        <b><font color=#3a6797>incr</font></b> dd(idx) -1
        <b><font color=#ca14ca>break</font></b>
      }
    }
    <b><font color=#3a6797>after</font></b> idle ::playtkl::Playing
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>set</font></b> opts {}
  <b><font color=#3a6797>set</font></b> time 0
  <b><font color=#3a6797>foreach</font></b> wdt <font color=#1b1baa>$data</font> {
    <b><font color=#3a6797>set</font></b> wc [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$wdt</font> 0 1]
    <b><font color=#3a6797>set</font></b> dt [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$wdt</font> 3 end] ;<i><font color=#4b5d50># e.g. %x=657</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dt</font> ne {??}} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wc</font> eq {%t}} {
        <b><font color=#3a6797>set</font></b> time <font color=#1b1baa>$dt</font>
        <b><font color=#ca14ca>continue</font></b>
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wc</font> eq {%x}} {<b><font color=#3a6797>set</font></b> X <font color=#1b1baa>$dt</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wc</font> eq {%y}} {<b><font color=#3a6797>set</font></b> Y <font color=#1b1baa>$dt</font>}
      <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#6c3e67>-exact</font> <font color=#1b1baa>$fields</font> <font color=#1b1baa>$wc</font>]
      <b><font color=#3a6797>append</font></b> opts { } [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$fields</font> <font color=#1b1baa>$i</font>-1 0] { } <font color=#1b1baa>$dt</font>
    }
  }
  <b><font color=#3a6797>set</font></b> dd(win) <font color=#1b1baa>$win</font>
  <b><font color=#3a6797>set</font></b> dd(data) <font color=#1b1baa>$data</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ev</font> eq {Motion} && [<b><font color=#3a6797>info</font></b> exists X] && [<b><font color=#3a6797>info</font></b> exists Y]} {
    <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> event generate <font color=#1b1baa>$win</font> &lt;Motion&gt; <font color=#6c3e67>-warp</font> 1 <font color=#6c3e67>-x</font> <font color=#1b1baa>$X</font> <font color=#6c3e67>-y</font> <font color=#1b1baa>$Y</font>]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>after</font></b> idle [<b><font color=#3a6797>list</font></b> event generate <font color=#1b1baa>$win</font> &lt;<font color=#1b1baa>$ev</font>&gt; {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$opts</font>]
  }
  <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$dd(fcont)</font> <font color=#1b1baa>$dd(idx)</font>+1]
  <b><font color=#3a6797>set</font></b> time1 [Data %t [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$line</font> 2 end]]
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$time</font> || ![<b><font color=#3a6797>string</font></b> is integer <font color=#6c3e67>-strict</font> <font color=#1b1baa>$time1</font>]} {
    <b><font color=#3a6797>set</font></b> aft idle
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> aft [<b><font color=#3a6797>expr</font></b> {max(0,<font color=#1b1baa>$time1</font>-<font color=#1b1baa>$time</font>)}]
  }
  <b><font color=#3a6797>after</font></b> <font color=#1b1baa>$aft</font> ::playtkl::Playing
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::record'>record</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Starts the recording.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>record</span> <span class='ruff_arg'>fname ?endkey?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>fname</code></code></td><td class='ruff_defitem'>name of file to store the recording</td></tr>
<tr><td class='ruff_defitem'><code><code>endkey</code></code></td><td class='ruff_defitem'>key to stop the recording; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_record' href="javascript:toggleSource('playtkl_record')">Show source</a></p>
<div id='playtkl_record' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::record {fname {endkey {}}} {
  <i><font color=#4b5d50># Starts the recording.</font></i>
  <i><font color=#4b5d50>#   fname - name of file to store the recording</font></i>
  <i><font color=#4b5d50>#   endkey - key to stop the recording</font></i>

  <b><font color=#3a6797>variable</font></b> fields
  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>set</font></b> dd(isrec) yes
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dd(endkey)</font> eq {}} {
    <b><font color=#3a6797>foreach</font></b> {o w} <font color=#1b1baa>$fields</font> {<b><font color=#3a6797>append</font></b> opts <font color=#8b2a0e>&quot; <font color=#1b1baa>{</font>%<font color=#1b1baa>$</font>w=<font color=#1b1baa>$</font>w<font color=#1b1baa>}</font>&quot;</font>}
    <b><font color=#3a6797>foreach</font></b> ev {KeyPress KeyRelease ButtonPress ButtonRelease Motion} {
      <b><font color=#134070>bind</font></b> all &lt;<font color=#1b1baa>$ev</font>&gt; <font color=#8b2a0e>&quot;+ ::playtkl::Recording %W <font color=#1b1baa>$</font>ev <font color=#1b1baa>$</font>opts&quot;</font>
    }
  }
  <b><font color=#3a6797>set</font></b> dd(fname) <font color=#1b1baa>$fname</font>
  <b><font color=#3a6797>set</font></b> dd(endkey) <font color=#1b1baa>$endkey</font>
  <b><font color=#3a6797>set</font></b> dd(idx) -1
  <b><font color=#3a6797>lassign</font></b> {} dd(prevev) dd(fcont) dd(win)
  <b><font color=#3a6797>set</font></b> dd(msgbeg) [inform Recording]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::Recording'>Recording</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Saves data of an event occured on a window.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Recording</span> <span class='ruff_arg'>win ev ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>win</code></code></td><td class='ruff_defitem'>window's path</td></tr>
<tr><td class='ruff_defitem'><code><code>ev</code></code></td><td class='ruff_defitem'>event</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>data</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_Recording' href="javascript:toggleSource('playtkl_Recording')">Show source</a></p>
<div id='playtkl_Recording' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::Recording {win ev args} {
  <i><font color=#4b5d50># Saves data of an event occured on a window.</font></i>
  <i><font color=#4b5d50>#   win - window's path</font></i>
  <i><font color=#4b5d50>#   ev - event</font></i>
  <i><font color=#4b5d50>#   args - data</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>if</font></b> {![isend]} {
    <b><font color=#3a6797>set</font></b> key [Data %K <font color=#1b1baa>$args</font>]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$key</font> eq <font color=#1b1baa>$dd(endkey)</font>} {
      end
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ev</font> eq {KeyRelease} && <font color=#1b1baa>$dd(prevev)</font> ne {KeyPress} && <font color=#1b1baa>$key</font> in {Tab Return}} {
        <b><font color=#3a6797>set</font></b> t %t=[<b><font color=#3a6797>expr</font></b> {[Data %t <font color=#1b1baa>$args</font>]-1}]
        <b><font color=#3a6797>lappend</font></b> dd(fcont) KeyPress\ <font color=#1b1baa>$win</font>\ <font color=#1b1baa>$args</font>\ <font color=#1b1baa>$t</font>
      }
      <b><font color=#3a6797>lappend</font></b> dd(fcont) <font color=#1b1baa>$ev</font>\ <font color=#1b1baa>$win</font>\ <font color=#1b1baa>$args</font>
      <b><font color=#3a6797>set</font></b> dd(prevev) <font color=#1b1baa>$ev</font>
    }
  }
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::playtkl::replay'>replay</a><span class='ns_scope'> [<a href="playtkl.html#::playtkl" title="::playtkl" class='ruff_cmd'>::playtkl</a>]</span><span class='tinylink'><a href='playtkl.html#::playtkl'>playtkl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Replays a read/written recording, fastly at replaying a macro.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>replay</span> <span class='ruff_arg'>?fname? ?ismacro?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>fname</code></code></td><td class='ruff_defitem'>name of file to store the recording; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
<tr><td class='ruff_defitem'><code><code>ismacro</code></code></td><td class='ruff_defitem'>yes for fast replaying a macro; <i>optional, default</i> <code>yes</code></td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_playtkl_replay' href="javascript:toggleSource('playtkl_replay')">Show source</a></p>
<div id='playtkl_replay' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::playtkl::replay {{fname {}} {ismacro yes}} {
  <i><font color=#4b5d50># Replays a read/written recording, fastly at replaying a macro.</font></i>
  <i><font color=#4b5d50>#   fname - name of file to store the recording</font></i>
  <i><font color=#4b5d50>#   ismacro - yes for fast replaying a macro</font></i>

  <b><font color=#3a6797>variable</font></b> dd
  <b><font color=#3a6797>set</font></b> dd(idx) -1
  <b><font color=#3a6797>set</font></b> dd(isrec) no
  <b><font color=#3a6797>set</font></b> dd(pause) no
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$fname</font> ne {}} {
    <b><font color=#3a6797>set</font></b> ch [<b><font color=#3a6797>open</font></b> <font color=#1b1baa>$fname</font>]
    <b><font color=#3a6797>set</font></b> dd(fcont) [<b><font color=#3a6797>split</font></b> [<b><font color=#3a6797>string</font></b> trim [<b><font color=#3a6797>read</font></b> <font color=#1b1baa>$ch</font>]] \n]
    <b><font color=#3a6797>close</font></b> <font color=#1b1baa>$ch</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ismacro</font>} {
    <b><font color=#3a6797>set</font></b> fcont [<b><font color=#3a6797>list</font></b>]
    <b><font color=#3a6797>set</font></b> time 0
    <b><font color=#3a6797>foreach</font></b> line <font color=#1b1baa>$dd(fcont)</font> {
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>regexp</font></b> {^\s*#+} <font color=#1b1baa>$line</font>#]} { ;<i><font color=#4b5d50># skip empty or commented</font></i>
        <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$line</font> 0 1]
        <b><font color=#3a6797>append</font></b> ln <font color=#8b2a0e>&quot; %t=<font color=#1b1baa>[</font>incr time 2<font color=#1b1baa>]</font> &quot;</font> [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$line</font> 3 end]
        <b><font color=#3a6797>lappend</font></b> fcont <font color=#1b1baa>$ln</font>
      }
    }
    <b><font color=#3a6797>set</font></b> dd(fcont) <font color=#1b1baa>$fcont</font>
  }
  Playing
  inform Playing
}<br><br></code></pre></div>
</div></div></div><div class='yui-b navbox' ><h1><a href='#::playtkl'>playtkl</a></h1><h2><a href='#::playtkl-What's that'>What's that</a></h2><h2><a href='#::playtkl-Testing Tk'>Testing Tk</a></h2><h2><a href='#::playtkl-How's that'>How's that</a></h2><h2><a href='#::playtkl-Records'>Records</a></h2><h2><a href='#::playtkl-Macros'>Macros</a></h2><h2><a href='#::playtkl-Issues'>Issues</a></h2><h2><a href='#::playtkl-Links'>Links</a></h2><h2><a href='#::playtkl-Commands'>Commands</a></h2><h4 class='tooltip'><a href='playtkl.html#::playtkl::Data'>Data</a><span class='tooltiptext'>Extracts event's data of wildcard
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::end'>end</a><span class='tooltiptext'>Closes the recording/playing.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::inform'>inform</a><span class='tooltiptext'>Puts out a short message and the current time.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::isend'>isend</a><span class='tooltiptext'>Checks if no recording/playing is performed.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::PausePlaying'>PausePlaying</a><span class='tooltiptext'>Pauses / resumes the playing.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::play'>play</a><span class='tooltiptext'>Starts the playback.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::Playing'>Playing</a><span class='tooltiptext'>Plays a current record.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::record'>record</a><span class='tooltiptext'>Starts the recording.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::Recording'>Recording</a><span class='tooltiptext'>Saves data of an event occured on a window.
</span></h4><h4 class='tooltip'><a href='playtkl.html#::playtkl::replay'>replay</a><span class='tooltiptext'>Replays a read/written recording, fastly at replaying a macro.
</span></h4></div></div><div id='ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div></div>
</div></body></html>
