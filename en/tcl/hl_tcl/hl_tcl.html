<!DOCTYPE html><html><head><meta charset="utf-8"/>
<link rel="stylesheet" href="../../../zoo/sh/styles/aplsimple.css">
<title>::hl_tcl reference</title>
<style>
/*
Copyright (c) 2009, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.net/yui/license.txt
version: 2.7.0
*/
html{color:#000;background:#FFF;}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,button,textarea,p,blockquote,th,td{margin:0;padding:0;}table{border-collapse:collapse;border-spacing:0;}fieldset,img{border:0;}address,caption,cite,code,dfn,em,strong,th,var,optgroup{font-style:inherit;font-weight:inherit;}del,ins{text-decoration:none;}li{list-style:none;}caption,th{text-align:left;}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal;}q:before,q:after{content:'';}abbr,acronym{border:0;font-variant:normal;}sup{vertical-align:baseline;}sub{vertical-align:baseline;}legend{color:#000;}input,button,textarea,select,optgroup,option{font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;}input,button,textarea,select{*font-size:100%;}body{font:13px/1.231 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small;}select,input,button,textarea,button{font:99% arial,helvetica,clean,sans-serif;}table{font-size:inherit;font:100%;}pre,code,kbd,samp,tt{font-family:Consolas,"Courier New",monospace;font-size:100%;line-height:100%;}body{text-align:center;}#doc,#doc2,#doc3,#doc4,.yui-t1,.yui-t2,.yui-t3,.yui-t4,.yui-t5,.yui-t6,.yui-t7{margin:auto;text-align:left;width:57.69em;*width:56.25em;}#doc2{width:73.076em;*width:71.25em;}#doc3{margin:auto 10px;width:auto;}#doc4{width:74.923em;*width:73.05em;}.yui-b{position:relative;}.yui-b{_position:static;}#yui-main .yui-b{position:static;}#yui-main,.yui-g .yui-u .yui-g{width:100%;}.yui-t1 #yui-main,.yui-t2 #yui-main,.yui-t3 #yui-main{float:right;margin-left:-25em;}.yui-t4 #yui-main,.yui-t5 #yui-main,.yui-t6 #yui-main{float:left;margin-right:-25em;}.yui-t1 .yui-b{float:left;width:12.30769em;*width:12.00em;}.yui-t1 #yui-main .yui-b{margin-left:13.30769em;*margin-left:13.05em;}.yui-t2 .yui-b{float:left;width:9.8461em;*width:13.50em;}.yui-t2 #yui-main .yui-b{margin-left:10.8461em;*margin-left:14.55em;}.yui-t3 .yui-b{float:left;width:23.0769em;*width:22.50em;}.yui-t3 #yui-main .yui-b{margin-left:24.0769em;*margin-left:23.62em;}.yui-t4 .yui-b{float:right;width:13.8456em;*width:13.50em;}.yui-t4 #yui-main .yui-b{margin-right:14.8456em;*margin-right:14.55em;}.yui-t5 .yui-b{float:right;width:18.4615em;*width:18.00em;}.yui-t5 #yui-main .yui-b{margin-right:19.4615em;*margin-right:19.125em;}.yui-t6 .yui-b{float:right;width:23.0769em;*width:22.50em;}.yui-t6 #yui-main .yui-b{margin-right:24.0769em;*margin-right:23.62em;}.yui-t7 #yui-main .yui-b{display:block;margin:0 0 1em 0;}#yui-main .yui-b{float:none;width:auto;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf,.yui-gc .yui-u,.yui-gd .yui-g,.yui-g .yui-gc .yui-u,.yui-ge .yui-u,.yui-ge .yui-g,.yui-gf .yui-g,.yui-gf .yui-u{float:right;}.yui-g div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first,.yui-ge div.first,.yui-gf div.first,.yui-g .yui-gc div.first,.yui-g .yui-ge div.first,.yui-gc div.first div.first{float:left;}.yui-g .yui-u,.yui-g .yui-g,.yui-g .yui-gb,.yui-g .yui-gc,.yui-g .yui-gd,.yui-g .yui-ge,.yui-g .yui-gf{width:49.1%;}.yui-gb .yui-u,.yui-g .yui-gb .yui-u,.yui-gb .yui-g,.yui-gb .yui-gb,.yui-gb .yui-gc,.yui-gb .yui-gd,.yui-gb .yui-ge,.yui-gb .yui-gf,.yui-gc .yui-u,.yui-gc .yui-g,.yui-gd .yui-u{width:32%;margin-left:1.99%;}.yui-gb .yui-u{*margin-left:1.9%;*width:31.9%;}.yui-gc div.first,.yui-gd .yui-u{width:66%;}.yui-gd div.first{width:32%;}.yui-ge div.first,.yui-gf .yui-u{width:74.2%;}.yui-ge .yui-u,.yui-gf div.first{width:24%;}.yui-g .yui-gb div.first,.yui-gb div.first,.yui-gc div.first,.yui-gd div.first{margin-left:0;}.yui-g .yui-g .yui-u,.yui-gb .yui-g .yui-u,.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u,.yui-ge .yui-g .yui-u,.yui-gf .yui-g .yui-u{width:49%;*width:48.1%;*margin-left:0;}.yui-g .yui-g .yui-u{width:48.1%;}.yui-g .yui-gb div.first,.yui-gb .yui-gb div.first{*margin-right:0;*width:32%;_width:31.7%;}.yui-g .yui-gc div.first,.yui-gd .yui-g{width:66%;}.yui-gb .yui-g div.first{*margin-right:4%;_margin-right:1.3%;}.yui-gb .yui-gc div.first,.yui-gb .yui-gd div.first{*margin-right:0;}.yui-gb .yui-gb .yui-u,.yui-gb .yui-gc .yui-u{*margin-left:1.8%;_margin-left:4%;}.yui-g .yui-gb .yui-u{_margin-left:1.0%;}.yui-gb .yui-gd .yui-u{*width:66%;_width:61.2%;}.yui-gb .yui-gd div.first{*width:31%;_width:29.5%;}.yui-g .yui-gc .yui-u,.yui-gb .yui-gc .yui-u{width:32%;_float:right;margin-right:0;_margin-left:0;}.yui-gb .yui-gc div.first{width:66%;*float:left;*margin-left:0;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf .yui-u{margin:0;}.yui-gb .yui-gb .yui-u{_margin-left:.7%;}.yui-gb .yui-g div.first,.yui-gb .yui-gb div.first{*margin-left:0;}.yui-gc .yui-g .yui-u,.yui-gd .yui-g .yui-u{*width:48.1%;*margin-left:0;}.yui-gb .yui-gd div.first{width:32%;}.yui-g .yui-gd div.first{_width:29.9%;}.yui-ge .yui-g{width:24%;}.yui-gf .yui-g{width:74.2%;}.yui-gb .yui-ge div.yui-u,.yui-gb .yui-gf div.yui-u{float:right;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf div.first{float:left;}.yui-gb .yui-ge .yui-u,.yui-gb .yui-gf div.first{*width:24%;_width:20%;}.yui-gb .yui-ge div.first,.yui-gb .yui-gf .yui-u{*width:73.5%;_width:65.5%;}.yui-ge div.first .yui-gd .yui-u{width:65%;}.yui-ge div.first .yui-gd div.first{width:32%;}#hd:after,#bd:after,#ft:after,.yui-g:after,.yui-gb:after,.yui-gc:after,.yui-gd:after,.yui-ge:after,.yui-gf:after{content:".";display:block;height:0;clear:both;visibility:hidden;}#hd,#bd,#ft,.yui-g,.yui-gb,.yui-gc,.yui-gd,.yui-ge,.yui-gf{zoom:0;}

body{margin:10px;}h1{font-size:138.5%;}h2{font-size:123.1%;}h3{font-size:108%;}h1,h2,h3{margin:1em 0;}h1,h2,h3,h4,h5,h6,strong,dt{font-weight:bold;}optgroup{font-weight:normal;}abbr,acronym{border-bottom:1px dotted #000;cursor:help;}em{font-style:italic;}del{text-decoration:line-through;}blockquote,ul,ol,dl{margin:1em;}ol,ul,dl{margin-left:2em;}ol li{list-style:decimal outside;}ul li{list-style:disc outside;}dl dd{margin-left:1em;}th,td{border:1px solid #000;padding:.5em;}th{font-weight:bold;text-align:center;}caption{margin-bottom:.5em;text-align:center;}sup{vertical-align:super;}sub{vertical-align:sub;}p,fieldset,table,pre{margin-bottom:1em;}button,input[type="checkbox"],input[type="radio"],input[type="reset"],input[type="submit"]{padding:1px;}

/* Ruff default CSS */

body {
  /*max-width: 70em;*/
  margin: 0;
}

h1,h2 {
  color: #888888;
  margin-bottom: 0.5em;
  margin-top: 0em;
}

#ft { font-size: x-small; font-family: Arial, sans-serif;
  text-align: left;
  border-top: 1px solid #0B3467;
  color: #888888;
  margin-top: 10px;
}

.banner h2 {
  color: #0B3467;
}

#hd.banner {
 font-family: "Times New Roman", serif;
 font-size: 200%;
 line-height: 64px;
 border-bottom: thin solid #0B3467;
 color: #0B3467;
}

p.linkline {
  text-align: right;
  font-size: smaller;
  /*    margin-top: -1em; */
  margin-bottom: 0;
}

.tinylink {
  font-size: x-small;
  font-variant: normal;
  font-family: Arial, sans-serif;
  float: right;
  padding:2px;
}

h1 .tinylink a {
  color: white;
}

#bd {
font-family: Arial, sans-serif;
/*font-size: 108%;*/
}

div.navbox {
  /* margin-top: 1em; */
  background-color: #0B3467;
  color: white;
  padding: 3px 4px 2px 4px;
  font-family: Arial, sans-serif;
  overflow: hidden;
}

div.navbox:hover {
  overflow: visible;
}

/* Note .navbox header css should be based on $header_levels */
.navbox h1, .navbox h2, .navbox h3, .navbox h4, .navbox h5 {
  font-size: 85%;
  margin: 0px;
  font-weight: normal;
}
.navbox h1 {
  font-weight: bold; /* Override */
}
.navbox h2 {
  padding-left: 1em;
}
.navbox h3 {
  padding-left: 2em;
}
.navbox h4 {
  padding-left: 2.5em;
  font-weight: normal;
}
.navbox h5 {
  padding-left: 3em;
  font-weight: normal;
}
.navbox hr {
  color: white;
  margin-top:0.1em;
  margin-bottom:0.1em;
}

.navbox a:link, .navbox a:visited, .navbox a:hover {
  text-decoration: none;
  color: white;
  background-color: #0B3467;
}

.navbox a:hover {
   font-weight: bold;
}

/* Tooltip text - see https://www.w3schools.com/css/css_tooltip.asp */
.tooltip {
  position: relative;
  /* display: inline-block; */
}

.tooltip .tooltiptext {
  width: 100%;
  font-weight: bold;
  background-color: white;
  color: #0B3467;
  text-align: left;
  border: 1px solid #0B3467;
  /* border-radius: 4px; */
  position: absolute;
  z-index: 1;
  margin-left: 4px;
  padding: 2px 3px;
  visibility: hidden;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
}

span.ns_scope {
  color: #aaaaaa;
}

span.ns_scope a:link, span.ns_scope a:visited {
  text-decoration: none;
  color: #aaaaaa;

}

li {
  margin-top: 0.5em;
}

span.ns_scope a:hover {
  text-decoration: none;
  color: #666666;
}

table {
  margin: 1em;
  margin-top: 0.5em;
  border: thin solid;
  border-collapse: collapse;
  border-color: #808080;
  padding: 4px;
}

td {
  border: thin solid;
  border-color: #808080;
  vertical-align: top;
  font-size: 93%;
  padding: 0.3em;
  padding-top: 0.1em;
}
th {
  border: thin solid;
  border-color: #808080;
  padding: 0.3em;
  padding-top: 0.1em;
  background-color: #CCCCCC;
}

dt, dd {
   font-size: 93%;
}

h1.ruff {
  background-color: #0B3467;
  color: #ffffff;
  padding-left: 0.2em;
  font-family: "Times New Roman", serif;
}
h2.ruff {
  font-variant: small-caps;
  color: #0B3467;
  font-weight: bold;
  font-family: "Times New Roman", serif;
}

h3.ruff, h4.ruff, h5.ruff, h6.ruff {
  color: #0B3467;
}
h5.ruff {
  font-style: italic;
  font-weight: normal;
}
h6.ruff {
  font-weight: normal;
}
h3.ruffclass, h3.ruffproc, h3.ruffmethod,
h4.ruffclass, h4.ruffproc, h4.ruffmethod,
h5.ruffclass, h5.ruffproc, h5.ruffmethod {
  border-bottom: thin solid #0B3467;
  color: #0B3467;
  margin-bottom: 0.2em;
}

pre {
  background-color: #f9f9f9;
  margin-top: 1em;
  margin-left: 1em;
  padding: 5px;
  font-family: Consolas, "Courier New", monospace;
  /* width: max-content; --- to leave footsteps */ overflow: auto;
  line-height: 1.2em;
}

.ruff_dyn_src {
  display: none; /* Displayed via JS */
}

.ruff_synopsis {
  border: thin solid #cccccc;
  background: #f9f9f9;
  font-family: Consolas, "Courier New", monospace;
  padding: 5px;
  margin: 0em 2em 1em;
}
.ruff_const, .ruff_cmd, ruff_defitem {
  font-weight: bold;
  font-family: Consolas, "Courier New", monospace;
}
.ruff_arg {
  font-style: italic;
  font-family: Consolas, "Courier New", monospace;
}

.ruff_source_link {
  font-size: smaller;
}

.ruff_index {
  font-size: small;
  color: grey;
  line-height: 1;
}

.ruff_index ul li {
  list-style-type: none;
}

.ruff_index ul li a {
  text-decoration: none;
}
</style>
<script>function toggleSource( id )
{
  /* Copied from Rails */
  var elem
  var link

  if( document.getElementById )
  {
      elem = document.getElementById( id )
      link = document.getElementById( "l_" + id )
  }
  else if ( document.all )
  {
      elem = eval( "document.all." + id )
      link = eval( "document.all.l_" + id )
  }
  else
      return false;

  if( elem.style.display == "block" )
  {
      elem.style.display = "none"
      link.innerHTML = "Show source"
  }
  else
  {
      elem.style.display = "block"
      link.innerHTML = "Hide source"
  }
}
</script></head>
<meta name="author" content="aplsimple">
<meta name="description" content="aplsimple's home page">
<meta name="keywords" content="aplsimple,home">
<link rel="stylesheet" href="../../../en/zoo/style.css">
<style>
table{
background-color: #f9f9f9;
margin: 0%;
margin-bottom: 2%;
padding: 0%;
box-shadow: none;
filter: none;
}
pre{
margin: 0%;
margin-bottom: 2%;
padding: 0%;
}
</style>
<link rel="icon" type="image/jpg" href="../../../zoo/favicon.jpg">
<body>
<div id="wrapper">
<div name="divd1" ALIGN="CENTER"> <FONT SIZE=5em color=#b01c20><B>
<noscript>THIS PAGE IS NOT WORKING WITHOUT JAVASCRIPT!
<BR>
<BR>PLEASE, SWITCH ON JAVASCRIPT IN SETTINGS OF YOUR BROWSER AND RELOAD THE PAGE.
</noscript>
</B></FONT></div>
<div id='doc3' class='yui-t2'>
<script src="../../../zoo/funcs.js"></script>
<script src="../../../en/zoo/this.js"></script>
<section id=sec2>
<div id='hd' class='banner'>
<a name='hl_tcl.html'>::hl_tcl reference</a>
</div>
<div id='bd'><div id='yui-main'><div class='yui-b'><h1 class='ruff'><a name='::hl_tcl'></a>::hl_tcl<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>The <em>hl_tcl</em> package is a syntax highlighter for Tcl/Tk code.</p>
<p class='ruff'>It can be applied to a <em>Tk text</em> widget or to a static html page.</p>
<p class='ruff'>The <em>Tk text</em> widget may be made read-only or editable. Also, the <em>hl_tcl</em> may take an argument, sort of command to watch the viewing / editing.</p>
<p class='ruff'>When applied to html pages, the <em>hl_tcl</em> highlights Tcl/Tk code snippets embedded between &lt;code&gt; &lt;/code&gt; tags.</p>
<p class='ruff'>The <em>hl_tcl</em> has highlighted its own code in <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a>.</p>
<br><h2 class='ruff'><a name='::hl_tcl-Some of blah-blah'></a>Some of blah-blah<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The Tcl being incredibly dynamic language sets a lot of problems before any Tcl syntax highlighter. Probably, the usage of quotes and esp. the strings spanning several lines are the main challenges.</p>
<p class='ruff'>Below is a line that brings most (not <em>hl_tcl</em>, as seen in <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a>) of Tcl highlighters in a stupor:</p>
<pre class='ruff'><br><code class="tcl">  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> first {&quot;} <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font>]]==-1} {<b><font color=#ca14ca>return</font></b> no}
<br></code></pre>
<p class='ruff'>... as well as this one:</p>
<pre class='ruff'><br><code class="tcl">  <b><font color=#3a6797>regsub</font></b> <font color=#6c3e67>-all</font> {(([^A-Z@]|\\@)[.?!](&quot;|'|'')?([])])?) } <font color=#1b1baa>$fieldText</font> {\1  } fieldText
<br></code></pre>
<p class='ruff'>Good luck for a highlighter when the second line (or similar) follows the first, giving it a matching quote and thus bringing it out of the stupor.</p>
<p class='ruff'>Those orphan quotes are often used in <code>regexp</code> and <code>regsub</code> Tcl commands, so that when a honest Tcl highlighter (like <a href="https://www.geany.org" title="Geany IDE">Geany</a>) stumbles upon an orphan quote, it tries its best to highlight the rest of code as a string, till the next unmatched quote.</p>
<p class='ruff'>Thus, we have</p>
<p class='ruff'><img src="https://aplsimple.github.io/en/tcl/hl_tcl/files/hltcl1.png" class="media" alt=""></p>
<p class='ruff'>... instead of</p>
<p class='ruff'><img src="https://aplsimple.github.io/en/tcl/hl_tcl/files/hltcl2.png" class="media" alt=""></p>
<p class='ruff'>There are &quot;tricky&quot; highlighters (like <a href="https://wiki.gnome.org/Apps/Gedit" title="Gedit editor">Gedit</a>) that behave more wisely at the stumbling an orphan quote: they permit only a one-line Tcl strings (if not continued with \), so that the string highlighting would be most likely finished in the same line it started. No problems except for this silly line. And no delays due to the highlighting the rest of code...</p>
<p class='ruff'>... as seen in:</p>
<p class='ruff'><img src="https://aplsimple.github.io/en/tcl/hl_tcl/files/hltcl3.png" class="media" alt=""></p>
<br><h2 class='ruff'><a name='::hl_tcl-Some of editors'></a>Some of editors<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'><a href="https://www.geany.org" title="Geany IDE">Geany</a>. Probably, the best Tcl highlighter. And the great programming tool at that. Still, it has few drawbacks:</p>
<ul class='ruff'>
<li>doesn't highlight the above mentioned Tcl lines properly</li>
<li>doesn't highlight <code>${var}</code> in contrast with <code>$var</code></li>
<li>tries to highlight any (even hexidecimal) number it encounters, thus <code>set a 1fix</code> or <code>set b #abxxx</code> looks a bit peculiar</li>
<li><code>set c {#000000 #FFFFFF}</code> is quite a legal Tcl command, not for Geany</li>
<li>no highlighting TclOO (<code>method, mixin, my</code> etc.)</li>
</ul>
<p class='ruff'><a href="http://www.vim.org/" title="Vim editor">Vim</a>. Probably, the fastest Tcl highlighter. Great and awful. Nonetheless:</p>
<ul class='ruff'>
<li>tricky with those above mentioned Tcl lines</li>
<li>doesn't highlight ttk commands (Tk only) and TclOO</li>
<li>tries to highlight every bit of Tcl, e.g. <code>set set set</code> is highlighted as three <code>set</code> commands ;)</li>
<li>as a result, much more florid than most of others</li>
</ul>
<p class='ruff'><a href="https://kate-editor.org" title="Kate editor">Kate</a>. As nearly good as Geany. As nearly florid as Vim (<code>set set set</code>). Doesn't highlight ttk and TclOO.</p>
<p class='ruff'><a href="https://github.com/phase1geo/tke/" title="TKE editor">TKE</a>. Written in Tcl/Tk, it might be the best of all to highlight the Tcl/Tk. In spite of its suspended state it still can. Issues with highlighting strings and the performance.</p>
<p class='ruff'><a href="http://mate-desktop.org" title="Pluma editor">Pluma</a> and <a href="https://wiki.gnome.org/Apps/Gedit" title="Gedit editor">Gedit</a> seem to use the same Tcl highlighting engine that gives rather good results. Still, the mentioned above drawbacks are here too. And no highlighting of tk, ttk, TclOO.</p>
<p class='ruff'><a href="https://notepad-plus-plus.org/" title="Notepad++ official site">Notepad++</a>. Very fast Tcl highlighter. And very basic. All the same drawbacks. No highlighting of tk, ttk, TclOO. <em>Plus</em> an obsolete version of Tcl, i.e. no highlighting <code>lset, lassign</code> etc.</p>
<br><h2 class='ruff'><a name='::hl_tcl-What can we do?'></a>What can we do?<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>To develop an ideal (correct and fast) Tcl/Tk highlighter, we would have to dive into Tcl core. Though, no hopes to achieve the ideal through repeating the core in Tcl/Tk or massively using the regular expressions.</p>
<p class='ruff'>That said, while implementing Tcl/Tk highlighter <em>in pure Tcl/Tk</em>, we might hope to achieve a reasonable compromise between the performance and the elimination of blunders.</p>
<p class='ruff'>It seems <em>hl_tcl</em> got close to this compromise. Specifically, it provides:</p>
<ul class='ruff'>
<li>special highlighting for Tcl and TclOO commands</li>
<li>special highlighting for Tk and ttk commands</li>
<li>special highlighting for declarations <code>proc, method, oo::class</code> etc. as well as <code>return, yield</code></li>
<li>special highlighting for <code>#comments</code>, <code>$variables</code>, <code>&quot;strings&quot;</code>, <code>-options</code></li>
<li>in-line comments being recognized and thus highlighted only after <code>;#</code></li>
<li>proper handling of most <code>regexp</code> and <code>regsub</code> expressions containing a quote</li>
<li>highlighting the multi-line strings, with possible switching this mode off (a-la Gedit) to improve the performance</li>
<li>customizing colors of the highlighting</li>
<li>highlighting viewable/editable <em>Tk text</em> widget and static html pages</li>
<li>good performance at editing 1000-4000 LOC and rather acceptable for 4000-9000 LOC</li>
<li>even monstrous 10000 LOC and more are handled fast at the &quot;tricky&quot; mode a-la Gedit</li>
</ul>
<p class='ruff'>The <em>hl_tcl</em> doesn't provide the following:</p>
<ul class='ruff'>
<li>highlighting <em>numbers</em></li>
<li>highlighting <em>brackets</em>, except for matched ones and inside the strings</li>
</ul>
<p class='ruff'>These are in no way critical drawbacks. A little less florid Tcl code might be even preferable for other tastes.</p>
<p class='ruff'>The Tcl can arrange its pitfalls for <em>hl_tcl</em> (I know where). Also, tricky practices or tastes can make a fool of <em>hl_tcl</em>. Still hopefully these pranks are few and rare to encounter.</p>
<br><h2 class='ruff'><a name='::hl_tcl-Use for text widget'></a>Use for text widget<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>The code below:</p>
<pre class='ruff'><br><code class="tcl">  <b><font color=#3a6797>package</font></b> require hl_tcl

  <b><font color=#ca14ca>proc</font></b> ::stub {args} {<b><font color=#3a6797>puts</font></b> <font color=#7d1a1a>&quot;stub: <font color=#1b1baa>$</font>args&quot;</font>}

  ::hl_tcl::hl_init <font color=#1b1baa>$::txt</font> <font color=#6c3e67>-readonly</font> yes <font color=#6c3e67>-cmd</font> ::stub

  <i><font color=#4b5d50>#... inserting a text into the text widget</font></i>

  ::hl_tcl::hl_text <font color=#1b1baa>$::txt</font>
<br></code></pre>
<p class='ruff'>sets an example of <em>hl_tcl</em> usage. Here are the details:</p>
<ul class='ruff'>
<li><strong><code>::stub</code></strong> is a procedure to watch the text editing; here it simply puts out the text's last index;</li>
<li><strong><code>hl_init</code></strong> is called <em>before</em> filling the text widget with a Tcl code; it sets the highlighting options and disables the highlighting till <em>hl_text</em> runs;</li>
<li><strong><code>hl_text</code></strong> runs to highlight the Tcl code of the text widget and to view/edit it.</li>
</ul>
<p class='ruff'>The <strong><code>hl_init</code></strong> takes arguments:</p>
<ul class='ruff'>
<li><em>txt</em> is the text widget's path</li>
<li><em>args</em> contains options of text widget (omittable)</li>
</ul>
<p class='ruff'>The <em>args</em> is a list of <em>-option &quot;value&quot;</em> where <em>-option</em> may be:</p>
<ul class='ruff'>
<li><em>-colors</em> - list of colors: clrCOM, clrCOMTK, clrSTR, clrVAR, clrCMN, clrPROC, clrOPT</li>
<li><em>-dark</em> - flag &quot;dark background of text&quot;, i.e. simplified <em>-colors</em> (default &quot;no&quot;)</li>
<li><em>-font</em> - attributes of text font</li>
<li><em>-readonly</em> - flag &quot;text is read-only&quot; (default &quot;no&quot;)</li>
<li><em>-multiline</em> - flag &quot;multi-line strings&quot; (default &quot;yes&quot;)</li>
<li><em>-cmd</em> - command to watch editing/viewing (default &quot;&quot;)</li>
<li><em>-cmdpos</em> - command to watch cursor positioning (default &quot;&quot;)</li>
<li><em>-seen</em> - number of first lines seen at start (default 500)</li>
<li><em>-optRE</em> - flag &quot;use a regular expression to highlight options&quot; (default &quot;yes&quot;)</li>
</ul>
<p class='ruff'><strong>Note</strong>: <code>-seen 500</code> and <code>-multiline no</code> can improve the performance a lot. It's recommended to use <code>-seen 500</code> (or any other reasonable limit, e.g. <code>-seen 200</code>) at any rate, except for static html pages.</p>
<p class='ruff'>The rest of <em>hl_tcl</em> procedures are:</p>
<ul class='ruff'>
<li><strong><code>hl_all</code></strong> updates all highlighted existing text widgets, e.g. at changing a color scheme of application</li>
<li><strong><code>hl_readonly</code></strong> gets/sets a read-only mode and/or a command to watch a text widget at viewing/editing it</li>
<li><strong><code>hl_colors</code></strong> gets a list of colors for highlighting</li>
</ul>
<p class='ruff'>See details in <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a>.</p>
<br><h2 class='ruff'><a name='::hl_tcl-Use for static html'></a>Use for static html<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<p class='ruff'>In the <a href="https://chiselapp.com/user/aplsimple/repository/hl_tcl/download" >hl_tcl.zip</a>, there is a Tcl script named <em>tcl_html.tcl</em> that highlights Tcl snippets of static html page(s).</p>
<p class='ruff'>It runs as follows:</p>
<pre class='ruff'><br><code class="tcl">  tclsh tcl_html.tcl <font color=#7d1a1a>&quot;glob-pattern-of-html-files&quot;</font>
<br></code></pre>
<p class='ruff'>For example:</p>
<pre class='ruff'><br><code class="tcl">  tclsh ~/UTILS/hl_tcl/tcl_html.tcl <font color=#7d1a1a>&quot;~/UTILS/mulster/tasks/ruff/src/*&quot;</font>
<br></code></pre>
<p class='ruff'>In this example, the html files are located in <code>~/UTILS/mulster/tasks/ruff/src</code>.</p>
<p class='ruff'>Perhaps, you would want to modify the <em>tcl_html.tcl</em>, this way:</p>
<ul class='ruff'>
<li>replace <code>&quot;no&quot;</code> with <code>&quot;yes&quot;</code> for dark html pages</li>
<li>replace <code>&lt;code class=&quot;tcl&quot;&gt;</code> with html tags <em>starting</em> the Tcl code in your html files</li>
<li>replace <code>&lt;/code&gt;</code> with html tags <em>finishing</em> the Tcl code in your html files</li>
</ul>
<p class='ruff'>These are arguments of <code>::hl_tcl_html::highlight</code> procedure.</p>
<p class='ruff'>The tag pairs can be multiple if the html pages contain them, e.g.</p>
<pre class='ruff'><br><code class="tcl">  ::hl_tcl_html::highlight <font color=#1b1baa>$fhtml</font> <font color=#7d1a1a>&quot;no&quot;</font>  {&lt;code class=<font color=#7d1a1a>&quot;tcl&quot;</font>&gt;} {&lt;/code&gt;}  {&lt;pre class=<font color=#7d1a1a>&quot;code&quot;</font>&gt;} {&lt;/pre&gt;}
<br></code></pre>
<br><h2 class='ruff'><a name='::hl_tcl-Links'></a>Links<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<ul class='ruff'>
<li><a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >Reference</a></li>
<li><a href="https://chiselapp.com/user/aplsimple/repository/hl_tcl/download" >Source</a> (hl_tcl.zip)</li>
<li><a href="https://github.com/aplsimple/hl_tcl/releases/download/hl_tcl-0.6.1/hl_tcl-0.6.1.mp4" >Demo of hl_tcl v0.6.1</a> (25 Mb)</li>
</ul>
<p class='ruff'>Note that <a href="https://aplsimple.github.io/en/tcl/hl_tcl/hl_tcl.html" >hl_tcl</a> is still disposed to update.</p>
<br><h2 class='ruff'><a name='::hl_tcl-Commands'></a>Commands<span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<br><br><br><h4 class='ruffproc'><a name='::hl_tcl::addingColors'>addingColors</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Sets/gets colors for a text syntax highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>addingColors</span> <span class='ruff_arg'>dark ?txt?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>dark</code></code></td><td class='ruff_defitem'>yes, if the current theme is dark</td></tr>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>path to the text or {}; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>If <em>txt</em> omitted, returns a list of resting colors. The resting colors are:</p>
<ul class='ruff'>
<li>current line's background</li>
<li>#TODO and #! comment's foreground</li>
</ul>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_1' href="javascript:toggleSource('1')">Show source</a></p>
<div id='1' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::addingColors {dark {txt {}}} {

  <i><font color=#4b5d50># Sets/gets colors for a text syntax highlighting.</font></i>
  <i><font color=#4b5d50>#   dark - yes, if the current theme is dark</font></i>
  <i><font color=#4b5d50>#   txt - path to the text or {}</font></i>
  <i><font color=#4b5d50># If *txt* omitted, returns a list of resting colors.</font></i>
  <i><font color=#4b5d50># The resting colors are:</font></i>
  <i><font color=#4b5d50>#   - current line's background</font></i>
  <i><font color=#4b5d50>#   - #TODO and #! comment's foreground</font></i>

  <b><font color=#3a6797>variable</font></b> my::data
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> clrCURL [<b><font color=#3a6797>lindex</font></b> [::apave::obj csGet] 16]}]} {
    <b><font color=#3a6797>set</font></b> clrCURL {}
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dark</font>} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clrCURL</font> eq {}} {<b><font color=#3a6797>set</font></b> clrCURL #29383c}
    <b><font color=#3a6797>set</font></b> clrCMN2 #ff7272
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$clrCURL</font> eq {}} {<b><font color=#3a6797>set</font></b> clrCURL #efe0cd}
    <b><font color=#3a6797>set</font></b> clrCMN2 #ff0000
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$txt</font> eq {}} {
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$clrCURL</font> <font color=#1b1baa>$clrCMN2</font>]
  }
  <b><font color=#3a6797>set</font></b> my::data(COLORS,<font color=#1b1baa>$txt</font>) [<b><font color=#3a6797>list</font></b> {<b><font color=#3a6797>*</font></b>}[hl_colors <font color=#1b1baa>$txt</font>] <font color=#1b1baa>$clrCURL</font> <font color=#1b1baa>$clrCMN2</font>]
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_all'>hl_all</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Updates (&quot;rehighlights&quot;) all highlighted and existing text widgets.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_all</span> <span class='ruff_arg'>?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>dict of options</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::hl_init" title="hl_init" class='ruff_cmd'>hl_init</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_2' href="javascript:toggleSource('2')">Show source</a></p>
<div id='2' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_all {args} {

  <i><font color=#4b5d50># Updates (&quot;rehighlights&quot;) all highlighted and existing text widgets.</font></i>
  <i><font color=#4b5d50>#   args - dict of options</font></i>
  <i><font color=#4b5d50># See also: hl_init</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(LIST_TXT)]} {
    <b><font color=#3a6797>foreach</font></b> wattrs <font color=#1b1baa>$::hl_tcl::my::data(LIST_TXT)</font> {
      <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$wattrs</font> txt ro com2
      <b><font color=#3a6797>if</font></b> {[<b><font color=#134070>winfo</font></b> exists <font color=#1b1baa>$txt</font>]} {
        <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(SETCOLORS,<font color=#1b1baa>$txt</font>)]} {
          <b><font color=#3a6797>unset</font></b> ::hl_tcl::my::data(COLORS,<font color=#1b1baa>$txt</font>) ;<i><font color=#4b5d50># colors defined by DARK</font></i>
        }
        <i><font color=#4b5d50># args (if set) override the appropriate settings for $txt</font></i>
        hl_init <font color=#1b1baa>$txt</font> -- {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
        hl_text <font color=#1b1baa>$txt</font>
      }
    }
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_colorNames'>hl_colorNames</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Returns a list of color names for syntax highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_colorNames</span> </div>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of color names for syntax highlighting.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_3' href="javascript:toggleSource('3')">Show source</a></p>
<div id='3' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_colorNames {} {

  <i><font color=#4b5d50># Returns a list of color names for syntax highlighting.</font></i>

  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> clrCOM clrCOMTK clrSTR clrVAR clrCMN clrPROC clrOPT clrBRA]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_colors'>hl_colors</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets/sets the main colors for highlighting (except for &quot;curr.line&quot;).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_colors</span> <span class='ruff_arg'>txt ?dark? ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path or {} or an index of default colors</td></tr>
<tr><td class='ruff_defitem'><code><code>dark</code></code></td><td class='ruff_defitem'>flag &quot;dark scheme&quot; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>a list of colors to set for <em>txt</em></td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of colors for COM COMTK STR VAR CMN PROC OPT BRAC  or, if the colors aren't initialized, &quot;standard&quot; colors.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_4' href="javascript:toggleSource('4')">Show source</a></p>
<div id='4' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_colors {txt {dark {}} args} {

  <i><font color=#4b5d50># Gets/sets the main colors for highlighting (except for &quot;curr.line&quot;).</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path or {} or an index of default colors</font></i>
  <i><font color=#4b5d50>#   dark - flag &quot;dark scheme&quot;</font></i>
  <i><font color=#4b5d50>#   args - a list of colors to set for *txt*</font></i>
  <i><font color=#4b5d50># Returns a list of colors for COM COMTK STR VAR CMN PROC OPT BRAC  or, if the colors aren't initialized, &quot;standard&quot; colors.</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$args</font>]} {
    <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(COLORS,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$args</font>
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(COLORS,<font color=#1b1baa>$txt</font>)]}  {
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$::hl_tcl::my::data(COLORS,$txt)</font>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dark</font> eq {}} {<b><font color=#3a6797>set</font></b> dark <font color=#1b1baa>$::hl_tcl::my::data(DARK,$txt)</font>}
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> is integer <font color=#6c3e67>-strict</font> <font color=#1b1baa>$txt</font>] || <font color=#1b1baa>$txt</font>&lt;0 || <font color=#1b1baa>$txt</font>&gt;3} {<b><font color=#3a6797>set</font></b> txt 0}
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dark</font>} {<b><font color=#3a6797>set</font></b> dark 1} {<b><font color=#3a6797>set</font></b> dark 0}
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$::hl_tcl::my::data(SYNTAXCOLORS,$txt)</font> <font color=#1b1baa>$dark</font>]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_init'>hl_init</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Initializes highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_init</span> <span class='ruff_arg'>txt ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>dict of options</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>The 'args' options include:</p>
<table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code>--</code></td><td class='ruff_defitem'>means that only args' options will be initialized (defaults skipped)</td></tr>
<tr><td class='ruff_defitem'><code>-dark</code></td><td class='ruff_defitem'>flag &quot;the text widget has dark background&quot;</td></tr>
<tr><td class='ruff_defitem'><code>-readonly</code></td><td class='ruff_defitem'>flag &quot;read-only&quot;</td></tr>
<tr><td class='ruff_defitem'><code>-optRE</code></td><td class='ruff_defitem'>flag &quot;use of RE to highlight options&quot;</td></tr>
<tr><td class='ruff_defitem'><code>-multiline</code></td><td class='ruff_defitem'>flag &quot;allowed multi-line strings&quot;</td></tr>
<tr><td class='ruff_defitem'><code>-cmd</code></td><td class='ruff_defitem'>command to watch editing/viewing</td></tr>
<tr><td class='ruff_defitem'><code>-cmdpos</code></td><td class='ruff_defitem'>command to watch cursor positioning</td></tr>
<tr><td class='ruff_defitem'><code>-colors</code></td><td class='ruff_defitem'>list of colors: clrCOM, clrCOMTK, clrSTR, clrVAR, clrCMN, clrPROC</td></tr>
<tr><td class='ruff_defitem'><code>-font</code></td><td class='ruff_defitem'>attributes of font</td></tr>
<tr><td class='ruff_defitem'><code>-seen</code></td><td class='ruff_defitem'>lines seen at start</td></tr>
<tr><td class='ruff_defitem'><code>-keywords</code></td><td class='ruff_defitem'>additional commands to highlight (as Tk ones)</td></tr>
</table>
<p class='ruff'>This procedure has to be called before writing a text in the text widget.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_5' href="javascript:toggleSource('5')">Show source</a></p>
<div id='5' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_init {txt args} {

  <i><font color=#4b5d50># Initializes highlighting.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   args - dict of options</font></i>
  <i><font color=#4b5d50># The 'args' options include:</font></i>
  <i><font color=#4b5d50>#   -- - means that only args' options will be initialized (defaults skipped)</font></i>
  <i><font color=#4b5d50>#   -dark - flag &quot;the text widget has dark background&quot;</font></i>
  <i><font color=#4b5d50>#   -readonly - flag &quot;read-only&quot;</font></i>
  <i><font color=#4b5d50>#   -optRE - flag &quot;use of RE to highlight options&quot;</font></i>
  <i><font color=#4b5d50>#   -multiline - flag &quot;allowed multi-line strings&quot;</font></i>
  <i><font color=#4b5d50>#   -cmd - command to watch editing/viewing</font></i>
  <i><font color=#4b5d50>#   -cmdpos - command to watch cursor positioning</font></i>
  <i><font color=#4b5d50>#   -colors - list of colors: clrCOM, clrCOMTK, clrSTR, clrVAR, clrCMN, clrPROC</font></i>
  <i><font color=#4b5d50>#   -font - attributes of font</font></i>
  <i><font color=#4b5d50>#   -seen - lines seen at start</font></i>
  <i><font color=#4b5d50>#   -keywords - additional commands to highlight (as Tk ones)</font></i>
  <i><font color=#4b5d50># This procedure has to be called before writing a text in the text widget.</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> setonly [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0] eq {--}}]]} {
    <b><font color=#3a6797>set</font></b> args [<b><font color=#3a6797>lrange</font></b> <font color=#1b1baa>$args</font> 1 end]
  }
  <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(REG_TXT,<font color=#1b1baa>$txt</font>) {}  ;<i><font color=#4b5d50># disables Modified at changing the text</font></i>
  <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(KEYWORDS,<font color=#1b1baa>$txt</font>) {}
  <b><font color=#3a6797>foreach</font></b> {opt val} {<font color=#6c3e67>-dark</font> 0 <font color=#6c3e67>-readonly</font> 0 <font color=#6c3e67>-cmd</font> {} <font color=#6c3e67>-cmdpos</font> {} <font color=#6c3e67>-optRE</font> 1  <font color=#6c3e67>-multiline</font> 1 <font color=#6c3e67>-seen</font> 500 <font color=#6c3e67>-plaintext</font> no <font color=#6c3e67>-insertwidth</font> 2 <font color=#6c3e67>-keywords</font> {}} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>dict</font></b> exists <font color=#1b1baa>$args</font> <font color=#1b1baa>$opt</font>]} {
      <b><font color=#3a6797>set</font></b> val [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$args</font> <font color=#1b1baa>$opt</font>]
    } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$setonly</font>} {
      <b><font color=#3a6797>continue</font></b>  ;<i><font color=#4b5d50># only those set in args are taken into account</font></i>
    }
    <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data([<b><font color=#3a6797>string</font></b> toupper [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$opt</font> 1 end]],<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$val</font>
  }
  <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(CMD_TK_EXP) [<b><font color=#3a6797>lsort</font></b> [<b><font color=#3a6797>list</font></b>  {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$::hl_tcl::my::data(CMD_TK)</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$::hl_tcl::my::data(KEYWORDS,$txt)</font>]]
  <b><font color=#3a6797>unset</font></b> ::hl_tcl::my::data(KEYWORDS,<font color=#1b1baa>$txt</font>)
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>dict</font></b> exists <font color=#1b1baa>$args</font> <font color=#6c3e67>-colors</font>]} {
    <b><font color=#3a6797>set</font></b> colors [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$args</font> <font color=#6c3e67>-colors</font>]
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$colors</font>]==9} {
      <b><font color=#3a6797>lassign</font></b> [addingColors <font color=#1b1baa>$::hl_tcl::my::data(DARK,$txt)</font>] -&gt; clrCMN2
      <b><font color=#3a6797>lappend</font></b> colors <font color=#1b1baa>$clrCMN2</font>  ;<i><font color=#4b5d50># if #TODO color omitted, add it</font></i>
    }
    <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(COLORS,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$colors</font>
    <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(SETCOLORS,<font color=#1b1baa>$txt</font>) 1
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(COLORS,<font color=#1b1baa>$txt</font>)]}  {
      addingColors <font color=#1b1baa>$::hl_tcl::my::data(DARK,$txt)</font> <font color=#1b1baa>$txt</font>
    }
  }
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$setonly</font>} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>dict</font></b> exists <font color=#1b1baa>$args</font> <font color=#6c3e67>-font</font>]} {
      <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(FONT,<font color=#1b1baa>$txt</font>) [<b><font color=#3a6797>dict</font></b> get <font color=#1b1baa>$args</font> <font color=#6c3e67>-font</font>]
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(FONT,<font color=#1b1baa>$txt</font>) [<b><font color=#134070>font</font></b> actual TkFixedFont]
    }
  }
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$setonly</font> || [<b><font color=#3a6797>dict</font></b> exists <font color=#1b1baa>$args</font> <font color=#6c3e67>-readonly</font>]} {
    hl_readonly <font color=#1b1baa>$txt</font> <font color=#1b1baa>$::hl_tcl::my::data(READONLY,$txt)</font>
  }
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first ::hl_tcl:: [<b><font color=#134070>bind</font></b> <font color=#1b1baa>$txt</font>]]&lt;0} {
    my::BindToEvent <font color=#1b1baa>$txt</font> &lt;FocusIn&gt; ::hl_tcl::my::ShowCurrentLine <font color=#1b1baa>$txt</font>
  }
  <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(_INSPOS_,<font color=#1b1baa>$txt</font>) {}
  my::MemPos <font color=#1b1baa>$txt</font>
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_line'>hl_line</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Updates a current line's highlighting.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_line</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_6' href="javascript:toggleSource('6')">Show source</a></p>
<div id='6' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_line {txt} {

  <i><font color=#4b5d50># Updates a current line's highlighting.</font></i>
  <i><font color=#4b5d50>#   txt - text's path</font></i>

  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$::hl_tcl::my::data(PLAINTEXT,$txt)</font>} {
    <b><font color=#3a6797>set</font></b> ln0 [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$txt</font> index insert])}]
    <b><font color=#3a6797>set</font></b> ln2 [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$txt</font> index end])}]
    <b><font color=#3a6797>set</font></b> ln1 [<b><font color=#3a6797>expr</font></b> {max (1,<font color=#1b1baa>$ln0</font>-1)}]
    <b><font color=#3a6797>set</font></b> ln2 [<b><font color=#3a6797>expr</font></b> {min (<font color=#1b1baa>$ln2</font>,<font color=#1b1baa>$ln0</font>+1)}]
    <i><font color=#4b5d50># update lines: previous, current, next</font></i>
    ::hl_tcl::my::RunCoroAfterIdle <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln1</font> <font color=#1b1baa>$ln2</font> no
  }
  ::hl_tcl::my::MemPos <font color=#1b1baa>$txt</font> yes
  <font color=#1b1baa>$txt</font> configure <font color=#6c3e67>-insertwidth</font> <font color=#1b1baa>$::hl_tcl::my::data(INSERTWIDTH,$txt)</font>
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_readonly'>hl_readonly</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Makes the text widget be readonly or gets its 'read-only' state.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_readonly</span> <span class='ruff_arg'>txt ?ro? ?com2?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>ro</code></code></td><td class='ruff_defitem'>flag &quot;the text widget is readonly&quot; <i>optional, default</i> <code>-1</code></td></tr>
<tr><td class='ruff_defitem'><code><code>com2</code></code></td><td class='ruff_defitem'>command to be called at viewing and after changes; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>If 'ro' argument is omitted, returns the widget's 'read-only' state.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_7' href="javascript:toggleSource('7')">Show source</a></p>
<div id='7' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_readonly {txt {ro -1} {com2 {}}} {

  <i><font color=#4b5d50># Makes the text widget be readonly or gets its 'read-only' state.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   ro - flag &quot;the text widget is readonly&quot;</font></i>
  <i><font color=#4b5d50>#   com2 - command to be called at viewing and after changes</font></i>
  <i><font color=#4b5d50># If 'ro' argument is omitted, returns the widget's 'read-only' state.</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ro</font>==-1} {
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(READONLY,<font color=#1b1baa>$txt</font>)] && <font color=#1b1baa>$::hl_tcl::my::data(READONLY,$txt)</font>}]
  }
  <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(READONLY,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$ro</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$com2</font> ne {}} {<b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(CMD,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$com2</font>}
  <b><font color=#3a6797>set</font></b> newcom <font color=#7d1a1a>&quot;::<font color=#1b1baa>$</font>txt.internal&quot;</font>
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>info</font></b> commands <font color=#1b1baa>$newcom</font>] eq <font color=#7d1a1a>&quot;&quot;</font>} {<b><font color=#3a6797>rename</font></b> <font color=#1b1baa>$txt</font> <font color=#1b1baa>$newcom</font>}
  <b><font color=#3a6797>set</font></b> com <font color=#7d1a1a>&quot;<font color=#1b1baa>[</font>namespace current<font color=#1b1baa>]</font>::my::Modified <font color=#1b1baa>$</font>txt&quot;</font>
  <i><font color=#4b5d50>#if {$com2 ne &quot;&quot;} {append com &quot; ; $com2&quot;}</font></i>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ro</font>} {<b><font color=#ca14ca>proc</font></b> ::<font color=#1b1baa>$txt</font> {args} <font color=#7d1a1a>&quot;  switch -exact -- \[lindex \$args 0\] \{  insert \{<font color=#1b1baa>$</font>com2\}  delete \{<font color=#1b1baa>$</font>com2\}  replace \{<font color=#1b1baa>$</font>com2\}  default \{ return \[eval <font color=#1b1baa>$</font>newcom \$args\] \}  \}&quot;</font>
  } <b><font color=#3a6797>else</font></b> {<b><font color=#ca14ca>proc</font></b> ::<font color=#1b1baa>$txt</font> {args} <font color=#7d1a1a>&quot;  switch -exact -- \[lindex \$args 0\] \{  delete \{<font color=#1b1baa>$</font>com <font color=#1b1baa>{</font>*<font color=#1b1baa>}</font>\$args\}  insert \{<font color=#1b1baa>$</font>com <font color=#1b1baa>{</font>*<font color=#1b1baa>}</font>\$args\}  replace \{<font color=#1b1baa>$</font>com <font color=#1b1baa>{</font>*<font color=#1b1baa>}</font>\$args\}  \} ;  set _res_ \[eval <font color=#1b1baa>$</font>newcom \$args\] ;  return \$_res_&quot;</font>
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::hl_text'>hl_text</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl" title="::hl_tcl" class='ruff_cmd'>::hl_tcl</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl'>hl_tcl</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights Tcl code of a text widget.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>hl_text</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_8' href="javascript:toggleSource('8')">Show source</a></p>
<div id='8' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::hl_text {txt} {

  <i><font color=#4b5d50># Highlights Tcl code of a text widget.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>

  <b><font color=#3a6797>set</font></b> font0 <font color=#1b1baa>$::hl_tcl::my::data(FONT,$txt)</font>
  <b><font color=#3a6797>set</font></b> font1 [<b><font color=#3a6797>set</font></b> font2 <font color=#1b1baa>$font0</font>]
  <font color=#1b1baa>$txt</font> tag configure tagSTD <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font0&quot;</font>
  <font color=#1b1baa>$txt</font> tag add tagSTD 1.0 end
  <b><font color=#3a6797>dict</font></b> set font1 <font color=#6c3e67>-weight</font> bold
  <b><font color=#3a6797>dict</font></b> set font2 <font color=#6c3e67>-slant</font> italic
  <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$::hl_tcl::my::data(COLORS,$txt)</font>  clrCOM clrCOMTK clrSTR clrVAR clrCMN clrPROC clrOPT clrBRA clrCURL clrCMN2
  <font color=#1b1baa>$txt</font> tag configure tagCOM <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font1&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrCOM</font>
  <font color=#1b1baa>$txt</font> tag configure tagCOMTK <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font1&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrCOMTK</font>
  <font color=#1b1baa>$txt</font> tag configure tagSTR <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font0&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrSTR</font>
  <font color=#1b1baa>$txt</font> tag configure tagVAR <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font0&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrVAR</font>
  <font color=#1b1baa>$txt</font> tag configure tagCMN <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font2&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrCMN</font>
  <font color=#1b1baa>$txt</font> tag configure tagCMN2 <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font2&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrCMN2</font> ;<i><font color=#4b5d50>#red</font></i>
  <font color=#1b1baa>$txt</font> tag configure tagPROC <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font1&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrPROC</font>
  <font color=#1b1baa>$txt</font> tag configure tagOPT <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font0&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrOPT</font>
  <font color=#1b1baa>$txt</font> tag configure tagBRACKET <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font0&quot;</font> <font color=#6c3e67>-foreground</font> <font color=#1b1baa>$clrBRA</font>
  <font color=#1b1baa>$txt</font> tag configure tagBRACKETERR <font color=#6c3e67>-font</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>font0&quot;</font> <font color=#6c3e67>-foreground</font> white <font color=#6c3e67>-background</font> red
  <font color=#1b1baa>$txt</font> tag configure tagCURLINE <font color=#6c3e67>-background</font> <font color=#1b1baa>$clrCURL</font>
  <font color=#1b1baa>$txt</font> tag raise sel
  <font color=#1b1baa>$txt</font> tag raise tagBRACKETERR
  <b><font color=#3a6797>catch</font></b> {<font color=#1b1baa>$txt</font> tag raise hilited;  <font color=#1b1baa>$txt</font> tag raise hilited2} ;<i><font color=#4b5d50># for apave package</font></i>
  my::HighlightAll <font color=#1b1baa>$txt</font>
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(BIND_TXT,<font color=#1b1baa>$txt</font>)]} {
    my::BindToEvent <font color=#1b1baa>$txt</font> &lt;FocusIn&gt; ::hl_tcl::my::MemPos <font color=#1b1baa>$txt</font>
    my::BindToEvent <font color=#1b1baa>$txt</font> &lt;KeyPress&gt; ::hl_tcl::my::MemPos1 <font color=#1b1baa>$txt</font> yes %K %s
    my::BindToEvent <font color=#1b1baa>$txt</font> &lt;KeyRelease&gt; ::hl_tcl::my::MemPos <font color=#1b1baa>$txt</font>
    my::BindToEvent <font color=#1b1baa>$txt</font> &lt;ButtonRelease-1&gt; ::hl_tcl::my::MemPos <font color=#1b1baa>$txt</font>
    <b><font color=#3a6797>foreach</font></b> ev {Enter KeyRelease ButtonRelease-1} {
      my::BindToEvent <font color=#1b1baa>$txt</font> &lt;<font color=#1b1baa>$ev</font>&gt; ::hl_tcl::my::HighlightBrackets <font color=#1b1baa>$txt</font>
    }
    <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(BIND_TXT,<font color=#1b1baa>$txt</font>) yes
  }
  <b><font color=#3a6797>set</font></b> ro <font color=#1b1baa>$::hl_tcl::my::data(READONLY,$txt)</font>
  <b><font color=#3a6797>set</font></b> com2 <font color=#1b1baa>$::hl_tcl::my::data(CMD,$txt)</font>
  <b><font color=#3a6797>set</font></b> txtattrs [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ro</font> <font color=#1b1baa>$com2</font>]
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exists ::hl_tcl::my::data(LIST_TXT)] ||  [<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>lsearch</font></b> <font color=#6c3e67>-index</font> 0 <font color=#6c3e67>-exact</font> <font color=#1b1baa>$::hl_tcl::my::data(LIST_TXT)</font> <font color=#1b1baa>$txt</font>]]==-1} {
    <b><font color=#3a6797>lappend</font></b> ::hl_tcl::my::data(LIST_TXT) <font color=#1b1baa>$txtattrs</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> ::hl_tcl::my::data(LIST_TXT) [<b><font color=#3a6797>lreplace</font></b> <font color=#1b1baa>$::hl_tcl::my::data(LIST_TXT)</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$txtattrs</font>]
  }
  hl_readonly <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ro</font> <font color=#1b1baa>$com2</font>
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><h1 class='ruff'><a name='::hl_tcl::my'></a>::hl_tcl::my<span class='tinylink'><a href='#top'>Top</a></span></h1>
<div style='clear:both;'></div>
<p class='ruff'>The <code>::hl_tcl::my</code> namespace contains procedures for the &quot;internal&quot; usage by <em>hl_tcl</em> package.</p>
<p class='ruff'>All of them are upper-cased, in contrast with the UI procedures of <code>hl_tcl</code> namespace.</p>
<br><h2 class='ruff'><a name='::hl_tcl::my-Commands'></a>Commands<span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h2>
<div style='clear:both;'></div>
<br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::AuxEnding'>AuxEnding</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Auxiliary procedure to process the ending comments in the line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>AuxEnding</span> <span class='ruff_arg'>kName lineName iName</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>kName</code></code></td><td class='ruff_defitem'>variable's name for 'k'</td></tr>
<tr><td class='ruff_defitem'><code><code>lineName</code></code></td><td class='ruff_defitem'>variable's name for 'line'</td></tr>
<tr><td class='ruff_defitem'><code><code>iName</code></code></td><td class='ruff_defitem'>variable's name for 'i'</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::HighlightLine" title="HighlightLine" class='ruff_cmd'>HighlightLine</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_9' href="javascript:toggleSource('9')">Show source</a></p>
<div id='9' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::AuxEnding {kName lineName iName} {

  <i><font color=#4b5d50># Auxiliary procedure to process the ending comments in the line.</font></i>
  <i><font color=#4b5d50>#   kName - variable's name for 'k'</font></i>
  <i><font color=#4b5d50>#   lineName - variable's name for 'line'</font></i>
  <i><font color=#4b5d50>#   iName - variable's name for 'i'</font></i>
  <i><font color=#4b5d50># See also: HighlightLine</font></i>

  <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$kName</font> k <font color=#1b1baa>$lineName</font> line <font color=#1b1baa>$iName</font> i
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> k [<b><font color=#3a6797>string</font></b> first # <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font>]]&gt;-1 &&  [<b><font color=#3a6797>string</font></b> index [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$line</font>] 0] eq {#}} {
    <b><font color=#ca14ca>return</font></b> 1
  }
  <i><font color=#4b5d50># not found a full line comment =&gt; try to find &quot;good&quot; ending comments i.e. &quot;;# ...&quot;</font></i>
  <i><font color=#4b5d50># at that even proper comments like</font></i>
  <i><font color=#4b5d50>#   if {cond} { #...</font></i>
  <i><font color=#4b5d50>#   }</font></i>
  <i><font color=#4b5d50># are skipped as &quot;bad&quot;</font></i>
  <b><font color=#3a6797>set</font></b> k [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>regexp</font></b> <font color=#6c3e67>-inline</font> <font color=#6c3e67>-indices</font> {;\s*#} [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font> end]] 0 0]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$k</font> eq {}} {
    <b><font color=#3a6797>set</font></b> k -1
    <b><font color=#ca14ca>return</font></b> 0
  }
  <b><font color=#3a6797>set</font></b> k [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$k</font>+<font color=#1b1baa>$i</font>+1}]
  <b><font color=#ca14ca>return</font></b> 1
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::BindToEvent'>BindToEvent</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Binds an event on a widget to a command.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>BindToEvent</span> <span class='ruff_arg'>w event ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>w</code></code></td><td class='ruff_defitem'>the widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>event</code></code></td><td class='ruff_defitem'>the event</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>the command</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_10' href="javascript:toggleSource('10')">Show source</a></p>
<div id='10' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::BindToEvent {w event args} {

  <i><font color=#4b5d50># Binds an event on a widget to a command.</font></i>
  <i><font color=#4b5d50>#   w - the widget's path</font></i>
  <i><font color=#4b5d50>#   event - the event</font></i>
  <i><font color=#4b5d50>#   args - the command</font></i>

  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$args</font> [<b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> <font color=#1b1baa>$event</font>]]&lt;0} {
    <b><font color=#134070>bind</font></b> <font color=#1b1baa>$w</font> <font color=#1b1baa>$event</font> [<b><font color=#3a6797>list</font></b> + {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::CoroHighlightAll'>CoroHighlightAll</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights all of a text as a coroutine.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CoroHighlightAll</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::HighlightAll" title="HighlightAll" class='ruff_cmd'>HighlightAll</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_11' href="javascript:toggleSource('11')">Show source</a></p>
<div id='11' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::CoroHighlightAll {txt} {

  <i><font color=#4b5d50># Highlights all of a text as a coroutine.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50># See also: HighlightAll</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>catch</font></b> {  ;<i><font color=#4b5d50># $txt may be destroyed, so catch this</font></i>
    <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$data(PLAINTEXT,$txt)</font>} {
      <b><font color=#3a6797>set</font></b> tlen [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$txt</font> index end] .] 0]
      RemoveTags <font color=#1b1baa>$txt</font> 1.0 end
      <b><font color=#3a6797>set</font></b> maxl [<b><font color=#3a6797>expr</font></b> {min(<font color=#1b1baa>$data(SEEN,$txt)</font>,<font color=#1b1baa>$tlen</font>)}]
      <b><font color=#3a6797>set</font></b> maxl [<b><font color=#3a6797>expr</font></b> {min(<font color=#1b1baa>$data(SEEN,$txt)</font>,<font color=#1b1baa>$tlen</font>)}]
      <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> currQtd [<b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>set</font></b> lnseen 0]]} {<font color=#1b1baa>$ln</font>&lt;=<font color=#1b1baa>$tlen</font>} {} {
        <b><font color=#3a6797>set</font></b> currQtd [HighlightLine <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$currQtd</font>]
        <b><font color=#3a6797>incr</font></b> ln
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> lnseen]&gt;<font color=#1b1baa>$data(SEEN,$txt)</font>} {
          <b><font color=#3a6797>set</font></b> lnseen 0
          <b><font color=#3a6797>after</font></b> idle after 1 [<b><font color=#3a6797>info</font></b> coroutine]
          <b><font color=#ca14ca>yield</font></b>
        }
      }
    }
  }
  <b><font color=#3a6797>set</font></b> data(REG_TXT,<font color=#1b1baa>$txt</font>) {1}
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::CoroModified'>CoroModified</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Handles modifications of text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CoroModified</span> <span class='ruff_arg'>txt ?i1? ?i2? ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>i1</code></code></td><td class='ruff_defitem'>Not documented; <i>optional, default</i> <code>-1</code></td></tr>
<tr><td class='ruff_defitem'><code><code>i2</code></code></td><td class='ruff_defitem'>Not documented; <i>optional, default</i> <code>-1</code></td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::Modified" title="Modified" class='ruff_cmd'>Modified</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_12' href="javascript:toggleSource('12')">Show source</a></p>
<div id='12' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::CoroModified {txt {i1 -1} {i2 -1} args} {

  <i><font color=#4b5d50># Handles modifications of text.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50># See also: Modified</font></i>

  <b><font color=#3a6797>catch</font></b> {
    <b><font color=#3a6797>variable</font></b> data
    <i><font color=#4b5d50># current line:</font></i>
    <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$txt</font> index insert])}]
    <i><font color=#4b5d50># ending line:</font></i>
    <b><font color=#3a6797>set</font></b> endl [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$txt</font> index {end -1 char}])}]
    <i><font color=#4b5d50># range of change:</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$i1</font>!=-1} {
      <b><font color=#3a6797>set</font></b> dl [<b><font color=#3a6797>expr</font></b> {abs(<font color=#1b1baa>$i2</font>-<font color=#1b1baa>$i1</font>)}]
      <b><font color=#3a6797>set</font></b> ln <font color=#1b1baa>$i1</font>
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> dl [<b><font color=#3a6797>expr</font></b> {abs(int(<font color=#1b1baa>$data(CUR_LEN,$txt)</font>) - <font color=#1b1baa>$endl</font>)}]
    }
    <i><font color=#4b5d50># begin and end of changes:</font></i>
    <b><font color=#3a6797>set</font></b> ln1 [<b><font color=#3a6797>set</font></b> lno1 [<b><font color=#3a6797>expr</font></b> {max((<font color=#1b1baa>$ln</font>-<font color=#1b1baa>$dl</font>),1)}]]
    <b><font color=#3a6797>set</font></b> ln2 [<b><font color=#3a6797>set</font></b> lno2 [<b><font color=#3a6797>expr</font></b> {min((<font color=#1b1baa>$ln</font>+<font color=#1b1baa>$dl</font>),<font color=#1b1baa>$endl</font>)}]]
    <b><font color=#3a6797>lassign</font></b> [CountQSH <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln</font>] cntq cnts ccmnt
    <i><font color=#4b5d50># flag &quot;highlight to the end&quot;:</font></i>
    <b><font color=#3a6797>set</font></b> bf1 [<b><font color=#3a6797>expr</font></b> {abs(<font color=#1b1baa>$ln</font>-int(<font color=#1b1baa>$data(CURPOS,$txt)</font>))&gt;1 || <font color=#1b1baa>$dl</font>&gt;1  || <font color=#1b1baa>$cntq</font>!=<font color=#1b1baa>$data(CNT_QUOTE,$txt)</font>  || <font color=#1b1baa>$ccmnt</font>!=<font color=#1b1baa>$data(CNT_COMMENT,$txt)</font>}]
    <b><font color=#3a6797>set</font></b> bf2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$cnts</font>!=<font color=#1b1baa>$data(CNT_SLASH,$txt)</font>}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$bf1</font> && !<font color=#1b1baa>$data(MULTILINE,$txt)</font> || <font color=#1b1baa>$bf2</font>} {
      <b><font color=#3a6797>set</font></b> lnt1 <font color=#1b1baa>$ln</font>
      <b><font color=#3a6797>set</font></b> lnt2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$ln</font>+1}]
      <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$ln2</font>&lt;<font color=#1b1baa>$endl</font> && <font color=#1b1baa>$lnt1</font>&lt;<font color=#1b1baa>$endl</font> && <font color=#1b1baa>$lnt2</font>&lt;=<font color=#1b1baa>$endl</font> && (  [<font color=#1b1baa>$txt</font> get <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>lnt1.end -1 char&quot;</font> <font color=#1b1baa>$lnt1</font>.end] in {\\ \&quot;} ||
      [<font color=#1b1baa>$txt</font> get <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>lnt2.end -1 char&quot;</font> <font color=#1b1baa>$lnt2</font>.end] in {\\ \&quot;}) || <font color=#1b1baa>$bf2</font>} {
        <b><font color=#3a6797>incr</font></b> lnt1 ;<i><font color=#4b5d50># next lines be handled too, if ended with &quot;\\&quot;</font></i>
        <b><font color=#3a6797>incr</font></b> lnt2
        <b><font color=#3a6797>incr</font></b> ln2
        <b><font color=#3a6797>set</font></b> bf2 0
      }
    }
    <b><font color=#3a6797>set</font></b> tSTR [<font color=#1b1baa>$txt</font> tag ranges tagSTR]
    <b><font color=#3a6797>set</font></b> tCMN [<font color=#1b1baa>$txt</font> tag ranges tagCMN]
    <b><font color=#3a6797>lappend</font></b> tCMN {<b><font color=#3a6797>*</font></b>}[<font color=#1b1baa>$txt</font> tag ranges tagCMN2]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ln1</font>==1} {
      <b><font color=#3a6797>set</font></b> currQtd 0
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> currQtd [LineState <font color=#1b1baa>$txt</font> <font color=#1b1baa>$tSTR</font> <font color=#1b1baa>$tCMN</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln1.0 -1 chars&quot;</font>]
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(PLAINTEXT,$txt)</font>} {
      <font color=#1b1baa>$txt</font> tag add tagSTD <font color=#1b1baa>$ln1</font>.0 <font color=#1b1baa>$ln2</font>.end
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>set</font></b> lnseen 0
      <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$ln1</font>&lt;=<font color=#1b1baa>$ln2</font>} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ln1</font>==<font color=#1b1baa>$ln2</font>} {
          <b><font color=#3a6797>set</font></b> bf2 [LineState <font color=#1b1baa>$txt</font> <font color=#1b1baa>$tSTR</font> <font color=#1b1baa>$tCMN</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln1.end +1 chars&quot;</font>]
        }
        RemoveTags <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln1</font>.0 <font color=#1b1baa>$ln1</font>.end
        <b><font color=#3a6797>set</font></b> currQtd [HighlightLine <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln1</font> <font color=#1b1baa>$currQtd</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ln1</font>==<font color=#1b1baa>$ln2</font> && (<font color=#1b1baa>$bf1</font> || <font color=#1b1baa>$bf2</font>!=<font color=#1b1baa>$currQtd</font>) && <font color=#1b1baa>$data(MULTILINE,$txt)</font>} {
          <b><font color=#3a6797>set</font></b> ln2 <font color=#1b1baa>$endl</font>  ;<i><font color=#4b5d50># run to the end</font></i>
        }
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>incr</font></b> lnseen]&gt;<font color=#1b1baa>$data(SEEN,$txt)</font>} {
          <b><font color=#3a6797>set</font></b> lnseen 0
          <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$data(COROATFER,$txt)</font>}
          <b><font color=#3a6797>set</font></b> data(COROATFER,<font color=#1b1baa>$txt</font>) [<b><font color=#3a6797>after</font></b> idle after 1 [<b><font color=#3a6797>info</font></b> coroutine]]
          <b><font color=#ca14ca>yield</font></b>
        }
        <b><font color=#3a6797>incr</font></b> ln1
      }
    }
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> cmd <font color=#1b1baa>$data(CMD,$txt)</font>] ne {}} {
      <i><font color=#4b5d50># run a command after changes done (its arguments are txt, ln1, ln2)</font></i>
      <b><font color=#3a6797>append</font></b> cmd <font color=#7d1a1a>&quot; <font color=#1b1baa>$</font>txt <font color=#1b1baa>$</font>lno1 <font color=#1b1baa>$</font>lno2 <font color=#1b1baa>$</font>args&quot;</font>
      {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$cmd</font>
    }
    MemPos <font color=#1b1baa>$txt</font>
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::CoroRun'>CoroRun</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<div class='ruff_synopsis'><span class='ruff_cmd'>CoroRun</span> <span class='ruff_arg'>txt pos1 pos2 ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>pos1</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>pos2</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_13' href="javascript:toggleSource('13')">Show source</a></p>
<div id='13' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::CoroRun {txt pos1 pos2 args} {

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>info</font></b> exist data(REG_TXT,<font color=#1b1baa>$txt</font>)] || <font color=#1b1baa>$data(REG_TXT,$txt)</font> eq {} ||  ![<b><font color=#3a6797>info</font></b> exist data(CUR_LEN,<font color=#1b1baa>$txt</font>)]} {
    <i><font color=#4b5d50># skip changes till the highlighting done</font></i>
    <b><font color=#3a6797>after</font></b> 10 [<b><font color=#3a6797>list</font></b> ::hl_tcl::my::RunCoroAfterIdle <font color=#1b1baa>$txt</font> <font color=#1b1baa>$pos1</font> <font color=#1b1baa>$pos2</font> yes {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>]
    <b><font color=#ca14ca>return</font></b>
  }
  <i><font color=#4b5d50># let them work one by one</font></i>
  <b><font color=#3a6797>set</font></b> i1 [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$pos1</font>)}]
  <b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$pos2</font>)}]
  <b><font color=#3a6797>set</font></b> coroNo [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>incr</font></b> data(CORMOD)] % 10000000}]
  <b><font color=#ca14ca>coroutine</font></b> CoModified<font color=#1b1baa>$coroNo</font> ::hl_tcl::my::CoroModified <font color=#1b1baa>$txt</font> <font color=#1b1baa>$i1</font> <font color=#1b1baa>$i2</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::CountChar'>CountChar</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Counts a character in a string.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CountChar</span> <span class='ruff_arg'>str ch ?plistName? ?escaped?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>str</code></code></td><td class='ruff_defitem'>the string</td></tr>
<tr><td class='ruff_defitem'><code><code>ch</code></code></td><td class='ruff_defitem'>the character</td></tr>
<tr><td class='ruff_defitem'><code><code>plistName</code></code></td><td class='ruff_defitem'>variable name for a list of positions of <em>ch</em>; <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
<tr><td class='ruff_defitem'><code><code>escaped</code></code></td><td class='ruff_defitem'>true, if the character is escaped; <i>optional, default</i> <code>yes</code></td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a number of any occurences of character <em>ch</em> in string <em>str</em> if the character is escaped, but if it is not escaped, only non-escaped characters are counted.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_14' href="javascript:toggleSource('14')">Show source</a></p>
<div id='14' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::CountChar {str ch {plistName {}} {escaped yes}} {

  <i><font color=#4b5d50># Counts a character in a string.</font></i>
  <i><font color=#4b5d50>#   str - the string</font></i>
  <i><font color=#4b5d50>#   ch - the character</font></i>
  <i><font color=#4b5d50>#   plistName - variable name for a list of positions of *ch*</font></i>
  <i><font color=#4b5d50>#   escaped - true, if the character is escaped.</font></i>
  <i><font color=#4b5d50># Returns a number of any occurences of character *ch* in string *str*</font></i>
  <i><font color=#4b5d50># if the character is escaped, but if it is not escaped, only non-escaped</font></i>
  <i><font color=#4b5d50># characters are counted.</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$plistName</font> ne {}} {
    <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$plistName</font> plist
    <b><font color=#3a6797>set</font></b> plist [<b><font color=#3a6797>list</font></b>]
  }
  <b><font color=#3a6797>set</font></b> icnt [<b><font color=#3a6797>set</font></b> begidx 0]
  <b><font color=#3a6797>while</font></b> {[<b><font color=#3a6797>set</font></b> idx [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$ch</font> <font color=#1b1baa>$str</font>]] &gt;= 0} {
    <b><font color=#3a6797>set</font></b> nidx <font color=#1b1baa>$idx</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$escaped</font> || ![Escaped <font color=#1b1baa>$str</font> <font color=#1b1baa>$idx</font>]} {
      <b><font color=#3a6797>incr</font></b> icnt
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$plistName</font> ne {}} {<b><font color=#3a6797>lappend</font></b> plist [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$begidx</font>+<font color=#1b1baa>$idx</font>}]}
    }
    <b><font color=#3a6797>incr</font></b> begidx [<b><font color=#3a6797>incr</font></b> idx]
    <b><font color=#3a6797>set</font></b> str [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$str</font> <font color=#1b1baa>$idx</font> end]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$icnt</font>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::CountQSH'>CountQSH</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Counts quotes, slashes, hashes in a line</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>CountQSH</span> <span class='ruff_arg'>txt ln</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>ln</code></code></td><td class='ruff_defitem'>line's index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_15' href="javascript:toggleSource('15')">Show source</a></p>
<div id='15' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::CountQSH {txt ln} {

  <i><font color=#4b5d50># Counts quotes, slashes, hashes in a line</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   ln - line's index</font></i>

  <b><font color=#3a6797>set</font></b> ln [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$ln</font>)}]
  <b><font color=#3a6797>set</font></b> st [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$ln</font>.0 <font color=#1b1baa>$ln</font>.end]
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>list</font></b> [CountChar <font color=#1b1baa>$st</font> \&quot;] [CountChar <font color=#1b1baa>$st</font> \\] [CountChar <font color=#1b1baa>$st</font> #]]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::Escaped'>Escaped</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if a character is escaped in a string.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Escaped</span> <span class='ruff_arg'>line curpos</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>line</code></code></td><td class='ruff_defitem'>the string</td></tr>
<tr><td class='ruff_defitem'><code><code>curpos</code></code></td><td class='ruff_defitem'>position of the character in the line</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns 1 if the character is escaped in the string.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_16' href="javascript:toggleSource('16')">Show source</a></p>
<div id='16' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::Escaped {line curpos} {

  <i><font color=#4b5d50># Checks if a character is escaped in a string.</font></i>
  <i><font color=#4b5d50>#   line - the string</font></i>
  <i><font color=#4b5d50>#   curpos - position of the character in the line</font></i>
  <i><font color=#4b5d50># Returns 1 if the character is escaped in the string.</font></i>

  <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> 0 <font color=#1b1baa>$curpos</font>-1]
  <b><font color=#3a6797>set</font></b> linetrim [<b><font color=#3a6797>string</font></b> trimright <font color=#1b1baa>$line</font> \\]
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {([<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]-[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$linetrim</font>])%2}]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::FirstQtd'>FirstQtd</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Searches the quote characters in line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>FirstQtd</span> <span class='ruff_arg'>lineName iName currQtd</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>lineName</code></code></td><td class='ruff_defitem'>variable's name for 'line'</td></tr>
<tr><td class='ruff_defitem'><code><code>iName</code></code></td><td class='ruff_defitem'>variable's name for 'i'</td></tr>
<tr><td class='ruff_defitem'><code><code>currQtd</code></code></td><td class='ruff_defitem'>yes, if searching inside the quoted</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns &quot;yes&quot; if a quote character was found.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_17' href="javascript:toggleSource('17')">Show source</a></p>
<div id='17' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::FirstQtd {lineName iName currQtd} {

  <i><font color=#4b5d50># Searches the quote characters in line.</font></i>
  <i><font color=#4b5d50>#   lineName - variable's name for 'line'</font></i>
  <i><font color=#4b5d50>#   iName - variable's name for 'i'</font></i>
  <i><font color=#4b5d50>#   currQtd - yes, if searching inside the quoted</font></i>
  <i><font color=#4b5d50># Returns &quot;yes&quot; if a quote character was found.</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>upvar</font></b> 1 <font color=#1b1baa>$lineName</font> line <font color=#1b1baa>$iName</font> i
  <b><font color=#3a6797>while</font></b> {1} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>string</font></b> first \&quot; <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font>]]==-1} {<b><font color=#ca14ca>return</font></b> no}
    <b><font color=#3a6797>if</font></b> {[NotEscaped <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font>]} {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$currQtd</font>} {<b><font color=#ca14ca>return</font></b> yes}
      <b><font color=#3a6797>set</font></b> i1 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>-1}]
      <b><font color=#3a6797>set</font></b> i2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i</font>+1}]
      <b><font color=#3a6797>if</font></b> {[NotEscaped <font color=#1b1baa>$line</font> <font color=#1b1baa>$i1</font>]} {
        <b><font color=#3a6797>set</font></b> c1 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> <font color=#1b1baa>$i1</font>]  ;<i><font color=#4b5d50># check the string ends</font></i>
        <b><font color=#3a6797>set</font></b> c2 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> <font color=#1b1baa>$i2</font>]
        <i><font color=#4b5d50># not needed: $c1 in $data(S_BOTH) && $c2 ni $data(S_BOTH) ||</font></i>
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c1</font> in <font color=#1b1baa>$data(S_LEFT)</font> && <font color=#1b1baa>$c2</font> ni <font color=#1b1baa>$data(S_RIGHT)</font>
        || <font color=#1b1baa>$c1</font> ni <font color=#1b1baa>$data(S_LEFT)</font> && <font color=#1b1baa>$c2</font> in <font color=#1b1baa>$data(S_RIGHT)</font>} {
          <b><font color=#ca14ca>return</font></b> yes
        }
        <i><font color=#4b5d50># last reverence: for braced expression</font></i>
        <b><font color=#3a6797>set</font></b> i1 <font color=#1b1baa>$i</font>
        <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$i1</font>&gt;0} {
          <b><font color=#3a6797>set</font></b> c1 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> <font color=#1b1baa>$i1</font>-1]
          <b><font color=#3a6797>set</font></b> c2 [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> <font color=#1b1baa>$i1</font>]
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c1</font> in <font color=#1b1baa>$data(S_SPACE)</font>} {<b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$c2</font> ne <font color=#7d1a1a>&quot;\{&quot;</font>}]}
          <b><font color=#3a6797>incr</font></b> i1 -1
        }
        <b><font color=#ca14ca>return</font></b> no
      }
      <b><font color=#ca14ca>return</font></b> yes
    }
    <b><font color=#3a6797>incr</font></b> i
  }
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightAll'>HighlightAll</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights all of a text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightAll</span> <span class='ruff_arg'>txt</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Makes a coroutine from this.</p>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::CoroHighlightAll" title="CoroHighlightAll" class='ruff_cmd'>CoroHighlightAll</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_18' href="javascript:toggleSource('18')">Show source</a></p>
<div id='18' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::HighlightAll {txt} {

  <i><font color=#4b5d50># Highlights all of a text.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50># Makes a coroutine from this.</font></i>
  <i><font color=#4b5d50># See also: CoroHighlightAll</font></i>

  <i><font color=#4b5d50># let them work one by one:</font></i>
  <b><font color=#3a6797>set</font></b> coroNo [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>incr</font></b> ::hl_tcl::my::data(CORALL)] % 10000000}]
  <b><font color=#ca14ca>coroutine</font></b> co_HlAll<font color=#1b1baa>$coroNo</font> ::hl_tcl::my::CoroHighlightAll <font color=#1b1baa>$txt</font>
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightBrackets'>HighlightBrackets</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights matching brackets if any.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightBrackets</span> <span class='ruff_arg'>w</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>w</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_19' href="javascript:toggleSource('19')">Show source</a></p>
<div id='19' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::HighlightBrackets {w} {

  <i><font color=#4b5d50># Highlights matching brackets if any.</font></i>
  <i><font color=#4b5d50>#   w - text widget's path</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> curpos [ShowCurrentLine <font color=#1b1baa>$w</font>]
  <b><font color=#3a6797>set</font></b> curpos2 [<font color=#1b1baa>$w</font> index {insert -1 chars}]
  <b><font color=#3a6797>set</font></b> ch [<font color=#1b1baa>$w</font> get <font color=#1b1baa>$curpos</font>]
  <b><font color=#3a6797>set</font></b> il [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$ch</font> <font color=#1b1baa>$data(LBR)</font>]
  <b><font color=#3a6797>set</font></b> ir [<b><font color=#3a6797>string</font></b> first <font color=#1b1baa>$ch</font> <font color=#1b1baa>$data(RBR)</font>]
  <b><font color=#3a6797>set</font></b> txt [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$w</font> get 1.0 end] \n]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$il</font>&gt;-1} {
    <b><font color=#3a6797>set</font></b> brcpos [MatchedBrackets <font color=#1b1baa>$txt</font> <font color=#1b1baa>$curpos</font>  [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(LBR)</font> <font color=#1b1baa>$il</font>] [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(RBR)</font> <font color=#1b1baa>$il</font>] 1]
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$ir</font>&gt;-1} {
    <b><font color=#3a6797>set</font></b> brcpos [MatchedBrackets <font color=#1b1baa>$txt</font> <font color=#1b1baa>$curpos</font>  [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(RBR)</font> <font color=#1b1baa>$ir</font>] [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(LBR)</font> <font color=#1b1baa>$ir</font>] -1]
  } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>set</font></b> il [<b><font color=#3a6797>string</font></b> first [<font color=#1b1baa>$w</font> get <font color=#1b1baa>$curpos2</font>] <font color=#1b1baa>$data(LBR)</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> curpos <font color=#1b1baa>$curpos2</font>
    <b><font color=#3a6797>set</font></b> brcpos [MatchedBrackets <font color=#1b1baa>$txt</font> <font color=#1b1baa>$curpos</font>  [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(LBR)</font> <font color=#1b1baa>$il</font>] [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(RBR)</font> <font color=#1b1baa>$il</font>] 1]
  } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>set</font></b> ir [<b><font color=#3a6797>string</font></b> first [<font color=#1b1baa>$w</font> get <font color=#1b1baa>$curpos2</font>] <font color=#1b1baa>$data(RBR)</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> curpos <font color=#1b1baa>$curpos2</font>
    <b><font color=#3a6797>set</font></b> brcpos [MatchedBrackets <font color=#1b1baa>$txt</font> <font color=#1b1baa>$curpos</font>  [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(RBR)</font> <font color=#1b1baa>$ir</font>] [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$data(LBR)</font> <font color=#1b1baa>$ir</font>] -1]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#ca14ca>return</font></b>
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$brcpos</font> ne {}} {
    <font color=#1b1baa>$w</font> tag add tagBRACKET <font color=#1b1baa>$brcpos</font>
    <font color=#1b1baa>$w</font> tag add tagBRACKET <font color=#1b1baa>$curpos</font>
  } <b><font color=#3a6797>else</font></b> {
    <font color=#1b1baa>$w</font> tag add tagBRACKETERR <font color=#1b1baa>$curpos</font>
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightCmd'>HighlightCmd</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights Tcl/Tk commands.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightCmd</span> <span class='ruff_arg'>txt line ln pri i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>line</code></code></td><td class='ruff_defitem'>line to be highlighted</td></tr>
<tr><td class='ruff_defitem'><code><code>ln</code></code></td><td class='ruff_defitem'>line number</td></tr>
<tr><td class='ruff_defitem'><code><code>pri</code></code></td><td class='ruff_defitem'>column number to highlighted from</td></tr>
<tr><td class='ruff_defitem'><code><code>i</code></code></td><td class='ruff_defitem'>current position in 'line'</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_20' href="javascript:toggleSource('20')">Show source</a></p>
<div id='20' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::HighlightCmd {txt line ln pri i} {

  <i><font color=#4b5d50># Highlights Tcl/Tk commands.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   line - line to be highlighted</font></i>
  <i><font color=#4b5d50>#   ln - line number</font></i>
  <i><font color=#4b5d50>#   pri - column number to highlighted from</font></i>
  <i><font color=#4b5d50>#   i - current position in 'line'</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <font color=#1b1baa>$txt</font> tag add tagSTD <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>i +1 chars&quot;</font>
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$pri</font>} {
    <b><font color=#3a6797>incr</font></b> pri -1
    <b><font color=#3a6797>set</font></b> RE <font color=#1b1baa>$data(RE1)</font>
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>set</font></b> RE <font color=#1b1baa>$data(RE0)</font>
  }
  <b><font color=#3a6797>set</font></b> st [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$pri</font> <font color=#1b1baa>$i</font>-1]
  <b><font color=#3a6797>set</font></b> lcom [<b><font color=#3a6797>regexp</font></b> <font color=#6c3e67>-inline</font> <font color=#6c3e67>-all</font> <font color=#6c3e67>-indices</font> <font color=#1b1baa>$RE</font> <font color=#1b1baa>$st</font>]
  <i><font color=#4b5d50># commands</font></i>
  <b><font color=#3a6797>foreach</font></b> {- - lc -} <font color=#1b1baa>$lcom</font> {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$lc</font> i1 i2
    <b><font color=#3a6797>set</font></b> c [<b><font color=#3a6797>string</font></b> trim [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$st</font> <font color=#1b1baa>$i1</font> <font color=#1b1baa>$i2</font>] <font color=#7d1a1a>&quot;\{\}\[;\t &quot;</font>]
    <b><font color=#3a6797>set</font></b> ik [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i2</font>-<font color=#1b1baa>$i1</font>+1-[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$c</font>]}]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c</font> ne {}} {
      <b><font color=#3a6797>incr</font></b> i1 <font color=#1b1baa>$ik</font>
      <b><font color=#3a6797>incr</font></b> i2
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#6c3e67>-exact</font> <font color=#6c3e67>-sorted</font> <font color=#1b1baa>$data(CMD_TCL)</font> <font color=#1b1baa>$c</font>]&gt;-1} {
        <font color=#1b1baa>$txt</font> tag add tagCOM <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>i1 char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>i2 char&quot;</font>
      } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#6c3e67>-exact</font> <font color=#6c3e67>-sorted</font> <font color=#1b1baa>$data(PROC_TCL)</font> <font color=#1b1baa>$c</font>]&gt;-1} {
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c</font> eq {<b><font color=#3a6797>namespace</font></b>} &&
        ![<b><font color=#3a6797>regexp</font></b> {^namespace[\s]+eval([\s]|$)+} [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$st</font> <font color=#1b1baa>$i1</font> end]]} {
          <b><font color=#3a6797>set</font></b> tag tagCOM ;<i><font color=#4b5d50># let &quot;namespace eval&quot; only be highlighted as proc/return</font></i>
        } <b><font color=#3a6797>else</font></b> {
          <b><font color=#3a6797>set</font></b> tag tagPROC
        }
        <font color=#1b1baa>$txt</font> tag add <font color=#1b1baa>$tag</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>i1 char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>i2 char&quot;</font>
      } <b><font color=#3a6797>elseif</font></b> {[<b><font color=#3a6797>lsearch</font></b> <font color=#6c3e67>-exact</font> <font color=#6c3e67>-sorted</font> <font color=#1b1baa>$data(CMD_TK_EXP)</font> <font color=#1b1baa>$c</font>]&gt;-1} {
        <font color=#1b1baa>$txt</font> tag add tagCOMTK <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>i1 char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>i2 char&quot;</font>
      }
    }
  }
  <i><font color=#4b5d50># $variables:</font></i>
  <b><font color=#3a6797>set</font></b> dlist [<b><font color=#3a6797>list</font></b>]
  <b><font color=#3a6797>set</font></b> slen [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$st</font>]-1}]
  <b><font color=#3a6797>set</font></b> cnt [CountChar <font color=#1b1baa>$st</font> \$ dlist no]
  <b><font color=#3a6797>foreach</font></b> dl <font color=#1b1baa>$dlist</font> {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$dl</font>+1] eq <font color=#7d1a1a>&quot;\{&quot;</font>} {
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> br2 [<b><font color=#3a6797>string</font></b> first \} <font color=#1b1baa>$st</font> <font color=#1b1baa>$dl</font>+2]]!=-1} {
        <font color=#1b1baa>$txt</font> tag add tagVAR <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>dl char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>[</font>incr br2<font color=#1b1baa>]</font> char&quot;</font>
      }
      <b><font color=#3a6797>continue</font></b>
    }
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>set</font></b> dl2 <font color=#1b1baa>$dl</font>]} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$slen</font>} {} {
      <b><font color=#3a6797>incr</font></b> i
      <b><font color=#3a6797>set</font></b> ch [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> is wordchar <font color=#1b1baa>$ch</font>] || <font color=#1b1baa>$ch</font> eq {:}} {
        <b><font color=#3a6797>set</font></b> dl2 <font color=#1b1baa>$i</font>
        <b><font color=#3a6797>continue</font></b>
      } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$ch</font> eq {(}} {
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> br2 [<b><font color=#3a6797>string</font></b> first {)} <font color=#1b1baa>$st</font> <font color=#1b1baa>$i</font>+1]]&gt;-1} {
          <b><font color=#3a6797>set</font></b> dl2 <font color=#1b1baa>$br2</font>
        }
      }
      <b><font color=#3a6797>break</font></b>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dl2</font>&gt;<font color=#1b1baa>$dl</font>} {
      <font color=#1b1baa>$txt</font> tag add tagVAR <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>dl char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>[</font>incr dl2<font color=#1b1baa>]</font> char&quot;</font>
    }
  }
  <i><font color=#4b5d50># -options</font></i>
  <b><font color=#3a6797>set</font></b> dl -1
  <b><font color=#3a6797>while</font></b> {[<b><font color=#3a6797>set</font></b> dl [<b><font color=#3a6797>string</font></b> first - <font color=#1b1baa>$st</font> [<b><font color=#3a6797>incr</font></b> dl]]]&gt;-1} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$dl</font>-1] ni <font color=#1b1baa>$data(S_SPACE2)</font>} <b><font color=#3a6797>continue</font></b>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$dl</font>+1] eq {-}} {
      <b><font color=#3a6797>incr</font></b> dl ;<i><font color=#4b5d50># for --longoption</font></i>
    }
    <b><font color=#3a6797>set</font></b> i <font color=#1b1baa>$dl</font>
    <b><font color=#3a6797>set</font></b> ch [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$i</font>+1]
    <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> is alpha <font color=#6c3e67>-strict</font> <font color=#1b1baa>$ch</font>]} { ;<i><font color=#4b5d50># || ![string is ascii -strict $ch]</font></i>
      <b><font color=#3a6797>continue</font></b> ;<i><font color=#4b5d50># first, a Latin letter</font></i>
    }
    <b><font color=#3a6797>set</font></b> dl2 -1
    <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$slen</font>} {
      <b><font color=#3a6797>incr</font></b> i
      <b><font color=#3a6797>set</font></b> ch [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$i</font>]
      <b><font color=#3a6797>if</font></b> {![<b><font color=#3a6797>string</font></b> is wordchar <font color=#1b1baa>$ch</font>] && <font color=#1b1baa>$ch</font> ne {-}} <b><font color=#3a6797>break</font></b>
      <b><font color=#3a6797>set</font></b> dl2 <font color=#1b1baa>$i</font>
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dl2</font>&gt;-1} {
      <font color=#1b1baa>$txt</font> tag add tagOPT <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>$</font>dl char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>pri +<font color=#1b1baa>[</font>incr dl2<font color=#1b1baa>]</font> char&quot;</font>
      <b><font color=#3a6797>set</font></b> dl <font color=#1b1baa>$dl2</font>
    }
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightComment'>HighlightComment</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights comments.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightComment</span> <span class='ruff_arg'>txt line ln k</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>line</code></code></td><td class='ruff_defitem'>current line</td></tr>
<tr><td class='ruff_defitem'><code><code>ln</code></code></td><td class='ruff_defitem'>line's number</td></tr>
<tr><td class='ruff_defitem'><code><code>k</code></code></td><td class='ruff_defitem'>comment's starting position in line</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_21' href="javascript:toggleSource('21')">Show source</a></p>
<div id='21' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::HighlightComment {txt line ln k} {

  <i><font color=#4b5d50># Highlights comments.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   line - current line</font></i>
  <i><font color=#4b5d50>#   ln - line's number</font></i>
  <i><font color=#4b5d50>#   k - comment's starting position in line</font></i>

  <b><font color=#3a6797>set</font></b> stcom [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$k</font> end]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>regexp</font></b> {^\s*#\s*(!|TODO)} <font color=#1b1baa>$stcom</font>]} {
    <font color=#1b1baa>$txt</font> tag add tagCMN2 <font color=#1b1baa>$ln</font>.<font color=#1b1baa>$k</font> <font color=#1b1baa>$ln</font>.end  ;<i><font color=#4b5d50># &quot;!&quot; and TODO comments</font></i>
  } <b><font color=#3a6797>else</font></b> {
    <font color=#1b1baa>$txt</font> tag add tagCMN <font color=#1b1baa>$ln</font>.<font color=#1b1baa>$k</font> <font color=#1b1baa>$ln</font>.end
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightLine'>HighlightLine</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlightes a line in text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightLine</span> <span class='ruff_arg'>txt ln prevQtd</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>ln</code></code></td><td class='ruff_defitem'>line's number</td></tr>
<tr><td class='ruff_defitem'><code><code>prevQtd</code></code></td><td class='ruff_defitem'>flag of &quot;being quoted&quot; from the previous line</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_22' href="javascript:toggleSource('22')">Show source</a></p>
<div id='22' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::HighlightLine {txt ln prevQtd} {

  <i><font color=#4b5d50># Highlightes a line in text.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   ln - line's number</font></i>
  <i><font color=#4b5d50>#   prevQtd - flag of &quot;being quoted&quot; from the previous line</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> line [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$ln</font>.0 <font color=#1b1baa>$ln</font>.end]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prevQtd</font>==-1} {  ;<i><font color=#4b5d50># comments continued</font></i>
    HighlightComment <font color=#1b1baa>$txt</font> <font color=#1b1baa>$line</font> <font color=#1b1baa>$ln</font> 0
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> end] ne <font color=#7d1a1a>&quot;\\&quot;</font>} {<b><font color=#3a6797>set</font></b> prevQtd 0}
    <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$prevQtd</font>
  }
  <b><font color=#3a6797>set</font></b> currQtd <font color=#1b1baa>$prevQtd</font>  ;<i><font color=#4b5d50># current state of being quoted</font></i>
  <b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>set</font></b> pri [<b><font color=#3a6797>set</font></b> lasti 0]]
  <b><font color=#3a6797>set</font></b> k -1
  <b><font color=#3a6797>while</font></b> {1} {
    <b><font color=#3a6797>if</font></b> {![FirstQtd line i <font color=#1b1baa>$currQtd</font>]} <b><font color=#3a6797>break</font></b>
    <b><font color=#3a6797>set</font></b> lasti <font color=#1b1baa>$i</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$currQtd</font>} {
      HighlightStr <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln</font>.<font color=#1b1baa>$pri</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>ln.<font color=#1b1baa>$</font>i +1 char&quot;</font>
      <b><font color=#3a6797>set</font></b> currQtd 0
      <b><font color=#3a6797>incr</font></b> lasti
      <b><font color=#3a6797>if</font></b> {[AuxEnding j line lasti]} {
        <b><font color=#3a6797>set</font></b> i <font color=#1b1baa>$lasti</font>
        <b><font color=#3a6797>set</font></b> st [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> <font color=#1b1baa>$i</font> <font color=#1b1baa>$j</font>]
        <b><font color=#3a6797>set</font></b> it 0
        <b><font color=#3a6797>if</font></b> {[FirstQtd st it <font color=#1b1baa>$currQtd</font>]} <b><font color=#3a6797>continue</font></b>  ;<i><font color=#4b5d50># there is a quote yet</font></i>
        <b><font color=#3a6797>set</font></b> k <font color=#1b1baa>$j</font>
        <b><font color=#3a6797>break</font></b>
      }
    } <b><font color=#3a6797>else</font></b> {
      <b><font color=#3a6797>if</font></b> {[AuxEnding j line pri] && <font color=#1b1baa>$j</font>&lt;<font color=#1b1baa>$i</font>} {
        <b><font color=#3a6797>set</font></b> lasti <font color=#1b1baa>$pri</font>
        <b><font color=#3a6797>set</font></b> k <font color=#1b1baa>$j</font>
        <b><font color=#3a6797>break</font></b>
      }
      HighlightCmd <font color=#1b1baa>$txt</font> <font color=#1b1baa>$line</font> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$pri</font> <font color=#1b1baa>$i</font>
      <b><font color=#3a6797>set</font></b> currQtd 1
    }
    <b><font color=#3a6797>set</font></b> pri <font color=#1b1baa>$i</font>
    <b><font color=#3a6797>incr</font></b> i
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$currQtd</font>} {
    HighlightStr <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln</font>.<font color=#1b1baa>$pri</font> <font color=#1b1baa>$ln</font>.end
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$k</font>&gt;-1 || [AuxEnding k line lasti]} {
    HighlightCmd <font color=#1b1baa>$txt</font> <font color=#1b1baa>$line</font> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$lasti</font> <font color=#1b1baa>$k</font>
    HighlightComment <font color=#1b1baa>$txt</font> <font color=#1b1baa>$line</font> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$k</font>
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> end] eq <font color=#7d1a1a>&quot;\\&quot;</font>} {<b><font color=#3a6797>set</font></b> currQtd -1}
  } <b><font color=#3a6797>else</font></b> {
    HighlightCmd <font color=#1b1baa>$txt</font> <font color=#1b1baa>$line</font> <font color=#1b1baa>$ln</font> <font color=#1b1baa>$lasti</font> [<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]
  }
  <b><font color=#3a6797>if</font></b> {!<font color=#1b1baa>$data(MULTILINE,$txt)</font> && <font color=#1b1baa>$currQtd</font> && [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> end] ne <font color=#7d1a1a>&quot;\\&quot;</font>} {
    <b><font color=#3a6797>set</font></b> currQtd 0
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$currQtd</font>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::HighlightStr'>HighlightStr</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Highlights strings.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>HighlightStr</span> <span class='ruff_arg'>txt p1 p2</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>p1</code></code></td><td class='ruff_defitem'>starting index of the string in 'txt'</td></tr>
<tr><td class='ruff_defitem'><code><code>p2</code></code></td><td class='ruff_defitem'>ending index of the string in 'txt'</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_23' href="javascript:toggleSource('23')">Show source</a></p>
<div id='23' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::HighlightStr {txt p1 p2} {

  <i><font color=#4b5d50># Highlights strings.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   p1 - starting index of the string in 'txt'</font></i>
  <i><font color=#4b5d50>#   p2 - ending index of the string in 'txt'</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> p1 [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$p1</font>]
  <b><font color=#3a6797>set</font></b> p2 [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$p2</font>]
  <font color=#1b1baa>$txt</font> tag add tagSTR <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font>
  <b><font color=#3a6797>set</font></b> st [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font>]
  <b><font color=#3a6797>set</font></b> lcom [<b><font color=#3a6797>regexp</font></b> <font color=#6c3e67>-inline</font> <font color=#6c3e67>-all</font> <font color=#6c3e67>-indices</font> <font color=#1b1baa>$data(RE5)</font> <font color=#1b1baa>$st</font>]
  <b><font color=#3a6797>foreach</font></b> {lc g1 g2} <font color=#1b1baa>$lcom</font> {
    <b><font color=#3a6797>lassign</font></b> <font color=#1b1baa>$lc</font> i1 i2
    <b><font color=#3a6797>incr</font></b> i2
    <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$i1</font>&lt;<font color=#1b1baa>$i2</font>} {
      <b><font color=#3a6797>incr</font></b> i1
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> first [<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$st</font> <font color=#1b1baa>$i1</font>] <font color=#7d1a1a>&quot;\[\]\$\{\}&quot;</font>]&gt;-1} {
        <b><font color=#3a6797>set</font></b> i12 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$i1</font>+1}]
        <font color=#1b1baa>$txt</font> tag add tagVAR <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>p1 +<font color=#1b1baa>$</font>i1 char&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>p1 +<font color=#1b1baa>$</font>i12 char&quot;</font>
      }
    }
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::InRange'>InRange</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if a text position is in a range of text positions.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>InRange</span> <span class='ruff_arg'>p1 p2 l ?c?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>p1</code></code></td><td class='ruff_defitem'>1st position of range</td></tr>
<tr><td class='ruff_defitem'><code><code>p2</code></code></td><td class='ruff_defitem'>2nd position of range</td></tr>
<tr><td class='ruff_defitem'><code><code>l</code></code></td><td class='ruff_defitem'>line position to check (or 'l.c' if 'c' not set)</td></tr>
<tr><td class='ruff_defitem'><code><code>c</code></code></td><td class='ruff_defitem'>column position to check; <i>optional, default</i> <code>-1</code></td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_24' href="javascript:toggleSource('24')">Show source</a></p>
<div id='24' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::InRange {p1 p2 l {c -1}} {

  <i><font color=#4b5d50># Checks if a text position is in a range of text positions.</font></i>
  <i><font color=#4b5d50>#   p1 - 1st position of range</font></i>
  <i><font color=#4b5d50>#   p2 - 2nd position of range</font></i>
  <i><font color=#4b5d50>#   l - line position to check (or 'l.c' if 'c' not set)</font></i>
  <i><font color=#4b5d50>#   c - column position to check</font></i>

  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$c</font>==-1} {<b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$l</font> .] l c}
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$p1</font> .] l1 c1
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$p2</font> .] l2 c2
  <b><font color=#3a6797>incr</font></b> c2 -1 ;<i><font color=#4b5d50># text ranges are not right-inclusive</font></i>
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {  (<font color=#1b1baa>$l</font>&gt;=<font color=#1b1baa>$l1</font> && <font color=#1b1baa>$l</font>&lt;<font color=#1b1baa>$l2</font> && <font color=#1b1baa>$c</font>&gt;=<font color=#1b1baa>$c1</font>) || (<font color=#1b1baa>$l</font>&gt;<font color=#1b1baa>$l1</font> && <font color=#1b1baa>$l</font>&lt;=<font color=#1b1baa>$l2</font> && <font color=#1b1baa>$c</font>&lt;=<font color=#1b1baa>$c2</font>) ||
    (<font color=#1b1baa>$l</font>==<font color=#1b1baa>$l1</font> && <font color=#1b1baa>$l1</font>==<font color=#1b1baa>$l2</font> && <font color=#1b1baa>$c</font>&gt;=<font color=#1b1baa>$c1</font> && <font color=#1b1baa>$c</font>&lt;=<font color=#1b1baa>$c2</font>) || (<font color=#1b1baa>$l</font>&gt;<font color=#1b1baa>$l1</font> && <font color=#1b1baa>$l</font>&lt;<font color=#1b1baa>$l2</font>)}]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::LineState'>LineState</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Gets an initial state of line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>LineState</span> <span class='ruff_arg'>txt tSTR tCMN l1</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>tSTR</code></code></td><td class='ruff_defitem'>ranges of string tags</td></tr>
<tr><td class='ruff_defitem'><code><code>tCMN</code></code></td><td class='ruff_defitem'>ranges of comment tags</td></tr>
<tr><td class='ruff_defitem'><code><code>l1</code></code></td><td class='ruff_defitem'>the line's index</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Returns: 0 if no tags for the line; 1 if the line is a string's continuation; -1 if the line is a comment's continuation.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_25' href="javascript:toggleSource('25')">Show source</a></p>
<div id='25' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::LineState {txt tSTR tCMN l1} {

  <i><font color=#4b5d50># Gets an initial state of line.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   tSTR - ranges of string tags</font></i>
  <i><font color=#4b5d50>#   tCMN - ranges of comment tags</font></i>
  <i><font color=#4b5d50>#   l1 - the line's index</font></i>
  <i><font color=#4b5d50># Returns: 0 if no tags for the line; 1 if the line is a string's continuation; -1 if the line is a comment's continuation.</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> i1 [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$l1</font>]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> prev [<b><font color=#3a6797>string</font></b> first -1 <font color=#1b1baa>$l1</font>]]&gt;-1} {
    <b><font color=#3a6797>set</font></b> i1 [<font color=#1b1baa>$txt</font> index <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>i1 -1 chars&quot;</font>]
  }
  <b><font color=#3a6797>set</font></b> ch [<font color=#1b1baa>$txt</font> get <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>i1&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>i1 +1 chars&quot;</font>]
  <b><font color=#3a6797>if</font></b> {[SearchTag <font color=#1b1baa>$tCMN</font> [<font color=#1b1baa>$txt</font> index <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>i1 -1 chars&quot;</font>]]!=-1} {  ;<i><font color=#4b5d50># is a comment continues?</font></i>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ch</font> eq <font color=#7d1a1a>&quot;\\&quot;</font>} {<b><font color=#ca14ca>return</font></b> -1}
  } <b><font color=#3a6797>elseif</font></b> {<font color=#1b1baa>$data(MULTILINE,$txt)</font> || <font color=#1b1baa>$ch</font> eq <font color=#7d1a1a>&quot;\\&quot;</font>} {         ;<i><font color=#4b5d50># is a string continues?</font></i>
    <b><font color=#3a6797>set</font></b> nl [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$l1</font> .] 0]
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$prev</font>&gt;-1} {
      <i><font color=#4b5d50># is the start of line quoted?</font></i>
      <i><font color=#4b5d50># Tk tag ranges refer only to non-empty lines</font></i>
      <i><font color=#4b5d50># =&gt; previous two non-empty chars' coordinates are needed</font></i>
      <i><font color=#4b5d50># to analize whether they:</font></i>
      <i><font color=#4b5d50># - end the range</font></i>
      <i><font color=#4b5d50># - are inside of the range</font></i>
      <i><font color=#4b5d50># - begin the range</font></i>
      <b><font color=#3a6797>set</font></b> co1 [<b><font color=#3a6797>set</font></b> co2 {}]
      <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$nl</font>&gt;1} {
        <b><font color=#3a6797>incr</font></b> nl -1
        <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> line [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$nl</font>.0 <font color=#1b1baa>$nl</font>.end]] ne {}} {
          <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$co2</font> eq {}} {
            <b><font color=#3a6797>set</font></b> co2 [<font color=#1b1baa>$txt</font> index <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>nl.end -1 char&quot;</font>]
            <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]&gt;1} {
              <b><font color=#3a6797>set</font></b> co1 [<font color=#1b1baa>$txt</font> index <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>nl.end -2 char&quot;</font>]
              <b><font color=#3a6797>break</font></b>
            }
          } <b><font color=#3a6797>else</font></b> {
            <b><font color=#3a6797>set</font></b> co1 [<font color=#1b1baa>$txt</font> index <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>nl.end -1 char&quot;</font>]
            <b><font color=#3a6797>break</font></b>
          }
        }
      }
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$co2</font> eq {}} {<b><font color=#ca14ca>return</font></b> 0}   {<b><font color=#3a6797>set</font></b> f2 [<b><font color=#3a6797>expr</font></b> {[SearchTag <font color=#1b1baa>$tSTR</font> <font color=#1b1baa>$co2</font>]!=-1}]}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$co1</font> eq {}} {<b><font color=#3a6797>set</font></b> f1 <font color=#1b1baa>$f2</font>} {<b><font color=#3a6797>set</font></b> f1 [<b><font color=#3a6797>expr</font></b> {[SearchTag <font color=#1b1baa>$tSTR</font> <font color=#1b1baa>$co1</font>]!=-1}]}
      <b><font color=#3a6797>set</font></b> ch [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$co2</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>co2 +1 chars&quot;</font>]
      <b><font color=#3a6797>set</font></b> c [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$co2</font>] .] 1]
      <b><font color=#3a6797>if</font></b> {![NotEscaped <font color=#1b1baa>$line</font> <font color=#1b1baa>$c</font>]} {<b><font color=#3a6797>set</font></b> ch {}}
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$ch</font> ne {&quot;} && <font color=#1b1baa>$f2</font> || <font color=#1b1baa>$ch</font> eq {&quot;} && !<font color=#1b1baa>$f1</font>}]
    }
    <i><font color=#4b5d50># is the end of line quoted?</font></i>
    <b><font color=#3a6797>set</font></b> line {}
    <b><font color=#3a6797>set</font></b> nltot [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$txt</font> index end] .] 0]
    <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$nl</font>&lt;<font color=#1b1baa>$nltot</font>} {
      <b><font color=#3a6797>incr</font></b> nl
      <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> line [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$nl</font>.0 <font color=#1b1baa>$nl</font>.end]] ne {}} <b><font color=#3a6797>break</font></b>
    }
    <b><font color=#3a6797>set</font></b> i1 <font color=#1b1baa>$nl</font>.0
    <b><font color=#3a6797>set</font></b> ch [<font color=#1b1baa>$txt</font> get <font color=#1b1baa>$i1</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>i1 +1 chars&quot;</font>]
    <b><font color=#3a6797>set</font></b> c [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>split</font></b> [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$i1</font>] .] 1]
    <b><font color=#3a6797>if</font></b> {![NotEscaped <font color=#1b1baa>$line</font> <font color=#1b1baa>$c</font>]} {<b><font color=#3a6797>set</font></b> ch {}}
    <b><font color=#3a6797>set</font></b> f1 [<b><font color=#3a6797>expr</font></b> {[SearchTag <font color=#1b1baa>$tSTR</font> [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$i1</font>]]!=-1}]
    <b><font color=#3a6797>set</font></b> f2 [<b><font color=#3a6797>expr</font></b> {[SearchTag <font color=#1b1baa>$tSTR</font> [<font color=#1b1baa>$txt</font> index <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>i1 +1 chars&quot;</font>]]!=-1}]
    <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$ch</font> ne {&quot;} && <font color=#1b1baa>$f1</font> || <font color=#1b1baa>$ch</font> eq {&quot;} && !<font color=#1b1baa>$f2</font>}]
  }
  <b><font color=#ca14ca>return</font></b> 0
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::MatchedBrackets'>MatchedBrackets</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Finds a match of characters (dchar for schar).</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MatchedBrackets</span> <span class='ruff_arg'>inplist curpos schar dchar dir</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>inplist</code></code></td><td class='ruff_defitem'>list of strings where to find a match</td></tr>
<tr><td class='ruff_defitem'><code><code>curpos</code></code></td><td class='ruff_defitem'>position of schar in nl.nc form where nl=1.., nc=0..</td></tr>
<tr><td class='ruff_defitem'><code><code>schar</code></code></td><td class='ruff_defitem'>source character</td></tr>
<tr><td class='ruff_defitem'><code><code>dchar</code></code></td><td class='ruff_defitem'>destination character</td></tr>
<tr><td class='ruff_defitem'><code><code>dir</code></code></td><td class='ruff_defitem'>search direction: 1 to the end, -1 to the beginning of list</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_26' href="javascript:toggleSource('26')">Show source</a></p>
<div id='26' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::MatchedBrackets {inplist curpos schar dchar dir} {

  <i><font color=#4b5d50># Finds a match of characters (dchar for schar).</font></i>
  <i><font color=#4b5d50>#   inplist - list of strings where to find a match</font></i>
  <i><font color=#4b5d50>#   curpos - position of schar in nl.nc form where nl=1.., nc=0..</font></i>
  <i><font color=#4b5d50>#   schar - source character</font></i>
  <i><font color=#4b5d50>#   dchar - destination character</font></i>
  <i><font color=#4b5d50>#   dir - search direction: 1 to the end, -1 to the beginning of list</font></i>

  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$curpos</font> .] nl nc
  <b><font color=#3a6797>set</font></b> escaped [Escaped [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$inplist</font> <font color=#1b1baa>$nl</font>-1] <font color=#1b1baa>$nc</font>]
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$dir</font>==1} {<b><font color=#3a6797>set</font></b> rng1 <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>nc end&quot;</font>} <b><font color=#3a6797>else</font></b> {<b><font color=#3a6797>set</font></b> rng1 <font color=#7d1a1a>&quot;0 <font color=#1b1baa>$</font>nc&quot;</font>; <b><font color=#3a6797>set</font></b> nc 0}
  <b><font color=#3a6797>set</font></b> retpos {}
  <b><font color=#3a6797>set</font></b> scount [<b><font color=#3a6797>set</font></b> dcount 0]
  <b><font color=#3a6797>incr</font></b> nl -1
  <b><font color=#3a6797>set</font></b> inplen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$inplist</font>]
  <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$nl</font>&gt;=0 && <font color=#1b1baa>$nl</font>&lt;<font color=#1b1baa>$inplen</font>} {
    <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$inplist</font> <font color=#1b1baa>$nl</font>]
    <b><font color=#3a6797>set</font></b> line [<b><font color=#3a6797>string</font></b> range <font color=#1b1baa>$line</font> {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$rng1</font>]
    <b><font color=#3a6797>set</font></b> sc [CountChar <font color=#1b1baa>$line</font> <font color=#1b1baa>$schar</font> slist <font color=#1b1baa>$escaped</font>]
    <b><font color=#3a6797>set</font></b> dc [CountChar <font color=#1b1baa>$line</font> <font color=#1b1baa>$dchar</font> dlist <font color=#1b1baa>$escaped</font>]
    <b><font color=#3a6797>set</font></b> plen [<b><font color=#3a6797>llength</font></b> [<b><font color=#3a6797>set</font></b> plist [MergePosList -1 <font color=#1b1baa>$slist</font> <font color=#1b1baa>$dlist</font>]]]
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$dir</font>&gt;0?0:(<font color=#1b1baa>$plen</font>-1)}]} {<font color=#1b1baa>$i</font>&gt;=0 && <font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$plen</font>} {<b><font color=#3a6797>incr</font></b> i <font color=#1b1baa>$dir</font>} {
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$plist</font> <font color=#1b1baa>$i</font>] src pos
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$src</font>} {<b><font color=#3a6797>incr</font></b> dcount} {<b><font color=#3a6797>incr</font></b> scount}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$scount</font> &lt;= <font color=#1b1baa>$dcount</font>} {
        <b><font color=#3a6797>set</font></b> retpos [<b><font color=#3a6797>incr</font></b> nl].[<b><font color=#3a6797>incr</font></b> pos <font color=#1b1baa>$nc</font>]
        <b><font color=#3a6797>break</font></b>
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$retpos</font> ne {}} <b><font color=#3a6797>break</font></b>
    <b><font color=#3a6797>set</font></b> nc 0
    <b><font color=#3a6797>set</font></b> rng1 {0 end}
    <b><font color=#3a6797>incr</font></b> nl <font color=#1b1baa>$dir</font>
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$retpos</font>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::MemPos'>MemPos</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Remembers the state of current line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MemPos</span> <span class='ruff_arg'>txt ?doit?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>doit</code></code></td><td class='ruff_defitem'>argument for ShowCurrentLine; <i>optional, default</i> <code>no</code></td></tr>
</table>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::ShowCurrentLine" title="ShowCurrentLine" class='ruff_cmd'>ShowCurrentLine</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_27' href="javascript:toggleSource('27')">Show source</a></p>
<div id='27' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::MemPos {txt {doit no}} {

  <i><font color=#4b5d50># Remembers the state of current line.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   doit - argument for ShowCurrentLine</font></i>
  <i><font color=#4b5d50># See also: ShowCurrentLine</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> data(_INSPOS_,<font color=#1b1baa>$txt</font>) [MemPos1 <font color=#1b1baa>$txt</font> no]
  <b><font color=#3a6797>set</font></b> ln [ShowCurrentLine <font color=#1b1baa>$txt</font> <font color=#1b1baa>$doit</font>]
  <b><font color=#3a6797>set</font></b> data(CUR_LEN,<font color=#1b1baa>$txt</font>) [<font color=#1b1baa>$txt</font> index {end -1 char}]
  <b><font color=#3a6797>lassign</font></b> [CountQSH <font color=#1b1baa>$txt</font> <font color=#1b1baa>$ln</font>]  data(CNT_QUOTE,<font color=#1b1baa>$txt</font>) data(CNT_SLASH,<font color=#1b1baa>$txt</font>) data(CNT_COMMENT,<font color=#1b1baa>$txt</font>)
  <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$txt</font> tag ranges tagBRACKET] ne {}}    {<font color=#1b1baa>$txt</font> tag remove tagBRACKET 1.0 end}
  <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$txt</font> tag ranges tagBRACKETERR] ne {}} {<font color=#1b1baa>$txt</font> tag remove tagBRACKETERR 1.0 end}
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>set</font></b> cmd <font color=#1b1baa>$data(CMDPOS,$txt)</font>] ne {}} {
    <i><font color=#4b5d50># run a command after changing position (with the state as arguments)</font></i>
    <b><font color=#3a6797>append</font></b> cmd <font color=#7d1a1a>&quot; <font color=#1b1baa>$</font>txt <font color=#1b1baa>$</font>data(CUR_LEN,<font color=#1b1baa>$</font>txt) <font color=#1b1baa>$</font>ln <font color=#1b1baa>$</font>data(CNT_QUOTE,<font color=#1b1baa>$</font>txt)  <font color=#1b1baa>$</font>data(CNT_SLASH,<font color=#1b1baa>$</font>txt) <font color=#1b1baa>$</font>data(CNT_COMMENT,<font color=#1b1baa>$</font>txt)&quot;</font>
    <b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$data(CMDATFER,$txt)</font>}
    <b><font color=#3a6797>set</font></b> data(CMDATFER,<font color=#1b1baa>$txt</font>) [<b><font color=#3a6797>after</font></b> idle <font color=#1b1baa>$cmd</font>]
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::MemPos1'>MemPos1</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks and sets the cursor's width, depending on its position.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MemPos1</span> <span class='ruff_arg'>txt ?donorm? ?K? ?s?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>donorm</code></code></td><td class='ruff_defitem'>if yes, forces &quot;normal&quot; cursor; <i>optional, default</i> <code>yes</code></td></tr>
<tr><td class='ruff_defitem'><code><code>K</code></code></td><td class='ruff_defitem'>key (%K of bind); <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
<tr><td class='ruff_defitem'><code><code>s</code></code></td><td class='ruff_defitem'>state (%s of bind); <i>optional, default</i> <code>&quot;&quot;</code></td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>This fixes an issue with text cursor: less width at 0th column.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_28' href="javascript:toggleSource('28')">Show source</a></p>
<div id='28' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::MemPos1 {txt {donorm yes} {K {}} {s {}}} {

  <i><font color=#4b5d50># Checks and sets the cursor's width, depending on its position.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   donorm - if yes, forces &quot;normal&quot; cursor</font></i>
  <i><font color=#4b5d50>#   K - key (%K of bind)</font></i>
  <i><font color=#4b5d50>#   s - state (%s of bind)</font></i>
  <i><font color=#4b5d50># This fixes an issue with text cursor: less width at 0th column.</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$K</font> eq {Home} && [<b><font color=#3a6797>string</font></b> is digit <font color=#6c3e67>-strict</font> <font color=#1b1baa>$s</font>] &&  [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$s</font> & 4}]==0 && [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$s</font> & 1}]==0} {
    <i><font color=#4b5d50># Ctrl-Home & Shift-Home are passed</font></i>
    <b><font color=#3a6797>set</font></b> p1 [<font color=#1b1baa>$txt</font> index insert]
    <b><font color=#3a6797>set</font></b> line [<font color=#1b1baa>$txt</font> get <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>p1 linestart&quot;</font> <font color=#7d1a1a>&quot;<font color=#1b1baa>$</font>p1 lineend&quot;</font>]
    <b><font color=#3a6797>set</font></b> p [<b><font color=#3a6797>expr</font></b> {[<b><font color=#3a6797>string</font></b> length <font color=#1b1baa>$line</font>]-[<b><font color=#3a6797>string</font></b> length [<b><font color=#3a6797>string</font></b> trimleft <font color=#1b1baa>$line</font>]]}]
    <b><font color=#3a6797>set</font></b> p2 [<b><font color=#3a6797>expr</font></b> {int(<font color=#1b1baa>$p1</font>)}].<font color=#1b1baa>$p</font>
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$p</font> && <font color=#1b1baa>$p2</font> ne <font color=#1b1baa>$p1</font>} {
      <b><font color=#3a6797>after</font></b> idle <font color=#7d1a1a>&quot;::tk::TextSetCursor <font color=#1b1baa>$</font>txt <font color=#1b1baa>$</font>p2&quot;</font>
      <b><font color=#ca14ca>return</font></b> 0
    }
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(INSERTWIDTH,$txt)</font>==1} {
    <b><font color=#3a6797>if</font></b> {[<font color=#1b1baa>$txt</font> cget <font color=#6c3e67>-insertwidth</font>]!=1} {<font color=#1b1baa>$txt</font> configure <font color=#6c3e67>-insertwidth</font> 1}
    <b><font color=#ca14ca>return</font></b> 0
  }
  <b><font color=#3a6797>set</font></b> insLC [<font color=#1b1baa>$txt</font> index insert]
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$insLC</font> .] L C
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(_INSPOS_,$txt)</font> eq {}} {
    <b><font color=#3a6797>set</font></b> L2 [<b><font color=#3a6797>set</font></b> C2 0]
  } <b><font color=#3a6797>else</font></b> {
    <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$data(_INSPOS_,$txt)</font> .] L2 C2
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$L</font>!=<font color=#1b1baa>$L2</font> || <font color=#1b1baa>$C</font>==0 || <font color=#1b1baa>$C2</font>==0} {
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$C</font> || <font color=#1b1baa>$donorm</font>} {
      <font color=#1b1baa>$txt</font> configure <font color=#6c3e67>-insertwidth</font> <font color=#1b1baa>$data(INSERTWIDTH,$txt)</font>
    } <b><font color=#3a6797>else</font></b> {
      <font color=#1b1baa>$txt</font> configure <font color=#6c3e67>-insertwidth</font> [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$data(INSERTWIDTH,$txt)</font>*2-1}]
    }
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$insLC</font>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::MergePosList'>MergePosList</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Merges lists of numbers that are not-coinciding and sorted.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>MergePosList</span> <span class='ruff_arg'>none ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>none</code></code></td><td class='ruff_defitem'>a number to be not allowed in the lists (e.g. less than minimal)</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>list of the lists to be merged</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a list of pairs: index of list + item of list.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_29' href="javascript:toggleSource('29')">Show source</a></p>
<div id='29' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::MergePosList {none args} {

  <i><font color=#4b5d50># Merges lists of numbers that are not-coinciding and sorted.</font></i>
  <i><font color=#4b5d50>#   none - a number to be not allowed in the lists (e.g. less than minimal)</font></i>
  <i><font color=#4b5d50>#   args - list of the lists to be merged</font></i>
  <i><font color=#4b5d50># Returns a list of pairs: index of list + item of list.</font></i>

  <b><font color=#3a6797>set</font></b> itot [<b><font color=#3a6797>set</font></b> ilist 0]
  <b><font color=#3a6797>set</font></b> lind [<b><font color=#3a6797>set</font></b> lout [<b><font color=#3a6797>list</font></b>]]
  <b><font color=#3a6797>foreach</font></b> lst <font color=#1b1baa>$args</font> {
    <b><font color=#3a6797>incr</font></b> ilist
    <b><font color=#3a6797>incr</font></b> itot [<b><font color=#3a6797>set</font></b> llen [<b><font color=#3a6797>llength</font></b> <font color=#1b1baa>$lst</font>]]
    <b><font color=#3a6797>lappend</font></b> lind [<b><font color=#3a6797>list</font></b> 0 <font color=#1b1baa>$llen</font>]
  }
  <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> i 0} {<font color=#1b1baa>$i</font>&lt;<font color=#1b1baa>$itot</font>} {<b><font color=#3a6797>incr</font></b> i} {
    <b><font color=#3a6797>set</font></b> min <font color=#1b1baa>$none</font>
    <b><font color=#3a6797>set</font></b> ind -1
    <b><font color=#3a6797>for</font></b> {<b><font color=#3a6797>set</font></b> k 0} {<font color=#1b1baa>$k</font>&lt;<font color=#1b1baa>$ilist</font>} {<b><font color=#3a6797>incr</font></b> k} {
      <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$lind</font> <font color=#1b1baa>$k</font>] li llen
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$li</font> &lt; <font color=#1b1baa>$llen</font>} {
        <b><font color=#3a6797>set</font></b> e [<b><font color=#3a6797>lindex</font></b> [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> <font color=#1b1baa>$k</font>] <font color=#1b1baa>$li</font>]
        <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$min</font> == <font color=#1b1baa>$none</font> || <font color=#1b1baa>$min</font> &gt; <font color=#1b1baa>$e</font>} {
          <b><font color=#3a6797>set</font></b> ind <font color=#1b1baa>$k</font>
          <b><font color=#3a6797>set</font></b> min <font color=#1b1baa>$e</font>
          <b><font color=#3a6797>set</font></b> savli [<b><font color=#3a6797>incr</font></b> li]
          <b><font color=#3a6797>set</font></b> savlen <font color=#1b1baa>$llen</font>
        }
      }
    }
    <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ind</font> == -1} {<b><font color=#ca14ca>return</font></b> <font color=#6c3e67>-code</font> error {Error: probably in the input data}}
    <b><font color=#3a6797>lset</font></b> lind <font color=#1b1baa>$ind</font> [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$savli</font> <font color=#1b1baa>$savlen</font>]
    <b><font color=#3a6797>lappend</font></b> lout [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$ind</font> <font color=#1b1baa>$min</font>]
  }
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$lout</font>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::Modified'>Modified</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Handles modifications of text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>Modified</span> <span class='ruff_arg'>txt oper pos1 ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>oper</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>pos1</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<h5 class='ruff'>Description</h5><p class='ruff'>Makes a coroutine from this.</p>
<h5 class='ruff'>See also</h5><p class='ruff'><a href="hl_tcl.html#::hl_tcl::my::CoroModified" title="CoroModified" class='ruff_cmd'>CoroModified</a></p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_30' href="javascript:toggleSource('30')">Show source</a></p>
<div id='30' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::Modified {txt oper pos1 args} {

  <i><font color=#4b5d50># Handles modifications of text.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50># Makes a coroutine from this.</font></i>
  <i><font color=#4b5d50># See also: CoroModified</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> ar2 [<b><font color=#3a6797>lindex</font></b> <font color=#1b1baa>$args</font> 0]
  <b><font color=#3a6797>set</font></b> posins [<font color=#1b1baa>$txt</font> index insert]
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> pos1 [<b><font color=#3a6797>set</font></b> pos2 [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$pos1</font>]]}]} {
    <b><font color=#3a6797>set</font></b> pos1 [<b><font color=#3a6797>set</font></b> pos2 <font color=#1b1baa>$posins</font>]
  }
  <b><font color=#3a6797>switch</font></b> <font color=#1b1baa>$oper</font> {
    insert {
      <b><font color=#3a6797>set</font></b> pos2 [<b><font color=#3a6797>expr</font></b> {<font color=#1b1baa>$pos1</font> + [<b><font color=#3a6797>llength</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$ar2</font> \n]]}]
    }
    delete {
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$ar2</font> eq {} || [<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>set</font></b> pos2 [<font color=#1b1baa>$txt</font> index <font color=#1b1baa>$ar2</font>]}]} {
        <b><font color=#3a6797>set</font></b> pos2 <font color=#1b1baa>$posins</font>
      }
    }
  }
  RunCoroAfterIdle <font color=#1b1baa>$txt</font> <font color=#1b1baa>$pos1</font> <font color=#1b1baa>$pos2</font> no {<b><font color=#3a6797>*</font></b>}<font color=#1b1baa>$args</font>
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::NotEscaped'>NotEscaped</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Checks if a character escaped in a line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>NotEscaped</span> <span class='ruff_arg'>line i</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>line</code></code></td><td class='ruff_defitem'>line</td></tr>
<tr><td class='ruff_defitem'><code><code>i</code></code></td><td class='ruff_defitem'>the character's position in 'line'</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns &quot;1&quot; if the character not escaped.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_31' href="javascript:toggleSource('31')">Show source</a></p>
<div id='31' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::NotEscaped {line i} {

  <i><font color=#4b5d50># Checks if a character escaped in a line.</font></i>
  <i><font color=#4b5d50>#   line - line</font></i>
  <i><font color=#4b5d50>#   i - the character's position in 'line'</font></i>
  <i><font color=#4b5d50># Returns &quot;1&quot; if the character not escaped.</font></i>

  <b><font color=#3a6797>set</font></b> cntq 0
  <b><font color=#3a6797>while</font></b> {<font color=#1b1baa>$i</font>&gt;0} {
    <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>string</font></b> index <font color=#1b1baa>$line</font> [<b><font color=#3a6797>incr</font></b> i -1]] ne <font color=#7d1a1a>&quot;\\&quot;</font>} {
      <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {(<font color=#1b1baa>$cntq</font>%2)==0}]
    }
    <b><font color=#3a6797>incr</font></b> cntq
  }
  <b><font color=#ca14ca>return</font></b> [<b><font color=#3a6797>expr</font></b> {(<font color=#1b1baa>$cntq</font>%2)==0}]
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::RemoveTags'>RemoveTags</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Removes tags in text.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>RemoveTags</span> <span class='ruff_arg'>txt from to</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>from</code></code></td><td class='ruff_defitem'>starting index</td></tr>
<tr><td class='ruff_defitem'><code><code>to</code></code></td><td class='ruff_defitem'>ending index</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_32' href="javascript:toggleSource('32')">Show source</a></p>
<div id='32' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::RemoveTags {txt from to} {

  <i><font color=#4b5d50># Removes tags in text.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   from - starting index</font></i>
  <i><font color=#4b5d50>#   to - ending index</font></i>

  <b><font color=#3a6797>foreach</font></b> tag {tagCOM tagCOMTK tagSTR tagVAR tagCMN tagCMN2 tagPROC tagOPT} {
    <font color=#1b1baa>$txt</font> tag remove <font color=#1b1baa>$tag</font> <font color=#1b1baa>$from</font> <font color=#1b1baa>$to</font>
  }
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::RunCoroAfterIdle'>RunCoroAfterIdle</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Runs a &quot;modified&quot; corotine after idle.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>RunCoroAfterIdle</span> <span class='ruff_arg'>txt pos1 pos2 wait ?args?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>pos1</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>pos2</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>wait</code></code></td><td class='ruff_defitem'>Not documented.</td></tr>
<tr><td class='ruff_defitem'><code><code>args</code></code></td><td class='ruff_defitem'>Optional arguments.</td></tr>
</table>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_33' href="javascript:toggleSource('33')">Show source</a></p>
<div id='33' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::RunCoroAfterIdle {txt pos1 pos2 wait args} {

  <i><font color=#4b5d50># Runs a &quot;modified&quot; corotine after idle.</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$wait</font>} {
    <b><font color=#3a6797>catch</font></b> {
      <b><font color=#3a6797>after</font></b> cancel <font color=#1b1baa>$data(COROAFTER,$txt)</font>
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(COROPOS1,$txt)</font> &lt; <font color=#1b1baa>$pos1</font>} {<b><font color=#3a6797>set</font></b> pos1 <font color=#1b1baa>$data(COROPOS1,$txt)</font>}
      <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$data(COROPOS2,$txt)</font> &gt; <font color=#1b1baa>$pos2</font>} {<b><font color=#3a6797>set</font></b> pos2 <font color=#1b1baa>$data(COROPOS2,$txt)</font>}
    }
    <b><font color=#3a6797>set</font></b> data(COROPOS1,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$pos1</font>
    <b><font color=#3a6797>set</font></b> data(COROPOS2,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$pos2</font>
  }
  <b><font color=#3a6797>set</font></b> data(COROAFTER,<font color=#1b1baa>$txt</font>) [<b><font color=#3a6797>after</font></b> idle <font color=#7d1a1a>&quot;::hl_tcl::my::CoroRun <font color=#1b1baa>$</font>txt <font color=#1b1baa>$</font>pos1 <font color=#1b1baa>$</font>pos2 <font color=#1b1baa>$</font>args&quot;</font>]
  <b><font color=#ca14ca>return</font></b>
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::SearchTag'>SearchTag</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Searches a position in tag ranges.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>SearchTag</span> <span class='ruff_arg'>tagpos l1</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>tagpos</code></code></td><td class='ruff_defitem'>tag position ranges</td></tr>
<tr><td class='ruff_defitem'><code><code>l1</code></code></td><td class='ruff_defitem'>the position to find</td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a found range's index of -1 if not found.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_34' href="javascript:toggleSource('34')">Show source</a></p>
<div id='34' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::SearchTag {tagpos l1} {

  <i><font color=#4b5d50># Searches a position in tag ranges.</font></i>
  <i><font color=#4b5d50>#   tagpos - tag position ranges</font></i>
  <i><font color=#4b5d50>#   l1 - the position to find</font></i>
  <i><font color=#4b5d50># Returns a found range's index of -1 if not found.</font></i>

  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$l1</font> .] l c
  <b><font color=#3a6797>set</font></b> i 0
  <b><font color=#3a6797>foreach</font></b> {p1 p2} <font color=#1b1baa>$tagpos</font> {
    <b><font color=#3a6797>if</font></b> {[InRange <font color=#1b1baa>$p1</font> <font color=#1b1baa>$p2</font> <font color=#1b1baa>$l</font> <font color=#1b1baa>$c</font>]} {<b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$i</font>}
    <b><font color=#3a6797>incr</font></b> i 2
  }
  <b><font color=#ca14ca>return</font></b> -1
}<br><br></code></pre></div>
</div><br><br><br><h4 class='ruffproc'><a name='::hl_tcl::my::ShowCurrentLine'>ShowCurrentLine</a><span class='ns_scope'> [<a href="hl_tcl.html#::hl_tcl::my" title="::hl_tcl::my" class='ruff_cmd'>::hl_tcl::my</a>]</span><span class='tinylink'><a href='hl_tcl.html#::hl_tcl::my'>my</a>, <a href='#top'>Top</a></span></h4>
<div style='clear:both;'></div>
<p class='ruff'>Shows the current line.</p>
<div class='ruff_synopsis'><span class='ruff_cmd'>ShowCurrentLine</span> <span class='ruff_arg'>txt ?doit?</span></div>
<h5 class='ruff'>Parameters</h5><table class='ruff_deflist'>
<tr><td class='ruff_defitem'><code><code>txt</code></code></td><td class='ruff_defitem'>text widget's path</td></tr>
<tr><td class='ruff_defitem'><code><code>doit</code></code></td><td class='ruff_defitem'>if yes, forces updating current line's background; <i>optional, default</i> <code>no</code></td></tr>
</table>
<h5 class='ruff'>Return value</h5><p class='ruff'>Returns a current position of cursor.</p>
<div class='ruff_source'><p class='ruff_source_link'><a id='l_35' href="javascript:toggleSource('35')">Show source</a></p>
<div id='35' class='ruff_dyn_src'><pre><br><code class="tcl"><b><font color=#ca14ca>proc</font></b> ::hl_tcl::my::ShowCurrentLine {txt {doit no}} {

  <i><font color=#4b5d50># Shows the current line.</font></i>
  <i><font color=#4b5d50>#   txt - text widget's path</font></i>
  <i><font color=#4b5d50>#   doit - if yes, forces updating current line's background</font></i>
  <i><font color=#4b5d50># Returns a current position of cursor.</font></i>

  <b><font color=#3a6797>variable</font></b> data
  <b><font color=#3a6797>set</font></b> pos [<font color=#1b1baa>$txt</font> index insert]
  <b><font color=#3a6797>set</font></b> nlines [<b><font color=#3a6797>expr</font></b> {int([<font color=#1b1baa>$txt</font> index end])}]
  <b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$pos</font> .] ln cn
  <b><font color=#3a6797>if</font></b> {[<b><font color=#3a6797>catch</font></b> {<b><font color=#3a6797>lassign</font></b> [<b><font color=#3a6797>split</font></b> <font color=#1b1baa>$data(CURPOS,$txt)</font> .] ln2 cn2}]} {
    <b><font color=#3a6797>set</font></b> ln2 <font color=#1b1baa>$ln</font>
    <b><font color=#3a6797>set</font></b> cn2 <font color=#1b1baa>$cn</font>
    <b><font color=#3a6797>set</font></b> data(CURPOS,<font color=#1b1baa>$txt</font>) [<b><font color=#3a6797>set</font></b> data(NLINES,<font color=#1b1baa>$txt</font>) 0]
  }
  <b><font color=#3a6797>if</font></b> {<font color=#1b1baa>$doit</font> || int(<font color=#1b1baa>$data(CURPOS,$txt)</font>)!=<font color=#1b1baa>$ln</font> || <font color=#1b1baa>$data(NLINES,$txt)</font>!=<font color=#1b1baa>$nlines</font>  || <font color=#1b1baa>$ln</font>!=<font color=#1b1baa>$ln2</font> || abs(<font color=#1b1baa>$cn</font>-<font color=#1b1baa>$cn2</font>)&gt;1 || <font color=#1b1baa>$cn</font>&lt;2} {
    <font color=#1b1baa>$txt</font> tag remove tagCURLINE 1.0 end
    <font color=#1b1baa>$txt</font> tag add tagCURLINE [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$pos</font> linestart] [<b><font color=#3a6797>list</font></b> <font color=#1b1baa>$pos</font> lineend]+1displayindices
  }
  <b><font color=#3a6797>set</font></b> data(NLINES,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$nlines</font>
  <b><font color=#3a6797>set</font></b> data(CURPOS,<font color=#1b1baa>$txt</font>) <font color=#1b1baa>$pos</font>
  <b><font color=#ca14ca>return</font></b> <font color=#1b1baa>$pos</font>
}<br><br></code></pre></div>
</div></div></div><div class='yui-b navbox' ><h1><a href='#::hl_tcl'>hl_tcl</a></h1><h2><a href='#::hl_tcl-Some of blah-blah'>Some of blah-blah</a></h2><h2><a href='#::hl_tcl-Some of editors'>Some of editors</a></h2><h2><a href='#::hl_tcl-What can we do?'>What can we do?</a></h2><h2><a href='#::hl_tcl-Use for text widget'>Use for text widget</a></h2><h2><a href='#::hl_tcl-Use for static html'>Use for static html</a></h2><h2><a href='#::hl_tcl-Links'>Links</a></h2><h2><a href='#::hl_tcl-Commands'>Commands</a></h2><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::addingColors'>addingColors</a><span class='tooltiptext'>Sets/gets colors for a text syntax highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_all'>hl_all</a><span class='tooltiptext'>Updates (&quot;rehighlights&quot;) all highlighted and existing text widgets.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_colorNames'>hl_colorNames</a><span class='tooltiptext'>Returns a list of color names for syntax highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_colors'>hl_colors</a><span class='tooltiptext'>Gets/sets the main colors for highlighting (except for &quot;curr.line&quot;).
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_init'>hl_init</a><span class='tooltiptext'>Initializes highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_line'>hl_line</a><span class='tooltiptext'>Updates a current line's highlighting.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_readonly'>hl_readonly</a><span class='tooltiptext'>Makes the text widget be readonly or gets its 'read-only' state.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::hl_text'>hl_text</a><span class='tooltiptext'>Highlights Tcl code of a text widget.
</span></h4><h1><a href='#::hl_tcl::my'>hl_tcl::my</a></h1><h2><a href='#::hl_tcl::my-Commands'>Commands</a></h2><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::AuxEnding'>AuxEnding</a><span class='tooltiptext'>Auxiliary procedure to process the ending comments in the line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::BindToEvent'>BindToEvent</a><span class='tooltiptext'>Binds an event on a widget to a command.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CoroHighlightAll'>CoroHighlightAll</a><span class='tooltiptext'>Highlights all of a text as a coroutine.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CoroModified'>CoroModified</a><span class='tooltiptext'>Handles modifications of text.
</span></h4><h4><a href='hl_tcl.html#::hl_tcl::my::CoroRun'>CoroRun</a></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CountChar'>CountChar</a><span class='tooltiptext'>Counts a character in a string.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::CountQSH'>CountQSH</a><span class='tooltiptext'>Counts quotes, slashes, hashes in a line
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::Escaped'>Escaped</a><span class='tooltiptext'>Checks if a character is escaped in a string.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::FirstQtd'>FirstQtd</a><span class='tooltiptext'>Searches the quote characters in line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightAll'>HighlightAll</a><span class='tooltiptext'>Highlights all of a text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightBrackets'>HighlightBrackets</a><span class='tooltiptext'>Highlights matching brackets if any.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightCmd'>HighlightCmd</a><span class='tooltiptext'>Highlights Tcl/Tk commands.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightComment'>HighlightComment</a><span class='tooltiptext'>Highlights comments.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightLine'>HighlightLine</a><span class='tooltiptext'>Highlightes a line in text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::HighlightStr'>HighlightStr</a><span class='tooltiptext'>Highlights strings.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::InRange'>InRange</a><span class='tooltiptext'>Checks if a text position is in a range of text positions.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::LineState'>LineState</a><span class='tooltiptext'>Gets an initial state of line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MatchedBrackets'>MatchedBrackets</a><span class='tooltiptext'>Finds a match of characters (dchar for schar).
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MemPos'>MemPos</a><span class='tooltiptext'>Remembers the state of current line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MemPos1'>MemPos1</a><span class='tooltiptext'>Checks and sets the cursor's width, depending on its position.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::MergePosList'>MergePosList</a><span class='tooltiptext'>Merges lists of numbers that are not-coinciding and sorted.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::Modified'>Modified</a><span class='tooltiptext'>Handles modifications of text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::NotEscaped'>NotEscaped</a><span class='tooltiptext'>Checks if a character escaped in a line.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::RemoveTags'>RemoveTags</a><span class='tooltiptext'>Removes tags in text.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::RunCoroAfterIdle'>RunCoroAfterIdle</a><span class='tooltiptext'>Runs a &quot;modified&quot; corotine after idle.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::SearchTag'>SearchTag</a><span class='tooltiptext'>Searches a position in tag ranges.
</span></h4><h4 class='tooltip'><a href='hl_tcl.html#::hl_tcl::my::ShowCurrentLine'>ShowCurrentLine</a><span class='tooltiptext'>Shows the current line.
</span></h4></div></div><div id='ft'><div style='float: right;'>Document generated by <a href='https://ruff.magicsplat.com'>Ruff!</a></div></div>
</div></body></html>
